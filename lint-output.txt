node.exe : `next lint` is 
deprecated and will be removed in 
Next.js 16.
At line:1 char:1
+ & "C:\Program 
Files\nodejs/node.exe" 
"C:\Users\hp14f\AppData\Roaming\ ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSp 
   ecified: (`next lint` is ... in  
   Next.js 16.:String) [], Remote   
 Exception
    + FullyQualifiedErrorId : Nativ 
   eCommandError
 
For new projects, use 
create-next-app to choose your 
preferred linter.
For existing projects, migrate to 
the ESLint CLI:
npx @next/codemod@canary 
next-lint-to-eslint-cli .

[{"filePath":"D:\\UBIG\\Projek\\Pres
ensi-New\\src\\action\\create-organi
zation.ts","messages":[{"ruleId":nul
l,"message":"Unused eslint-disable 
directive (no problems were 
reported from '@typescript-eslint/no
-explicit-any').","line":655,"column
":5,"severity":1,"nodeType":null,"fi
x":{"range":[18178,18240],"text":" "
}}],"suppressedMessages":[],"errorCo
unt":0,"fatalErrorCount":0,"warningC
ount":1,"fixableErrorCount":0,"fixab
leWarningCount":1,"source":"\"use 
server\";\r\n\r\nimport { 
createClient } from \"@/utils/supaba
se/server\";\r\nimport { 
createClient as createAdminClient } 
from \"@supabase/supabase-js\";\r\ni
mport { Organization, Role } from \"
@/lib/types/organization\";\r\n\r\ni
nterface LoginResponse {\r\n  
success: boolean;\r\n  message?: 
string;\r\n  user?: {\r\n    id: 
string;\r\n    email: string;\r\n   
 first_name: string;\r\n    
last_name: string;\r\n    avatar: 
string;\r\n  };\r\n  
organizations?: 
Organization[];\r\n}\r\n\r\nexport 
interface CreateOrganizationInput 
{\r\n  orgName: string;\r\n  
orgCode: string;\r\n  timezone: 
string;\r\n  industry?: string;\r\n 
 phone?: string;\r\n  email?: 
string;\r\n  website?: string;\r\n  
address?: string;\r\n  city?: 
string;\r\n  stateProvince?: 
string;\r\n  postalCode?: 
string;\r\n  defaultRoleId: 
string;\r\n}\r\n\r\nexport 
interface CreateOrganizationResult 
{\r\n  success: boolean;\r\n  
message: string;\r\n  data?: {\r\n  
  organizationId: number;\r\n    
organizationName: string;\r\n    
organizationCode: string;\r\n  
};\r\n  error?: 
string;\r\n}\r\n\r\nfunction 
generateInvitationCode(length: 
number = 6): string {\r\n  const 
chars = \"ABCDEFGHJKLMNPQRSTUVWXYZ23
456789\";\r\n  let result = 
\"\";\r\n  for (let i = 0; i < 
length; i++) {\r\n    result += char
s.charAt(Math.floor(Math.random() * 
chars.length));\r\n  }\r\n  return 
result;\r\n}\r\n\r\n/**\r\n * 
Multi-Org Login\r\n * Fetch user's 
organizations and roles after 
login\r\n */\r\nexport async 
function loginMultiOrg(formData: 
FormData): Promise<LoginResponse> 
{\r\n  const supabase = await 
createClient();\r\n\r\n  const 
email = formData.get(\"email\") as 
string;\r\n  const password = 
formData.get(\"password\") as 
string;\r\n\r\n  if (!email || 
!password) {\r\n    return { 
success: false, message: \"Email 
and password are required\" };\r\n  
}\r\n\r\n  // Sign in with email 
and password\r\n  const { data, 
error } = await supabase.auth.signIn
WithPassword({\r\n    email,\r\n    
password,\r\n  })\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message 
};\r\n  }\r\n\r\n  if (!data.user) 
{\r\n    return { success: false, 
message: \"Login failed. Please 
ensure your email is confirmed.\" 
};\r\n  }\r\n\r\n  const user = 
data.user;\r\n\r\n  // Get user 
profile\r\n  const { data: profile, 
error: profileError } = await 
supabase\r\n    
.from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    .eq(\"id\", 
user.id)\r\n    .single()\r\n\r\n  
if (profileError || !profile) {\r\n 
   return { success: false, 
message: \"User profile not found\" 
};\r\n  }\r\n\r\n  // Get user's 
organizations with roles\r\n  const 
{ data: orgMembers, error: 
orgMembersError } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      id,\r\n      
organization_id,\r\n      
is_active,\r\n      organizations 
(\r\n        id,\r\n        
name,\r\n        code,\r\n        
timezone,\r\n        
country_code,\r\n        
is_active\r\n      ),\r\n      
organization_member_roles (\r\n     
   id,\r\n        system_roles 
(\r\n          id,\r\n          
code,\r\n          name,\r\n        
  description\r\n        )\r\n      
)\r\n    `)\r\n    .eq(\"user_id\", 
user.id)\r\n    .eq(\"is_active\", 
true)\r\n\r\n  if (orgMembersError) 
{\r\n    return { success: false, 
message: \"Failed to fetch 
organizations\" };\r\n  }\r\n\r\n  
// Transform organizations data\r\n 
 const organizations: 
Organization[] = [];\r\n\r\n  if 
(orgMembers && orgMembers.length > 
0) {\r\n    for (const member of 
orgMembers) {\r\n      const org = 
member.organizations as any;\r\n    
  const roles: Role[] = [];\r\n\r\n 
     // Extract roles from 
organization_member_roles\r\n      
if 
(member.organization_member_roles 
&& Array.isArray(member.organization
_member_roles)) {\r\n        for 
(const memberRole of 
member.organization_member_roles) 
{\r\n          if 
(memberRole.system_roles && Array.is
Array(memberRole.system_roles) && 
memberRole.system_roles.length > 0) 
{\r\n            const role = 
memberRole.system_roles[0];\r\n     
       if (role) {\r\n              
roles.push({\r\n                id: 
role.id,\r\n                code: 
role.code,\r\n                name: 
role.name,\r\n                
description: role.description,\r\n  
            })\r\n            }\r\n 
         }\r\n        }\r\n      
}\r\n\r\n      if (org) {\r\n       
 organizations.push({\r\n          
id: org.id,\r\n          name: 
org.name,\r\n          code: 
org.code,\r\n          timezone: 
org.timezone,\r\n          
country_code: org.country_code,\r\n 
         roles,\r\n        })\r\n   
   }\r\n    }\r\n  }\r\n\r\n  
return {\r\n    success: true,\r\n  
  user: {\r\n      id: user.id,\r\n 
     email: user.email || \"\",\r\n 
     first_name: profile.first_name 
|| \"\",\r\n      last_name: 
profile.last_name || \"\",\r\n      
avatar: profile.profile_photo_url 
|| \"\",\r\n    },\r\n    
organizations,\r\n  
};\r\n}\r\n\r\n/**\r\n * Get User 
Organizations\r\n * Fetch 
organizations for current logged-in 
user\r\n */\r\nexport async 
function getUserOrganizations(): 
Promise<{\r\n  success: boolean\r\n 
 message?: string\r\n  
organizations?: 
Organization[]\r\n}> {\r\n  const 
supabase = await 
createClient();\r\n\r\n  const { 
data: { user }, error: userError } 
= await 
supabase.auth.getUser()\r\n\r\n  if 
(userError || !user) {\r\n    
return { success: false, message: 
\"User not authenticated\" };\r\n  
}\r\n\r\n  console.log('≡ƒöì 
getUserOrganizations: User 
authenticated:', user.id)\r\n\r\n  
const { data: orgMembers, error: 
orgMembersError } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      id,\r\n      
organization_id,\r\n      
organizations (\r\n        id,\r\n  
      name,\r\n        code,\r\n    
    timezone,\r\n        
country_code\r\n      ),\r\n      
organization_member_roles (\r\n     
   id,\r\n        system_roles 
(\r\n          id,\r\n          
code,\r\n          name,\r\n        
  description\r\n        )\r\n      
)\r\n    `)\r\n    .eq(\"user_id\", 
user.id)\r\n    .eq(\"is_active\", 
true)\r\n\r\n  console.log('≡ƒöì 
getUserOrganizations: Query 
result:', orgMembers)\r\n  
console.log('≡ƒöì 
getUserOrganizations: Query 
error:', orgMembersError)\r\n  if 
(orgMembersError) {\r\n    return { 
success: false, message: \"Failed 
to fetch organizations\" };\r\n  
}\r\n\r\n  const organizations: 
Organization[] = [];\r\n\r\n  if 
(orgMembers && orgMembers.length > 
0) {\r\n    for (const member of 
orgMembers) {\r\n      const org = 
member.organizations as any;\r\n    
  const roles: Role[] = [];\r\n\r\n 
     if 
(member.organization_member_roles 
&& Array.isArray(member.organization
_member_roles)) {\r\n        for 
(const memberRole of 
member.organization_member_roles) 
{\r\n          if 
(memberRole.system_roles && Array.is
Array(memberRole.system_roles) && 
memberRole.system_roles.length > 0) 
{\r\n            const role = 
memberRole.system_roles[0]!;\r\n    
        roles.push({\r\n            
  id: role.id,\r\n              
code: role.code,\r\n              
name: role.name,\r\n              
description: role.description,\r\n  
          })\r\n          }\r\n     
   }\r\n      }\r\n\r\n      if 
(org) {\r\n        
organizations.push({\r\n          
id: org.id,\r\n          name: 
org.name,\r\n          code: 
org.code,\r\n          timezone: 
org.timezone,\r\n          
country_code: org.country_code,\r\n 
         roles,\r\n        })\r\n   
   }\r\n    }\r\n  }\r\n\r\n  
return {\r\n    success: true,\r\n  
  organizations,\r\n  
};\r\n}\r\n\r\n/**\r\n * Create 
Organization (server action)\r\n 
*/\r\nexport async function 
createOrganization(\r\n  input: 
CreateOrganizationInput\r\n): 
Promise<CreateOrganizationResult> 
{\r\n  try {\r\n    const supabase 
= await createClient();\r\n    
const {\r\n      data: { user 
},\r\n      error: userError,\r\n   
 } = await 
supabase.auth.getUser();\r\n\r\n    
if (userError || !user) {\r\n      
return { success: false, message: 
\"User not authenticated\" };\r\n   
 }\r\n\r\n    // Generate 
invitation code and ensure 
uniqueness (best-effort)\r\n    let 
invCode = 
generateInvitationCode();\r\n    
for (let attempt = 0; attempt < 3; 
attempt++) {\r\n      const { data: 
existing } = await supabase\r\n     
   .from(\"organizations\")\r\n     
   .select(\"id\")\r\n        
.eq(\"inv_code\", invCode)\r\n      
  .maybeSingle();\r\n      if 
(!existing) break;\r\n      invCode 
= generateInvitationCode();\r\n    
}\r\n\r\n    // Create admin client 
with service role key for insert 
operations\r\n    const supabaseUrl 
= process.env.NEXT_PUBLIC_SUPABASE_U
RL;\r\n    const serviceRoleKey = pr
ocess.env.SUPABASE_SERVICE_ROLE_KEY;
\r\n\r\n    if (!supabaseUrl || 
!serviceRoleKey) {\r\n      
console.error(\"[CREATE-ORG] 
Missing environment variables:\", 
{\r\n        hasUrl: 
!!supabaseUrl,\r\n        hasKey: 
!!serviceRoleKey,\r\n      });\r\n  
    return {\r\n        success: 
false,\r\n        message: \"Server 
configuration error\",\r\n        
error: \"Missing Supabase 
credentials\",\r\n      };\r\n    
}\r\n\r\n    const adminClient = 
createAdminClient(supabaseUrl, 
serviceRoleKey);\r\n\r\n    // 
Insert organization\r\n    const { 
data: organization, error: orgError 
} = await adminClient\r\n      
.from(\"organizations\")\r\n      
.insert([\r\n        {\r\n          
name: input.orgName,\r\n          
legal_name: input.orgName,\r\n      
    code: input.orgCode,\r\n        
  timezone: input.timezone,\r\n     
     industry: input.industry || 
null,\r\n          phone: 
input.phone || null,\r\n          
email: input.email || null,\r\n     
     website: input.website || 
null,\r\n          address: 
input.address || null,\r\n          
city: input.city || null,\r\n       
   state_province: 
input.stateProvince || null,\r\n    
      postal_code: input.postalCode 
|| null,\r\n          country_code: 
\"ID\",\r\n          is_active: 
true,\r\n          is_suspended: 
false,\r\n          inv_code: 
invCode,\r\n        },\r\n      
])\r\n      .select()\r\n      
.single();\r\n\r\n    if (orgError 
|| !organization) {\r\n      
console.error(\"[CREATE-ORG] Error 
creating organization:\", {\r\n     
   error: orgError,\r\n        
message: orgError?.message,\r\n     
   details: orgError?.details,\r\n  
      hint: orgError?.hint,\r\n     
 });\r\n      return {\r\n        
success: false,\r\n        message: 
orgError?.message || \"Failed to 
create organization\",\r\n        
error: orgError?.message || 
\"Database error\",\r\n      };\r\n 
   }\r\n\r\n    // Add user as 
organization member (without 
biodata, so they won't appear in 
export)\r\n    // This is needed so 
creator can access the 
organization\r\n    const { data: 
member, error: memberError } = 
await adminClient\r\n      
.from(\"organization_members\")\r\n 
     .insert([\r\n        {\r\n     
     user_id: user.id,\r\n          
organization_id: 
organization.id,\r\n          
hire_date: new Date().toISOString().
split(\"T\")[0],\r\n          
is_active: true,\r\n          // No 
biodata_nik - creator won't appear 
in export (filtered out)\r\n        
},\r\n      ])\r\n      
.select()\r\n      
.single();\r\n\r\n    if 
(memberError || !member) {\r\n      
console.error(\"[CREATE-ORG] Error 
adding member:\", {\r\n        
error: memberError,\r\n        
message: memberError?.message,\r\n  
      details: 
memberError?.details,\r\n        
hint: memberError?.hint,\r\n        
code: memberError?.code,\r\n      
});\r\n      // Rollback: delete 
organization\r\n      await adminCli
ent.from(\"organizations\").delete()
.eq(\"id\", organization.id);\r\n   
   return {\r\n        success: 
false,\r\n        message: \"Failed 
to add user to organization\",\r\n  
      error: memberError?.message 
|| \"Database error\",\r\n      
};\r\n    }\r\n\r\n    // Assign 
default role to user\r\n    const { 
data: selectedRole, error: 
roleError } = await adminClient\r\n 
     .from(\"system_roles\")\r\n    
  .select(\"id\")\r\n      
.eq(\"code\", 
input.defaultRoleId)\r\n      
.single();\r\n\r\n    if (roleError 
|| !selectedRole) {\r\n      
console.error(\"[CREATE-ORG] Error 
fetching selected role:\", {\r\n    
    roleCode: 
input.defaultRoleId,\r\n        
error: roleError,\r\n        
message: roleError?.message,\r\n    
    details: 
roleError?.details,\r\n        
hint: roleError?.hint,\r\n        
code: roleError?.code,\r\n      
});\r\n      // Rollback: delete 
member and organization\r\n      
await adminClient.from(\"organizatio
n_members\").delete().eq(\"id\", 
member.id);\r\n      await adminClie
nt.from(\"organizations\").delete().
eq(\"id\", organization.id);\r\n    
  return {\r\n        success: 
false,\r\n        message: \"Failed 
to assign role\",\r\n        error: 
roleError?.message || `Role 
${input.defaultRoleId} not 
found`,\r\n      };\r\n    
}\r\n\r\n    const { error: 
memberRoleError } = await 
adminClient\r\n      .from(\"organiz
ation_member_roles\")\r\n      
.insert([\r\n        {\r\n          
organization_member_id: 
member.id,\r\n          role_id: 
selectedRole.id,\r\n        },\r\n  
    ]);\r\n\r\n    if 
(memberRoleError) {\r\n      
console.error(\"[CREATE-ORG] Error 
assigning role:\", {\r\n        
error: memberRoleError,\r\n        
message: 
memberRoleError?.message,\r\n       
 details: 
memberRoleError?.details,\r\n       
 hint: memberRoleError?.hint,\r\n   
     code: 
memberRoleError?.code,\r\n      
});\r\n      // Rollback: delete 
member and organization\r\n      
await adminClient.from(\"organizatio
n_members\").delete().eq(\"id\", 
member.id);\r\n      await adminClie
nt.from(\"organizations\").delete().
eq(\"id\", organization.id);\r\n    
  return {\r\n        success: 
false,\r\n        message: \"Failed 
to assign role to member\",\r\n     
   error: memberRoleError?.message 
|| \"Database error\",\r\n      
};\r\n    }\r\n\r\n    return {\r\n 
     success: true,\r\n      
message: `Organization 
\"${organization.name}\" created 
successfully`,\r\n      data: {\r\n 
       organizationId: 
organization.id,\r\n        
organizationName: 
organization.name,\r\n        
organizationCode: 
organization.code,\r\n      },\r\n  
  };\r\n  } catch (error) {\r\n    
console.error(\"[CREATE-ORG] 
Unexpected error:\", error);\r\n    
const errorMessage = error 
instanceof Error ? error.message : 
\"Unknown error\";\r\n    return 
{\r\n      success: false,\r\n      
message: \"An unexpected error 
occurred\",\r\n      error: 
errorMessage,\r\n    };\r\n  
}\r\n}\r\n\r\n/**\r\n * Get 
Organization Roles\r\n * Fetch 
available roles for a specific 
organization\r\n */\r\nexport async 
function getOrganizationRoles(organi
zationId: number): Promise<{\r\n  
success: boolean\r\n  message?: 
string\r\n  roles?: Role[]\r\n}> 
{\r\n  const supabase = await 
createClient();\r\n\r\n  const { 
data: { user }, error: userError } 
= await 
supabase.auth.getUser()\r\n\r\n  if 
(userError || !user) {\r\n    
return { success: false, message: 
\"User not authenticated\" };\r\n  
}\r\n\r\n  // Verify user is member 
of this organization\r\n  const { 
data: member, error: memberError } 
= await supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(\"id\")\r\n    
.eq(\"user_id\", user.id)\r\n    
.eq(\"organization_id\", 
organizationId)\r\n    
.eq(\"is_active\", true)\r\n    
.maybeSingle()\r\n\r\n  if 
(memberError || !member) {\r\n    
return { success: false, message: 
\"User is not a member of this 
organization\" };\r\n  }\r\n\r\n  
// Get roles for this member\r\n  
const { data: memberRoles, error: 
rolesError } = await supabase\r\n   
 .from(\"organization_member_roles\"
)\r\n    .select(`\r\n      
role:system_roles (\r\n        
id,\r\n        code,\r\n        
name,\r\n        description\r\n    
  )\r\n    `)\r\n    
.eq(\"organization_member_id\", 
member.id)\r\n\r\n  if (rolesError) 
{\r\n    return { success: false, 
message: \"Failed to fetch roles\" 
};\r\n  }\r\n\r\n  const roles: 
Role[] = [];\r\n\r\n  if 
(memberRoles && 
Array.isArray(memberRoles)) {\r\n   
 for (const memberRole of 
memberRoles) {\r\n      if 
(memberRole.role && 
Array.isArray(memberRole.role) && 
memberRole.role.length > 0) {\r\n   
     const role = 
memberRole.role[0]!;\r\n        
roles.push({\r\n          id: 
role.id,\r\n          code: 
role.code,\r\n          name: 
role.name,\r\n          
description: role.description,\r\n  
      })\r\n      }\r\n    }\r\n  
}\r\n\r\n  return {\r\n    success: 
true,\r\n    roles,\r\n  
};\r\n}\r\n\r\n/**\r\n * Get Role 
Permissions\r\n * Fetch permissions 
for a specific role\r\n 
*/\r\nexport async function 
getRolePermissions(roleId: number): 
Promise<{\r\n  success: boolean\r\n 
 message?: string\r\n  
permissions?: string[]\r\n}> {\r\n  
const supabase = await 
createClient();\r\n\r\n  const { 
data: { user }, error: userError } 
= await 
supabase.auth.getUser()\r\n\r\n  if 
(userError || !user) {\r\n    
return { success: false, message: 
\"User not authenticated\" };\r\n  
}\r\n\r\n  // Get permissions for 
this role\r\n  const { data: 
rolePermissions, error: permError } 
= await supabase\r\n    
.from(\"role_permissions\")\r\n    
.select(`\r\n      
permission:nfk_permissions (\r\n    
    code\r\n      )\r\n    `)\r\n   
 .eq(\"role_id\", roleId)\r\n\r\n  
if (permError) {\r\n    return { 
success: false, message: \"Failed 
to fetch permissions\" };\r\n  
}\r\n\r\n  const permissions: 
string[] = [];\r\n\r\n  if 
(rolePermissions && 
Array.isArray(rolePermissions)) 
{\r\n    for (const rp of 
rolePermissions) {\r\n      if 
(rp.permission && 
Array.isArray(rp.permission) && 
rp.permission.length > 0) {\r\n     
   const permission = 
rp.permission[0]!;\r\n        if 
(permission && permission.code) 
{\r\n          permissions.push(perm
ission.code)\r\n        }\r\n      
}\r\n    }\r\n  }\r\n\r\n  return 
{\r\n    success: true,\r\n    
permissions,\r\n  
};\r\n}\r\n\r\n/**\r\n * Validate 
organization code uniqueness\r\n 
*/\r\nexport async function 
validateOrganizationCode(\r\n  
code: string\r\n): Promise<{ 
isValid: boolean; message?: string 
}> {\r\n  try {\r\n    const 
supabase = createAdminClient(\r\n   
   process.env.NEXT_PUBLIC_SUPABASE_
URL || \"\",\r\n      process.env.SU
PABASE_SERVICE_ROLE_KEY || \"\"\r\n 
   );\r\n\r\n    const { data, 
error } = await supabase\r\n      
.from(\"organizations\")\r\n      
.select(\"id\")\r\n      
.eq(\"code\", code)\r\n      
.maybeSingle();\r\n\r\n    if 
(error) {\r\n      
console.error(\"[VALIDATE-ORG] 
Validation error:\", error);\r\n    
  return { isValid: false, message: 
\"Validation failed\" };\r\n    
}\r\n\r\n    if (data) {\r\n      
return { isValid: false, message: 
\"Organization code already 
exists\" };\r\n    }\r\n\r\n    
return { isValid: true };\r\n  } 
catch (err) {\r\n    
console.error(\"[VALIDATE-ORG] 
Unexpected error:\", err);\r\n    
return { isValid: false, message: 
\"Unexpected error validating 
code\" };\r\n  
}\r\n}\r\n\r\n/**\r\n * Get 
available roles (system roles)\r\n 
*/\r\nexport async function 
getAvailableRoles(): Promise<\r\n  
Array<{ id: string; code: string; 
name: string }>\r\n> {\r\n  try 
{\r\n    const supabase = 
createAdminClient(\r\n      process.
env.NEXT_PUBLIC_SUPABASE_URL || 
\"\",\r\n      process.env.SUPABASE_
SERVICE_ROLE_KEY || \"\"\r\n    
);\r\n\r\n    const { data, error } 
= await supabase\r\n      
.from(\"system_roles\")\r\n      
.select(\"id, code, name\")\r\n     
 .order(\"name\", { ascending: true 
});\r\n\r\n    if (error) {\r\n     
 console.error(\"[ROLES] Failed to 
fetch roles:\", error);\r\n      
return [];\r\n    }\r\n\r\n    
return (data || []).map((r) => 
({\r\n      id: r.id,\r\n      
code: r.code,\r\n      name: 
r.name,\r\n    }));\r\n  } catch 
(err) {\r\n    
console.error(\"[ROLES] Unexpected 
error:\", err);\r\n    return 
[];\r\n  }\r\n}\r\n\r\n/**\r\n * 
Get available timezones\r\n 
*/\r\nexport async function 
getAvailableTimezones(): 
Promise<string[]> {\r\n  try {\r\n  
  // Node 18 supports 
Intl.supportedValuesOf\r\n    // 
Provide fallback to a minimal list 
if not available\r\n    // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n    
const intl: any = Intl as any;\r\n  
  if (typeof intl.supportedValuesOf 
=== \"function\") {\r\n      return 
intl.supportedValuesOf(\"timeZone\")
;\r\n    }\r\n    return [\"UTC\", 
\"Asia/Jakarta\", 
\"Asia/Makassar\", 
\"Asia/Jayapura\"];\r\n  } catch 
{\r\n    return [\"UTC\", 
\"Asia/Jakarta\", 
\"Asia/Makassar\", 
\"Asia/Jayapura\"];\r\n  
}\r\n}\r\n\r\n/**\r\n * Logout 
Multi-Org\r\n * Clear session and 
redirect\r\n */\r\nexport async 
function logoutMultiOrg(): 
Promise<{\r\n  success: boolean\r\n 
 message?: string\r\n}> {\r\n  
const supabase = await 
createClient()\r\n\r\n  const { 
error } = await 
supabase.auth.signOut()\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message 
};\r\n  }\r\n\r\n  return { 
success: true };\r\n}\r\n","usedDepr
ecatedRules":[]},{"filePath":"D:\\UB
IG\\Projek\\Presensi-New\\src\\actio
n\\members.ts","messages":[{"ruleId"
:null,"message":"Unused 
eslint-disable directive (no 
problems were reported from '@typesc
ript-eslint/no-explicit-any').","lin
e":489,"column":5,"severity":1,"node
Type":null,"fix":{"range":[18366,184
28],"text":" "}}],"suppressedMessage
s":[],"errorCount":0,"fatalErrorCoun
t":0,"warningCount":1,"fixableErrorC
ount":0,"fixableWarningCount":1,"sou
rce":"\"use server\";\r\nimport { 
createClient } from \"@/utils/supaba
se/server\";\r\nimport { 
createAdminClient } from \"@/utils/s
upabase/admin\";\r\nimport { 
IOrganization_member } from 
\"@/interface\";\r\n\r\nimport { 
memberLogger } from 
'@/lib/logger';\r\n\r\nasync 
function getSupabase() {\r\n  
return await 
createClient();\r\n}\r\n\r\n// Γ₧ò 
Add 
MemIOrganization_member\r\nexport 
const createOrganizationMember = 
async (Organization_member: 
Partial<IOrganization_member>) => 
{\r\n  const supabase = await 
getSupabase();\r\n  const { data, 
error } = await supabase.from(\"orga
nization_members\").insert([Organiza
tion_member]).select().single();\r\n
\r\n  if (error) {\r\n    return { 
success: false, message: 
error.message, data: null };\r\n  
}\r\n  return { success: true, 
message: \"Members added 
successfully\", data: data as 
IOrganization_member 
};\r\n};\r\nexport const 
getAllOrganization_member = async 
(organizationId?: number) => {\r\n  
const supabase = await 
getSupabase();\r\n  const 
adminClient = 
createAdminClient();\r\n\r\n  // 1. 
Retrieve user from cookies\r\n  
const { data: { user }, error: 
userError } = await 
supabase.auth.getUser();\r\n\r\n  
if (userError || !user) {\r\n    
return { success: false, message: 
\"User not logged in\", data: [] 
};\r\n  }\r\n\r\n  // 2. Determine 
which organization to fetch\r\n  
let targetOrgId = 
organizationId;\r\n\r\n  if 
(!targetOrgId) {\r\n    // If no 
organizationId provided, get user's 
first organization\r\n    const { 
data: memberships } = await 
supabase\r\n      
.from(\"organization_members\")\r\n 
     
.select(\"organization_id\")\r\n    
  .eq(\"user_id\", 
user.id);\r\n\r\n    const member = 
memberships?.[0];\r\n\r\n    if 
(!member) {\r\n      return { 
success: true, message: \"User not 
registered in any organization\", 
data: [] };\r\n    }\r\n    
targetOrgId = 
member.organization_id;\r\n  
}\r\n\r\n  memberLogger.debug(`≡ƒôì 
Fetching members for organization: 
${targetOrgId}`);\r\n\r\n  // 3. 
Fetch all members belonging to the 
organization\r\n  // Note: Increase 
limit to 10000 to support large 
organizations\r\n  // Fetch with 
explicit limit (Supabase max is 
1000 per request by default)\r\n  
// We'll use multiple requests if 
needed\r\n  let allData: any[] = 
[];\r\n  let currentPage = 0;\r\n  
const pageSize = 1000;\r\n  let 
hasMore = true;\r\n\r\n  while 
(hasMore) {\r\n    const from = 
currentPage * pageSize;\r\n    
const to = from + pageSize - 
1;\r\n\r\n    const { data: 
pageData, error: pageError } = 
await adminClient\r\n      
.from(\"organization_members\")\r\n 
     .select(`\r\n      *,\r\n      
user:user_id (\r\n        id,\r\n   
     email,\r\n        
first_name,\r\n        
middle_name,\r\n        
last_name,\r\n        
display_name,\r\n        phone,\r\n 
       mobile,\r\n        
date_of_birth,\r\n        
jenis_kelamin,\r\n        nik,\r\n  
      nisn,\r\n        
tempat_lahir,\r\n        agama,\r\n 
       jalan,\r\n        rt,\r\n    
    rw,\r\n        dusun,\r\n       
 kelurahan,\r\n        
kecamatan,\r\n        
profile_photo_url,\r\n        
search_name,\r\n        
is_active\r\n      ),\r\n      
departments:department_id (\r\n     
   id,\r\n        name,\r\n        
code,\r\n        
organization_id\r\n      ),\r\n     
 positions:position_id (\r\n        
id,\r\n        title,\r\n        
code\r\n      ),\r\n      
role:system_roles!role_id (\r\n     
   id,\r\n        code,\r\n        
name,\r\n        description\r\n    
  )\r\n    `)\r\n      
.eq(\"organization_id\", 
targetOrgId)\r\n      
.eq(\"is_active\", true)\r\n      
.order(\"created_at\", { ascending: 
true })\r\n      .range(from, 
to);\r\n\r\n    if (pageError) 
{\r\n      memberLogger.error('Γ¥î 
Error fetching page', currentPage, 
pageError);\r\n      return { 
success: false, message: 
pageError.message, data: [] };\r\n  
  }\r\n\r\n    if (pageData && 
pageData.length > 0) {\r\n      // 
Normalize departments structure 
(Supabase might return array or 
object)\r\n      
pageData.forEach((member: any) => 
{\r\n        if 
(member.departments) {\r\n          
// If departments is an array, take 
the first element\r\n          if 
(Array.isArray(member.departments) 
&& member.departments.length > 0) 
{\r\n            member.departments 
= member.departments[0];\r\n        
  }\r\n          // If departments 
is null or empty array, set to 
null\r\n          else if 
(Array.isArray(member.departments) 
&& member.departments.length === 0) 
{\r\n            member.departments 
= null;\r\n          }\r\n        
}\r\n\r\n        // Log untuk 
debugging\r\n        if 
(member.department_id && 
!member.departments) {\r\n          
memberLogger.debug(`ΓÜá∩╕Å Member 
${member.id} has department_id 
${member.department_id} but no 
departments from join`);\r\n        
}\r\n      });\r\n\r\n      allData 
= allData.concat(pageData);\r\n     
 memberLogger.debug(`≡ƒôä Fetched 
page ${currentPage + 1}: 
${pageData.length} records (total 
so far: 
${allData.length})`);\r\n\r\n      
// If we got less than pageSize, 
we're done\r\n      if 
(pageData.length < pageSize) {\r\n  
      hasMore = false;\r\n      } 
else {\r\n        
currentPage++;\r\n      }\r\n    } 
else {\r\n      hasMore = 
false;\r\n    }\r\n\r\n    // 
Safety limit: stop after 20 pages 
(20,000 records)\r\n    if 
(currentPage >= 20) {\r\n      
memberLogger.warn('ΓÜá∩╕Å Reached 
safety limit of 20 pages (20,000 
records)');\r\n      hasMore = 
false;\r\n    }\r\n  }\r\n\r\n  
const data = allData;\r\n\r\n  // 
4. Untuk member yang user_id null, 
ambil data dari biodata berdasarkan 
biodata_nik atau employee_id 
(NIK)\r\n  // Dan juga perbaiki 
departments jika join gagal\r\n  if 
(data && data.length > 0) {\r\n    
// Kumpulkan semua department_id 
yang perlu di-fetch (dari 
organization_members dan 
biodata)\r\n    const deptIds = new 
Set<number>();\r\n    let 
membersWithoutDept = 0;\r\n    
data.forEach((member: any) => {\r\n 
     // Check if departments is 
null, undefined, empty array, or 
doesn't have name\r\n      const 
hasValidDept = member.departments 
&&\r\n        (typeof 
member.departments === 'object' && 
!Array.isArray(member.departments) 
&& member.departments.name) ||\r\n  
      
(Array.isArray(member.departments) 
&& member.departments.length > 0 && 
member.departments[0]?.name);\r\n\r\
n      if (member.department_id && 
!hasValidDept) {\r\n        // 
Convert to number to ensure 
consistency\r\n        const deptId 
= typeof member.department_id === 
'string' ? 
parseInt(member.department_id, 10) 
: member.department_id;\r\n        
if (!isNaN(deptId)) {\r\n          
deptIds.add(deptId);\r\n          
membersWithoutDept++;\r\n        } 
else {\r\n          
memberLogger.warn(`ΓÜá∩╕Å Invalid 
department_id for member 
${member.id}:`, 
member.department_id);\r\n        
}\r\n      }\r\n    });\r\n\r\n    
memberLogger.debug(`≡ƒöì Found 
${membersWithoutDept} members 
without departments but with 
department_id`);\r\n    
memberLogger.debug(`≡ƒôï Department 
IDs to fetch:`, 
Array.from(deptIds));\r\n\r\n    // 
Fetch departments untuk semua 
member yang perlu (baik yang punya 
user_id maupun tidak)\r\n    const 
departmentsMap = new Map();\r\n    
if (deptIds.size > 0) {\r\n      
const deptIdsArray = 
Array.from(deptIds);\r\n      
memberLogger.debug(`≡ƒôÑ Fetching 
${deptIdsArray.length} 
departments...`);\r\n      const { 
data: deptList, error: deptError } 
= await adminClient\r\n        
.from(\"departments\")\r\n        
.select(\"id, name, code, 
organization_id\")\r\n        
.in(\"id\", deptIdsArray);\r\n\r\n  
    if (deptError) {\r\n        
memberLogger.error('Γ¥î Error 
fetching departments:', 
deptError);\r\n      } else if 
(deptList) {\r\n        
memberLogger.debug(`Γ£à Fetched 
${deptList.length} departments:`, 
deptList.map((d: any) => 
`${d.id}:${d.name}`));\r\n        
deptList.forEach((dept: any) => 
{\r\n          // Ensure id is 
number for consistent lookup\r\n    
      const deptId = typeof dept.id 
=== 'string' ? parseInt(dept.id, 
10) : dept.id;\r\n          if 
(!isNaN(deptId)) {\r\n            
departmentsMap.set(deptId, 
dept);\r\n          }\r\n        
});\r\n        
memberLogger.debug(`≡ƒôè 
Departments map keys:`, Array.from(d
epartmentsMap.keys()));\r\n      } 
else {\r\n        
memberLogger.warn('ΓÜá∩╕Å No 
departments returned from 
query');\r\n      }\r\n    
}\r\n\r\n    const 
membersWithoutUser = 
data.filter((m: any) => !m.user_id 
&& (m.biodata_nik || 
m.employee_id));\r\n\r\n    if 
(membersWithoutUser.length > 0) 
{\r\n      const niks = 
membersWithoutUser.map((m: any) => 
m.biodata_nik || m.employee_id).filt
er(Boolean);\r\n\r\n      if 
(niks.length > 0) {\r\n        
const { data: biodataList, error: 
biodataError } = await 
adminClient\r\n          
.from(\"biodata\")\r\n          
.select(\"nik, nama, nickname, 
email, no_telepon, jenis_kelamin, 
agama, department_id\")\r\n         
 .in(\"nik\", niks);\r\n\r\n        
if (!biodataError && biodataList) 
{\r\n          // Merge biodata ke 
dalam member data\r\n          
const biodataMap = new 
Map(biodataList.map((b: any) => 
[b.nik, b]));\r\n\r\n          // 
Tambahkan department_id dari 
biodata ke set dan fetch jika belum 
ada di map\r\n          const 
newDeptIds = new Set<number>();\r\n 
         biodataList.forEach((b: 
any) => {\r\n            if 
(b.department_id) {\r\n             
 const biodataDeptId = typeof 
b.department_id === 'string' ? 
parseInt(b.department_id, 10) : 
b.department_id;\r\n              
if (!isNaN(biodataDeptId) && 
!departmentsMap.has(biodataDeptId)) 
{\r\n                
newDeptIds.add(biodataDeptId);\r\n  
            }\r\n            }\r\n  
        });\r\n\r\n          // 
Fetch departments baru dari biodata 
jika ada\r\n          if 
(newDeptIds.size > 0) {\r\n         
   const newDeptIdsArray = 
Array.from(newDeptIds);\r\n         
   memberLogger.debug(`≡ƒôÑ 
Fetching ${newDeptIdsArray.length} 
additional departments from 
biodata:`, newDeptIdsArray);\r\n    
        const { data: newDeptList, 
error: newDeptError } = await 
adminClient\r\n              
.from(\"departments\")\r\n          
    .select(\"id, name, code, 
organization_id\")\r\n              
.in(\"id\", 
newDeptIdsArray);\r\n\r\n           
 if (newDeptError) {\r\n            
  memberLogger.error('Γ¥î Error 
fetching additional departments:', 
newDeptError);\r\n            } 
else if (newDeptList) {\r\n         
     memberLogger.debug(`Γ£à 
Fetched ${newDeptList.length} 
additional departments`);\r\n       
       newDeptList.forEach((dept: 
any) => {\r\n                const 
deptId = typeof dept.id === 
'string' ? parseInt(dept.id, 10) : 
dept.id;\r\n                if 
(!isNaN(deptId)) {\r\n              
    departmentsMap.set(deptId, 
dept);\r\n                }\r\n     
         });\r\n            }\r\n   
       }\r\n\r\n          
data.forEach((member: any) => {\r\n 
           // Check if departments 
is valid\r\n            const 
hasValidDept = member.departments 
&&\r\n              (typeof 
member.departments === 'object' && 
!Array.isArray(member.departments) 
&& member.departments.name) ||\r\n  
            
(Array.isArray(member.departments) 
&& member.departments.length > 0 && 
member.departments[0]?.name);\r\n\r\
n            if (!member.user_id && 
(member.biodata_nik || 
member.employee_id)) {\r\n          
    const nik = member.biodata_nik 
|| member.employee_id;\r\n          
    const biodata = 
biodataMap.get(nik);\r\n            
  if (biodata) {\r\n                
// Buat object user dummy dari 
biodata untuk konsistensi dengan 
struktur yang ada\r\n               
 member.user = {\r\n                
  id: null,\r\n                  
email: biodata.email || null,\r\n   
               first_name: 
biodata.nama?.split(\" \")[0] || 
biodata.nama || null,\r\n           
       last_name: 
biodata.nama?.split(\" 
\").slice(1).join(\" \") || 
null,\r\n                  
display_name: biodata.nickname || 
biodata.nama || null,\r\n           
     };\r\n                // 
Update biodata relation jika belum 
ada\r\n                if 
(!member.biodata) {\r\n             
     member.biodata = biodata;\r\n  
              }\r\n\r\n             
   // Jika member tidak punya 
departments tapi biodata punya 
department_id, ambil dari 
biodata\r\n                if 
(!hasValidDept && 
biodata.department_id) {\r\n        
          const biodataDeptId = 
typeof biodata.department_id === 
'string' ? 
parseInt(biodata.department_id, 10) 
: biodata.department_id;\r\n        
          if 
(!isNaN(biodataDeptId)) {\r\n       
             const dept = department
sMap.get(biodataDeptId);\r\n        
            if (dept) {\r\n         
             member.departments = 
dept;\r\n                      
memberLogger.debug(`Γ£à Set 
departments from biodata for member 
${member.id} (dept_id: 
${biodataDeptId}):`, 
dept.name);\r\n                    
}\r\n                  }\r\n        
        }\r\n              }\r\n    
        }\r\n\r\n            // 
Fallback: jika member punya 
department_id tapi tidak punya 
departments (join gagal)\r\n        
    if (member.department_id && 
!hasValidDept) {\r\n              
const deptId = typeof 
member.department_id === 'string' ? 
parseInt(member.department_id, 10) 
: member.department_id;\r\n         
     if (!isNaN(deptId)) {\r\n      
          const dept = 
departmentsMap.get(deptId);\r\n     
           if (dept) {\r\n          
        member.departments = 
dept;\r\n                  
memberLogger.debug(`Γ£à Set 
departments from department_id for 
member ${member.id} (dept_id: 
${deptId}):`, dept.name);\r\n       
         } else {\r\n               
   memberLogger.warn(`ΓÜá∩╕Å 
Department ID ${deptId} not found 
in departments map for member 
${member.id}`);\r\n                
}\r\n              }\r\n            
}\r\n          });\r\n        }\r\n 
     }\r\n    }\r\n\r\n    // 
Setelah semua processing, pastikan 
semua member yang punya 
department_id punya departments\r\n 
   // (menggunakan departmentsMap 
yang sudah di-fetch sebelumnya)\r\n 
   let fixedCount = 0;\r\n    
data.forEach((member: any) => {\r\n 
     // Check if departments is 
valid\r\n      const hasValidDept = 
member.departments &&\r\n        
(typeof member.departments === 
'object' && 
!Array.isArray(member.departments) 
&& member.departments.name) ||\r\n  
      
(Array.isArray(member.departments) 
&& member.departments.length > 0 && 
member.departments[0]?.name);\r\n\r\
n      if (member.department_id && 
!hasValidDept) {\r\n        // 
Convert department_id to number if 
it's a string\r\n        const 
deptId = typeof 
member.department_id === 'string' ? 
parseInt(member.department_id, 10) 
: member.department_id;\r\n\r\n     
   if (!isNaN(deptId)) {\r\n        
  const dept = 
departmentsMap.get(deptId);\r\n     
     if (dept) {\r\n            
member.departments = dept;\r\n      
      fixedCount++;\r\n            
memberLogger.debug(`Γ£à Set 
departments from department_id for 
member ${member.id} (dept_id: 
${deptId}):`, dept.name);\r\n       
   } else {\r\n            
memberLogger.warn(`ΓÜá∩╕Å 
Department ID ${deptId} (type: 
${typeof member.department_id}) not 
found in departments map for member 
${member.id} (biodata_nik: 
${member.biodata_nik})`);\r\n       
     memberLogger.warn(`ΓÜá∩╕Å 
Available department IDs in map:`, A
rray.from(departmentsMap.keys()));\r
\n          }\r\n        } else 
{\r\n          
memberLogger.warn(`ΓÜá∩╕Å Invalid 
department_id for member 
${member.id}:`, 
member.department_id);\r\n        
}\r\n      }\r\n    });\r\n\r\n    
memberLogger.info(`≡ƒöº Fixed 
departments for ${fixedCount} 
members`);\r\n  }\r\n\r\n  
memberLogger.info(`Γ£à Fetched 
${data?.length || 0} members for 
organization ${targetOrgId}`);\r\n  
return { success: true, data: data 
as IOrganization_member[] 
};\r\n};\r\n\r\ntype 
OrganizationSummary = {\r\n  
organizationId: string | null;\r\n  
stats: {\r\n    totalMembers: 
number;\r\n    activeMembers: 
number;\r\n    inactiveMembers: 
number;\r\n    pendingInvitations: 
number;\r\n  };\r\n};\r\n\r\nexport 
const getMemberSummary = async (): 
Promise<OrganizationSummary> => 
{\r\n  const supabase = await 
getSupabase();\r\n\r\n  const {\r\n 
   data: { user },\r\n    error: 
userError,\r\n  } = await 
supabase.auth.getUser();\r\n\r\n  
if (userError || !user) {\r\n    
return {\r\n      organizationId: 
null,\r\n      stats: { 
totalMembers: 0, activeMembers: 0, 
inactiveMembers: 0, 
pendingInvitations: 0 },\r\n    
};\r\n  }\r\n\r\n  const { data: 
memberships, error: membershipError 
} = await supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(\"organization_id\")\r\n 
   .eq(\"user_id\", 
user.id);\r\n\r\n  const membership 
= memberships?.[0];\r\n\r\n  if 
(membershipError || 
!membership?.organization_id) {\r\n 
   return {\r\n      
organizationId: null,\r\n      
stats: { totalMembers: 0, 
activeMembers: 0, inactiveMembers: 
0, pendingInvitations: 0 },\r\n    
};\r\n  }\r\n\r\n  const 
organizationId = 
membership.organization_id as 
string;\r\n\r\n  const 
[totalMembersRes, activeMembersRes, 
pendingInvitesRes] = await 
Promise.all([\r\n    supabase\r\n   
   
.from(\"organization_members\")\r\n 
     .select(\"id\", { count: 
\"exact\", head: true })\r\n      
.eq(\"organization_id\", 
organizationId),\r\n    
supabase\r\n      
.from(\"organization_members\")\r\n 
     .select(\"id\", { count: 
\"exact\", head: true })\r\n      
.eq(\"organization_id\", 
organizationId)\r\n      
.eq(\"is_active\", true),\r\n    
supabase\r\n      
.from(\"member_invitations\")\r\n   
   .select(\"id\", { count: 
\"exact\", head: true })\r\n      
.eq(\"organization_id\", 
organizationId)\r\n      
.eq(\"status\", \"pending\"),\r\n  
]);\r\n\r\n  const totalMembers = 
totalMembersRes.count ?? 0;\r\n  
const activeMembers = 
activeMembersRes.count ?? 0;\r\n  
const inactiveMembers = 
totalMembers - activeMembers;\r\n  
const pendingInvitations = 
pendingInvitesRes.count ?? 
0;\r\n\r\n  return {\r\n    
organizationId,\r\n    stats: {\r\n 
     totalMembers,\r\n      
activeMembers,\r\n      
inactiveMembers,\r\n      
pendingInvitations,\r\n    },\r\n  
};\r\n};\r\n\r\n// Γ£Å∩╕Å Update 
Organization\r\nexport const 
updateOrganizationMember = async 
(id: string, organization: 
Partial<IOrganization_member>) => 
{\r\n  const supabase = await 
getSupabase();\r\n\r\n  const { 
data, error } = await supabase\r\n  
  
.from(\"organization_members\")\r\n 
   .update(organization)\r\n    
.eq(\"id\", id)\r\n    
.select()\r\n    .single();\r\n\r\n 
 if (error) {\r\n    return { 
success: false, message: 
error.message, data: null };\r\n  
}\r\n  return { success: true, 
message: \"Organization updated 
successfully\", data: data as 
IOrganization_member 
};\r\n};\r\nexport const 
deleteOrganization_member = async 
(id: string) => {\r\n  const 
supabase = await 
getSupabase();\r\n\r\n  const { 
data, error } = await supabase\r\n  
  
.from(\"organization_members\")\r\n 
   .delete()\r\n    .eq(\"id\", 
id)\r\n    .select()\r\n    
.single();\r\n\r\n  if (error) 
{\r\n    return { success: false, 
message: error.message, data: null 
};\r\n  }\r\n  return { success: 
true, message: \"Organization 
Members deleted successfully\", 
data: data as IOrganization_member 
};\r\n};\r\n\r\n\r\nexport const 
getOrganizationMembersById = async 
(id: string) => {\r\n  const 
supabase = await getSupabase();\r\n 
 const { data, error } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n    *,\r\n    
organizations:organization_id 
(*),\r\n    rfid_cards 
(card_number, card_type),\r\n    
role:system_roles!role_id (\r\n     
 id,\r\n      code,\r\n      
name,\r\n      description\r\n    
)\r\n  `)\r\n    .eq(\"id\", 
id)\r\n    .single()\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message, 
data: null }\r\n  }\r\n\r\n  // If 
the member row exists, also fetch 
related user, department and 
position records\r\n  try {\r\n    
// eslint-disable-next-line @typescr
ipt-eslint/no-explicit-any\r\n    
const member: any = data\r\n\r\n    
if (member) {\r\n      // Fetch 
user profile\r\n      if 
(member.user_id) {\r\n        // 
select common profile fields 
including email explicitly\r\n      
  const { data: userData, error: 
userError } = await supabase\r\n    
      .from(\"user_profiles\")\r\n  
        .select(\"id, 
employee_code, nik, first_name, 
middle_name, last_name, 
display_name, phone, mobile, 
date_of_birth, profile_photo_url, 
email, is_active, created_at, 
updated_at, deleted_at, jalan, rt, 
rw, dusun, kelurahan, 
kecamatan\")\r\n          
.eq(\"id\", member.user_id)\r\n     
     .maybeSingle()\r\n\r\n        
if (!userError && userData) 
member.user = userData\r\n      
}\r\n\r\n      // Fetch department 
(group)\r\n      if 
(member.department_id) {\r\n        
const { data: deptData, error: 
deptError } = await supabase\r\n    
      .from(\"departments\")\r\n    
      .select(\"*\")\r\n          
.eq(\"id\", 
member.department_id)\r\n          
.maybeSingle()\r\n\r\n        if 
(!deptError && deptData) 
member.departments = deptData\r\n   
   }\r\n\r\n      // Fetch 
position\r\n      if 
(member.position_id) {\r\n        
const { data: posData, error: 
posError } = await supabase\r\n     
     .from(\"positions\")\r\n       
   .select(\"*\")\r\n          
.eq(\"id\", member.position_id)\r\n 
         .maybeSingle()\r\n\r\n     
   if (!posError && posData) 
member.positions = posData\r\n      
}\r\n\r\n      if 
(!member.organization && 
member.organization_id) {\r\n       
 const { data: orgData, error: 
orgError } = await supabase\r\n     
     .from(\"organizations\")\r\n   
       .select(\"*\")\r\n          
.eq(\"id\", 
member.organization_id)\r\n         
 .maybeSingle()\r\n\r\n        if 
(!orgError && orgData) 
member.organization = orgData\r\n   
   }\r\n    }\r\n  } catch (e) 
{\r\n\r\n    memberLogger.warn('getO
rganizationMembersById: failed to 
fetch related records', e)\r\n  
}\r\n\r\n  return { success: true, 
data }\r\n}\r\n\r\nexport const 
getDepartmentMembersByOrganization 
= async (organizationId: string) => 
{\r\n  const supabase = await 
getSupabase();\r\n  const { data, 
error } = await supabase\r\n    
.from(\"departments\")\r\n    
.select(\r\n      `\r\n      
id,\r\n      name,\r\n      organiza
tion_members:organization_members!de
partment_id (id)\r\n      `\r\n    
)\r\n    .eq(\"organization_id\", 
organizationId);\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message, 
data: [] };\r\n  }\r\n\r\n  const 
result = (data || []).map((dept) => 
({\r\n    department: 
dept.name,\r\n    members: 
dept.organization_members ? 
dept.organization_members.length : 
0,\r\n  }));\r\n\r\n  return { 
success: true, data: result 
};\r\n};\r\n\r\n\r\nexport const 
getUserOrganizationId = async 
(userId: string) => {\r\n  const 
supabase = await getSupabase();\r\n 
 const { data: memberships, error: 
error } = await supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(\"organization_id\")\r\n 
   .eq(\"user_id\", 
userId);\r\n\r\n  const data = 
memberships?.[0];\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message, 
organizationId: null };\r\n  
}\r\n\r\n  if (!data) {\r\n    // 
user is not yet registered in 
organization_members\r\n    return 
{ success: true, message: \"User 
not in organization\", 
organizationId: null };\r\n  
}\r\n\r\n  return { success: true, 
message: \"Organization found\", 
organizationId: 
data.organization_id 
};\r\n};\r\n\r\nexport const 
getMembersByGroupId = async 
(groupId: string) => {\r\n  const 
supabase = await getSupabase();\r\n 
 const { data, error } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      *,\r\n      
user:user_id (\r\n        id,\r\n   
     email,\r\n        
first_name,\r\n        
middle_name,\r\n        
last_name,\r\n        
display_name\r\n      )\r\n    
`)\r\n    .eq(\"department_id\", 
groupId);\r\n\r\n  if (error) {\r\n 
   return { success: false, 
message: error.message, data: [] 
};\r\n  }\r\n\r\n  return { 
success: true, data: data as 
IOrganization_member[] 
};\r\n};\r\n\r\nexport const 
getMembersByPositionId = async 
(positionId: string) => {\r\n  
const supabase = await 
getSupabase();\r\n  const { data, 
error } = await supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      *,\r\n      
user:user_id (\r\n        id,\r\n   
     email,\r\n        
first_name,\r\n        
middle_name,\r\n        
last_name,\r\n        
display_name\r\n      )\r\n    
`)\r\n    .eq(\"position_id\", 
positionId);\r\n\r\n  if (error) 
{\r\n    return { success: false, 
message: error.message, data: [] 
};\r\n  }\r\n\r\n  return { 
success: true, data: data as 
IOrganization_member[] 
};\r\n};\r\n\r\nexport const 
moveMembersToGroup = async 
(memberIds: string[], 
targetGroupId: string) => {\r\n  
const supabase = await 
getSupabase();\r\n  const { data, 
error } = await supabase\r\n    
.from(\"organization_members\")\r\n 
   .update({ department_id: 
targetGroupId })\r\n    .in(\"id\", 
memberIds)\r\n    
.select();\r\n\r\n  if (error) 
{\r\n    return { success: false, 
message: error.message, data: null 
};\r\n  }\r\n\r\n  return { 
success: true, message: \"Members 
moved successfully\", data 
};\r\n};\r\n\r\nexport const 
getOrganizationMembersPaginated = 
async ({\r\n  page = 1,\r\n  
pageSize = 10,\r\n  query = 
\"\",\r\n  organizationId,\r\n}: 
{\r\n  page?: number;\r\n  
pageSize?: number;\r\n  query?: 
string;\r\n  organizationId?: 
string;\r\n}) => {\r\n  const 
supabase = await getSupabase();\r\n 
 const adminClient = 
createAdminClient();\r\n\r\n  // 1. 
Get user and organization if not 
provided\r\n  let targetOrgId = 
organizationId;\r\n\r\n  if 
(!targetOrgId) {\r\n    const { 
data: { user }, error: userError } 
= await 
supabase.auth.getUser();\r\n\r\n    
if (userError || !user) {\r\n      
return { success: false, message: 
\"User not logged in\", data: [], 
metadata: { total: 0, page, 
pageSize, totalPages: 0 } };\r\n    
}\r\n\r\n    const { data: 
memberships } = await supabase\r\n  
    
.from(\"organization_members\")\r\n 
     
.select(\"organization_id\")\r\n    
  .eq(\"user_id\", 
user.id);\r\n\r\n    const member = 
memberships?.[0];\r\n\r\n    if 
(!member) {\r\n      return { 
success: false, message: \"User not 
registered in any organization\", 
data: [], metadata: { total: 0, 
page, pageSize, totalPages: 0 } 
};\r\n    }\r\n    targetOrgId = mem
ber.organization_id.toString();\r\n 
 }\r\n\r\n  const from = (page - 1) 
* pageSize;\r\n  const to = from + 
pageSize - 1;\r\n\r\n  let 
queryBuilder = adminClient\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      id,\r\n      
biodata_nik,\r\n      
employee_id,\r\n      
user:user_id!inner (\r\n        
first_name,\r\n        
last_name,\r\n        
display_name,\r\n        phone,\r\n 
       mobile,\r\n        
gender,\r\n        
jenis_kelamin\r\n      )\r\n    `, 
{ count: \"exact\" })\r\n    
.eq(\"organization_id\", 
targetOrgId)\r\n    
.eq(\"is_active\", true);\r\n\r\n  
if (query) {\r\n    queryBuilder = q
ueryBuilder.or(`first_name.ilike.%${
query}%,last_name.ilike.%${query}%,d
isplay_name.ilike.%${query}%`, { 
foreignTable: \"user\" });\r\n  } 
else {\r\n    queryBuilder = 
adminClient\r\n      
.from(\"organization_members\")\r\n 
     .select(`\r\n          id,\r\n 
         biodata_nik,\r\n          
employee_id,\r\n          
user:user_id (\r\n            
first_name,\r\n            
last_name,\r\n            
display_name,\r\n            
phone,\r\n            mobile,\r\n   
         gender,\r\n            
jenis_kelamin\r\n          )\r\n    
    `, { count: \"exact\" })\r\n    
  .eq(\"organization_id\", 
targetOrgId)\r\n      
.eq(\"is_active\", true);\r\n  
}\r\n\r\n  const { data, error, 
count } = await queryBuilder\r\n    
.range(from, to)\r\n    
.order(\"created_at\", { ascending: 
true });\r\n\r\n  if (error) {\r\n  
  console.error(\"Error fetching 
members:\", error);\r\n    return { 
success: false, message: 
error.message, data: [], metadata: 
{ total: 0, page, pageSize, 
totalPages: 0 } };\r\n  }\r\n\r\n  
// Manually fetch biodata for 
members with no user but having 
NIK\r\n  let finalData: any[] = 
data || [];\r\n\r\n  if 
(finalData.length > 0) {\r\n    
const membersWithoutUser = 
finalData.filter((m: any) => 
!m.user && (m.biodata_nik || 
m.employee_id));\r\n\r\n    if 
(membersWithoutUser.length > 0) 
{\r\n      const niks = 
membersWithoutUser.map((m: any) => 
m.biodata_nik || m.employee_id).filt
er(Boolean);\r\n\r\n      if 
(niks.length > 0) {\r\n        
const { data: biodataList } = await 
adminClient\r\n          
.from(\"biodata\")\r\n          
.select(\"nik, nama\")\r\n          
.in(\"nik\", niks);\r\n\r\n        
if (biodataList) {\r\n          
const biodataMap = new 
Map(biodataList.map((b: any) => 
[b.nik, b]));\r\n\r\n          
finalData = finalData.map(member => 
{\r\n            if (!member.user 
&& (member.biodata_nik || 
member.employee_id)) {\r\n          
    const nik = member.biodata_nik 
|| member.employee_id;\r\n          
    const biodata = 
biodataMap.get(nik);\r\n            
  if (biodata) {\r\n                
member.biodata = biodata;\r\n       
       }\r\n            }\r\n       
     return member;\r\n          
});\r\n        }\r\n      }\r\n    
}\r\n  }\r\n\r\n  const 
mappedMembers = finalData.map((m: 
any) => ({\r\n    id: 
String(m.id),\r\n    name: 
m.user\r\n      ? 
`${m.user.first_name || ''} 
${m.user.last_name || ''}`.trim() 
|| m.user.display_name\r\n      : 
(m.biodata?.nama || \"Unknown 
Member\")\r\n  }));\r\n\r\n  return 
{\r\n    success: true,\r\n    
data: mappedMembers,\r\n    
metadata: {\r\n      total: count 
|| 0,\r\n      page,\r\n      
pageSize,\r\n      totalPages: 
Math.ceil((count || 0) / 
pageSize)\r\n    }\r\n  
};\r\n};\r\n\r\nexport const 
getAllOrganizationMemberIds = async 
({\r\n  query = \"\",\r\n  
organizationId,\r\n}: {\r\n  
query?: string;\r\n  
organizationId?: string;\r\n}) => 
{\r\n  const supabase = await 
getSupabase();\r\n  const 
adminClient = 
createAdminClient();\r\n\r\n  // 1. 
Get user and organization if not 
provided\r\n  let targetOrgId = 
organizationId;\r\n\r\n  if 
(!targetOrgId) {\r\n    const { 
data: { user }, error: userError } 
= await 
supabase.auth.getUser();\r\n\r\n    
if (userError || !user) {\r\n      
return { success: false, message: 
\"User not logged in\", data: [] 
};\r\n    }\r\n\r\n    const { 
data: member } = await supabase\r\n 
     
.from(\"organization_members\")\r\n 
     
.select(\"organization_id\")\r\n    
  .eq(\"user_id\", user.id)\r\n     
 .maybeSingle();\r\n\r\n    if 
(!member) {\r\n      return { 
success: false, message: \"User not 
registered in any organization\", 
data: [] };\r\n    }\r\n    
targetOrgId = member.organization_id
.toString();\r\n  }\r\n\r\n  let 
allIds: string[] = [];\r\n  let 
currentPage = 0;\r\n  const 
pageSize = 1000;\r\n  let hasMore = 
true;\r\n\r\n  while (hasMore) 
{\r\n    const from = currentPage * 
pageSize;\r\n    const to = from + 
pageSize - 1;\r\n\r\n    // Clone 
the query builder if needed, but 
here we just need to add range\r\n  
  // Note: queryBuilder is modified 
in place, so we need to be 
careful.\r\n    // However, if we 
define queryBuilder specific to the 
loop or just use range.\r\n\r\n    
// Better to reconstruct query each 
time or use existing if it supports 
re-execution with range.\r\n    // 
Supabase query builders are 
immutable-ish until executed? \r\n  
  // Actually, calling .range() 
returns a new builder usually.\r\n  
  // Let's safe bet: reconstruct or 
use a base builder.\r\n\r\n    let 
pageQuery;\r\n\r\n    if (query) 
{\r\n      pageQuery = 
adminClient\r\n        
.from(\"organization_members\")\r\n 
       .select(`\r\n          
id,\r\n          user:user_id!inner 
(\r\n            first_name,\r\n    
        last_name,\r\n            
display_name\r\n          )\r\n     
   `)\r\n        
.eq(\"organization_id\", 
targetOrgId)\r\n        
.eq(\"is_active\", true)\r\n        
.or(`first_name.ilike.%${query}%,las
t_name.ilike.%${query}%,display_name
.ilike.%${query}%`, { foreignTable: 
\"user\" });\r\n    } else {\r\n    
  pageQuery = adminClient\r\n       
 
.from(\"organization_members\")\r\n 
       .select(`id`)\r\n        
.eq(\"organization_id\", 
targetOrgId)\r\n        
.eq(\"is_active\", true);\r\n    
}\r\n\r\n    const { data, error } 
= await pageQuery\r\n      
.range(from, to)\r\n      
.order(\"created_at\", { ascending: 
true });\r\n\r\n    if (error) 
{\r\n      console.error(\"Error 
fetching member IDs page\", 
currentPage, error);\r\n      // 
specific error handling? return 
partial?\r\n      return { success: 
false, message: error.message, 
data: [] };\r\n    }\r\n\r\n    if 
(data && data.length > 0) {\r\n     
 const ids = data.map((m: any) => 
String(m.id));\r\n      allIds = 
allIds.concat(ids);\r\n\r\n      if 
(data.length < pageSize) {\r\n      
  hasMore = false;\r\n      } else 
{\r\n        currentPage++;\r\n     
 }\r\n    } else {\r\n      hasMore 
= false;\r\n    }\r\n\r\n    // 
Safety break to prevent infinite 
loops if something goes wrong\r\n   
 if (currentPage > 50) { // 50 * 
1000 = 50,000 members\r\n      conso
le.warn(\"getAllOrganizationMemberId
s reached safety limit of 50 
pages\");\r\n      hasMore = 
false;\r\n    }\r\n  }\r\n\r\n  
return {\r\n    success: true,\r\n  
  data: allIds\r\n  };\r\n};","usedD
eprecatedRules":[]},{"filePath":"D:\
\UBIG\\Projek\\Presensi-New\\src\\ac
tion\\projects.ts","messages":[{"rul
eId":"prefer-const","severity":2,"me
ssage":"'teamMembersByTeamId' is 
never reassigned. Use 'const' instea
d.","line":104,"column":9,"nodeType"
:"Identifier","messageId":"useConst"
,"endLine":104,"endColumn":51,"fix":
{"range":[3268,3320],"text":"const 
teamMembersByTeamId: Record<number, 
any[]> = {};"}}],"suppressedMessages
":[],"errorCount":1,"fatalErrorCount
":0,"warningCount":0,"fixableErrorCo
unt":1,"fixableWarningCount":0,"sour
ce":"\"use server\";\r\n\r\nimport 
{ createClient } from \"@/utils/supa
base/server\";\r\nimport { 
createAdminClient } from \"@/utils/s
upabase/admin\";\r\nimport { 
getUserOrganization } from \"@/utils
/get-user-org\";\r\n\r\nexport 
interface IProject {\r\n    id: 
number;\r\n    organization_id: 
number;\r\n    code: string;\r\n    
name: string;\r\n    description?: 
string;\r\n    status: string;\r\n  
  priority: string;\r\n    
start_date?: string;\r\n    
end_date?: string;\r\n    
is_billable: boolean;\r\n    
currency_code: string;\r\n    
budget_amount?: number;\r\n    
budget_hours?: number;\r\n    
color_code?: string;\r\n    
metadata?: any;\r\n    created_at: 
string;\r\n    updated_at: 
string;\r\n    deleted_at?: 
string;\r\n\r\n    // Joined 
relation\r\n    organizations?: 
{\r\n        id: number;\r\n        
name: string;\r\n    };\r\n    
team_projects?: {\r\n        
team_id: number;\r\n        teams?: 
{\r\n            id: number;\r\n    
        name: string;\r\n           
 team_members?: {\r\n               
 id: number;\r\n                
role: string;\r\n                
organization_members?: {\r\n        
            id: number;\r\n         
           user_id: string;\r\n     
               user_profiles?: 
{\r\n                        id: 
string;\r\n                        
first_name: string;\r\n             
           last_name: string;\r\n   
                     
profile_photo_url: string;\r\n      
              }\r\n                
}\r\n            }[];\r\n        
};\r\n    }[];\r\n}\r\n\r\nexport 
const getAllProjects = async 
(organizationId?: number | string) 
=> {\r\n    const supabase = await 
createClient();\r\n\r\n    let 
finalOrgId = 
organizationId;\r\n\r\n    if 
(!finalOrgId) {\r\n        try 
{\r\n            finalOrgId = await 
getUserOrganization(supabase);\r\n  
      } catch (error: any) {\r\n    
        console.error(\"Error 
fetching organization:\", 
error);\r\n            return { 
success: false, message: 
error.message || \"Error fetching 
organization\", data: [] };\r\n     
   }\r\n    }\r\n\r\n    
console.log(`[ACTION 
getAllProjects] Received orgId: 
${organizationId}, Resolved 
finalOrgId: 
${finalOrgId}`);\r\n\r\n    // Step 
1: Fetch projects with basic team 
info (team names) + task count + 
client\r\n    const { data, error } 
= await supabase\r\n        
.from(\"projects\")\r\n        
.select(`\r\n            *,\r\n     
       organizations(id, name),\r\n 
           team_projects(team_id, 
teams(id, name)),\r\n            
tasks(count),\r\n            
client_projects(client_id, 
clients(id, name))\r\n        
`)\r\n        
.eq(\"organization_id\", 
finalOrgId)\r\n        
.neq(\"status\", \"deleted\")\r\n   
     .order(\"name\", { ascending: 
true });\r\n\r\n    if (error) 
{\r\n        
console.error(\"Supabase fetch 
error in getAllProjects:\", 
error.message, error.details, 
error.hint);\r\n        return { 
success: false, message: 
error.message, data: [] };\r\n    
}\r\n\r\n    // Step 2: Collect all 
team_ids from all projects\r\n    
const allTeamIds: number[] = 
[];\r\n    (data || 
[]).forEach((proj: any) => {\r\n    
    (proj.team_projects || 
[]).forEach((tp: any) => {\r\n      
      if (tp.team_id && 
!allTeamIds.includes(tp.team_id)) 
{\r\n                
allTeamIds.push(tp.team_id);\r\n    
        }\r\n        });\r\n    
});\r\n\r\n    
console.log(\"[getAllProjects] 
allTeamIds:\", allTeamIds);\r\n\r\n 
   // Step 3: Fetch all team 
members for those teams (use 
adminClient to bypass RLS)\r\n    
const adminClient = 
createAdminClient();\r\n    let 
teamMembersByTeamId: Record<number, 
any[]> = {};\r\n    if 
(allTeamIds.length > 0) {\r\n       
 const { data: tmData, error: 
tmError } = await adminClient\r\n   
         
.from(\"team_members\")\r\n         
   .select(`\r\n                
team_id,\r\n                
organization_member_id,\r\n         
       role,\r\n                orga
nization_members!team_members_organi
zation_member_id_fkey(\r\n          
          id,\r\n                   
 user_id,\r\n                    use
r_profiles!organization_members_user
_id_fkey(\r\n                       
 id,\r\n                        
first_name,\r\n                     
   last_name,\r\n                   
     profile_photo_url\r\n          
          )\r\n                
)\r\n            `)\r\n            
.in(\"team_id\", 
allTeamIds);\r\n\r\n        
console.log(\"[getAllProjects] 
team_members query error:\", 
tmError);\r\n        
console.log(\"[getAllProjects] 
team_members count:\", 
tmData?.length, \"sample:\", 
JSON.stringify(tmData?.slice(0, 1), 
null, 2));\r\n\r\n        if 
(!tmError && tmData) {\r\n          
  tmData.forEach((tm: any) => {\r\n 
               const tid = 
tm.team_id as number;\r\n           
     if (!teamMembersByTeamId[tid]) 
{\r\n                    
teamMembersByTeamId[tid] = [];\r\n  
              }\r\n                t
eamMembersByTeamId[tid].push(tm);\r\
n            });\r\n        }\r\n   
 }\r\n\r\n    // Step 4: Inject 
team_members into each project's 
team_projects\r\n    const 
enrichedData = (data || 
[]).map((proj: any) => ({\r\n       
 ...proj,\r\n        team_projects: 
(proj.team_projects || []).map((tp: 
any) => ({\r\n            
...tp,\r\n            teams: 
tp.teams ? {\r\n                
...tp.teams,\r\n                
team_members: 
teamMembersByTeamId[tp.team_id] || 
[]\r\n            } : null,\r\n     
   })),\r\n    }));\r\n\r\n    
return { success: true, data: 
enrichedData as unknown as 
IProject[] };\r\n};\r\n\r\nexport 
const createProject = async 
(payload: {\r\n    name: 
string;\r\n    is_billable?: 
boolean;\r\n    metadata?: any;\r\n 
   teams?: number[];\r\n}, 
organizationId?: number) => {\r\n   
 const supabase = await 
createClient();\r\n\r\n    const { 
data: { user } } = await 
supabase.auth.getUser();\r\n    if 
(!user) return { success: false, 
message: \"Unauthenticated\" 
};\r\n\r\n    let orgId = 
organizationId;\r\n    if (!orgId) 
{\r\n        try {\r\n            
orgId = await 
getUserOrganization(supabase);\r\n  
      } catch (error: any) {\r\n    
        return { success: false, 
message: error.message || \"Failed 
to get organization\" };\r\n        
}\r\n    }\r\n\r\n    // Create 
auto-generated code\r\n    const { 
count } = await supabase\r\n        
.from(\"projects\")\r\n        
.select(\"*\", { count: \"exact\", 
head: true })\r\n        
.eq(\"organization_id\", 
orgId);\r\n\r\n    // Fallback 
timestamp if count is somehow 
null\r\n    const baseCount = count 
!= null ? count + 1 : 
Date.now();\r\n    const code = `PRJ
-${orgId}-${baseCount}`;\r\n\r\n    
const { data, error } = await 
supabase\r\n        
.from(\"projects\")\r\n        
.insert({\r\n            
organization_id: orgId,\r\n         
   code,\r\n            name: 
payload.name,\r\n            
is_billable: payload.is_billable 
!== false, // default true\r\n      
      status: 'active',\r\n         
   metadata: payload.metadata || 
{},\r\n        })\r\n        
.select()\r\n        
.single();\r\n\r\n    if (error) 
return { success: false, message: 
error.message };\r\n\r\n    // 
Handle team_projects\r\n    if 
(payload.teams && 
payload.teams.length > 0) {\r\n     
   const teamProjects = 
payload.teams.map((teamId: number) 
=> ({\r\n            team_id: 
teamId,\r\n            project_id: 
data.id\r\n        }));\r\n        
await supabase.from(\"team_projects\
").insert(teamProjects);\r\n    
}\r\n\r\n    return { success: 
true, data };\r\n};\r\n\r\nexport 
const updateProject = async (id: 
number, payload: {\r\n    name?: 
string;\r\n    is_billable?: 
boolean;\r\n    metadata?: any;\r\n 
   teams?: number[];\r\n    
status?: string;\r\n}) => {\r\n    
const supabase = await 
createClient();\r\n\r\n    const 
updateData: any = {};\r\n    if 
(payload.name !== undefined) 
updateData.name = payload.name;\r\n 
   if (payload.is_billable !== 
undefined) updateData.is_billable = 
payload.is_billable;\r\n    if 
(payload.metadata !== undefined) 
updateData.metadata = 
payload.metadata;\r\n    if 
(payload.status !== undefined) 
updateData.status = 
payload.status;\r\n    
updateData.updated_at = new 
Date().toISOString();\r\n\r\n    
const { data, error } = await 
supabase\r\n        
.from(\"projects\")\r\n        
.update(updateData)\r\n        
.eq(\"id\", id)\r\n        
.select()\r\n        
.single();\r\n\r\n    if (error) 
return { success: false, message: 
error.message };\r\n\r\n    if 
(payload.teams !== undefined) {\r\n 
       // Delete old teams\r\n      
  await supabase.from(\"team_project
s\").delete().eq(\"project_id\", 
id);\r\n        // Insert new 
teams\r\n        if 
(payload.teams.length > 0) {\r\n    
        const teamProjects = 
payload.teams.map((teamId: number) 
=> ({\r\n                team_id: 
teamId,\r\n                
project_id: id\r\n            
}));\r\n            await supabase.f
rom(\"team_projects\").insert(teamPr
ojects);\r\n        }\r\n    
}\r\n\r\n    return { success: 
true, data };\r\n};\r\n\r\nexport 
const archiveProject = async (id: 
number) => {\r\n    return 
updateProject(id, { status: 
\"archived\" 
});\r\n};\r\n\r\nexport const 
unarchiveProject = async (id: 
number) => {\r\n    return 
updateProject(id, { status: 
\"active\" });\r\n};\r\n\r\nexport 
const deleteProject = async (id: 
number) => {\r\n    const supabase 
= await createClient();\r\n\r\n    
// Provide soft-delete via 
status\r\n    const { error } = 
await supabase\r\n        
.from(\"projects\")\r\n        
.update({\r\n            status: 
\"deleted\",\r\n            
deleted_at: new 
Date().toISOString()\r\n        
})\r\n        .eq(\"id\", 
id);\r\n\r\n    if (error) return { 
success: false, message: 
error.message };\r\n    return { 
success: true 
};\r\n};\r\n\r\n/**\r\n * Fetch a 
flat list of { id, name } for 
member dropdown pickers.\r\n * Uses 
admin client so RLS doesn't block 
results.\r\n */\r\nexport const 
getSimpleMembersForDropdown = async 
(organizationId: number | string) 
=> {\r\n    const adminClient = 
createAdminClient();\r\n\r\n    
const { data, error } = await 
adminClient\r\n        
.from(\"organization_members\")\r\n 
       .select(`\r\n            
id,\r\n            user_profiles!org
anization_members_user_id_fkey(\r\n 
               id,\r\n              
  first_name,\r\n                
last_name,\r\n                
display_name,\r\n                
profile_photo_url\r\n            
)\r\n        `)\r\n        
.eq(\"organization_id\", 
organizationId)\r\n        
.eq(\"is_active\", true);\r\n\r\n   
 if (error) {\r\n        console.err
or(\"[getSimpleMembersForDropdown] 
error:\", error.message);\r\n       
 return { success: false, data: [] 
as { id: string; name: string }[] 
};\r\n    }\r\n\r\n    const 
members = (data || []).map((m: any) 
=> {\r\n        const profile = 
m.user_profiles;\r\n        const 
name = profile\r\n            ? 
([profile.first_name, profile.last_n
ame].filter(Boolean).join(\" \") || 
profile.display_name || 
\"Unknown\")\r\n            : 
\"Unknown\";\r\n        return { 
id: String(m.id), name };\r\n    
}).filter(m => m.name !== 
\"Unknown\");\r\n\r\n    console.log
(\"[getSimpleMembersForDropdown] 
count:\", members.length);\r\n    
return { success: true, data: 
members };\r\n};\r\n","usedDeprecate
dRules":[]},{"filePath":"D:\\UBIG\\P
rojek\\Presensi-New\\src\\action\\us
ers.ts","messages":[{"ruleId":null,"
message":"Unused eslint-disable 
directive (no problems were 
reported from '@typescript-eslint/no
-explicit-any').","line":125,"column
":3,"severity":1,"nodeType":null,"fi
x":{"range":[3722,3784],"text":" "}}
,{"ruleId":null,"message":"Unused 
eslint-disable directive (no 
problems were reported from '@typesc
ript-eslint/no-explicit-any').","lin
e":135,"column":3,"severity":1,"node
Type":null,"fix":{"range":[4162,4224
],"text":" "}},{"ruleId":null,"messa
ge":"Unused eslint-disable 
directive (no problems were 
reported from '@typescript-eslint/no
-explicit-any').","line":139,"column
":5,"severity":1,"nodeType":null,"fi
x":{"range":[4349,4411],"text":" "}}
,{"ruleId":null,"message":"Unused 
eslint-disable directive (no 
problems were reported from '@typesc
ript-eslint/no-explicit-any').","lin
e":141,"column":3,"severity":1,"node
Type":null,"fix":{"range":[4472,4534
],"text":" "}},{"ruleId":null,"messa
ge":"Unused eslint-disable 
directive (no problems were 
reported from '@typescript-eslint/no
-explicit-any').","line":153,"column
":5,"severity":1,"nodeType":null,"fi
x":{"range":[4936,4998],"text":" "}}
,{"ruleId":null,"message":"Unused 
eslint-disable directive (no 
problems were reported from '@typesc
ript-eslint/no-explicit-any').","lin
e":157,"column":7,"severity":1,"node
Type":null,"fix":{"range":[5148,5210
],"text":" "}}],"suppressedMessages"
:[],"errorCount":0,"fatalErrorCount"
:0,"warningCount":6,"fixableErrorCou
nt":0,"fixableWarningCount":6,"sourc
e":"\"use server\"\r\n\r\nimport { 
createClient } from \"@/utils/supaba
se/server\"\r\nimport { IUser } 
from \"@/interface\"\r\n\r\nimport 
{ logger } from 
'@/lib/logger';\r\n// Helper buat 
bikin client\r\nasync function 
getSupabase() {\r\n  return await 
createClient()\r\n}\r\n\r\n// 
======================\r\n// SIGN 
UP\r\n// 
======================\r\nexport 
async function signUp(formData: 
FormData) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
email = formData.get(\"email\") as 
string\r\n  const password = 
formData.get(\"password\") as 
string\r\n  const firstName = 
(formData.get(\"first_name\") as 
string) || \"\"\r\n  const 
middleName = 
(formData.get(\"middle_name\") as 
string) || \"\"\r\n  const lastName 
= (formData.get(\"last_name\") as 
string) || \"\"\r\n\r\n  const 
displayNameParts = [firstName, 
middleName, lastName].filter((part) 
=> part && part.trim() !== 
\"\")\r\n  const displayName = 
displayNameParts.join(\" \") || 
firstName || email\r\n\r\n  const { 
data, error } = await 
supabase.auth.signUp({\r\n    
email,\r\n    password,\r\n    
options: {\r\n      data: {\r\n     
   first_name: firstName,\r\n       
 middle_name: middleName || 
null,\r\n        last_name: 
lastName || null,\r\n        
display_name: displayName,\r\n      
},\r\n      // Ensure email 
confirmation is handled 
automatically\r\n      
emailRedirectTo: 
`${process.env.NEXT_PUBLIC_SITE_URL 
|| process.env.NEXT_PUBLIC_APP_URL 
|| 'https://absensi-ubig.vercel.app'
}/onboarding`,\r\n    },\r\n  
})\r\n\r\n  if (error) return { 
error: error.message }\r\n\r\n  // 
If user is created and confirmed 
(auto-confirm is enabled in 
Supabase)\r\n  if (data.user && 
data.session) {\r\n    return { 
success: true, user: data.user, 
session: data.session }\r\n  
}\r\n\r\n  // If user is created 
but not confirmed (email 
confirmation required)\r\n  if 
(data.user && !data.session) {\r\n  
  return { success: true, user: 
data.user, needsConfirmation: true 
}\r\n  }\r\n\r\n  return { success: 
true, user: data.user 
}\r\n}\r\n\r\n// 
======================\r\n// SIGN 
IN WITH GOOGLE\r\n// 
======================\r\nexport 
async function signInWithGoogle() 
{\r\n  const supabase = await 
getSupabase()\r\n\r\n  const { 
data, error } = await 
supabase.auth.signInWithOAuth({\r\n 
   provider: 'google',\r\n    
options: {\r\n      redirectTo: 
`${process.env.NEXT_PUBLIC_SITE_URL 
|| process.env.NEXT_PUBLIC_APP_URL 
|| 'https://absensi-ubig.vercel.app'
}/auth/callback`,\r\n      
skipBrowserRedirect: false,\r\n     
 queryParams: {\r\n        
access_type: 'online',\r\n        
prompt: 'select_account',\r\n      
},\r\n    },\r\n  })\r\n\r\n  if 
(error) {\r\n    
logger.error('Google OAuth error:', 
error)\r\n    return { error: 
error.message, url: null }\r\n  
}\r\n\r\n  return { url: data.url, 
error: null }\r\n}\r\n\r\n// 
======================\r\n// 
LOGIN\r\n// 
======================\r\nexport 
async function login(formData: 
FormData) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
email = formData.get(\"email\") as 
string\r\n  const password = 
formData.get(\"password\") as 
string\r\n\r\n  const { data, error 
} = await supabase.auth.signInWithPa
ssword({\r\n    email,\r\n    
password,\r\n  })\r\n\r\n  if 
(error) return { success: false, 
message: error.message }\r\n  if 
(!data.user) {\r\n    return { 
success: false, message: \"Login 
failed. Please ensure your email is 
confirmed.\" }\r\n  }\r\n\r\n  
const user = data.user\r\n\r\n  
const { data: profiles, error: 
profileError } = await supabase\r\n 
   .from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    .eq(\"id\", 
user.id)\r\n    .limit(1)\r\n\r\n  
const profile = 
profiles?.[0]\r\n\r\n  if 
(profileError) return { success: 
false, message: 
profileError.message }\r\n\r\n  // 
Get organization role\r\n  const { 
data: orgMemberships } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(`\r\n      
role:system_roles(code, name)\r\n   
 `)\r\n    .eq(\"user_id\", 
user.id)\r\n    .eq(\"is_active\", 
true)\r\n\r\n  const orgMember = 
orgMemberships?.[0]\r\n\r\n  // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n  const 
orgRole = orgMember?.role ? 
(Array.isArray(orgMember.role) ? 
orgMember.role[0]?.code : 
(orgMember.role as any)?.code) : 
null\r\n\r\n  const { data: 
rolesData, error: roleError } = 
await supabase\r\n    
.from(\"user_roles\")\r\n    
.select(\"role:system_roles(id, 
name)\")\r\n    .eq(\"user_id\", 
user.id)\r\n\r\n  if (roleError) 
return { success: false, message: 
roleError.message }\r\n\r\n  // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n  const 
roles = (rolesData as any)?.map((r: 
any) => ({\r\n    id: r.role?.id || 
r.id,\r\n    name: r.role?.name || 
r.name\r\n    // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n  
})).filter((role: any) => role.id 
&& role.name) ?? []\r\n  // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n  const 
roleIds = roles.map((r: any) => 
r.id)\r\n\r\n  let permissions: { 
code: string; name: string }[] = 
[]\r\n  if (roleIds.length > 0) 
{\r\n    const { data: permData, 
error: permError } = await 
supabase\r\n      
.from(\"role_permissions\")\r\n     
 .select(\"permission:permissions(co
de, name)\")\r\n      
.in(\"role_id\", roleIds)\r\n\r\n   
 if (permError) return { success: 
false, message: permError.message 
}\r\n\r\n    // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n    
permissions = (permData as 
any)?.map((p: any) => ({\r\n      
code: p.permission?.code || 
p.code,\r\n      name: 
p.permission?.name || p.name\r\n    
  // eslint-disable-next-line @types
cript-eslint/no-explicit-any\r\n    
})).filter((perm: any) => perm.code 
&& perm.name) ?? []\r\n  }\r\n\r\n  
return {\r\n    success: true,\r\n  
  user: {\r\n      id: user.id,\r\n 
     email: user.email,\r\n      
...profile, // Spread all profile 
data including 
profile_photo_url\r\n    },\r\n    
roles,\r\n    permissions,\r\n    
orgRole, // Organization role code 
(e.g., 'ADMIN_ORG', 
'SUPER_ADMIN')\r\n  
}\r\n}\r\n\r\n// 
======================\r\n// 
PASSWORD RESET\r\n// 
======================\r\nexport 
async function 
requestPasswordReset(formData: 
FormData) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
email = (formData.get('email') as 
string)?.trim()\r\n\r\n  if 
(!email) {\r\n    return { success: 
false, message: 'Email is 
required.' }\r\n  }\r\n\r\n  const 
redirectUrl = 
`${process.env.NEXT_PUBLIC_SITE_URL 
|| process.env.NEXT_PUBLIC_APP_URL 
|| 'https://absensi-ubig.vercel.app'
}/auth/reset-password`\r\n\r\n  
const { error } = await supabase.aut
h.resetPasswordForEmail(email, 
{\r\n    redirectTo: 
redirectUrl,\r\n  })\r\n\r\n  if 
(error) {\r\n    return { success: 
false, message: error.message }\r\n 
 }\r\n\r\n  return {\r\n    
success: true,\r\n    message: 'We 
have sent a password reset link to 
your email.',\r\n  
}\r\n}\r\n\r\nexport async function 
resetPassword(formData: FormData) 
{\r\n  const supabase = await 
getSupabase()\r\n\r\n  const 
password = 
(formData.get('password') as 
string)?.trim()\r\n\r\n  if 
(!password || password.length < 8) 
{\r\n    return { success: false, 
message: 'New password must be at 
least 8 characters.' }\r\n  
}\r\n\r\n  const { error } = await 
supabase.auth.updateUser({ password 
})\r\n\r\n  if (error) {\r\n    
return { success: false, message: 
error.message }\r\n  }\r\n\r\n  // 
Optional: ensure recovery session 
is cleared so user logs in 
manually\r\n  await 
supabase.auth.signOut()\r\n\r\n  
return {\r\n    success: true,\r\n  
  message: 'Password successfully 
updated. Please login again.',\r\n  
}\r\n}\r\n\r\n// 
======================\r\n// GET 
ALL USERS (ADMIN ONLY - USE WITH 
CAUTION)\r\n// 
======================\r\n// 
WARNING: This function returns ALL 
users from ALL organizations\r\n// 
Only use this for 
admin/system-level operations\r\n// 
For regular user operations, use 
getOrganizationUsers() 
instead\r\nexport async function 
getAllUsers() {\r\n  const supabase 
= await getSupabase()\r\n\r\n  
const { data, error } = await 
supabase\r\n    
.from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    
.order(\"created_at\", { ascending: 
false })\r\n\r\n  if (error) return 
{ success: false, message: 
error.message, data: [] }\r\n\r\n  
return { success: true, data: data 
as IUser[] }\r\n}\r\n\r\n// 
======================\r\n// GET 
ORGANIZATION USERS (SECURE - 
FILTERED BY ORGANIZATION)\r\n// 
======================\r\n// This 
function returns only users from 
the current user's 
organization\r\nexport async 
function getOrganizationUsers() 
{\r\n  const supabase = await 
getSupabase()\r\n\r\n  // Get 
current user's organization\r\n  
const { data: { user }, error: 
userError } = await 
supabase.auth.getUser()\r\n  if 
(userError || !user) {\r\n    
return { success: false, message: 
\"User not authenticated\", data: 
[] }\r\n  }\r\n\r\n  // Get user's 
organization membership\r\n  const 
{ data: memberships, error: 
memberError } = await supabase\r\n  
  
.from(\"organization_members\")\r\n 
   .select(\"organization_id\")\r\n 
   .eq(\"user_id\", 
user.id)\r\n\r\n  if (memberError 
|| !memberships || 
memberships.length === 0) {\r\n    
return { success: false, message: 
\"User not in any organization\", 
data: [] }\r\n  }\r\n\r\n  const 
member = memberships[0];\r\n  if 
(!member || 
!member.organization_id) {\r\n    
return { success: false, message: 
\"User organization data 
incomplete\", data: [] }\r\n  
}\r\n\r\n  // Get all members in 
the same organization\r\n  const { 
data: orgMembers, error: 
orgMembersError } = await 
supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(\"user_id\")\r\n    
.eq(\"organization_id\", 
member.organization_id)\r\n\r\n  if 
(orgMembersError) {\r\n    return { 
success: false, message: 
orgMembersError.message, data: [] 
}\r\n  }\r\n\r\n  const userIds = 
orgMembers?.map(m => m.user_id) || 
[]\r\n  if (userIds.length === 0) 
{\r\n    return { success: true, 
data: [] }\r\n  }\r\n\r\n  // Fetch 
user profiles ONLY for members in 
the same organization\r\n  const { 
data, error } = await supabase\r\n  
  .from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    .in(\"id\", 
userIds)\r\n    
.order(\"created_at\", { ascending: 
false })\r\n\r\n  if (error) return 
{ success: false, message: 
error.message, data: [] }\r\n\r\n  
return { success: true, data: data 
as IUser[] }\r\n}\r\n\r\nexport 
async function 
getAllUsersNotRegistered() {\r\n  
const supabase = await 
getSupabase()\r\n\r\n  const { 
data: members, error: memberError } 
= await supabase\r\n    
.from(\"organization_members\")\r\n 
   .select(\"user_id\")\r\n\r\n  if 
(memberError) return { success: 
false, message: 
memberError.message, data: [] 
}\r\n\r\n  const memberIds = 
members.map((m) => 
m.user_id)\r\n\r\n  const { data, 
error } = await supabase\r\n    
.from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    .not(\"id\", 
\"in\", `(${memberIds.join(\",\") 
|| 0})`)\r\n    
.order(\"created_at\", { ascending: 
false })\r\n\r\n  if (error) return 
{ success: false, message: 
error.message, data: [] }\r\n\r\n  
return { success: true, data: data 
as IUser[] }\r\n}\r\n\r\n// 
======================\r\n// GET 
CURRENT USER PROFILE\r\n// 
======================\r\nexport 
async function 
getCurrentUserProfile() {\r\n  
const supabase = await 
getSupabase()\r\n\r\n  const { 
data: { user }, error: userError } 
= await supabase.auth.getUser()\r\n 
 if (userError || !user) return { 
error: \"Not logged in\", profile: 
null }\r\n\r\n  const { data: 
profile, error } = await 
supabase\r\n    
.from(\"user_profiles\")\r\n    
.select(\"*\")\r\n    .eq(\"id\", 
user.id)\r\n    .single()\r\n\r\n  
if (error || !profile) return { 
error: error?.message || \"Profile 
not found\", profile: null 
}\r\n\r\n  return { error: null, 
profile }\r\n}\r\n\r\n// 
======================\r\n// 
LOGOUT\r\n// 
======================\r\nexport 
async function logout() {\r\n  
const supabase = await 
getSupabase()\r\n  const { error } 
= await 
supabase.auth.signOut()\r\n\r\n  if 
(error) return { success: false, 
error: error.message }\r\n  return 
{ success: true }\r\n}\r\n\r\n// 
======================\r\n// DELETE 
USER\r\n// 
======================\r\nexport 
async function deleteUsers(id: 
string) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
{ data, error } = await 
supabase\r\n    
.from(\"user_profiles\")\r\n    
.delete()\r\n    .eq(\"id\", 
id)\r\n    .select()\r\n    
.single()\r\n\r\n  if (error) 
return { success: false, message: 
error.message, data: null }\r\n  
return { success: true, message: 
\"Users deleted successfully\", 
data: data as IUser 
}\r\n}\r\n\r\n// 
======================\r\n// UPDATE 
USER\r\n// 
======================\r\nexport 
async function updateUsers(id: 
string, values: Record<string, 
unknown>) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
{ role_id, ...profileData } = 
values\r\n\r\n  const { error: 
profileError } = await supabase\r\n 
   .from(\"user_profiles\")\r\n    
.update(profileData)\r\n    
.eq(\"id\", id)\r\n\r\n  if 
(profileError) return { success: 
false, message: 
profileError.message }\r\n\r\n  if 
(role_id) {\r\n    const { error: 
roleError } = await supabase\r\n    
  .from(\"user_roles\")\r\n      
.upsert({ user_id: id, role_id 
})\r\n\r\n    if (roleError) return 
{ success: false, message: 
roleError.message }\r\n  }\r\n\r\n  
return { success: true 
}\r\n}\r\n\r\n// 
======================\r\n// USER 
ROLES\r\n// 
======================\r\nexport 
async function getUserRoles(userId: 
string) {\r\n  const supabase = 
await getSupabase()\r\n\r\n  const 
{ data: roles, error } = await 
supabase\r\n    
.from(\"user_roles\")\r\n    
.select(`role:system_role(name, 
id)`)\r\n    .eq(\"user_id\", 
userId)\r\n\r\n  if (error) return 
{ success: false, message: 
error.message, data: [] }\r\n\r\n  
return { success: true, data: roles 
}\r\n}\r\n\r\n// 
======================\r\n// USER 
PERMISSIONS\r\n// 
======================\r\nexport 
async function 
getUserPermissions(userId: string) 
{\r\n  const supabase = await 
getSupabase()\r\n\r\n  const { 
data: roles, error: roleError } = 
await supabase\r\n    
.from(\"user_roles\")\r\n    
.select(`role_id`)\r\n    
.eq(\"user_id\", userId)\r\n\r\n  
if (roleError) return { success: 
false, message: roleError.message, 
data: [] }\r\n  if (!roles || 
roles.length === 0) return { 
success: true, data: [] }\r\n\r\n  
const roleIds = roles.map((r) => 
r.role_id)\r\n\r\n  const { data: 
permissions, error: permError } = 
await supabase\r\n    
.from(\"role_permissions\")\r\n    .
select(`permission:permission(name, 
code), role:system_role(name)`)\r\n 
   .in(\"role_id\", 
roleIds)\r\n\r\n  if (permError) 
return { success: false, message: 
permError.message, data: [] 
}\r\n\r\n  return { success: true, 
data: permissions }\r\n}\r\n","usedD
eprecatedRules":[]},{"filePath":"D:\
\UBIG\\Projek\\Presensi-New\\src\\ap
p\\attendance\\list\\page.tsx","mess
ages":[{"ruleId":null,"message":"Unu
sed eslint-disable directive (no 
problems were reported from 'react-h
ooks/exhaustive-deps').","line":302,
"column":5,"severity":1,"nodeType":n
ull,"fix":{"range":[12272,12327],"te
xt":" "}}],"suppressedMessages":[],"
errorCount":0,"fatalErrorCount":0,"w
arningCount":1,"fixableErrorCount":0
,"fixableWarningCount":1,"source":"\
"use client\"\r\nimport React, { 
useCallback, useEffect, useMemo, 
useRef, useState } from 
\"react\"\r\nimport type { 
RealtimePostgresChangesPayload } 
from 
\"@supabase/supabase-js\"\r\nimport 
type { DateFilterState } from \"@/co
mponents/analytics/date-filter-bar\"
\r\nimport { DateFilterBar } from \"
@/components/analytics/date-filter-b
ar\"\r\nimport { useOrgStore } from 
\"@/store/org-store\"\r\nimport { 
formatInTimeZone } from 
\"date-fns-tz\"\r\nimport type { 
GetAttendanceResult, 
AttendanceListItem } from 
\"@/action/attendance\"\r\nimport 
Link from \"next/link\"\r\nimport { 
Card, CardContent } from 
\"@/components/ui/card\"\r\nimport 
{ Button } from \"@/components/ui/bu
tton\"\r\nimport { createClient } 
from \"@/utils/supabase/client\"\r\n
import { Input } from 
\"@/components/ui/input\"\r\nimport 
{ toast } from \"sonner\"\r\nimport 
{ deleteAttendanceRecord, 
deleteMultipleAttendanceRecords, 
updateAttendanceRecord } from 
\"@/action/attendance\"\r\nimport { 
ConfirmDialog } from \"@/components/
ui/confirm-dialog\"\r\nimport {\r\n 
 Dialog,\r\n  DialogContent,\r\n  
DialogHeader,\r\n  DialogTitle,\r\n 
 DialogDescription,\r\n  
DialogFooter\r\n} from \"@/component
s/ui/dialog\"\r\nimport {\r\n  
Select,\r\n  SelectContent,\r\n  
SelectItem,\r\n  SelectTrigger,\r\n 
 SelectValue,\r\n} from \"@/componen
ts/ui/select\"\r\nimport { 
Separator } from \"@/components/ui/s
eparator\"\r\nimport { 
AnimatePresence, motion } from 
\"framer-motion\"\r\nimport {\r\n  
Search,\r\n  RotateCcw,\r\n  
Plus,\r\n  Download,\r\n  Edit,\r\n 
 Trash2,\r\n  CheckCircle2,\r\n  
Timer,\r\n  XCircle,\r\n  
AlertCircle,\r\n} from 
\"lucide-react\"\r\n\r\nimport { 
Avatar, AvatarFallback, AvatarImage 
} from \"@/components/ui/avatar\"\r\
nimport { Badge } from 
\"@/components/ui/badge\"\r\nimport 
{ Skeleton } from \"@/components/ui/
skeleton\"\r\nimport { 
PaginationFooter } from \"@/componen
ts/tables/pagination-footer\"\r\nimp
ort { cn } from 
\"@/lib/utils\"\r\nimport { 
formatLocalTime } from \"@/utils/tim
ezone\"\r\n\r\nfunction 
initialsFromName(name: string): 
string {\r\n  const parts = (name 
|| \"\").trim().split(/\\s+/).filter
(Boolean)\r\n  const first = 
parts[0]?.[0] ?? \"\"\r\n  const 
second = parts[1]?.[0] ?? \"\"\r\n  
return (first + second).toUpperCase(
)\r\n}\r\n\r\n// Tambahan helper 
untuk konsistensi tanggal sesuai 
timezone organisasi\r\nfunction 
toOrgYMD(d: Date, tz?: string): 
string {\r\n  if (!tz || tz === 
\"UTC\") {\r\n    const dt = new 
Date(d.getTime() - 
d.getTimezoneOffset() * 60000)\r\n  
  return dt.toISOString().slice(0, 
10)\r\n  }\r\n  try {\r\n    return 
formatInTimeZone(d, tz, 
\"yyyy-MM-dd\")\r\n  } catch {\r\n  
  const dt = new Date(d.getTime() - 
d.getTimezoneOffset() * 60000)\r\n  
  return dt.toISOString().slice(0, 
10)\r\n  }\r\n}\r\n\r\n// Clone 
lokal (sementara tetap delegasi ke 
komponen lama agar UI 
identik)\r\nfunction 
ModernAttendanceListCloned() {\r\n  
const orgStore = 
useOrgStore()\r\n\r\n  const 
[selectedOrgId, setSelectedOrgId] = 
useState<number | null>(null)\r\n  
const [dateRange, setDateRange] = 
useState<DateFilterState>(() => 
{\r\n    const start = new 
Date()\r\n    start.setHours(0, 0, 
0, 0)\r\n    const end = new 
Date()\r\n    end.setHours(23, 59, 
59, 999)\r\n    return { from: 
start, to: end, preset: \"today\" 
}\r\n  })\r\n\r\n  const 
[searchInput, setSearchInput] = 
useState<string>(\"\")\r\n  const 
[searchQuery, setSearchQuery] = 
useState<string>(\"\")\r\n  const 
[statusFilter, setStatusFilter] = 
useState<string>(\"all\")\r\n  
const [departmentFilter, 
setDepartmentFilter] = 
useState<string>(\"all\")\r\n  
const [selectedRecords, 
setSelectedRecords] = 
useState<string[]>([])\r\n  const 
[loading, setLoading] = 
useState<boolean>(true)\r\n  const 
[currentPage, setCurrentPage] = 
useState<number>(1)\r\n  const 
[itemsPerPage, setItemsPerPage] = 
useState<number>(10)\r\n  const 
[totalItems, setTotalItems] = 
useState<number>(0)\r\n  const 
[attendanceData, setAttendanceData] 
= useState<AttendanceListItem[]>([])
\r\n  const [userTimezone, 
setUserTimezone] = 
useState<string>(\"UTC\")\r\n  
//state list party\r\n  const 
[initialized, setInitialized] = 
useState(false)\r\n\r\n  // 
Tambahan untuk toolbar\r\n  const 
[departments, setDepartments] = 
useState<string[]>([])\r\n  const 
[isMounted, setIsMounted] = 
useState(false)\r\n  const 
[isSubmitting, setIsSubmitting] = 
useState(false)\r\n  const 
SHOW_LOCATION = false\r\n\r\n  // 
Confirm dialog state\r\n  type 
ConfirmState = { mode: \"single\" | 
\"bulk\"; id?: string }\r\n  const 
[confirmOpen, setConfirmOpen] = 
useState(false)\r\n  const 
[confirmState, setConfirmState] = 
useState<ConfirmState | 
null>(null)\r\n\r\n  // Edit dialog 
state\r\n  const [editOpen, 
setEditOpen] = useState(false)\r\n  
const [editTarget, setEditTarget] = 
useState<AttendanceListItem | 
null>(null)\r\n  const [editIn, 
setEditIn] = 
useState<string>(\"\")\r\n  const 
[editOut, setEditOut] = 
useState<string>(\"\")\r\n  const 
[editRemarks, setEditRemarks] = 
useState<string>(\"\")\r\n  // 
const fetchRef = useRef<(opts?: { 
mode?: \"full\" | \"single\"; id?: 
string }) => void>(() => {})\r\n  
// useEffect(() => { 
fetchRef.current = fetchData }, 
[fetchData])\r\n\r\n  // request id 
guard untuk menghindari stale 
update\r\n  const latestRequestRef 
= useRef(0)\r\n\r\n  useEffect(() 
=> {\r\n    const orgId = 
selectedOrgId || 
orgStore.organizationId\r\n    if 
(!orgId) return\r\n    const 
supabase = createClient()\r\n    
const channel = supabase\r\n      .c
hannel(`attendance_records:${orgId}`
)\r\n      .on(\r\n        
'postgres_changes',\r\n        { 
event: '*', schema: 'public', 
table: 'attendance_records' },\r\n  
      (\r\n          payload: Realti
mePostgresChangesPayload<{\r\n      
      new: { id?: string | number } 
| null\r\n            old: { id?: 
string | number } | null\r\n        
  }>\r\n        ) => {\r\n          
if (payload.eventType === 'INSERT' 
|| payload.eventType === 'UPDATE') 
{\r\n            const id = 
String((payload.new as { id?: 
string | number })?.id ?? '')\r\n   
         if (id) fetchRef.current({ 
mode: 'single', id })\r\n           
 else fetchRef.current({ mode: 
'full' })\r\n          } else if 
(payload.eventType === 'DELETE') 
{\r\n            const id = 
String((payload.old as { id?: 
string | number })?.id ?? '')\r\n   
         if (id) {\r\n              
setAttendanceData(prev => 
prev.filter(r => r.id !== id))\r\n  
            setTotalItems(prev => 
Math.max(0, prev - 1))\r\n          
  } else {\r\n              
fetchRef.current({ mode: 'full' 
})\r\n            }\r\n          
}\r\n        }\r\n      )\r\n      
.subscribe()\r\n\r\n    return () 
=> {\r\n      try { 
supabase.removeChannel(channel) } 
catch { }\r\n    }\r\n  }, 
[selectedOrgId, 
orgStore.organizationId])\r\n\r\n  
// Fallback org dari cookie jika 
store belum siap\r\n  useEffect(() 
=> {\r\n    if (selectedOrgId || 
orgStore.organizationId) return\r\n 
   try {\r\n      const m = 
document.cookie.match(/(?:^|; 
)org_id=(\\d+)/)\r\n      if (m && 
m[1]) {\r\n        const oid = 
Number(m[1])\r\n        if 
(!Number.isNaN(oid)) 
setSelectedOrgId(oid)\r\n      
}\r\n    } catch { }\r\n  }, 
[selectedOrgId, 
orgStore.organizationId])\r\n\r\n  
// Debounce input ke query\r\n  
useEffect(() => {\r\n    const 
timer = window.setTimeout(() => 
{\r\n      const v = (searchInput 
|| '').trim()\r\n      // 
Backend-driven: trigger hanya jika 
kosong (reset) atau >= 2 
karakter\r\n      if (v.length === 
0 || v.length >= 2) {\r\n        
setSearchQuery(v)\r\n      }\r\n    
}, 400)\r\n    return () => 
window.clearTimeout(timer)\r\n  }, 
[searchInput])\r\n\r\n  // Mounted 
flag untuk skeleton di toolbar 
filter\r\n  useEffect(() => {\r\n   
 setIsMounted(true)\r\n  }, 
[])\r\n\r\n  // Recompute 
departments dari attendanceData\r\n 
 useEffect(() => {\r\n    const 
uniqueDepts = Array.from(new 
Set(\r\n      
attendanceData.map((r) => 
r.member?.department)\r\n    
)).filter((d): d is string => 
Boolean(d && d !== \"No 
Department\")).sort()\r\n    const 
same = uniqueDepts.length === 
departments.length && 
uniqueDepts.every((d, i) => d === 
departments[i])\r\n    if (!same) 
setDepartments(uniqueDepts)\r\n  }, 
[attendanceData, 
departments])\r\n\r\n  // Key untuk 
cache (match dgn komponen lama)\r\n 
 const cacheKeyBase = useMemo(() => 
{\r\n    const orgId = 
selectedOrgId || 
orgStore.organizationId || 
\"no-org\"\r\n    const localToYMD 
= (d: Date) => new Date(d.getTime() 
- d.getTimezoneOffset() * 
60000).toISOString().slice(0, 
10)\r\n    const effFrom = 
(userTimezone && userTimezone !== 
\"UTC\") ? 
formatInTimeZone(dateRange.from, 
userTimezone, \"yyyy-MM-dd\") : 
localToYMD(dateRange.from)\r\n    
const effTo = (userTimezone && 
userTimezone !== \"UTC\") ? 
formatInTimeZone(dateRange.to, 
userTimezone, \"yyyy-MM-dd\") : 
localToYMD(dateRange.to)\r\n    
const status = statusFilter || 
\"all\"\r\n    const dept = 
departmentFilter || \"all\"\r\n    
const q = searchQuery || \"\"\r\n   
 return `attendance:list:${orgId}:p=
${currentPage}:l=${itemsPerPage}:fro
m=${effFrom}:to=${effTo}:status=${st
atus}:dept=${dept}:q=${q}`\r\n  }, 
[selectedOrgId, 
orgStore.organizationId, 
currentPage, itemsPerPage, 
dateRange.from, dateRange.to, 
statusFilter, departmentFilter, 
searchQuery, userTimezone])\r\n\r\n 
 // Fetch attendance data via 
server action (sudah Anda tambahkan 
di Tahap-5)\r\n  // helper untuk 
merge 1 record ke state saat 
incremental\r\n  // function 
upsertRecord(next: 
AttendanceListItem) {\r\n  //   
setAttendanceData(prev => {\r\n  // 
    const idx = prev.findIndex(r => 
r.id === next.id)\r\n  //     if 
(idx >= 0) {\r\n  //       const 
copied = [...prev]\r\n  //       
copied[idx] = next\r\n  //       
return copied\r\n  //     }\r\n  // 
    return [next, ...prev]\r\n  //  
 })\r\n  //   setTotalItems(prev => 
Math.max(prev, 1))\r\n  // 
}\r\n\r\n  const fetchData = 
useCallback(\r\n    async (opts?: { 
mode?: \"full\" | \"single\"; id?: 
string }) => {\r\n      const orgId 
= selectedOrgId || 
orgStore.organizationId\r\n      if 
(!orgId) {\r\n        
setLoading(true)\r\n        
return\r\n      }\r\n\r\n      
const mode = opts?.mode ?? 
\"full\"\r\n      const recordId = 
opts?.id\r\n\r\n      if (mode === 
\"single\" && recordId) {\r\n       
 // Rekomendasi: gunakan API route 
GET /api/attendance-records?id=...&o
rganizationId=...\r\n        // 
agar hasilnya sama dengan shape 
AttendanceListItem.\r\n        // 
Di sini contoh minimal: fallback ke 
full fetch jika endpoint by-id 
belum tersedia.\r\n        // 
Ketika endpoint by-id siap, ganti 
blok ini:\r\n        //   const one 
= await 
fetchSingleAttendance(recordId, 
orgId)\r\n        //   if (one && 
isRecordMatchesActiveFilters(one)) 
upsertRecord(one)\r\n        await 
(async () => {\r\n          await 
fetchData({ mode: \"full\" })\r\n   
     })()\r\n        return\r\n     
 }\r\n\r\n      
setLoading(true)\r\n      const 
reqId = latestRequestRef.current + 
1\r\n      latestRequestRef.current 
= reqId\r\n\r\n      try {\r\n      
  const searchParam = (searchQuery 
|| \"\").trim()\r\n        const 
params = new URLSearchParams()\r\n  
      params.set(\"page\", 
String(currentPage))\r\n        
params.set(\"limit\", 
String(itemsPerPage))\r\n        
params.set(\"dateFrom\", 
toOrgYMD(dateRange.from, 
userTimezone))\r\n        
params.set(\"dateTo\", 
toOrgYMD(dateRange.to, 
userTimezone))\r\n        
params.set(\"organizationId\", 
String(orgId))\r\n        if 
(statusFilter && statusFilter !== 
\"all\") params.set(\"status\", 
statusFilter)\r\n        if 
(departmentFilter && 
departmentFilter !== \"all\") 
params.set(\"department\", 
departmentFilter)\r\n        if 
(searchParam.length >= 2) 
params.set(\"search\", 
searchParam)\r\n\r\n        const 
res = await fetch(`/api/attendance-r
ecords?${params.toString()}`, {\r\n 
         method: \"GET\",\r\n       
   credentials: 
\"same-origin\",\r\n        })\r\n  
      const result: 
GetAttendanceResult = await 
res.json()\r\n        if (reqId !== 
latestRequestRef.current) 
return\r\n\r\n        if 
(result.success) {\r\n          
const data = (result.data || []) as 
AttendanceListItem[]\r\n          
setAttendanceData(data)\r\n         
 setTotalItems(Math.max(result.meta?
.total || 0, data.length))\r\n      
    if (data.length > 0) {\r\n      
      const nextTz = 
data[0]?.timezone ?? \"UTC\"\r\n    
        setUserTimezone((prev) => 
(prev === nextTz ? prev : 
nextTz))\r\n          }\r\n        
} else {\r\n          
setAttendanceData([])\r\n          
setTotalItems(0)\r\n        }\r\n   
   } catch {\r\n        if (reqId 
!== latestRequestRef.current) 
return\r\n      } finally {\r\n     
   if (reqId === 
latestRequestRef.current) 
setLoading(false)\r\n      }\r\n    
},\r\n    [selectedOrgId, 
orgStore.organizationId, 
currentPage, itemsPerPage, 
dateRange.from, dateRange.to, 
searchQuery, statusFilter, 
departmentFilter, userTimezone]\r\n 
 )\r\n\r\n  const fetchRef = 
useRef<(opts?: { mode?: \"full\" | 
\"single\"; id?: string }) => 
Promise<void>>(async () => { })\r\n 
 useEffect(() => { fetchRef.current 
= fetchData }, [fetchData])\r\n\r\n 
 useEffect(() => {\r\n    const 
orgId = selectedOrgId || 
orgStore.organizationId\r\n    if 
(!orgId) return\r\n    fetchData({ 
mode: 'full' })\r\n    // 
eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n  }, 
[dateRange.from, dateRange.to, 
statusFilter, departmentFilter, 
searchQuery, itemsPerPage, 
currentPage, selectedOrgId, 
orgStore.organizationId])\r\n\r\n  
// Handler Selected Actions 
(sementara no-op; akan diisi 
setelah list pindah)\r\n  // 
Handler Selected Actions\r\n  const 
handleEditClick = () => {\r\n    if 
(selectedRecords.length === 1) 
{\r\n      const id = 
selectedRecords[0]\r\n      const 
rec = attendanceData.find(r => r.id 
=== id) || null\r\n      if (!rec) 
{\r\n        toast.error(\"Selected 
record not found\")\r\n        
return\r\n      }\r\n      // 
Prefill form\r\n      
setEditTarget(rec)\r\n      
setEditIn(rec.checkIn ?? \"\")\r\n  
    setEditOut(rec.checkOut ?? 
\"\")\r\n      setEditRemarks(\"\") 
// tidak ada kolom remarks di list, 
default kosong\r\n      
setEditOpen(true)\r\n    } else if 
(selectedRecords.length > 1) {\r\n  
    toast.info(\"Bulk edit belum 
didukung\")\r\n    } else {\r\n     
 toast.info(\"Pilih satu record 
untuk diedit\")\r\n    }\r\n  
}\r\n\r\n  const handleEditSingle = 
(rec: AttendanceListItem) => {\r\n  
  setEditTarget(rec)\r\n    
setEditIn(rec.checkIn ?? \"\")\r\n  
  setEditOut(rec.checkOut ?? 
\"\")\r\n    
setEditRemarks(\"\")\r\n    
setEditOpen(true)\r\n  }\r\n\r\n  
const submitEdit = async () => 
{\r\n    if (!editTarget) 
return\r\n    try {\r\n      
setIsSubmitting(true)\r\n      
const res = await 
updateAttendanceRecord({\r\n        
id: editTarget.id,\r\n        
actual_check_in: editIn.trim() === 
\"\" ? null : editIn.trim(),\r\n    
    actual_check_out: 
editOut.trim() === \"\" ? null : 
editOut.trim(),\r\n        remarks: 
editRemarks.trim() === \"\" ? null 
: editRemarks.trim(),\r\n      
})\r\n      if (!res.success) {\r\n 
       toast.error(res.message || 
\"Failed to update record\")\r\n    
    return\r\n      }\r\n      // 
Optimistic update\r\n      
setAttendanceData(prev => {\r\n     
   const next = prev.map(r => {\r\n 
         if (r.id !== 
editTarget.id) return r\r\n         
 return {\r\n            ...r,\r\n  
          checkIn: editIn.trim() 
=== \"\" ? null : 
editIn.trim(),\r\n            
checkOut: editOut.trim() === \"\" ? 
null : editOut.trim(),\r\n          
  // status akan ikut dikoreksi 
oleh realtime/refresh; biarkan 
server hitung\r\n          }\r\n    
    })\r\n        return next\r\n   
   })\r\n      
toast.success(\"Record 
updated\")\r\n      
setEditOpen(false)\r\n      
setEditTarget(null)\r\n    } catch 
(e) {\r\n      const msg = e 
instanceof Error ? e.message : 
\"Failed to update record\"\r\n     
 toast.error(msg)\r\n    } finally 
{\r\n      
setIsSubmitting(false)\r\n    }\r\n 
 }\r\n\r\n  const 
handleDeleteMultiple = async () => 
{\r\n    if (selectedRecords.length 
=== 0) {\r\n      toast.info(\"No 
records selected\")\r\n      
return\r\n    }\r\n    
setConfirmState({ mode: \"bulk\" 
})\r\n    setConfirmOpen(true)\r\n  
}\r\n\r\n  useEffect(() => {\r\n    
// Jika data sudah ada, kita anggap 
initialized\r\n    if 
(attendanceData) 
setInitialized(true)\r\n  }, 
[attendanceData])\r\n\r\n  const 
getStatusColor = (status: string) 
=> {\r\n    switch (status) {\r\n   
   case \"present\":\r\n        
return \"bg-green-100 
text-green-700 dark:bg-green-900/30 
dark:text-green-400\"\r\n      case 
\"late\":\r\n        return 
\"bg-yellow-100 text-yellow-700 
dark:bg-yellow-900/30 
dark:text-yellow-400\"\r\n      
case \"absent\":\r\n        return 
\"bg-red-100 text-red-700 
dark:bg-red-900/30 
dark:text-red-400\"\r\n      case 
\"leave\":\r\n        return 
\"bg-blue-100 text-blue-700 
dark:bg-blue-900/30 
dark:text-blue-400\"\r\n      
default:\r\n        return 
\"bg-gray-100 text-gray-700 
dark:bg-gray-900/30 
dark:text-gray-400\"\r\n    }\r\n  
}\r\n  const getStatusIcon = 
(status: string) => {\r\n    switch 
(status) {\r\n      case 
\"present\":\r\n        return 
<CheckCircle2 className=\"h-3 w-3\" 
/>\r\n      case \"late\":\r\n      
  return <Timer className=\"h-3 
w-3\" />\r\n      case 
\"absent\":\r\n        return 
<XCircle className=\"h-3 w-3\" 
/>\r\n      default:\r\n        
return <AlertCircle className=\"h-3 
w-3\" />\r\n    }\r\n  }\r\n\r\n  
const LocationDisplay: React.FC<{ 
checkInLocationName: string | null; 
checkOutLocationName: string | null 
}> = () => null\r\n\r\n  const 
handleSelectAll = () => {\r\n    if 
(selectedRecords.length === 
attendanceData.length) {\r\n      
setSelectedRecords([])\r\n    } 
else {\r\n      setSelectedRecords(a
ttendanceData.map((r) => r.id))\r\n 
   }\r\n  }\r\n\r\n\r\n\r\n  const 
handleDeleteClick = (id: string) => 
{\r\n    setConfirmState({ mode: 
\"single\", id })\r\n    
setConfirmOpen(true)\r\n  }\r\n\r\n 
 // Flag sementara agar UI TIDAK 
berubah (toolbar baru tidak 
ditampilkan)\r\n  const 
SHOW_LOCAL_TOOLBAR = true\r\n  
const SHOW_LOCAL_LIST = 
true\r\n\r\n\r\n  return (\r\n    
<>\r\n      <style jsx 
global>{`\r\n        html body 
.custom-hover-row:hover,\r\n        
html body .custom-hover-row:hover > 
td {\r\n          background-color: 
#d1d5db !important; /* dark gray 
hover */\r\n        }\r\n        
html body.dark 
.custom-hover-row:hover,\r\n        
html body.dark 
.custom-hover-row:hover > td {\r\n  
        background-color: #374151 
!important;\r\n        }\r\n      
`}</style>\r\n      
{SHOW_LOCAL_TOOLBAR && (\r\n        
<div className=\"space-y-4\">\r\n   
       <div className=\"flex 
items-center justify-between\">\r\n 
           <h1 className=\"text-xl 
font-semibold\">Attendance 
list</h1>\r\n          
</div>\r\n\r\n          <div 
className=\"flex flex-col 
md:flex-row md:items-center gap-3 
md:gap-2 flex-wrap\">\r\n           
 {/* Search */}\r\n            <div 
className=\"w-full md:flex-1 
md:min-w-[200px] relative\">\r\n    
          <Search 
className=\"absolute left-3 top-1/2 
h-4 w-4 -translate-y-1/2 
text-gray-400\" />\r\n              
<Input\r\n                
placeholder=\"Search...\"\r\n       
         value={searchInput}\r\n    
            onChange={(e) => 
setSearchInput(e.target.value)}\r\n 
               onKeyDown={(e) => 
{\r\n                  if (e.key 
=== \"Enter\") 
setSearchQuery(searchInput)\r\n     
           }}\r\n                
className=\"pl-10 border-gray-300 
bg-white w-full\"\r\n              
/>\r\n            </div>\r\n\r\n    
        {/* Date Filter */}\r\n     
       <div className=\"w-full 
md:w-auto shrink-0\">\r\n           
   <DateFilterBar\r\n               
 dateRange={dateRange}\r\n          
      onDateRangeChange={setDateRang
e}\r\n                
className=\"w-full 
justify-start\"\r\n              
/>\r\n            </div>\r\n\r\n    
        {/* Status & Department 
Filter Group */}\r\n            
<div className=\"flex w-full 
md:w-auto gap-2 shrink-0\">\r\n     
         {/* Status Filter */}\r\n  
            <div className=\"flex-1 
md:w-auto\">\r\n                
{isMounted ? (\r\n                  
<Select value={statusFilter} onValue
Change={setStatusFilter}>\r\n       
             <SelectTrigger 
className=\"w-full md:w-[140px] 
border-gray-300 bg-white\">\r\n     
                 <SelectValue 
placeholder=\"Status\" />\r\n       
             </SelectTrigger>\r\n   
                 
<SelectContent>\r\n                 
     <SelectItem value=\"all\">All 
Status</SelectItem>\r\n             
         <SelectItem value=\"present
\">Present</SelectItem>\r\n         
             <SelectItem value=\"lat
e\">Late</SelectItem>\r\n           
           <SelectItem value=\"absen
t\">Absent</SelectItem>\r\n         
             <SelectItem 
value=\"leave\">On 
Leave</SelectItem>\r\n              
      </SelectContent>\r\n          
        </Select>\r\n               
 ) : (\r\n                  <div 
className=\"w-full md:w-[140px] h-9 
border border-gray-300 rounded 
bg-muted/50\" aria-hidden />\r\n    
            )}\r\n              
</div>\r\n\r\n              {/* 
Department Filter */}\r\n           
   <div className=\"flex-1 
md:w-auto\">\r\n                
{isMounted ? (\r\n                  
<Select value={departmentFilter} onV
alueChange={setDepartmentFilter}>\r\
n                    <SelectTrigger 
className=\"w-full md:w-[160px] 
border-gray-300 bg-white\">\r\n     
                 <SelectValue 
placeholder=\"Groups\" />\r\n       
             </SelectTrigger>\r\n   
                 
<SelectContent>\r\n                 
     <SelectItem value=\"all\">All 
Groups</SelectItem>\r\n             
         {departments.map((dept) => 
(\r\n                        
<SelectItem key={dept} 
value={dept}>\r\n                   
       {dept}\r\n                   
     </SelectItem>\r\n              
        ))}\r\n                    
</SelectContent>\r\n                
  </Select>\r\n                ) : 
(\r\n                  <div 
className=\"w-full md:w-[160px] h-9 
border border-gray-300 rounded 
bg-muted/50\" aria-hidden />\r\n    
            )}\r\n              
</div>\r\n            
</div>\r\n\r\n            {/* 
Actions Group */}\r\n            
<div className=\"flex w-full 
md:w-auto gap-2 shrink-0\">\r\n     
         {/* Refresh */}\r\n        
      <Button\r\n                
onClick={() => {\r\n                
  try {\r\n                    local
Storage.removeItem(cacheKeyBase)\r\n
                    localStorage.rem
oveItem(`${cacheKeyBase}:loading`)\r
\n                  } catch { }\r\n 
                 fetchData()\r\n    
            }}\r\n                
title=\"Refresh\"\r\n               
 className=\"shrink-0 bg-zinc-900 
text-zinc-50 hover:bg-zinc-900/90 
dark:bg-zinc-50 dark:text-zinc-900 
dark:hover:bg-zinc-50/90 
hover:cursor-pointer flex-1 
md:flex-none border-0\"\r\n         
     >\r\n                
<RotateCcw className=\"w-4 h-4\" 
/>\r\n              
</Button>\r\n\r\n              {/* 
Import */}\r\n              <Link 
href=\"/attendance/list/import\" 
className=\"flex-1 
md:flex-none\">\r\n                
<Button variant=\"outline\" 
className=\"w-full border-gray-300 
bg-white whitespace-nowrap\">\r\n   
               <Download 
className=\"mr-2 h-4 w-4\" />\r\n   
               Import\r\n           
     </Button>\r\n              
</Link>\r\n\r\n              {/* 
Manual Entry */}\r\n              
<Link href=\"/attendance/list/add\" 
className=\"flex-1 
md:flex-none\">\r\n                
<Button className=\"w-full 
bg-zinc-900 text-zinc-50 
hover:bg-zinc-900/90 
dark:bg-zinc-50 dark:text-zinc-900 
dark:hover:bg-zinc-50/90 
whitespace-nowrap border-0\">\r\n   
               <Plus 
className=\"mr-2 h-4 w-4\" />\r\n   
               Entry\r\n            
    </Button>\r\n              
</Link>\r\n            </div>\r\n   
       </div>\r\n\r\n          {/* 
Selected Actions */}\r\n          
<AnimatePresence>\r\n            
{selectedRecords.length > 0 && 
(\r\n              <motion.div\r\n  
              initial={{ opacity: 
0, y: -10 }}\r\n                
animate={{ opacity: 1, y: 0 }}\r\n  
              exit={{ opacity: 0, 
y: -10 }}\r\n                
className=\"flex items-center gap-2 
rounded-lg bg-muted px-4 py-2\"\r\n 
             >\r\n                
<span className=\"text-sm 
font-medium\">\r\n                  
{selectedRecords.length} 
selected\r\n                
</span>\r\n                
<Separator orientation=\"vertical\" 
className=\"h-6\" />\r\n            
    <Button variant=\"ghost\" 
size=\"sm\" 
onClick={handleEditClick}>\r\n      
            <Edit className=\"mr-2 
h-4 w-4\" />\r\n                  
{selectedRecords.length === 1 ? 
\"Edit\" : \"Bulk Edit\"}\r\n       
         </Button>\r\n              
  <Button\r\n                  
variant=\"destructive\"\r\n         
         size=\"sm\"\r\n            
      
onClick={handleDeleteMultiple}\r\n  
                
disabled={isSubmitting}\r\n         
       >\r\n                  
<Trash2 className=\"mr-2 h-4 w-4\" 
/>\r\n                  Delete 
Selected\r\n                
</Button>\r\n                
<Button\r\n                  
variant=\"ghost\"\r\n               
   size=\"sm\"\r\n                  
onClick={() => 
setSelectedRecords([])}\r\n         
         className=\"ml-auto\"\r\n  
              >\r\n                 
 Clear Selection\r\n                
</Button>\r\n              
</motion.div>\r\n            )}\r\n 
         </AnimatePresence>\r\n     
   </div>\r\n      )}\r\n\r\n      
{SHOW_LOCAL_LIST && (\r\n        
<div className=\"space-y-6\">\r\n   
       {/* Attendance List - LIST 
MODE */}\r\n          <Card>\r\n    
        <CardContent 
className=\"p-0\">\r\n              
{/* Mobile Card View - hidden dulu 
(sesuai komponen lama) */}\r\n      
        <div 
className=\"hidden\">\r\n           
     {(loading || !initialized) ? 
(\r\n                  <div 
className=\"divide-y\">\r\n         
           {Array.from({ length: 6 
}).map((_, i) => (\r\n              
        <div 
key={`mobile-skel-${i}`} 
className=\"p-4 space-y-3\">\r\n    
                    <div 
className=\"flex items-center 
gap-3\">\r\n                        
  <Skeleton className=\"h-10 w-10 
rounded-full\" />\r\n               
           <div className=\"flex-1 
min-w-0 space-y-2\">\r\n            
                <Skeleton 
className=\"h-4 w-40\" />\r\n       
                     <Skeleton 
className=\"h-3 w-24\" />\r\n       
                   </div>\r\n       
                 </div>\r\n         
               <div 
className=\"grid grid-cols-2 
gap-3\">\r\n                        
  <Skeleton className=\"h-4 w-24\" 
/>\r\n                          
<Skeleton className=\"h-4 w-24\" 
/>\r\n                          
<Skeleton className=\"h-4 w-24\" 
/>\r\n                          
<Skeleton className=\"h-6 w-20\" 
/>\r\n                        
</div>\r\n                      
</div>\r\n                    
))}\r\n                  </div>\r\n 
               ) : 
attendanceData.length === 0 ? (\r\n 
                 <div 
className=\"p-8 text-center 
text-muted-foreground\">\r\n        
            No attendance records 
found\r\n                  
</div>\r\n                ) : (\r\n 
                 
attendanceData.map((record, index: 
number) => (\r\n                    
<div key={`mobile-${record.id}-${ind
ex}`} className=\"p-4 space-y-3 
border-b last:border-b-0\">\r\n     
                 {/* ... bagian 
mobile card sama persis, 
dipersingkat di sini ... */}\r\n    
                </div>\r\n          
        ))\r\n                
)}\r\n              </div>\r\n\r\n  
            {/* Desktop Table View 
*/}\r\n              <div 
className=\"overflow-x-auto 
w-full\">\r\n                <table 
className=\"w-full 
min-w-[880px]\">\r\n                
  <thead className=\"border-b 
bg-muted/50\">\r\n                  
  <tr>\r\n                      <th 
className=\"p-3 text-left\">\r\n    
                    <input\r\n      
                    
type=\"checkbox\"\r\n               
           
checked={selectedRecords.length === 
attendanceData.length && 
attendanceData.length > 0}\r\n      
                    
onChange={handleSelectAll}\r\n      
                    
className=\"rounded 
border-gray-300\"\r\n               
         />\r\n                     
 </th>\r\n                      <th 
className=\"p-3 text-left text-xs 
font-medium\">Member</th>\r\n       
               <th className=\"p-3 
text-left text-xs 
font-medium\">Check In</th>\r\n     
                 <th 
className=\"p-3 text-left text-xs 
font-medium\">Check Out</th>\r\n    
                  <th 
className=\"p-3 text-left text-xs 
font-medium\">Break In</th>\r\n     
                 <th 
className=\"p-3 text-left text-xs 
font-medium\">Break Out</th>\r\n    
                  <th 
className=\"p-3 text-left text-xs 
font-medium\">Work Hours</th>\r\n   
                   <th 
className=\"p-3 text-left text-xs 
font-medium\">Status</th>\r\n       
               {SHOW_LOCATION ? <th 
className=\"p-3 text-left text-xs 
font-medium\">Location</th> : 
null}\r\n                      <th 
className=\"p-3 text-left text-xs 
font-medium\">Actions</th>\r\n      
              </tr>\r\n             
     </thead>\r\n                  
<tbody className=\"[&>tr:nth-child(e
ven)]:bg-muted/50\">\r\n            
        {(loading || !initialized) 
? (\r\n                      <>\r\n 
                       
{Array.from({ length: 6 }).map((_, 
i) => (\r\n                         
 <tr key={`table-skel-${i}`} 
className=\"border-b\">\r\n         
                   <td 
className=\"p-3\"><Skeleton 
className=\"h-3 w-3 rounded\" 
/></td>\r\n                         
   <td className=\"p-3\">\r\n       
                       <div 
className=\"flex items-center 
gap-3\">\r\n                        
        <Skeleton className=\"h-8 
w-8 rounded-full\" />\r\n           
                     <div 
className=\"space-y-2\">\r\n        
                          <Skeleton 
className=\"h-3 w-40\" />\r\n       
                           
<Skeleton className=\"h-2.5 w-24\" 
/>\r\n                              
  </div>\r\n                        
      </div>\r\n                    
        </td>\r\n                   
         <td 
className=\"p-3\"><Skeleton 
className=\"h-3 w-16\" /></td>\r\n  
                          <td 
className=\"p-3\"><Skeleton 
className=\"h-3 w-16\" /></td>\r\n  
                          <td 
className=\"p-3\"><Skeleton 
className=\"h-3 w-20\" /></td>\r\n  
                          <td 
className=\"p-3\"><Skeleton 
className=\"h-5 w-20 rounded-full\" 
/></td>\r\n                         
   <td className=\"p-3\"><Skeleton 
className=\"h-3 w-24\" /></td>\r\n  
                          
{SHOW_LOCATION ? <td 
className=\"p-3\"><Skeleton 
className=\"h-3 w-28\" /></td> : 
null}\r\n                           
 <td className=\"p-3\"><div 
className=\"flex items-center 
gap-1\"><Skeleton className=\"h-8 
w-8 rounded\" /><Skeleton 
className=\"h-8 w-8 rounded\" 
/></div></td>\r\n                   
       </tr>\r\n                    
    ))}\r\n                      
</>\r\n                    ) : 
attendanceData.length === 0 ? (\r\n 
                     <tr>\r\n       
                 <td colSpan={9} 
className=\"text-center py-6 
text-muted-foreground 
text-sm\">\r\n                      
    No attendance records found\r\n 
                       </td>\r\n    
                  </tr>\r\n         
           ) : (\r\n                
      attendanceData.map((record: 
AttendanceListItem, index: number) 
=> (\r\n                        
<tr\r\n                          key
={`table-${record.id}-${index}`}\r\n
                          style={{ 
backgroundColor: index % 2 === 1 ? 
'#f3f4f6' : '#ffffff' }}\r\n        
                  
className={cn(\"border-b 
transition-colors cursor-pointer 
custom-hover-row\")}\r\n            
            >\r\n                   
       <td className=\"p-3\">\r\n   
                         <input\r\n 
                             
type=\"checkbox\"\r\n               
               checked={selectedReco
rds.includes(record.id)}\r\n        
                      onChange={(e) 
=> {\r\n                            
    if (e.target.checked) setSelecte
dRecords([...selectedRecords, 
record.id])\r\n                     
           else setSelectedRecords(s
electedRecords.filter(id => id !== 
record.id))\r\n                     
         }}\r\n                     
         className=\"rounded 
border-gray-300\"\r\n               
             />\r\n                 
         </td>\r\n                  
        <td className=\"p-3\">\r\n  
                          <div 
className=\"flex items-center 
gap-3\">\r\n                        
      <Avatar className=\"h-8 
w-8\">\r\n                          
      <AvatarImage 
src={record.member.avatar} />\r\n   
                             <Avatar
Fallback>{initialsFromName(record.me
mber.name)}</AvatarFallback>\r\n    
                          
</Avatar>\r\n                       
       <div>\r\n                    
            <p 
className=\"font-medium 
text-sm\">\r\n                      
            <Link 
href={`/members/${record.member.id 
?? \"\"}`} 
className=\"hover:underline\">\r\n  
                                  
{record.member.name}\r\n            
                      </Link>\r\n   
                             
</p>\r\n                            
    <p className=\"text-xs text-mute
d-foreground\">{record.member.depart
ment}</p>\r\n                       
       </div>\r\n                   
         </div>\r\n                 
         </td>\r\n                  
        <td className=\"p-3\">\r\n  
                          {(() => 
{\r\n                              
const formatted = record.checkIn ? 
formatLocalTime(record.checkIn, 
userTimezone, \"24h\", true) : 
\"-\"\r\n                           
   if (formatted === \"-\") return 
<span className=\"text-xs 
font-mono\">-</span>\r\n            
                  const [datePart, 
timePart] = formatted.split(', 
')\r\n                              
return (\r\n                        
        <div className=\"flex 
flex-col text-xs font-mono\">\r\n   
                               
<span className=\"font-medium whites
pace-nowrap\">{datePart}</span>\r\n 
                                 
<span className=\"text-muted-foregro
und\">{timePart}</span>\r\n         
                         
{record.checkInMethod && (\r\n      
                              <span 
className=\"text-[10px] 
text-muted-foreground uppercase 
font-semibold mt-0.5\">\r\n         
                             
{record.checkInMethod}\r\n          
                          
</span>\r\n                         
         )}\r\n                     
           </div>\r\n               
               )\r\n                
            })()}\r\n               
           </td>\r\n                
          <td 
className=\"p-3\">\r\n              
              {(() => {\r\n         
                     const 
formatted = record.checkOut ? 
formatLocalTime(record.checkOut, 
userTimezone, \"24h\", true) : 
\"-\"\r\n                           
   if (formatted === \"-\") return 
<span className=\"text-xs 
font-mono\">-</span>\r\n            
                  const [datePart, 
timePart] = formatted.split(', 
')\r\n                              
return (\r\n                        
        <div className=\"flex 
flex-col text-xs font-mono\">\r\n   
                               
<span className=\"font-medium whites
pace-nowrap\">{datePart}</span>\r\n 
                                 
<span className=\"text-muted-foregro
und\">{timePart}</span>\r\n         
                         
{record.checkOutMethod && (\r\n     
                               
<span className=\"text-[10px] 
text-muted-foreground uppercase 
font-semibold mt-0.5\">\r\n         
                             
{record.checkOutMethod}\r\n         
                           
</span>\r\n                         
         )}\r\n                     
           </div>\r\n               
               )\r\n                
            })()}\r\n               
           </td>\r\n                
          <td 
className=\"p-3\">\r\n              
              {(() => {\r\n         
                     const 
formatted = record.actualBreakStart 
? formatLocalTime(record.actualBreak
Start, userTimezone, \"24h\", true) 
: \"-\"\r\n                         
     if (formatted === \"-\") 
return <span className=\"text-xs 
font-mono\">-</span>\r\n            
                  const [datePart, 
timePart] = formatted.split(', 
')\r\n                              
return (\r\n                        
        <div className=\"flex 
flex-col text-xs font-mono\">\r\n   
                               
<span className=\"font-medium whites
pace-nowrap\">{datePart}</span>\r\n 
                                 
<span className=\"text-muted-foregro
und\">{timePart}</span>\r\n         
                       </div>\r\n   
                           )\r\n    
                        })()}\r\n   
                       </td>\r\n    
                      <td 
className=\"p-3\">\r\n              
              {(() => {\r\n         
                     const 
formatted = record.actualBreakEnd ? 
formatLocalTime(record.actualBreakEn
d, userTimezone, \"24h\", true) : 
\"-\"\r\n                           
   if (formatted === \"-\") return 
<span className=\"text-xs 
font-mono\">-</span>\r\n            
                  const [datePart, 
timePart] = formatted.split(', 
')\r\n                              
return (\r\n                        
        <div className=\"flex 
flex-col text-xs font-mono\">\r\n   
                               
<span className=\"font-medium whites
pace-nowrap\">{datePart}</span>\r\n 
                                 
<span className=\"text-muted-foregro
und\">{timePart}</span>\r\n         
                       </div>\r\n   
                           )\r\n    
                        })()}\r\n   
                       </td>\r\n    
                      <td 
className=\"p-3\">\r\n              
              <div className=\"flex 
flex-col gap-1\">\r\n               
               <span 
className=\"font-medium text-xs\">{r
ecord.workHours}</span>\r\n         
                   </div>\r\n       
                   </td>\r\n        
                  <td 
className=\"p-3\">\r\n              
              <Badge 
className={cn(\"gap-1 px-2 py-0.5 
text-xs\", getStatusColor(record.sta
tus))}>\r\n                         
     
{getStatusIcon(record.status)}\r\n  
                            <span cl
assName=\"capitalize\">{record.statu
s.charAt(0).toUpperCase() + 
record.status.slice(1)}</span>\r\n  
                          
</Badge>\r\n                        
  </td>\r\n                         
 {\r\n                            
SHOW_LOCATION ? (\r\n               
               <td 
className=\"p-3\" >\r\n             
                   <LocationDisplay 
checkInLocationName={record.checkInL
ocationName} checkOutLocationName={r
ecord.checkOutLocationName} />\r\n  
                            
</td>\r\n                           
 ) : null}\r\n                      
    <td className=\"p-3\">\r\n      
                      <div 
className=\"flex items-center 
gap-1\">\r\n                        
      <Button variant=\"ghost\" 
size=\"icon\" title=\"Edit\" 
onClick={() => 
handleEditSingle(record)}>\r\n      
                          <Edit 
className=\"h-4 w-4\" />\r\n        
                      </Button>\r\n 
                             
<Button variant=\"ghost\" 
size=\"icon\" title=\"Delete\" 
onClick={() => 
handleDeleteClick(record.id)} 
className=\"text-destructive 
hover:text-destructive\">\r\n       
                         <Trash2 
className=\"h-4 w-4\" />\r\n        
                      </Button>\r\n 
                           
</div>\r\n                          
</td>\r\n                        
</tr>\r\n                      
))\r\n                    )}\r\n    
              </tbody>\r\n          
      </table>\r\n              
</div>\r\n\r\n            
</CardContent >\r\n          </Card 
>\r\n\r\n          {/* Pagination 
Footer */}\r\n          {\r\n       
     !loading && (\r\n              
<PaginationFooter\r\n               
 page={currentPage}\r\n             
   totalPages={Math.max(1, 
Math.ceil((Math.max(totalItems, 
attendanceData.length) || 0) / 
itemsPerPage))}\r\n                
onPageChange={(p) => 
setCurrentPage(Math.max(1, p))}\r\n 
               
isLoading={loading}\r\n             
   from={(Math.max(totalItems, 
attendanceData.length) > 0) ? 
(currentPage - 1) * itemsPerPage + 
1 : 0}\r\n                
to={(Math.max(totalItems, 
attendanceData.length) > 0) ? 
Math.min(currentPage * 
itemsPerPage, Math.max(totalItems, 
attendanceData.length)) : 0}\r\n    
            
total={Math.max(totalItems, 
attendanceData.length)}\r\n         
       pageSize={itemsPerPage}\r\n  
              
onPageSizeChange={(size) => { 
setItemsPerPage(size); 
setCurrentPage(1); }}\r\n           
     pageSizeOptions={[10, 20, 
50]}\r\n              />\r\n        
    )\r\n          }\r\n        
</div >\r\n      )\r\n      }\r\n   
   {/* Confirm Dialog */}\r\n      
<ConfirmDialog\r\n        
open={confirmOpen}\r\n        
onOpenChange={setConfirmOpen}\r\n   
     title={confirmState?.mode === 
\"bulk\" ? \"Delete selected 
records\" : \"Delete attendance 
record\"}\r\n        
description={\r\n          
confirmState?.mode === \"bulk\"\r\n 
           ? `This will delete 
${selectedRecords.length} selected 
record(s). This action cannot be 
undone.`\r\n            : \"This 
will delete the selected attendance 
record. This action cannot be 
undone.\"\r\n        }\r\n        
confirmText=\"Delete\"\r\n        
destructive\r\n        
loadingText=\"Deleting...\"\r\n     
   onConfirm={async () => {\r\n     
     if (!confirmState) return\r\n  
        try {\r\n            
setIsSubmitting(true)\r\n           
 if (confirmState.mode === 
\"bulk\") {\r\n              const 
res = await deleteMultipleAttendance
Records(selectedRecords)\r\n        
      if (!res.success) {\r\n       
         toast.error(res.message || 
\"Failed to delete selected 
records\")\r\n                
return\r\n              }\r\n       
       setAttendanceData(prev => 
{\r\n                const next = 
prev.filter(r => !selectedRecords.in
cludes(r.id))\r\n                
const removed = prev.length - 
next.length\r\n                
setTotalItems(t => Math.max(0, t - 
removed))\r\n                return 
next\r\n              })\r\n        
      setSelectedRecords([])\r\n    
          toast.success(\"Selected 
records deleted\")\r\n            } 
else if (confirmState.mode === 
\"single\" && confirmState.id) 
{\r\n              const id = 
confirmState.id\r\n              
const res = await 
deleteAttendanceRecord(id)\r\n      
        if (!res.success) {\r\n     
           toast.error(res.message 
|| \"Failed to delete record\")\r\n 
               return\r\n           
   }\r\n              
setAttendanceData(prev => {\r\n     
           const next = 
prev.filter(r => r.id !== id)\r\n   
             const removed = 
prev.length - next.length\r\n       
         if (removed > 0) 
setTotalItems(t => Math.max(0, t - 
removed))\r\n                return 
next\r\n              })\r\n        
      setSelectedRecords(prev => 
prev.filter(x => x !== id))\r\n     
         toast.success(\"Record 
deleted\")\r\n            }\r\n     
     } catch (e) {\r\n            
const msg = e instanceof Error ? 
e.message : \"Failed to 
delete\"\r\n            
toast.error(msg)\r\n          } 
finally {\r\n            
setIsSubmitting(false)\r\n          
  setConfirmState(null)\r\n         
 }\r\n        }}\r\n      />\r\n    
  <Dialog open={editOpen} 
onOpenChange={(open) => { if 
(!isSubmitting) setEditOpen(open) 
}}>\r\n        <DialogContent>\r\n  
        <DialogHeader>\r\n          
  <DialogTitle>Edit attendance 
record</DialogTitle>\r\n            
<DialogDescription>\r\n             
 Perbarui waktu Check In/Out dan 
catatan. Biarkan kosong untuk 
menghapus nilai.\r\n            
</DialogDescription>\r\n          
</DialogHeader>\r\n\r\n          
<div className=\"grid gap-3\">\r\n  
          <div className=\"grid 
gap-1.5\">\r\n              <label 
className=\"text-sm 
font-medium\">Check In 
(ISO)</label>\r\n              
<Input\r\n                
value={editIn}\r\n                
onChange={(e) => 
setEditIn(e.target.value)}\r\n      
          placeholder=\"contoh: 
2026-01-15T08:30:00+07:00\"\r\n     
           
disabled={isSubmitting}\r\n         
     />\r\n            
</div>\r\n\r\n            <div 
className=\"grid gap-1.5\">\r\n     
         <label className=\"text-sm 
font-medium\">Check Out 
(ISO)</label>\r\n              
<Input\r\n                
value={editOut}\r\n                
onChange={(e) => 
setEditOut(e.target.value)}\r\n     
           placeholder=\"contoh: 
2026-01-15T17:00:00+07:00\"\r\n     
           
disabled={isSubmitting}\r\n         
     />\r\n            
</div>\r\n\r\n            <div 
className=\"grid gap-1.5\">\r\n     
         <label className=\"text-sm 
font-medium\">Remarks</label>\r\n   
           <Input\r\n               
 value={editRemarks}\r\n            
    onChange={(e) => 
setEditRemarks(e.target.value)}\r\n 
               
placeholder=\"Catatan 
(opsional)\"\r\n                
disabled={isSubmitting}\r\n         
     />\r\n            </div>\r\n   
       </div>\r\n\r\n          
<DialogFooter>\r\n            
<Button variant=\"outline\" 
onClick={() => setEditOpen(false)} 
disabled={isSubmitting}>\r\n        
      Cancel\r\n            
</Button>\r\n            <Button 
onClick={submitEdit} 
disabled={isSubmitting} 
className=\"bg-black text-white 
hover:bg-black/90\">\r\n            
  {isSubmitting ? \"Saving...\" : 
\"Save Changes\"}\r\n            
</Button>\r\n          
</DialogFooter>\r\n        
</DialogContent>\r\n      
</Dialog>\r\n\r\n    </>\r\n  
)\r\n}\r\n\r\nexport default ModernA
ttendanceListCloned","usedDeprecated
Rules":[]},{"filePath":"D:\\UBIG\\Pr
ojek\\Presensi-New\\src\\app\\insigh
t\\highlights\\page.tsx","messages":
[{"ruleId":null,"message":"Unused 
eslint-disable directive (no 
problems were reported from 'react-h
ooks/exhaustive-deps').","line":51,"
column":5,"severity":1,"nodeType":nu
ll,"fix":{"range":[2010,2065],"text"
:" "}}],"suppressedMessages":[],"err
orCount":0,"fatalErrorCount":0,"warn
ingCount":1,"fixableErrorCount":0,"f
ixableWarningCount":1,"source":"\"us
e client\"\r\n\r\nimport { Info, 
ChevronRight } from 
\"lucide-react\"\r\nimport { 
useMemo, useState, useEffect } from 
\"react\"\r\nimport { 
useSearchParams } from 
\"next/navigation\"\r\nimport { 
DUMMY_BEHAVIOR_CHANGES, 
DUMMY_MEMBERS, 
DUMMY_SMART_NOTIFICATIONS, 
DUMMY_TEAMS, 
DUMMY_UNUSUAL_ACTIVITIES } from 
\"@/lib/data/dummy-data\"\r\nimport 
{ useTimezone } from \"@/components/
providers/timezone-provider\"\r\nimp
ort { InsightsHeader } from \"@/comp
onents/insights/InsightsHeader\"\r\n
import { InsightsRightSidebar } 
from \"@/components/insights/Insight
sRightSidebar\"\r\nimport type { 
DateRange, SelectedFilter } from \"@
/components/insights/types\"\r\n\r\n
export default function 
HighlightsPage() {\r\n  const 
timezone = useTimezone()\r\n  const 
searchParams = 
useSearchParams()\r\n  const 
memberIdFromUrl = searchParams.get(\
"memberId\")\r\n\r\n  const 
[sidebarOpen, setSidebarOpen] = 
useState(true)\r\n  const 
[selectedFilter, setSelectedFilter] 
= useState<SelectedFilter>({\r\n    
type: \"members\",\r\n    all: 
false,\r\n    id: memberIdFromUrl 
|| \"m1\",\r\n  })\r\n\r\n  // 
Update filter when memberId from 
URL changes\r\n  // Handle filter 
changes from URL params\r\n  
useEffect(() => {\r\n    if 
(memberIdFromUrl && memberIdFromUrl 
!== selectedFilter.id) {\r\n      
console.log(\"Syncing filter with 
URL:\", memberIdFromUrl)\r\n      
setSelectedFilter({\r\n        
type: \"members\",\r\n        all: 
false,\r\n        id: 
memberIdFromUrl,\r\n      })\r\n    
}\r\n  }, [memberIdFromUrl]) // 
Only run when URL param 
changes\r\n\r\n  // Handle initial 
restore from session storage (Once 
on mount)\r\n  useEffect(() => 
{\r\n    // Only restore if NO URL 
param is present\r\n    if 
(!memberIdFromUrl && typeof window 
!== \"undefined\") {\r\n      const 
savedMemberId = sessionStorage.getIt
em(\"screenshotSelectedMemberId\")\r
\n      if (savedMemberId && 
savedMemberId !== 
selectedFilter.id) {\r\n        
console.log(\"Restoring filter from 
session storage:\", 
savedMemberId)\r\n        
setSelectedFilter({\r\n          
type: \"members\",\r\n          
all: false,\r\n          id: 
savedMemberId,\r\n        })\r\n    
  }\r\n    }\r\n    // 
eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n  }, 
[]) // Run ONCE on mount\r\n  const 
[dateRange, setDateRange] = 
useState<DateRange>(() => {\r\n    
const end = new Date()\r\n    const 
start = new Date()\r\n    
start.setDate(end.getDate() - 
6)\r\n    start.setHours(0, 0, 0, 
0)\r\n    end.setHours(0, 0, 0, 
0)\r\n    return { startDate: 
start, endDate: end }\r\n  
})\r\n\r\n  const demoMembers = 
useMemo(() => DUMMY_MEMBERS, 
[])\r\n  const demoTeams = 
useMemo(() => DUMMY_TEAMS, 
[])\r\n\r\n  const 
filteredUnusualActivities = 
useMemo(() => {\r\n    let filtered 
= DUMMY_UNUSUAL_ACTIVITIES\r\n\r\n  
  if (!selectedFilter.all) {\r\n    
  if (selectedFilter.type === 
\"members\" && selectedFilter.id) 
{\r\n        filtered = 
filtered.filter((activity) => 
activity.memberId === 
selectedFilter.id)\r\n      } else 
if (selectedFilter.type === 
\"teams\" && selectedFilter.id) 
{\r\n        const team = 
DUMMY_TEAMS.find((t) => t.id === 
selectedFilter.id)\r\n        
filtered = 
filtered.filter((activity) => team?.
members.includes(activity.memberId))
\r\n      }\r\n    }\r\n\r\n    
return filtered.filter((activity) 
=> {\r\n      const activityDate = 
new Date(activity.date)\r\n      
return activityDate >= 
dateRange.startDate && activityDate 
<= dateRange.endDate\r\n    })\r\n  
}, [selectedFilter, 
dateRange])\r\n\r\n  const 
filteredNotifications = useMemo(() 
=> {\r\n    let filtered = 
DUMMY_SMART_NOTIFICATIONS\r\n\r\n   
 if (!selectedFilter.all) {\r\n     
 if (selectedFilter.type === 
\"members\" && selectedFilter.id) 
{\r\n        filtered = 
filtered.filter((notification) => 
notification.memberId === 
selectedFilter.id)\r\n      } else 
if (selectedFilter.type === 
\"teams\" && selectedFilter.id) 
{\r\n        const team = 
DUMMY_TEAMS.find((t) => t.id === 
selectedFilter.id)\r\n        
filtered = 
filtered.filter((notification) => te
am?.members.includes(notification.me
mberId))\r\n      }\r\n    
}\r\n\r\n    return 
filtered.filter((notification) => 
{\r\n      const notifDate = new 
Date(notification.timestamp)\r\n    
  return notifDate >= 
dateRange.startDate && notifDate <= 
dateRange.endDate\r\n    })\r\n  }, 
[selectedFilter, 
dateRange])\r\n\r\n  const 
filteredBehaviorChanges = 
useMemo(() => {\r\n    let filtered 
= DUMMY_BEHAVIOR_CHANGES\r\n\r\n    
if (!selectedFilter.all) {\r\n      
if (selectedFilter.type === 
\"members\" && selectedFilter.id) 
{\r\n        filtered = 
filtered.filter((change) => 
change.memberId === 
selectedFilter.id)\r\n      } else 
if (selectedFilter.type === 
\"teams\" && selectedFilter.id) 
{\r\n        const team = 
DUMMY_TEAMS.find((t) => t.id === 
selectedFilter.id)\r\n        
filtered = filtered.filter((change) 
=> team?.members.includes(change.mem
berId))\r\n      }\r\n    }\r\n\r\n 
   return filtered.filter((change) 
=> {\r\n      const changeDate = 
new Date(change.detectedAt)\r\n     
 return changeDate >= 
dateRange.startDate && changeDate 
<= dateRange.endDate\r\n    })\r\n  
}, [selectedFilter, 
dateRange])\r\n\r\n  const 
totalUnusualMinutes = filteredUnusua
lActivities.reduce((sum, activity) 
=> sum + activity.duration, 
0)\r\n\r\n  return (\r\n    <div 
className=\"min-h-screen 
bg-white\">\r\n      <div 
className=\"border-b 
border-gray-200\">\r\n        <div 
className=\"py-4 px-6\">\r\n        
  <h1 className=\"text-xl 
font-semibold 
mb-5\">Highlights</h1>\r\n          
<InsightsHeader\r\n            
selectedFilter={selectedFilter}\r\n 
           onSelectedFilterChange={s
etSelectedFilter}\r\n            
dateRange={dateRange}\r\n           
 onDateRangeChange={setDateRange}\r\
n            
members={demoMembers}\r\n           
 teams={demoTeams}\r\n            
sidebarOpen={sidebarOpen}\r\n       
     onToggleSidebar={() => 
setSidebarOpen((open) => 
!open)}\r\n            
timezone={timezone}\r\n          
/>\r\n        </div>\r\n      
</div>\r\n\r\n      <div 
className=\"flex flex-col 
lg:flex-row\">\r\n        <div 
className=\"flex-1 p-4 md:p-6 
space-y-6\">\r\n          
<section>\r\n            <div 
className=\"flex items-center 
justify-between mb-3\">\r\n         
     <div className=\"flex 
items-center gap-2\">\r\n           
     <h2 className=\"text-xs 
font-semibold text-gray-700 
uppercase tracking-wide\">Unusual 
Activity</h2>\r\n                
<Info className=\"w-4 h-4 
text-gray-400\" />\r\n              
</div>\r\n              <a\r\n      
          href=\"/insight/unusual-ac
tivity\"\r\n                
className=\"text-sm text-zinc-600 
hover:text-zinc-900 flex 
items-center gap-1 
font-medium\"\r\n              
>\r\n                View all\r\n   
             <ChevronRight 
className=\"w-4 h-4\" />\r\n        
      </a>\r\n            
</div>\r\n\r\n            <div 
className=\"border border-gray-200 
rounded-lg bg-white 
overflow-hidden\">\r\n              
<div className=\"p-4 md:p-6\">\r\n  
              <div className=\"flex 
flex-col md:flex-row gap-6\">\r\n   
               <div 
className=\"grid grid-cols-1 
sm:grid-cols-3 md:flex md:flex-col 
gap-4 min-w-[120px]\">\r\n          
          <div className=\"border 
border-gray-200 rounded-lg p-4 
bg-gray-50 flex flex-col 
justify-center\">\r\n               
       <div className=\"text-2xl 
md:text-3xl font-bold\">\r\n        
                {new Set(filteredUnu
sualActivities.map((activity) => 
activity.memberId)).size}\r\n       
               </div>\r\n           
           <div className=\"text-xs 
md:text-sm text-gray-600 
mt-1\">Members</div>\r\n            
        </div>\r\n\r\n              
      <div className=\"border 
border-gray-200 rounded-lg p-4 
bg-gray-50 flex flex-col 
justify-center\">\r\n               
       <div className=\"text-2xl 
md:text-3xl font-bold\">{filteredUnu
sualActivities.length}</div>\r\n    
                  <div 
className=\"text-xs md:text-sm 
text-gray-600 
mt-1\">Instances</div>\r\n          
          </div>\r\n\r\n            
        <div className=\"border 
border-gray-200 rounded-lg p-4 
bg-gray-50 flex flex-col 
justify-center\">\r\n               
       <div className=\"text-2xl 
md:text-3xl font-bold\">\r\n        
                
{Math.floor(totalUnusualMinutes / 
60)}:\r\n                        
{(totalUnusualMinutes % 
60).toString().padStart(2, 
\"0\")}\r\n                      
</div>\r\n                      
<div className=\"text-xs md:text-sm 
text-gray-600 mt-1\">Total time 
(h:m)</div>\r\n                    
</div>\r\n                  
</div>\r\n\r\n                  
<div className=\"flex-1\">\r\n      
              <div 
className=\"space-y-3\">\r\n        
              
{filteredUnusualActivities.slice(0, 
4).map((activity) => (\r\n          
              <div\r\n              
            key={activity.id}\r\n   
                       
className=\"flex items-start gap-3 
text-sm hover:bg-gray-50 p-2 
rounded-md -mx-2 transition-colors 
cursor-pointer\"\r\n                
        >\r\n                       
   <div\r\n                         
   className={`mt-0.5 w-2 h-2 
rounded-full shrink-0 
${activity.severity === 
\"highly_unusual\"\r\n              
                ? 
\"bg-red-500\"\r\n                  
            : activity.severity === 
\"unusual\"\r\n                     
           ? \"bg-orange-500\"\r\n  
                              : 
\"bg-yellow-500\"\r\n               
               }`}\r\n              
            />\r\n                  
        <div className=\"flex-1 
min-w-0\">\r\n                      
      <div className=\"flex 
items-center justify-between 
gap-2\">\r\n                        
      <span className=\"font-medium 
text-gray-900\">{activity.memberName
}</span>\r\n                        
      <span className=\"text-xs 
text-gray-500 shrink-0\">\r\n       
                         {new Date(a
ctivity.timestamp).toLocaleDateStrin
g(\"en-US\", {\r\n                  
                month: 
\"short\",\r\n                      
            day: \"numeric\",\r\n   
                             
})}\r\n                             
 </span>\r\n                        
    </div>\r\n                      
      <div 
className=\"text-gray-600 
mt-0.5\">\r\n                       
       <span className=\"font-medium
\">{activity.activityType}:</span>{\
" \"}\r\n                           
   {activity.description}\r\n       
                     </div>\r\n     
                       <div 
className=\"text-xs text-gray-500 
mt-1\">\r\n                         
     Duration: 
{Math.floor(activity.duration / 
60)}h {activity.duration % 60}m\r\n 
                           
</div>\r\n                          
</div>\r\n                        
</div>\r\n                      
))}\r\n                      
{filteredUnusualActivities.length 
=== 0 && (\r\n                      
  <div className=\"text-center py-6 
text-gray-500\">No unusual activity 
detected</div>\r\n                  
    )}\r\n                    
</div>\r\n                  
</div>\r\n                
</div>\r\n              </div>\r\n  
          </div>\r\n          
</section>\r\n\r\n          
<section>\r\n            <div 
className=\"flex items-center gap-2 
mb-3\">\r\n              <h2 
className=\"text-xs font-semibold 
text-gray-700 uppercase 
tracking-wide\">Smart 
Notifications</h2>\r\n              
<Info className=\"w-4 h-4 
text-gray-400\" />\r\n            
</div>\r\n\r\n            <div 
className=\"border border-gray-200 
rounded-lg p-6\">\r\n              
<div className=\"space-y-3\">\r\n   
             {filteredNotifications.
map((notification) => (\r\n         
         <div key={notification.id} 
className=\"p-4 border 
border-gray-200 rounded-lg 
hover:bg-gray-50\">\r\n             
       <div className=\"flex 
items-start justify-between\">\r\n  
                    <div 
className=\"flex-1\">\r\n           
             <div className=\"flex 
items-center gap-2 mb-2\">\r\n      
                    <span 
className=\"font-semibold text-sm\">
{notification.memberName}</span>\r\n
                          <span\r\n 
                           
className={`px-2 py-1 text-xs 
rounded ${notification.severity === 
\"high\"\r\n                        
      ? \"bg-red-100 
text-red-700\"\r\n                  
            : notification.severity 
=== \"medium\"\r\n                  
              ? \"bg-orange-100 
text-orange-700\"\r\n               
                 : \"bg-yellow-100 
text-yellow-700\"\r\n               
               }`}\r\n              
            >\r\n                   
         
{notification.severity}\r\n         
                 </span>\r\n        
                </div>\r\n          
              <div 
className=\"text-sm text-gray-600 mb
-2\">{notification.message}</div>\r\
n                        <div 
className=\"text-xs 
text-gray-500\">{new Date(notificati
on.timestamp).toLocaleString()}</div
>\r\n                      
</div>\r\n                      
<button className=\"px-3 py-1 
text-xs border border-gray-300 
rounded hover:bg-gray-50\">View 
Details</button>\r\n                
    </div>\r\n                  
</div>\r\n                ))}\r\n   
           </div>\r\n            
</div>\r\n          
</section>\r\n\r\n          
<section>\r\n            <div 
className=\"flex items-center gap-2 
mb-3\">\r\n              <h2 
className=\"text-xs font-semibold 
text-gray-700 uppercase 
tracking-wide\">Significant Changes 
in Behavior</h2>\r\n              
<Info className=\"w-4 h-4 
text-gray-400\" />\r\n            
</div>\r\n\r\n            <div 
className=\"border border-gray-200 
rounded-lg p-6\">\r\n              
<div className=\"space-y-3\">\r\n   
             {filteredBehaviorChange
s.map((change) => (\r\n             
     <div key={`${change.memberId}-$
{change.detectedAt}`} 
className=\"p-4 border 
border-gray-200 rounded-lg 
hover:bg-gray-50\">\r\n             
       <div className=\"flex 
items-start justify-between\">\r\n  
                    <div 
className=\"flex-1\">\r\n           
             <div className=\"flex 
items-center gap-2 mb-2\">\r\n      
                    <span 
className=\"font-semibold text-sm\">
{change.memberName}</span>\r\n      
                    <span\r\n       
                     
className={`px-2 py-1 text-xs 
rounded ${change.changeType === 
\"productivity_increase\"\r\n       
                       ? 
\"bg-green-100 text-green-700\"\r\n 
                             : 
change.changeType === 
\"productivity_decrease\"\r\n       
                         ? 
\"bg-red-100 text-red-700\"\r\n     
                           : 
\"bg-blue-100 text-blue-700\"\r\n   
                           }`}\r\n  
                        >\r\n       
                     
{change.changeType.replace(\"_\", 
\" \")}\r\n                         
 </span>\r\n                        
</div>\r\n                        
<div className=\"text-sm 
text-gray-600 mb-2\">{change.descrip
tion}</div>\r\n                     
   <div className=\"flex flex-wrap 
items-center gap-4 text-xs 
text-gray-500\">\r\n                
          <span>Previous: 
{change.previousValue}</span>\r\n   
                       
<span>ΓåÆ</span>\r\n                
          <span>Current: 
{change.currentValue}</span>\r\n    
                      <span 
className={`font-semibold 
${change.changePercent > 0 ? 
\"text-green-600\" : 
\"text-red-600\"}`}>\r\n            
                
{change.changePercent > 0 ? \"+\" : 
\"\"}\r\n                           
 {change.changePercent.toFixed(1)}%\
r\n                          
</span>\r\n                         
 <span>ΓÇó</span>\r\n               
           <span>{change.detectedAt}
</span>\r\n                        
</div>\r\n                      
</div>\r\n                    
</div>\r\n                  
</div>\r\n                ))}\r\n   
           </div>\r\n            
</div>\r\n          </section>\r\n  
      </div>\r\n        
<InsightsRightSidebar\r\n          
open={sidebarOpen}\r\n          
onOpenChange={setSidebarOpen}\r\n   
       members={demoMembers}\r\n    
      teams={demoTeams}\r\n         
 
selectedFilter={selectedFilter}\r\n 
         onSelectedFilterChange={set
SelectedFilter}\r\n        />\r\n   
   </div>\r\n    </div>\r\n  )\r\n}\
r\n","usedDeprecatedRules":[]},{"fil
ePath":"D:\\UBIG\\Projek\\Presensi-N
ew\\src\\app\\members\\[id]\\page.ts
x","messages":[{"ruleId":null,"messa
ge":"Unused eslint-disable 
directive (no problems were 
reported from 'react-hooks/rules-of-
hooks').","line":240,"column":3,"sev
erity":1,"nodeType":null,"fix":{"ran
ge":[6722,6776],"text":" "}}],"suppr
essedMessages":[],"errorCount":0,"fa
talErrorCount":0,"warningCount":1,"f
ixableErrorCount":0,"fixableWarningC
ount":1,"source":"\"use 
client\"\r\n\r\nimport React, { 
useState, useEffect, use } from 
\"react\"\r\nimport { useRouter, 
useSearchParams, usePathname } from 
\"next/navigation\"\r\nimport {\r\n 
 Mail,\r\n  Clock,\r\n  
ChevronDown,\r\n  Info,\r\n  X\r\n} 
from \"lucide-react\"\r\n\r\nimport 
{ Card, CardContent } from 
\"@/components/ui/card\"\r\nimport 
{ Avatar, AvatarFallback, 
AvatarImage } from \"@/components/ui
/avatar\"\r\nimport { Button } from 
\"@/components/ui/button\"\r\nimport
 {\r\n  DropdownMenu,\r\n  
DropdownMenuContent,\r\n  
DropdownMenuItem,\r\n  
DropdownMenuLabel,\r\n  
DropdownMenuSeparator,\r\n  
DropdownMenuTrigger,\r\n} from \"@/c
omponents/ui/dropdown-menu\"\r\nimpo
rt {\r\n  Select,\r\n  
SelectContent,\r\n  SelectItem,\r\n 
 SelectTrigger,\r\n  
SelectValue,\r\n} from \"@/component
s/ui/select\"\r\nimport { Input } 
from 
\"@/components/ui/input\"\r\nimport 
{ Label } from 
\"@/components/ui/label\"\r\nimport 
{ useProfilePhotoUrl } from 
\"@/hooks/use-profile\"\r\nimport { 
getUserInitials } from 
\"@/lib/avatar-utils\"\r\nimport 
type { IOrganization_member, 
IMemberPerformance, IUser } from 
\"@/interface\"\r\nimport { cn } 
from \"@/lib/utils\"\r\n// Server 
Actions\r\nimport { 
getOrganizationMembersById } from 
\"@/action/members\"\r\nimport { 
getMemberPerformance } from \"@/acti
on/member_performance\"\r\nimport { 
useMemberRecentAttendance } from \"@
/hooks/use-member-recent-attendance\
"\r\nimport { PageSkeleton } from \"
@/components/ui/loading-skeleton\"\r
\n\r\n// Types\r\ntype WorkSchedule 
= {\r\n  name: string\r\n  type: 
string\r\n  workingHours: 
string\r\n  workingDays: 
string[]\r\n}\r\n\r\ntype TabType = 
\"info\" | \"employment\" | 
\"roles\" | \"pay\" | \"worktime\" 
| \"settings\"\r\n\r\n// Helper 
Functions\r\nconst formatDate = 
(value?: string | null) => {\r\n  
if (!value) return \"-\"\r\n  const 
date = new Date(value)\r\n  if 
(Number.isNaN(date.getTime())) 
return value\r\n  return new 
Intl.DateTimeFormat(\"en-US\", 
{\r\n    month: \"short\",\r\n    
day: \"numeric\",\r\n    year: 
\"numeric\",\r\n  
}).format(date)\r\n}\r\n\r\nconst 
formatPhoneNumber = (phone?: string 
| null) => {\r\n  if (!phone || 
phone === \"-\" || phone.trim() === 
\"\") return \"\"\r\n  return 
phone\r\n}\r\n\r\n// 
Sub-Components\r\nfunction 
ContactInfoRow({ icon: Icon, text 
}: { icon: typeof Mail; text: 
string }) {\r\n  return (\r\n    
<div className=\"flex items-center 
gap-2 text-sm 
text-muted-foreground\">\r\n      
<Icon className=\"h-4 w-4\" />\r\n  
    <span>{text}</span>\r\n    
</div>\r\n  )\r\n}\r\n\r\nfunction 
FormField({\r\n  label,\r\n  
value,\r\n  placeholder,\r\n  type 
= \"text\",\r\n  linkText,\r\n  
disabled = false,\r\n}: {\r\n  
label: string\r\n  value?: 
string\r\n  placeholder?: 
string\r\n  type?: \"text\" | 
\"email\" | \"phone\" | 
\"date\"\r\n  linkText?: string\r\n 
 disabled?: boolean\r\n}) {\r\n  
return (\r\n    <div 
className=\"space-y-2\">\r\n      
<div className=\"flex items-center 
justify-between\">\r\n        
<Label className=\"text-xs 
font-semibold uppercase 
tracking-wide 
text-muted-foreground\">\r\n        
  {label}\r\n        </Label>\r\n   
     {linkText && (\r\n          
<button className=\"text-xs 
text-primary hover:underline\">{link
Text}</button>\r\n        )}\r\n    
  </div>\r\n      {type === 
\"phone\" ? (\r\n        <div 
className=\"flex gap-2\">\r\n       
   <Input\r\n            
type=\"tel\"\r\n            
defaultValue={value}\r\n            
placeholder={placeholder || \"+1 
201-555-0123\"}\r\n            
disabled={disabled}\r\n            
className=\"flex-1\"\r\n          
/>\r\n        </div>\r\n      ) : 
(\r\n        <Input\r\n          
type={type}\r\n          
defaultValue={value}\r\n          
placeholder={placeholder}\r\n       
   disabled={disabled}\r\n          
className=\"w-full\"\r\n        
/>\r\n      )}\r\n    </div>\r\n  
)\r\n}\r\n\r\nfunction 
MemberProfileHeader({\r\n  
user,\r\n  displayName,\r\n  
photoUrl,\r\n  joinDate,\r\n  
email,\r\n  lastTracked,\r\n}: 
{\r\n  user?: IUser\r\n  
displayName: string\r\n  photoUrl?: 
string\r\n  joinDate: string\r\n  
email: string\r\n  lastTracked: 
string\r\n}) {\r\n  return (\r\n    
<div className=\"flex gap-8 mb-6 
pb-6\">\r\n      {/* Left: Avatar 
*/}\r\n      <div 
className=\"flex-shrink-0\">\r\n    
    <div className=\"flex flex-col 
items-center text-center\">\r\n     
     <Avatar className=\"h-20 
w-20\">\r\n            <AvatarImage 
src={photoUrl} alt={displayName} 
/>\r\n            <AvatarFallback 
className=\"bg-gray-100 
text-gray-700 text-lg 
font-semibold\">\r\n              
{getUserInitials(\r\n               
 user?.first_name,\r\n              
  user?.last_name,\r\n              
  user?.display_name ?? 
undefined,\r\n                
user?.email ?? undefined\r\n        
      )}\r\n            
</AvatarFallback>\r\n          
</Avatar>\r\n          <p 
className=\"mt-3 text-xs 
text-muted-foreground\">\r\n        
    Joined\r\n            <br 
/>\r\n            {joinDate}\r\n    
      </p>\r\n        </div>\r\n    
  </div>\r\n\r\n      {/* Right: 
Contact Info */}\r\n      <div 
className=\"space-y-2\">\r\n        
<ContactInfoRow icon={Mail} 
text={email || \"No email\"} />\r\n 
       <ContactInfoRow icon={Clock} 
text={`Last tracked time 
${lastTracked}`} />\r\n      
</div>\r\n    </div>\r\n  
)\r\n}\r\n\r\nexport default 
function MemberProfilePage({ params 
}: { params: Promise<{ id: string 
}> }) {\r\n  const { id } = 
use(params)\r\n  const router = 
useRouter()\r\n  const searchParams 
= useSearchParams()\r\n  const 
pathname = usePathname()\r\n\r\n  
const activeTab = 
(searchParams.get(\"tab\") as 
TabType) || \"info\"\r\n\r\n  const 
[isSaving, setIsSaving] = 
useState(false)\r\n  const [member, 
setMember] = 
useState<IOrganization_member | 
null>(null)\r\n  const [, 
setPerformance] = 
useState<IMemberPerformance | 
undefined>(undefined)\r\n  const 
[loading, setLoading] = 
useState(true)\r\n  const [mounted, 
setMounted] = 
useState(false)\r\n\r\n  // Fetch 
Data\r\n  useEffect(() => {\r\n    
setMounted(true)\r\n    const 
fetchData = async () => {\r\n      
try {\r\n        const [memberRes, 
perfRes] = await Promise.all([\r\n  
        
getOrganizationMembersById(id),\r\n 
         
getMemberPerformance(id),\r\n       
 ])\r\n\r\n        if (memberRes && 
memberRes.success && 
memberRes.data) {\r\n          
setMember(memberRes.data as unknown 
as IOrganization_member)\r\n        
}\r\n        if (perfRes && 
perfRes.success && perfRes.data) 
{\r\n          
setPerformance(perfRes.data)\r\n    
    }\r\n      } catch (error) 
{\r\n        console.error(\"Failed 
to fetch member data\", error)\r\n  
    } finally {\r\n        
setLoading(false)\r\n      }\r\n    
}\r\n    fetchData()\r\n  }, 
[id])\r\n\r\n  // Get recent 
attendance data\r\n  const { data: 
recentAttendance } = 
useMemberRecentAttendance(id, 
14)\r\n\r\n  if (loading) {\r\n    
return (\r\n      <div 
className=\"p-4 md:p-6\">\r\n       
 <PageSkeleton />\r\n      
</div>\r\n    )\r\n  }\r\n\r\n  if 
(!member) {\r\n    return (\r\n     
 <div className=\"flex items-center 
justify-center min-h-screen\">\r\n  
      <div 
className=\"text-center\">\r\n      
    <p className=\"text-xl 
font-semibold 
text-muted-foreground\">Member not 
found.</p>\r\n        </div>\r\n    
  </div>\r\n    )\r\n  }\r\n\r\n  
// Derived State\r\n  const user: 
IUser | undefined = member.user\r\n 
 const email = user?.email || 
\"\"\r\n  const phone = user?.phone 
|| \"\"\r\n  // 
eslint-disable-next-line 
react-hooks/rules-of-hooks\r\n  
const photoUrl = useProfilePhotoUrl(
user?.profile_photo_url ?? 
undefined) ?? undefined\r\n\r\n  
const displayName = user\r\n    ? 
[user.first_name, user.middle_name, 
user.last_name]\r\n      
.filter((part) => part && 
part.trim().length)\r\n      
.join(\" \") ||\r\n    (user.email 
&& !user.email.toLowerCase().endsWit
h(\"@dummy.local\") ? user.email : 
null) ||\r\n    \"Name 
unavailable\"\r\n    : \"Name 
unavailable\"\r\n\r\n  const 
joinDate = 
formatDate(member.hire_date)\r\n  
const homeAddress = user\r\n    ? 
[user.jalan, user.kelurahan, user.ke
camatan].filter(Boolean).join(\", 
\")\r\n    : \"\"\r\n\r\n  // Fix: 
Cast to prevent narrowing to 
\"never\" since it's constantly 
undefined currently\r\n  const 
schedule = undefined as 
WorkSchedule | undefined\r\n\r\n  
const lastTracked = mounted && 
recentAttendance && 
recentAttendance.length > 0\r\n    
? formatDate(recentAttendance?.[0]?.
date)\r\n    : \"No recent 
activity\"\r\n\r\n  const 
handleSave = async () => {\r\n    
setIsSaving(true)\r\n    
setTimeout(() => 
setIsSaving(false), 1000)\r\n  
}\r\n\r\n  const tabs = [\r\n    { 
id: \"info\" as TabType, label: 
\"INFO\" },\r\n    { id: 
\"employment\" as TabType, label: 
\"EMPLOYMENT\" },\r\n    { id: 
\"roles\" as TabType, label: 
\"ROLES\" },\r\n    { id: \"pay\" 
as TabType, label: \"PAY / BILL\" 
},\r\n    { id: \"worktime\" as 
TabType, label: \"WORK TIME & 
LIMITS\" },\r\n    { id: 
\"settings\" as TabType, label: 
\"SETTINGS\" },\r\n  ]\r\n\r\n  
return (\r\n    <div 
className=\"h-full 
bg-background\">\r\n      {/* Top 
Bar */}\r\n      <div 
className=\"bg-card\">\r\n        
<div className=\"px-4 py-4\">\r\n   
       <div className=\"flex 
items-center justify-between\">\r\n 
           <h1 className=\"text-2xl 
font-bold\">{displayName}</h1>\r\n  
          <div className=\"flex 
items-center gap-3\">\r\n           
   <DropdownMenu>\r\n               
 <DropdownMenuTrigger asChild>\r\n  
                <Button 
variant=\"outline\" 
size=\"sm\">\r\n                    
Actions\r\n                    
<ChevronDown className=\"ml-2 h-4 
w-4\" />\r\n                  
</Button>\r\n                
</DropdownMenuTrigger>\r\n          
      <DropdownMenuContent 
align=\"end\" 
className=\"w-56\">\r\n             
     <DropdownMenuLabel>Actions</Dro
pdownMenuLabel>\r\n                 
 <DropdownMenuSeparator />\r\n      
            <DropdownMenuItem 
onClick={() => router.push(`/members
/edit/${member.id}`)}>\r\n          
          Edit Profile\r\n          
        </DropdownMenuItem>\r\n     
             
<DropdownMenuItem>Reset 
Password...</DropdownMenuItem>\r\n  
                
<DropdownMenuItem>Manage profile 
fields</DropdownMenuItem>\r\n       
           <DropdownMenuSeparator 
/>\r\n                  
<DropdownMenuItem onClick={() => 
router.push(\"/members\")}>\r\n     
               Back to Members\r\n  
                
</DropdownMenuItem>\r\n             
   </DropdownMenuContent>\r\n       
       </DropdownMenu>\r\n          
    <Button onClick={handleSave} 
disabled={isSaving}>\r\n            
    {isSaving ? \"Saving...\" : 
\"Save\"}\r\n              
</Button>\r\n            </div>\r\n 
         </div>\r\n        
</div>\r\n      </div>\r\n\r\n      
{/* Tabs */}\r\n      <div 
className=\"border-b bg-card\">\r\n 
       <div className=\"px-4\">\r\n 
         <div className=\"flex 
gap-6 overflow-x-auto\">\r\n        
    {tabs.map((tab) => (\r\n        
      <button\r\n                
key={tab.id}\r\n                
onClick={() => {\r\n                
  const params = new URLSearchParams
(searchParams.toString())\r\n       
           params.set(\"tab\", 
tab.id)\r\n                  router.
push(`${pathname}?${params.toString(
)}`, { scroll: false })\r\n         
       }}\r\n                
className={cn(\r\n                  
\"whitespace-nowrap border-b-2 px-1 
py-3 text-sm font-medium 
transition-colors 
hover:cursor-pointer\",\r\n         
         activeTab === tab.id\r\n   
                 ? \"border-primary 
text-primary\"\r\n                  
  : \"border-transparent 
text-muted-foreground 
hover:text-foreground\"\r\n         
       )}\r\n              >\r\n    
            {tab.label}\r\n         
     </button>\r\n            
))}\r\n          </div>\r\n        
</div>\r\n      </div>\r\n\r\n      
{/* Content */}\r\n      <div 
className=\"px-4 py-6\">\r\n\r\n    
    <MemberProfileHeader\r\n        
  user={user}\r\n          
displayName={displayName}\r\n       
   photoUrl={photoUrl}\r\n          
joinDate={joinDate}\r\n          
email={email}\r\n          
lastTracked={lastTracked}\r\n       
 />\r\n\r\n        {activeTab === 
\"info\" && (\r\n          <div 
className=\"space-y-6\">\r\n        
    <div 
className=\"space-y-4\">\r\n        
      <h2 className=\"text-sm 
font-bold\">Identity</h2>\r\n       
       <div className=\"grid gap-4 
md:grid-cols-2\">\r\n               
 <FormField\r\n                  
label=\"EMPLOYEE ID\"\r\n           
       value={user?.nik || 
member.employee_id || 
user?.employee_code || \"\"}\r\n    
              placeholder=\"No 
employee ID\"\r\n                
/>\r\n\r\n                
<FormField\r\n                  
label=\"BIRTHDAY\"\r\n              
    value={user?.date_of_birth ?? 
\"\"}\r\n                  
placeholder=\"YYYY-MM-DD\"\r\n      
            type=\"date\"\r\n       
         />\r\n              
</div>\r\n            
</div>\r\n\r\n            <div 
className=\"space-y-4\">\r\n        
      <h2 className=\"text-sm 
font-bold\">Contact</h2>\r\n        
      <div className=\"grid gap-4 
md:grid-cols-2\">\r\n               
 <FormField\r\n                  
label=\"HOME ADDRESS\"\r\n          
        value={homeAddress}\r\n     
             placeholder=\"Search 
for an address\"\r\n                
/>\r\n                
<FormField\r\n                  
label=\"PERSONAL EMAIL\"\r\n        
          value={email}\r\n         
         placeholder=\"name@example.
com\"\r\n                  
type=\"email\"\r\n                
/>\r\n                
<FormField\r\n                  
label=\"PERSONAL PHONE\"\r\n        
          value={formatPhoneNumber(p
hone)}\r\n                  
type=\"phone\"\r\n                
/>\r\n              </div>\r\n      
      </div>\r\n\r\n            
{schedule && (\r\n              
<div className=\"space-y-4\">\r\n   
             <h2 
className=\"text-sm 
font-bold\">Work Schedule</h2>\r\n  
              <Card>\r\n            
      <CardContent 
className=\"p-4\">\r\n              
      <div 
className=\"space-y-3\">\r\n        
              <div className=\"flex 
items-center justify-between\">\r\n 
                       <div>\r\n    
                      <p 
className=\"text-sm font-medium\">{s
chedule.name}</p>\r\n               
           <p className=\"text-xs te
xt-muted-foreground\">{schedule.type
}</p>\r\n                        
</div>\r\n                      
</div>\r\n                      
<div className=\"grid gap-3 
md:grid-cols-2\">\r\n               
         <div>\r\n                  
        <p className=\"text-xs 
text-muted-foreground\">Working 
Hours</p>\r\n                       
   <p className=\"text-sm font-mediu
m\">{schedule.workingHours}</p>\r\n 
                       </div>\r\n   
                     <div>\r\n      
                    <p 
className=\"text-xs 
text-muted-foreground\">Working 
Days</p>\r\n                        
  <p className=\"text-sm font-medium
\">{schedule.workingDays.join(\", 
\")}</p>\r\n                        
</div>\r\n                      
</div>\r\n                    
</div>\r\n                  
</CardContent>\r\n                
</Card>\r\n              </div>\r\n 
           )}\r\n          
</div>\r\n        )}\r\n\r\n        
{activeTab === \"employment\" && 
(\r\n          <div 
className=\"space-y-6\">\r\n        
    <div 
className=\"space-y-4\">\r\n        
      <h2 className=\"text-sm 
font-bold\">Employment 
Timeline</h2>\r\n              
<Card>\r\n                
<CardContent className=\"p-0\">\r\n 
                 <div 
className=\"grid divide-y 
md:grid-cols-3 md:divide-x 
md:divide-y-0\">\r\n                
    <div className=\"p-4\">\r\n     
                 <p 
className=\"text-xs 
text-muted-foreground uppercase 
tracking-wide\">Start Date</p>\r\n  
                    <p 
className=\"mt-1 font-medium\">{form
atDate(member.hire_date)}</p>\r\n   
                 </div>\r\n         
           <div 
className=\"p-4\">\r\n              
        <p className=\"text-xs 
text-muted-foreground uppercase 
tracking-wide\">Probation 
End</p>\r\n                      <p 
className=\"mt-1 font-medium\">{form
atDate(member.probation_end_date)}</
p>\r\n                    
</div>\r\n                    <div 
className=\"p-4\">\r\n              
        <p className=\"text-xs 
text-muted-foreground uppercase 
tracking-wide\">Duration</p>\r\n    
                  <p 
className=\"mt-1 font-medium\">\r\n 
                       {(() => 
{\r\n                          if 
(!member.hire_date) return 
\"-\"\r\n                          
const start = new 
Date(member.hire_date)\r\n          
                const end = 
member.termination_date ? new 
Date(member.termination_date) : new 
Date()\r\n                          
if (Number.isNaN(start.getTime())) 
return \"-\"\r\n\r\n                
          const diffTime = 
Math.abs(end.getTime() - 
start.getTime())\r\n                
          const diffDays = 
Math.ceil(diffTime / (1000 * 60 * 
60 * 24))\r\n\r\n                   
       if (diffDays < 30) return 
`${diffDays} days`\r\n              
            const months = 
Math.floor(diffDays / 30)\r\n       
                   if (months < 12) 
return `${months} months`\r\n       
                   const years = 
Math.floor(months / 12)\r\n         
                 const 
remainingMonths = months % 12\r\n   
                       return 
`${years} year${years > 1 ? \"s\" : 
\"\"}${remainingMonths > 0 ? `, 
${remainingMonths} 
month${remainingMonths > 1 ? \"s\" 
: \"\"}` : \"\"}`\r\n               
         })()}\r\n                  
    </p>\r\n                    
</div>\r\n                  
</div>\r\n                
</CardContent>\r\n              
</Card>\r\n            
</div>\r\n\r\n            <div 
className=\"space-y-4\">\r\n        
      <h2 className=\"text-sm 
font-bold\">Employment 
Details</h2>\r\n              <div 
className=\"grid gap-4 
md:grid-cols-2\">\r\n               
 <FormField\r\n                  
label=\"JOB TITLE\"\r\n             
     value={member.positions?.title 
|| \"No title assigned\"}\r\n       
           disabled={true}\r\n      
          />\r\n                
<FormField\r\n                  
label=\"DEPARTMENT\"\r\n            
      value={\r\n                   
 (member.departments as any)?.name 
|| (member.groups as any)?.name || 
\"No department\"\r\n               
   }\r\n                  
disabled={true}\r\n                
/>\r\n                
<FormField\r\n                  
label=\"MANAGER\"\r\n               
   value=\"Not assigned\"\r\n       
           disabled={true}\r\n      
          />\r\n                
<FormField\r\n                  
label=\"EMPLOYMENT TYPE\"\r\n       
           
value={member.contract_type || 
\"Not specified\"}\r\n              
    disabled={true}\r\n             
   />\r\n                
<FormField\r\n                  
label=\"EMPLOYMENT STATUS\"\r\n     
             
value={member.employment_status || 
(member.is_active ? \"Active\" : 
\"Inactive\")}\r\n                  
disabled={true}\r\n                
/>\r\n                
<FormField\r\n                  
label=\"WORK LOCATION\"\r\n         
         
value={member.work_location || 
\"Not specified\"}\r\n              
    disabled={true}\r\n             
   />\r\n              </div>\r\n   
         </div>\r\n\r\n            
<div className=\"space-y-4\">\r\n   
           <div className=\"flex 
items-center justify-between\">\r\n 
               <h2 
className=\"text-sm 
font-bold\">Accounting</h2>\r\n     
           <span 
className=\"text-xs 
text-muted-foreground bg-muted px-2 
py-0.5 rounded\">View 
Only</span>\r\n              
</div>\r\n              <div 
className=\"grid gap-4 
md:grid-cols-2\">\r\n               
 <FormField\r\n                  
label=\"TAX INFO\"\r\n              
    value={member.tax_id_number || 
\"Not set\"}\r\n                  
disabled={true}\r\n                
/>\r\n\r\n                <div 
className=\"space-y-2\">\r\n        
          <div className=\"flex 
items-center justify-between\">\r\n 
                   <Label 
className=\"text-xs font-semibold 
uppercase tracking-wide 
text-muted-foreground\">\r\n        
              TAX TYPE\r\n          
          </Label>\r\n              
    </div>\r\n                  
<Select disabled 
defaultValue={member.tax_type || 
\"employee\"}>\r\n                  
  <SelectTrigger 
className=\"w-full\">\r\n           
           <SelectValue 
placeholder=\"Select type\" />\r\n  
                  
</SelectTrigger>\r\n                
    <SelectContent>\r\n             
         <SelectItem value=\"employe
e\">Employee</SelectItem>\r\n       
               <SelectItem value=\"c
ontractor\">Contractor</SelectItem>\
r\n                    
</SelectContent>\r\n                
  </Select>\r\n                
</div>\r\n\r\n                
<FormField\r\n                  
label=\"ACCOUNT CODE\"\r\n          
        value={member.account_code 
|| \"Not set\"}\r\n                 
 disabled={true}\r\n                
/>\r\n\r\n                <div 
className=\"space-y-2\">\r\n        
          <div className=\"flex 
items-center justify-between\">\r\n 
                   <Label 
className=\"text-xs font-semibold 
uppercase tracking-wide 
text-muted-foreground\">\r\n        
              CURRENCY\r\n          
          </Label>\r\n              
    </div>\r\n                  
<Select disabled 
defaultValue={member.currency || 
\"IDR\"}>\r\n                    
<SelectTrigger 
className=\"w-full\">\r\n           
           <SelectValue 
placeholder=\"Select currency\" 
/>\r\n                    
</SelectTrigger>\r\n                
    <SelectContent>\r\n             
         <SelectItem 
value=\"IDR\">IDR - Indonesian 
Rupiah</SelectItem>\r\n             
         <SelectItem 
value=\"USD\">USD - US 
Dollar</SelectItem>\r\n             
         <SelectItem 
value=\"EUR\">EUR - 
Euro</SelectItem>\r\n               
       <SelectItem 
value=\"SGD\">SGD - Singapore 
Dollar</SelectItem>\r\n             
       </SelectContent>\r\n         
         </Select>\r\n              
  </div>\r\n              
</div>\r\n            </div>\r\n    
      </div>\r\n        )}\r\n\r\n  
      {activeTab === \"roles\" && 
(\r\n          <div 
className=\"space-y-6\">\r\n        
    {/* Role Selection */}\r\n      
      <div 
className=\"space-y-4\">\r\n        
      <div className=\"flex 
items-center justify-between\">\r\n 
               <Label 
className=\"text-xs font-semibold 
uppercase tracking-wide 
text-muted-foreground\">\r\n        
          ROLE <span className=\"tex
t-red-500\">*</span>\r\n            
    </Label>\r\n                
<button className=\"text-xs 
text-primary 
hover:underline\">Learn 
more</button>\r\n              
</div>\r\n              <Select 
defaultValue={member.role?.name || 
\"Member\"}>\r\n                
<SelectTrigger 
className=\"w-full\">\r\n           
       <SelectValue 
placeholder=\"Select a role\" 
/>\r\n                
</SelectTrigger>\r\n                
<SelectContent>\r\n                 
 <SelectItem value=\"Owner\">Owner</
SelectItem>\r\n                  
<SelectItem value=\"Manager\">Manage
r</SelectItem>\r\n                  
<SelectItem value=\"Member\">Member<
/SelectItem>\r\n                  
<SelectItem value=\"Project 
Viewer\">Project 
Viewer</SelectItem>\r\n             
   </SelectContent>\r\n             
 </Select>\r\n            
</div>\r\n\r\n            {/* 
Projects & Teams */}\r\n            
<div className=\"grid gap-8 
md:grid-cols-2\">\r\n              
{/* Projects Column */}\r\n         
     <div 
className=\"space-y-6\">\r\n        
        <div className=\"flex 
items-center gap-2\">\r\n           
       <h3 className=\"text-sm 
font-bold\">Projects</h3>\r\n       
           <Info className=\"h-3 
w-3 text-muted-foreground\" />\r\n  
              </div>\r\n\r\n        
        <div 
className=\"space-y-2\">\r\n        
          <div className=\"flex 
items-center justify-between\">\r\n 
                   <Label 
className=\"text-sm 
text-muted-foreground\">Able to 
track time on these 
projects</Label>\r\n                
    <button className=\"text-xs 
text-primary 
hover:underline\">Select 
all</button>\r\n                  
</div>\r\n                  <div 
className=\"relative\">\r\n         
           <div className=\"flex 
min-h-[40px] w-full items-center 
justify-between rounded-md border 
border-input bg-background px-3 
py-2 text-sm ring-offset-background 
placeholder:text-muted-foreground 
focus:outline-none focus:ring-2 
focus:ring-ring focus:ring-offset-2 
disabled:cursor-not-allowed 
disabled:opacity-50\">\r\n          
            <span className=\"text-m
uted-foreground\">0 
projects</span>\r\n                 
     <X className=\"h-4 w-4 
cursor-pointer 
text-muted-foreground 
hover:text-foreground\" />\r\n      
              </div>\r\n            
        <div className=\"absolute 
left-0 top-0 h-full w-1 
rounded-l-md 
bg-blue-500\"></div>\r\n            
      </div>\r\n                
</div>\r\n              
</div>\r\n\r\n              {/* 
Teams Column */}\r\n              
<div className=\"space-y-6\">\r\n   
             <div className=\"flex 
items-center gap-2\">\r\n           
       <h3 className=\"text-sm 
font-bold\">Teams</h3>\r\n          
        <Info className=\"h-3 w-3 
text-muted-foreground\" />\r\n      
          </div>\r\n\r\n            
    <div 
className=\"space-y-2\">\r\n        
          <div className=\"flex 
items-center justify-between\">\r\n 
                   <Label 
className=\"text-sm 
text-muted-foreground\">Member in 
these teams</Label>\r\n             
       <button className=\"text-xs 
text-primary 
hover:underline\">Select 
all</button>\r\n                  
</div>\r\n                  <Input 
placeholder=\"Select teams\" />\r\n 
               </div>\r\n\r\n       
         <div 
className=\"space-y-2\">\r\n        
          <div className=\"flex 
items-center justify-between\">\r\n 
                   <Label 
className=\"text-sm 
text-muted-foreground\">Manages 
these teams as <span 
className=\"font-semibold 
text-foreground\">Team 
lead</span></Label>\r\n             
       <button className=\"text-xs 
text-primary 
hover:underline\">Select 
all</button>\r\n                  
</div>\r\n                  <Input 
placeholder=\"Select teams\" />\r\n 
               </div>\r\n           
   </div>\r\n            </div>\r\n 
         </div>\r\n        
)}\r\n\r\n        {/* Other tabs 
placeholder */}\r\n        
{activeTab !== \"info\" && 
activeTab !== \"employment\" && 
activeTab !== \"roles\" && (\r\n    
      <div className=\"flex 
items-center justify-center 
py-12\">\r\n            <p className
=\"text-muted-foreground\">\r\n     
         {tabs.find((t) => t.id === 
activeTab)?.label} content coming 
soon\r\n            </p>\r\n        
  </div>\r\n        )}\r\n      
</div>\r\n    </div >\r\n  )\r\n}\r\
n","usedDeprecatedRules":[]},{"fileP
ath":"D:\\UBIG\\Projek\\Presensi-New
\\src\\app\\members\\export\\page.ts
x","messages":[{"ruleId":null,"messa
ge":"Unused eslint-disable 
directive (no problems were 
reported from 'react-hooks/exhaustiv
e-deps').","line":275,"column":5,"se
verity":1,"nodeType":null,"fix":{"ra
nge":[10529,10584],"text":" "}}],"su
ppressedMessages":[],"errorCount":0,
"fatalErrorCount":0,"warningCount":1
,"fixableErrorCount":0,"fixableWarni
ngCount":1,"source":"\"use 
client\"\r\n\r\nimport React, { 
useState, useEffect, useRef } from 
\"react\"\r\nimport { useRouter, 
useSearchParams } from 
\"next/navigation\"\r\nimport { 
Wizard, WizardStep } from \"@/compon
ents/ui/wizard\"\r\nimport { Button 
} from \"@/components/ui/button\"\r\
nimport { Checkbox } from \"@/compon
ents/ui/checkbox\"\r\nimport { 
Label } from 
\"@/components/ui/label\"\r\nimport 
{ RadioGroup, RadioGroupItem } from 
\"@/components/ui/radio-group\"\r\ni
mport { Alert, AlertDescription } 
from 
\"@/components/ui/alert\"\r\nimport 
{ Table, TableBody, TableCell, 
TableHead, TableHeader, TableRow } 
from 
\"@/components/ui/table\"\r\nimport 
{ ScrollArea } from \"@/components/u
i/scroll-area\"\r\nimport { Card, 
CardContent, CardDescription, 
CardHeader, CardTitle } from 
\"@/components/ui/card\"\r\nimport 
{ Badge } from 
\"@/components/ui/badge\"\r\nimport 
{\r\n  FileSpreadsheet,\r\n  
FileText,\r\n  Loader2,\r\n  
CheckCircle2,\r\n  AlertCircle,\r\n 
 ArrowLeft,\r\n  Users,\r\n  
Search,\r\n  Filter,\r\n  X,\r\n  
GripVertical,\r\n  
ChevronsLeft,\r\n  
ChevronsRight,\r\n  
ChevronLeft,\r\n  ChevronRight,\r\n 
 Download\r\n} from 
\"lucide-react\"\r\nimport { toast 
} from \"sonner\"\r\nimport { 
useHydration } from 
\"@/hooks/useHydration\"\r\nimport 
{ useGroups } from 
\"@/hooks/use-groups\"\r\nimport 
Link from \"next/link\"\r\nimport { 
Input } from 
\"@/components/ui/input\"\r\nimport 
{ Popover, PopoverContent, 
PopoverTrigger } from \"@/components
/ui/popover\"\r\nimport { Command, 
CommandEmpty, CommandGroup, 
CommandInput, CommandItem, 
CommandList } from \"@/components/ui
/command\"\r\n\r\nconst 
WIZARD_STEPS: WizardStep[] = [\r\n  
{ number: 1, title: \"Pilih Data\", 
description: \"Ringkasan data yang 
akan diexport\" },\r\n  { number: 
2, title: \"Konfigurasi Export\", 
description: \"Pilih format dan 
kolom\" },\r\n  { number: 3, title: 
\"Preview Data\", description: 
\"Preview hasil export\" },\r\n  { 
number: 4, title: \"Export\", 
description: \"Proses export ke 
file\" },\r\n  { number: 5, title: 
\"Result\", description: \"Hasil 
export\" },\r\n]\r\n\r\n// 
Available export fields - ONLY from 
biodata table\r\nconst 
EXPORT_FIELDS = [\r\n  { key: 
\"nik\", label: \"NIK\", default: 
true },\r\n  { key: \"nama\", 
label: \"Nama Lengkap\", default: 
true },\r\n  { key: \"nickname\", 
label: \"Nickname\", default: false 
},\r\n  { key: \"nisn\", label: 
\"NISN\", default: false },\r\n  { 
key: \"jenis_kelamin\", label: 
\"Jenis Kelamin\", default: false 
},\r\n  { key: \"tempat_lahir\", 
label: \"Tempat Lahir\", default: 
false },\r\n  { key: 
\"tanggal_lahir\", label: \"Tanggal 
Lahir\", default: false },\r\n  { 
key: \"agama\", label: \"Agama\", 
default: false },\r\n  { key: 
\"jalan\", label: \"Jalan\", 
default: false },\r\n  { key: 
\"rt\", label: \"RT\", default: 
false },\r\n  { key: \"rw\", label: 
\"RW\", default: false },\r\n  { 
key: \"dusun\", label: \"Dusun\", 
default: false },\r\n  { key: 
\"kelurahan\", label: 
\"Kelurahan\", default: false 
},\r\n  { key: \"kecamatan\", 
label: \"Kecamatan\", default: 
false },\r\n  { key: 
\"no_telepon\", label: \"No. 
Telepon\", default: false },\r\n  { 
key: \"email\", label: \"Email\", 
default: true },\r\n  { key: 
\"department_id\", label: 
\"Group\", default: false },\r\n] 
as const\r\n\r\ntype ExportFormat = 
\"xlsx\" | \"csv\"\r\ntype 
ExportConfig = {\r\n  format: 
ExportFormat\r\n  selectedFields: 
string[]\r\n  includeHeader: 
boolean\r\n  dateFormat: 
string\r\n}\r\n\r\nexport default 
function MembersExportPage() {\r\n  
const router = useRouter()\r\n  
const searchParams = 
useSearchParams()\r\n  const { 
isHydrated, organizationId } = 
useHydration()\r\n  const 
[currentStep, setCurrentStep] = 
useState(1)\r\n  const [loading, 
setLoading] = useState(false)\r\n  
const [exporting, setExporting] = 
useState(false)\r\n  const 
[exportConfig, setExportConfig] = 
useState<ExportConfig>({\r\n    
format: \"xlsx\",\r\n    
selectedFields: 
EXPORT_FIELDS.filter(f => 
f.default).map(f => f.key),\r\n    
includeHeader: true,\r\n    
dateFormat: \"YYYY-MM-DD\",\r\n  
})\r\n  const [previewData, 
setPreviewData] = 
useState<Record<string, 
any>[]>([])\r\n  const [memberRows, 
setMemberRows] = 
useState<Record<string, any>[]>([]) 
// Data untuk tabel di Step 1\r\n  
const [totalCount, setTotalCount] = 
useState(0)\r\n  const 
[loadingMembers, setLoadingMembers] 
= useState(false)\r\n  const 
[selectedRows, setSelectedRows] = 
useState<Set<number>>(new Set()) // 
Indeks row yang dipilih\r\n  const 
[selectAllPages, setSelectAllPages] 
= useState(false) // Flag untuk 
menandai semua halaman dipilih\r\n  
const [currentPage, setCurrentPage] 
= useState(1)\r\n  const [pageSize, 
setPageSize] = useState(1000) // 
Maksimal 1000 data per halaman\r\n  
const [exportResult, 
setExportResult] = useState<{\r\n   
 success: boolean\r\n    fileUrl?: 
string\r\n    fileName?: string\r\n 
   exportedCount?: number\r\n    
message?: string\r\n  } | 
null>(null)\r\n  const 
[exportProgress, setExportProgress] 
= useState<{ current: number; 
total: number }>({\r\n    current: 
0,\r\n    total: 0,\r\n  })\r\n  
const exportProgressTimerRef = 
useRef<ReturnType<typeof 
setInterval> | null>(null)\r\n  
const exportFinishTimerRef = 
useRef<ReturnType<typeof 
setInterval> | null>(null)\r\n\r\n  
// Filter states - dynamic filter 
system (like Supabase)\r\n  const 
[searchQuery, setSearchQuery] = useS
tate(searchParams.get(\"search\") 
|| \"\")\r\n  const [filters, 
setFilters] = useState<Array<{\r\n  
  id: string\r\n    column: 
string\r\n    values: string[]\r\n  
}>>([])\r\n  const 
[showAddFilterPopover, 
setShowAddFilterPopover] = 
useState(false)\r\n  const 
[editingFilterId, 
setEditingFilterId] = 
useState<string | null>(null)\r\n  
const [filterOptions, 
setFilterOptions] = 
useState<Record<string, Array<{ 
value: string; label: string 
}>>>({})\r\n  const 
[loadingFilterOptions, 
setLoadingFilterOptions] = 
useState<Record<string, 
boolean>>({})\r\n  // State untuk 
2-step filter (pilih kolom ΓåÆ 
pilih nilai + Apply)\r\n  const 
[selectedColumnForFilter, 
setSelectedColumnForFilter] = 
useState<string | null>(null)\r\n  
const [tempNewFilterValues, 
setTempNewFilterValues] = 
useState<string[]>([])\r\n\r\n  // 
Load groups\r\n  const { data: 
groups = [] } = useGroups({\r\n    
enabled: isHydrated && 
!!organizationId\r\n  })\r\n\r\n  
// Load filter options from 
database\r\n  const 
loadFilterOptions = 
React.useCallback(async (columnKey: 
string) => {\r\n    if 
(!organizationId || !columnKey) 
return\r\n    if 
(filterOptions[columnKey] || 
loadingFilterOptions[columnKey]) 
return\r\n\r\n    
setLoadingFilterOptions(prev => ({ 
...prev, [columnKey]: true }))\r\n  
  try {\r\n      const url = new URL
(\"/api/members/export/filter-option
s\", window.location.origin)\r\n    
  url.searchParams.set(\"organizatio
nId\", String(organizationId))\r\n  
    
url.searchParams.set(\"column\", 
columnKey)\r\n\r\n      const res = 
await fetch(url.toString(), { 
credentials: \"same-origin\" })\r\n 
     const json = await 
res.json()\r\n\r\n      if 
(json.success) {\r\n        
setFilterOptions(prev => ({\r\n     
     ...prev,\r\n          
[columnKey]: json.options || []\r\n 
       }))\r\n      }\r\n    } 
catch (error) {\r\n      
console.error(\"Error loading 
filter options:\", error)\r\n    } 
finally {\r\n      
setLoadingFilterOptions(prev => ({ 
...prev, [columnKey]: false }))\r\n 
   }\r\n  }, [organizationId, 
filterOptions, 
loadingFilterOptions])\r\n\r\n  // 
Available filter columns (exclude 
already selected ones)\r\n  const 
getAvailableFilterColumns = () => 
{\r\n    const usedColumns = new 
Set(filters.map(f => f.column))\r\n 
   return [\r\n      {\r\n        
key: \"group\",\r\n        label: 
\"Group / Department\",\r\n        
options: groups.map(g => ({ value: 
String(g.id), label: g.name }))\r\n 
     },\r\n      {\r\n        key: 
\"jenis_kelamin\",\r\n        
label: \"Jenis Kelamin\",\r\n       
 options: 
filterOptions.jenis_kelamin || 
[]\r\n      },\r\n      {\r\n       
 key: \"agama\",\r\n        label: 
\"Agama\",\r\n        options: 
filterOptions.agama || []\r\n      
},\r\n    ].filter(col => 
!usedColumns.has(col.key))\r\n  
}\r\n\r\n  // Get filter values for 
API\r\n  const getFilterParams = () 
=> {\r\n    const params: 
Record<string, string[]> = {}\r\n   
 filters.forEach(filter => {\r\n    
  if (filter.column === \"group\") 
{\r\n        params.groups = 
filter.values\r\n      } else if 
(filter.column === 
\"jenis_kelamin\") {\r\n        
params.genders = filter.values\r\n  
    } else if (filter.column === 
\"agama\") {\r\n        
params.agamas = filter.values\r\n   
   } else if (filter.column === 
\"status\") {\r\n        
params.status = filter.values\r\n   
   }\r\n    })\r\n    return 
params\r\n  }\r\n\r\n  // Add new 
filter - Step 1: Pilih kolom, lalu 
buka panel untuk pilih nilai\r\n  
const selectColumnForFilter = 
(columnKey: string) => {\r\n    // 
Load filter options if needed\r\n   
 if (columnKey !== \"group\" && 
!filterOptions[columnKey]) {\r\n    
  loadFilterOptions(columnKey)\r\n  
  }\r\n    setSelectedColumnForFilte
r(columnKey)\r\n    
setTempNewFilterValues([])\r\n    
// Popover tetap terbuka untuk 
menampilkan panel nilai\r\n  
}\r\n\r\n  // Apply new filter - 
Step 2: Setelah pilih nilai, klik 
Apply\r\n  const applyNewFilter = 
() => {\r\n    if 
(!selectedColumnForFilter || 
tempNewFilterValues.length === 0) 
{\r\n      toast.error(\"Pilih 
minimal satu nilai untuk 
filter\")\r\n      return\r\n    
}\r\n    const filterId = `${selecte
dColumnForFilter}-${Date.now()}`\r\n
    setFilters(prev => [...prev, { 
id: filterId, column: 
selectedColumnForFilter, values: 
tempNewFilterValues }])\r\n    setSe
lectedColumnForFilter(null)\r\n    
setTempNewFilterValues([])\r\n    
setShowAddFilterPopover(false)\r\n  
}\r\n\r\n  // Remove filter\r\n  
const removeFilter = (filterId: 
string) => {\r\n    setFilters(prev 
=> prev.filter(f => f.id !== 
filterId))\r\n  }\r\n\r\n  // 
Update filter values\r\n  const 
updateFilterValues = (filterId: 
string, values: string[]) => {\r\n  
  setFilters(prev => prev.map(f => 
f.id === filterId ? { ...f, values 
} : f))\r\n  }\r\n\r\n  // Get 
filter column config\r\n  const 
getFilterColumnConfig = (columnKey: 
string) => {\r\n    const 
allColumns = [\r\n      {\r\n       
 key: \"group\",\r\n        label: 
\"Group / Department\",\r\n        
options: groups.map(g => ({ value: 
String(g.id), label: g.name }))\r\n 
     },\r\n      {\r\n        key: 
\"jenis_kelamin\",\r\n        
label: \"Jenis Kelamin\",\r\n       
 options: 
filterOptions.jenis_kelamin || 
[]\r\n      },\r\n      {\r\n       
 key: \"agama\",\r\n        label: 
\"Agama\",\r\n        options: 
filterOptions.agama || []\r\n      
},\r\n    ]\r\n    return 
allColumns.find(col => col.key === 
columnKey)\r\n  }\r\n\r\n  // Load 
filter options on mount\r\n  
useEffect(() => {\r\n    if 
(isHydrated && organizationId) 
{\r\n      
loadFilterOptions(\"agama\")\r\n    
  loadFilterOptions(\"jenis_kelamin\
")\r\n    }\r\n  }, [isHydrated, 
organizationId, 
loadFilterOptions])\r\n\r\n  // 
Reset selectAllPages ketika filter 
atau search berubah\r\n  
useEffect(() => {\r\n    
setSelectAllPages(false)\r\n    
setSelectedRows(new Set())\r\n  }, 
[searchQuery, filters])\r\n\r\n  // 
Step 1: Load member data summary 
and rows\r\n  useEffect(() => {\r\n 
   if (currentStep === 1 && 
isHydrated && organizationId) {\r\n 
     loadMemberSummary()\r\n      
loadMemberRows()\r\n    }\r\n    // 
eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n  }, 
[currentStep, isHydrated, 
organizationId, searchQuery, 
filters, currentPage, 
pageSize])\r\n\r\n  // Cleanup 
progress timer on unmount\r\n  
useEffect(() => {\r\n    return () 
=> {\r\n      if 
(exportProgressTimerRef.current) 
{\r\n        clearInterval(exportPro
gressTimerRef.current)\r\n        
exportProgressTimerRef.current = 
null\r\n      }\r\n      if 
(exportFinishTimerRef.current) 
{\r\n        clearInterval(exportFin
ishTimerRef.current)\r\n        
exportFinishTimerRef.current = 
null\r\n      }\r\n    }\r\n  }, 
[])\r\n\r\n  const 
loadMemberSummary = async () => 
{\r\n    setLoading(true)\r\n    
try {\r\n      const url = new 
URL(\"/api/members/export/count\", 
window.location.origin)\r\n      if 
(organizationId) url.searchParams.se
t(\"organizationId\", 
String(organizationId))\r\n      if 
(searchQuery) 
url.searchParams.set(\"search\", 
searchQuery)\r\n\r\n      const 
filterParams = 
getFilterParams()\r\n      if 
(filterParams.groups?.length) 
url.searchParams.set(\"groups\", fil
terParams.groups.join(\",\"))\r\n   
   if 
(filterParams.genders?.length) 
url.searchParams.set(\"genders\", fi
lterParams.genders.join(\",\"))\r\n 
     if 
(filterParams.agamas?.length) 
url.searchParams.set(\"agamas\", fil
terParams.agamas.join(\",\"))\r\n   
   if (filterParams.status?.length) 
{\r\n        const status = 
filterParams.status[0] // Status is 
single value\r\n        if (status) 
{\r\n          
url.searchParams.set(\"active\", 
status)\r\n        }\r\n      
}\r\n\r\n      const res = await 
fetch(url.toString(), { 
credentials: \"same-origin\" })\r\n 
     const json = await 
res.json()\r\n\r\n      if 
(json.success) {\r\n        
setTotalCount(json.count || 0)\r\n  
    } else {\r\n        
toast.error(json.message || \"Gagal 
memuat data member\")\r\n      
}\r\n    } catch (error) {\r\n      
console.error(\"Error loading 
member summary:\", error)\r\n      
toast.error(\"Gagal memuat data 
member\")\r\n    } finally {\r\n    
  setLoading(false)\r\n    }\r\n  
}\r\n\r\n  const loadMemberRows = 
async () => {\r\n    
setLoadingMembers(true)\r\n    try 
{\r\n      const url = new 
URL(\"/api/members/export/rows\", 
window.location.origin)\r\n      if 
(organizationId) url.searchParams.se
t(\"organizationId\", 
String(organizationId))\r\n      if 
(searchQuery) 
url.searchParams.set(\"search\", 
searchQuery)\r\n      
url.searchParams.set(\"page\", 
String(currentPage))\r\n      
url.searchParams.set(\"pageSize\", 
String(pageSize))\r\n\r\n      
const filterParams = 
getFilterParams()\r\n      if 
(filterParams.groups?.length) 
url.searchParams.set(\"groups\", fil
terParams.groups.join(\",\"))\r\n   
   if 
(filterParams.genders?.length) 
url.searchParams.set(\"genders\", fi
lterParams.genders.join(\",\"))\r\n 
     if 
(filterParams.agamas?.length) 
url.searchParams.set(\"agamas\", fil
terParams.agamas.join(\",\"))\r\n   
   if (filterParams.status?.length 
&& filterParams.status[0]) {\r\n    
    const status = 
filterParams.status[0]\r\n        
url.searchParams.set(\"active\", 
status)\r\n      }\r\n\r\n      
const res = await 
fetch(url.toString(), { 
credentials: \"same-origin\" })\r\n 
     const json = await 
res.json()\r\n\r\n      if 
(json.success) {\r\n        
setMemberRows(json.data || [])\r\n  
      // Reset selected rows saat 
ganti halaman\r\n        // Tapi 
jika selectAllPages true, tetap 
pilih semua row di halaman baru 
untuk visual feedback\r\n        if 
(selectAllPages) {\r\n          
setSelectedRows(new 
Set(json.data?.map((_: any, idx: 
number) => idx) || []))\r\n        
} else {\r\n          
setSelectedRows(new Set())\r\n      
  }\r\n      } else {\r\n        
toast.error(json.message || \"Gagal 
memuat data member\")\r\n      
}\r\n    } catch (error) {\r\n      
console.error(\"Error loading 
member rows:\", error)\r\n      
toast.error(\"Gagal memuat data 
member\")\r\n    } finally {\r\n    
  setLoadingMembers(false)\r\n    
}\r\n  }\r\n\r\n  const 
toggleRowSelection = (index: 
number) => {\r\n    // Jika user 
memilih/deselect row secara manual, 
reset selectAllPages\r\n    
setSelectAllPages(false)\r\n    
setSelectedRows(prev => {\r\n      
const newSet = new Set(prev)\r\n    
  if (newSet.has(index)) {\r\n      
  newSet.delete(index)\r\n      } 
else {\r\n        
newSet.add(index)\r\n      }\r\n    
  return newSet\r\n    })\r\n  
}\r\n\r\n  const toggleSelectAll = 
() => {\r\n    if (selectAllPages) 
{\r\n      // Jika semua halaman 
sudah dipilih, hapus semua 
pilihan\r\n      
setSelectAllPages(false)\r\n      
setSelectedRows(new Set())\r\n    } 
else {\r\n      // Pilih semua 
halaman (semua data yang sesuai 
filter)\r\n      
setSelectAllPages(true)\r\n      // 
Juga pilih semua row di halaman 
saat ini untuk visual feedback\r\n  
    setSelectedRows(new 
Set(memberRows.map((_, idx) => 
idx)))\r\n    }\r\n  }\r\n\r\n  
const totalPages = 
Math.ceil(totalCount / 
pageSize)\r\n\r\n  // Step 3: Load 
preview data (gunakan API rows agar 
konsisten dengan Data Member)\r\n  
const loadPreviewData = async () => 
{\r\n    setLoading(true)\r\n    // 
Jika user sudah memilih baris 
tertentu di Step 1,\r\n    // 
preview cukup menampilkan baris 
yang dipilih saja (maks 10 
baris),\r\n    // supaya sesuai 
ekspektasi bahwa hanya data 
terpilih yang akan diexport.\r\n    
if (selectedRows.size > 0 && 
memberRows.length > 0) {\r\n      
const selected = memberRows\r\n     
   .filter((_, idx) => 
selectedRows.has(idx))\r\n        
.slice(0, 10)\r\n      
setPreviewData(selected)\r\n      
setLoading(false)\r\n      
return\r\n    }\r\n\r\n    try 
{\r\n      const url = new 
URL(\"/api/members/export/rows\", 
window.location.origin)\r\n      if 
(organizationId) url.searchParams.se
t(\"organizationId\", 
String(organizationId))\r\n      if 
(searchQuery) 
url.searchParams.set(\"search\", 
searchQuery)\r\n      // Preview 
selalu ambil halaman pertama, 
maksimal 10 baris\r\n      
url.searchParams.set(\"page\", 
\"1\")\r\n      
url.searchParams.set(\"pageSize\", 
\"10\")\r\n\r\n      const 
filterParams = 
getFilterParams()\r\n      if 
(filterParams.groups?.length) 
url.searchParams.set(\"groups\", fil
terParams.groups.join(\",\"))\r\n   
   if 
(filterParams.genders?.length) 
url.searchParams.set(\"genders\", fi
lterParams.genders.join(\",\"))\r\n 
     if 
(filterParams.agamas?.length) 
url.searchParams.set(\"agamas\", fil
terParams.agamas.join(\",\"))\r\n   
   if (filterParams.status?.length) 
{\r\n        const status = 
filterParams.status[0]\r\n        
if (status) {\r\n          
url.searchParams.set(\"active\", 
status)\r\n        }\r\n      
}\r\n\r\n      const res = await 
fetch(url.toString(), { 
credentials: \"same-origin\" })\r\n 
     const json = await 
res.json()\r\n\r\n      if 
(json.success) {\r\n        
setPreviewData(json.data || [])\r\n 
     } else {\r\n        
toast.error(json.message || \"Gagal 
memuat preview data\")\r\n      
}\r\n    } catch (error) {\r\n      
console.error(\"Error loading 
preview:\", error)\r\n      
toast.error(\"Gagal memuat preview 
data\")\r\n    } finally {\r\n      
setLoading(false)\r\n    }\r\n  
}\r\n\r\n  // Step 4: Process 
export\r\n  const processExport = 
async () => {\r\n    
setExporting(true)\r\n    
setExportResult(null) // Reset 
previous result\r\n    \r\n    // 
Hitung total rows yang akan 
diexport\r\n    const 
estimatedTotal = selectAllPages ? 
totalCount : selectedRows.size\r\n  
  \r\n    // Setup progress 
tracking dengan timer incremental 
yang lebih realistis\r\n    if 
(estimatedTotal > 0) {\r\n      
setExportProgress({ current: 0, 
total: estimatedTotal })\r\n\r\n    
  // Estimasi waktu export 
berdasarkan jumlah data (lebih 
realistis)\r\n      // Asumsi: 
~100-500 rows per detik tergantung 
kompleksitas\r\n      const 
estimatedSeconds = Math.max(2, 
Math.ceil(estimatedTotal / 200)) // 
Minimal 2 detik\r\n      const 
targetProgress = 
Math.floor(estimatedTotal * 0.95) 
// Target 95% sebelum selesai\r\n   
   const steps = estimatedSeconds * 
5 // 5 update per detik = smooth 
animation\r\n      const 
incrementPerStep = 
Math.ceil(targetProgress / 
steps)\r\n\r\n      let stepCount = 
0\r\n      // Fake incremental 
progress selama proses export 
berjalan\r\n      // Akan diset ke 
nilai sebenarnya ketika server 
selesai memproses\r\n      
exportProgressTimerRef.current = 
setInterval(() => {\r\n        
setExportProgress((prev) => {\r\n   
       if (!prev.total) return 
prev\r\n          stepCount++\r\n   
       \r\n          // Hitung 
progress berdasarkan waktu yang 
sudah berlalu\r\n          const 
maxProgress = Math.min(\r\n         
   targetProgress,\r\n            
stepCount * incrementPerStep\r\n    
      )\r\n          \r\n          
if (prev.current >= maxProgress) 
return prev\r\n          \r\n       
   // Update progress dengan 
increment yang lebih besar untuk 
lebih cepat\r\n          const 
nextCurrent = Math.min(prev.current 
+ incrementPerStep, 
maxProgress)\r\n          return { 
...prev, current: nextCurrent }\r\n 
       })\r\n      }, 200) // 
Update setiap 200ms untuk animasi 
halus\r\n    } else {\r\n      // 
Jika tidak tahu totalnya, tetap 
reset progres\r\n      
setExportProgress({ current: 0, 
total: 0 })\r\n    }\r\n    \r\n    
try {\r\n      // Jika 
selectAllPages true, jangan kirim 
selectedNiks (biarkan API fetch 
semua data berdasarkan filter)\r\n  
    // Jika selectAllPages false, 
kirim selectedNiks dari row yang 
dipilih\r\n      let selectedNiks: 
string[] = []\r\n\r\n      if 
(selectAllPages) {\r\n        // 
Semua halaman dipilih - jangan 
kirim selectedNiks, biarkan API 
fetch semua data\r\n        
selectedNiks = []\r\n      } else 
{\r\n        // Ambil NIK dari row 
yang dipilih di halaman saat 
ini\r\n        selectedNiks = 
Array.from(selectedRows)\r\n        
  .map(idx => 
memberRows[idx]?.nik)\r\n          
.filter(nik => nik) // Filter NIK 
yang valid\r\n\r\n        if 
(selectedNiks.length === 0) {\r\n   
       toast.error(\"Tidak ada data 
yang dipilih untuk diexport\")\r\n  
        setExporting(false)\r\n     
     return\r\n        }\r\n      
}\r\n\r\n      // Use POST request 
to avoid 431 error (Request Header 
Fields Too Large)\r\n      // when 
sending large number of 
selectedNiks\r\n      const url = 
new URL(\"/api/members/export\", 
window.location.origin)\r\n\r\n     
 // Only put small params in URL, 
large data goes in body\r\n      
url.searchParams.set(\"format\", 
exportConfig.format)\r\n      url.se
archParams.set(\"includeHeader\", St
ring(exportConfig.includeHeader))\r\
n      url.searchParams.set(\"dateFo
rmat\", 
exportConfig.dateFormat)\r\n      
if (organizationId) url.searchParams
.set(\"organizationId\", 
String(organizationId))\r\n\r\n     
 // Prepare request body with large 
data\r\n      const requestBody: 
any = {\r\n        format: 
exportConfig.format,\r\n        
includeHeader: 
exportConfig.includeHeader,\r\n     
   dateFormat: 
exportConfig.dateFormat,\r\n        
organizationId: organizationId ? 
String(organizationId) : 
undefined,\r\n        fields: 
exportConfig.selectedFields,\r\n    
  }\r\n\r\n      // Hanya kirim 
selectedNiks jika tidak 
selectAllPages\r\n      if 
(!selectAllPages && 
selectedNiks.length > 0) {\r\n      
  requestBody.selectedNiks = 
selectedNiks\r\n      }\r\n\r\n     
 // Kirim filter params agar API 
bisa fetch semua data yang sesuai 
filter\r\n      const filterParams 
= getFilterParams()\r\n      if 
(filterParams.groups?.length) 
requestBody.groups = 
filterParams.groups.join(\",\")\r\n 
     if 
(filterParams.genders?.length) 
requestBody.genders = filterParams.g
enders.join(\",\")\r\n      if 
(filterParams.agamas?.length) 
requestBody.agamas = 
filterParams.agamas.join(\",\")\r\n 
     if 
(filterParams.status?.length && 
filterParams.status[0]) {\r\n       
 requestBody.active = 
filterParams.status[0]\r\n      
}\r\n      if (searchQuery) 
requestBody.search = 
searchQuery\r\n\r\n      // Add 
timeout (5 minutes for large 
exports)\r\n      const controller 
= new AbortController()\r\n      
const timeoutId = setTimeout(() => 
controller.abort(), 5 * 60 * 1000) 
// 5 minutes\r\n\r\n      try {\r\n 
       console.log(\"[EXPORT] 
Starting export request (POST):\", 
{\r\n          url: 
url.toString(),\r\n          
selectedNiksCount: 
selectedNiks.length,\r\n          
format: exportConfig.format,\r\n    
      fieldsCount: exportConfig.sele
ctedFields.length\r\n        
})\r\n\r\n        const res = await 
fetch(url.toString(), {\r\n         
 method: \"POST\",\r\n          
headers: {\r\n            
\"Content-Type\": 
\"application/json\",\r\n          
},\r\n          body: 
JSON.stringify(requestBody),\r\n    
      credentials: 
\"same-origin\",\r\n          
signal: controller.signal\r\n       
 })\r\n\r\n        
clearTimeout(timeoutId)\r\n\r\n     
   if (!res.ok) {\r\n          // 
Try to get error message from 
response\r\n          let 
errorMessage = `Export failed 
(Status: ${res.status} 
${res.statusText})`\r\n\r\n         
 try {\r\n            // Clone 
response to read without 
consuming\r\n            const 
clonedRes = res.clone()\r\n         
   const contentType = 
res.headers.get(\"content-type\") 
|| \"\"\r\n\r\n            if (conte
ntType.includes(\"application/json\"
)) {\r\n              // API 
returns JSON error response\r\n     
         const errorJson = await 
clonedRes.json()\r\n              
// Check if errorJson is empty or 
has no useful message\r\n           
   if (errorJson && typeof 
errorJson === 'object' && 
Object.keys(errorJson).length > 0) 
{\r\n                errorMessage = 
errorJson.message || 
errorJson.error || errorMessage\r\n 
             } else if (errorJson 
&& typeof errorJson === 'string') 
{\r\n                errorMessage = 
errorJson\r\n              } else 
{\r\n                // If 
errorJson is empty or invalid, use 
status-based message\r\n            
    if (res.status === 500) {\r\n   
               errorMessage = 
\"Server error occurred. Please 
check server logs for 
details.\"\r\n                } 
else if (res.status === 404) {\r\n  
                errorMessage = 
\"Resource not found. Please check 
your request parameters.\"\r\n      
          } else if (res.status === 
403) {\r\n                  
errorMessage = \"Access forbidden. 
You may not have permission to 
perform this action.\"\r\n          
      } else if (res.status === 
401) {\r\n                  
errorMessage = \"Authentication 
required. Please log in 
again.\"\r\n                } else 
{\r\n                  errorMessage 
= `Request failed with status 
${res.status}: 
${res.statusText}`\r\n              
  }\r\n              }\r\n          
    console.error(\"[EXPORT] API 
error response (JSON):\", {\r\n     
           status: res.status,\r\n  
              statusText: 
res.statusText,\r\n                
error: errorJson,\r\n               
 errorMessage\r\n              
})\r\n            } else {\r\n      
        // Read as text\r\n         
     const errorText = await 
clonedRes.text()\r\n              
if (errorText && errorText.trim()) 
{\r\n                errorMessage = 
errorText.length > 200\r\n          
        ? `${errorText.substring(0, 
200)}...`\r\n                  : 
errorText\r\n              }\r\n    
          console.error(\"[EXPORT] 
API error response (Text):\", {\r\n 
               status: 
res.status,\r\n                
statusText: res.statusText,\r\n     
           errorText: 
errorText.substring(0, 500)\r\n     
         })\r\n            }\r\n    
      } catch (parseError) {\r\n    
        console.error(\"[EXPORT] 
Failed to parse error response:\", 
parseError)\r\n            // Keep 
default error message with status 
info\r\n          }\r\n\r\n         
 throw new Error(errorMessage)\r\n  
      }\r\n\r\n        // Get blob 
and create download link\r\n        
const blob = await res.blob()\r\n   
     const downloadUrl = window.URL.
createObjectURL(blob)\r\n        
const fileName = 
`members-export-${new Date().toISOSt
ring().split(\"T\")[0]}.${exportConf
ig.format}`\r\n\r\n        // 
Trigger download\r\n        const 
link = 
document.createElement(\"a\")\r\n   
     link.href = downloadUrl\r\n    
    link.download = fileName\r\n    
    
document.body.appendChild(link)\r\n 
       link.click()\r\n        
document.body.removeChild(link)\r\n 
       window.URL.revokeObjectURL(do
wnloadUrl)\r\n\r\n        // Get 
count from selected rows atau 
totalCount jika selectAllPages\r\n  
      const exportedCount = 
selectAllPages ? totalCount : 
selectedNiks.length\r\n\r\n        
// Set progress ke nilai sebenarnya 
setelah server selesai 
memproses\r\n        // Pastikan 
progress sudah mendekati 100% 
sebelum set ke 100%\r\n        if 
(estimatedTotal > 0) {\r\n          
// Clear timer utama dulu\r\n       
   if 
(exportProgressTimerRef.current) 
{\r\n            clearInterval(expor
tProgressTimerRef.current)\r\n      
      
exportProgressTimerRef.current = 
null\r\n          }\r\n          
\r\n          // Clear finish timer 
jika ada\r\n          if 
(exportFinishTimerRef.current) 
{\r\n            clearInterval(expor
tFinishTimerRef.current)\r\n        
    exportFinishTimerRef.current = 
null\r\n          }\r\n          
\r\n          // Animate dari 
progress saat ini ke 100% dengan 
smooth transition\r\n          // 
Gunakan setTimeout untuk 
mendapatkan current progress 
state\r\n          setTimeout(() => 
{\r\n            
setExportProgress((prev) => {\r\n   
           const currentProgress = 
prev.current\r\n              const 
remaining = estimatedTotal - 
currentProgress\r\n              
\r\n              if (remaining <= 
0) {\r\n                return { 
current: estimatedTotal, total: 
estimatedTotal }\r\n              
}\r\n              \r\n             
 // Buat finish timer untuk animasi 
smooth ke 100%\r\n              
const steps = Math.max(5, 
Math.min(20, Math.ceil(remaining / 
10))) // 5-20 langkah\r\n           
   const increment = 
Math.ceil(remaining / steps)\r\n    
          let step = 0\r\n          
    \r\n              
exportFinishTimerRef.current = 
setInterval(() => {\r\n             
   step++\r\n                
setExportProgress((prevState) => 
{\r\n                  const 
nextCurrent = Math.min(\r\n         
           prevState.current + 
increment,\r\n                    
estimatedTotal\r\n                  
)\r\n                  \r\n         
         if (nextCurrent >= 
estimatedTotal || step >= steps) 
{\r\n                    if 
(exportFinishTimerRef.current) 
{\r\n                      clearInte
rval(exportFinishTimerRef.current)\r
\n                      
exportFinishTimerRef.current = 
null\r\n                    }\r\n   
                 return { current: 
estimatedTotal, total: 
estimatedTotal }\r\n                
  }\r\n                  \r\n       
           return { ...prevState, 
current: nextCurrent }\r\n          
      })\r\n              }, 50) // 
Update cepat untuk finish 
animation\r\n              \r\n     
         return prev // Return 
current state, finish timer akan 
handle update\r\n            })\r\n 
         }, 0)\r\n        }\r\n\r\n 
       setExportResult({\r\n        
  success: true,\r\n          
fileName,\r\n          
exportedCount,\r\n          
message: \"Export berhasil!\",\r\n  
      })\r\n\r\n        
toast.success(\"Export 
berhasil!\")\r\n        
setCurrentStep(5)\r\n      } catch 
(fetchError: any) {\r\n        
clearTimeout(timeoutId)\r\n        
if (fetchError.name === 
'AbortError') {\r\n          throw 
new Error(\"Export timeout. Data 
terlalu banyak, silakan pilih data 
yang lebih sedikit atau coba 
lagi.\")\r\n        }\r\n        
throw fetchError\r\n      }\r\n    
} catch (error: any) {\r\n      
console.error(\"Error exporting:\", 
error)\r\n      const errorMessage 
= error?.message || \"Gagal 
melakukan export. Silakan coba 
lagi.\"\r\n      
setExportResult({\r\n        
success: false,\r\n        message: 
errorMessage,\r\n      })\r\n      
toast.error(errorMessage)\r\n    } 
finally {\r\n      
setExporting(false)\r\n      if 
(exportProgressTimerRef.current) 
{\r\n        clearInterval(exportPro
gressTimerRef.current)\r\n        
exportProgressTimerRef.current = 
null\r\n      }\r\n      if 
(exportFinishTimerRef.current) 
{\r\n        clearInterval(exportFin
ishTimerRef.current)\r\n        
exportFinishTimerRef.current = 
null\r\n      }\r\n    }\r\n  
}\r\n\r\n  const handleNext = () => 
{\r\n    if (currentStep === 1) 
{\r\n      if (totalCount === 0) 
{\r\n        toast.error(\"Tidak 
ada data untuk diexport\")\r\n      
  return\r\n      }\r\n      if 
(!selectAllPages && 
selectedRows.size === 0) {\r\n      
  toast.error(\"Pilih minimal satu 
data member terlebih dahulu\")\r\n  
      return\r\n      }\r\n      
setCurrentStep(2)\r\n    } else if 
(currentStep === 2) {\r\n      if 
(exportConfig.selectedFields.length 
=== 0) {\r\n        
toast.error(\"Pilih minimal satu 
kolom untuk diexport\")\r\n        
return\r\n      }\r\n      
setCurrentStep(3)\r\n      
loadPreviewData()\r\n    } else if 
(currentStep === 3) {\r\n      
setCurrentStep(4)\r\n      // Don't 
auto-start export, wait for user to 
click \"Start Export\" button\r\n   
 } else if (currentStep === 4) 
{\r\n      // This step requires 
user to click \"Start Export\" 
button\r\n    }\r\n  }\r\n\r\n  
const handlePrevious = () => {\r\n  
  if (currentStep > 1) {\r\n      
// Allow going back from step 4 if 
not exporting\r\n      if 
(currentStep === 4 && exporting) 
{\r\n        return // Don't allow 
going back while exporting\r\n      
}\r\n      
setCurrentStep(currentStep - 1)\r\n 
     // Reset export result when 
going back\r\n      if (currentStep 
=== 4) {\r\n        
setExportResult(null)\r\n      
}\r\n    }\r\n  }\r\n\r\n  const 
toggleField = (fieldKey: string) => 
{\r\n    setExportConfig(prev => 
({\r\n      ...prev,\r\n      
selectedFields: prev.selectedFields.
includes(fieldKey)\r\n        ? 
prev.selectedFields.filter(f => f 
!== fieldKey)\r\n        : 
[...prev.selectedFields, 
fieldKey]\r\n    }))\r\n  }\r\n\r\n 
 const canGoNext = () => {\r\n    
if (currentStep === 1) return 
totalCount > 0 && (selectAllPages 
|| selectedRows.size > 0)\r\n    if 
(currentStep === 2) return 
exportConfig.selectedFields.length 
> 0\r\n    if (currentStep === 3) 
return true\r\n    if (currentStep 
=== 4) return false // User must 
click \"Start Export\" button\r\n   
 return false\r\n  }\r\n\r\n  if 
(!isHydrated) {\r\n    return (\r\n 
     <div className=\"flex 
items-center justify-center 
min-h-screen\">\r\n        <Loader2 
className=\"h-8 w-8 animate-spin\" 
/>\r\n      </div>\r\n    )\r\n  
}\r\n\r\n  return (\r\n    <div 
className=\"min-h-screen 
bg-background p-6\">\r\n      <div 
className=\"max-w-6xl 
mx-auto\">\r\n        <div 
className=\"mb-6 flex items-center 
gap-4\">\r\n          <Link\r\n     
       href=\"/members\"\r\n        
    prefetch={false}\r\n          
// onMouseEnter={(e) => {\r\n       
   //   const href = e.currentTarget
.getAttribute('href')\r\n          
//   if (href && router) {\r\n      
    //     
router.prefetch(href)\r\n          
//   }\r\n          // }}\r\n       
   >\r\n            <Button 
variant=\"ghost\" size=\"icon\" 
aria-label=\"Kembali ke halaman 
members\">\r\n              
<ArrowLeft className=\"h-4 w-4\" 
aria-hidden=\"true\" />\r\n         
   </Button>\r\n          
</Link>\r\n          <div>\r\n      
      <h1 className=\"text-2xl 
font-bold\">Export Data 
Member</h1>\r\n            <p classN
ame=\"text-muted-foreground\">\r\n  
            Export data member ke 
file Excel atau CSV dengan proses 
bertahap\r\n            </p>\r\n    
      </div>\r\n        
</div>\r\n\r\n        <Wizard\r\n   
       steps={WIZARD_STEPS}\r\n     
     currentStep={currentStep}\r\n  
        onNext={currentStep !== 4 ? 
handleNext : undefined}\r\n         
 onPrevious={currentStep !== 4 ? 
handlePrevious : undefined}\r\n     
     canGoNext={canGoNext()}\r\n    
      canGoPrevious={currentStep > 
1 && currentStep !== 4}\r\n         
 showNavigation={currentStep !== 
4}\r\n        >\r\n          {/* 
Step 1: Select Data */}\r\n         
 {currentStep === 1 && (\r\n        
    <div 
className=\"space-y-6\">\r\n        
      <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle className=\"flex 
items-center gap-2\">\r\n           
         <Filter className=\"h-5 
w-5\" />\r\n                    
Filter\r\n                  
</CardTitle>\r\n                
</CardHeader>\r\n                
<CardContent 
className=\"space-y-4\">\r\n        
          {/* Add Filter Button - 
2-step seperti Supabase */}\r\n     
             <div 
className=\"space-y-2\">\r\n        
            
<Label>Filter</Label>\r\n           
         <Popover\r\n               
       
open={showAddFilterPopover}\r\n     
                 
onOpenChange={(open) => {\r\n       
                 
setShowAddFilterPopover(open)\r\n   
                     if (!open) 
{\r\n                          setSe
lectedColumnForFilter(null)\r\n     
                     
setTempNewFilterValues([])\r\n      
                  }\r\n             
         }}\r\n                    
>\r\n                      
<PopoverTrigger asChild>\r\n        
                <Button\r\n         
                 
variant=\"outline\"\r\n             
             className=\"w-full 
justify-start\"\r\n                 
         aria-label=\"Tambahkan 
filter baru\"\r\n                   
       aria-expanded={showAddFilterP
opover}\r\n                         
 aria-haspopup=\"dialog\"\r\n       
                 >\r\n              
            <Filter 
className=\"mr-2 h-4 w-4\" 
aria-hidden=\"true\" />\r\n         
                 {filters.length 
=== 0 ? \"Pick a column to filter 
by\" : \"Add filter\"}\r\n          
              </Button>\r\n         
             </PopoverTrigger>\r\n  
                    
<PopoverContent\r\n                 
       className=\"w-[320px] 
p-0\"\r\n                        
align=\"start\"\r\n                 
       role=\"dialog\"\r\n          
              aria-label=\"Dialog 
pilih filter\"\r\n                  
      aria-describedby=\"filter-desc
ription\"\r\n                      
>\r\n                        <div 
id=\"filter-description\" 
className=\"sr-only\">\r\n          
                Pilih kolom untuk 
difilter, kemudian pilih nilai yang 
diinginkan\r\n                      
  </div>\r\n                        
{!selectedColumnForFilter ? (\r\n   
                       // Step 1: 
Pilih kolom\r\n                     
     <Command role=\"combobox\" 
aria-label=\"Pilih kolom 
filter\">\r\n                       
     <CommandInput 
placeholder=\"Cari kolom...\" 
aria-label=\"Cari kolom untuk 
filter\" />\r\n                     
       <CommandList>\r\n            
                  
<CommandEmpty>Kolom tidak 
ditemukan</CommandEmpty>\r\n        
                      
<CommandGroup>\r\n                  
              {getAvailableFilterCol
umns().map((column) => (\r\n        
                          
<CommandItem\r\n                    
                
key={column.key}\r\n                
                    onSelect={() => 
{\r\n                               
       selectColumnForFilter(column.
key)\r\n                            
        }}\r\n                      
              aria-label={`Pilih 
kolom ${column.label} untuk 
filter`}\r\n                        
          >\r\n                     
               {column.label}\r\n   
                               
</CommandItem>\r\n                  
              ))}\r\n               
                 
{getAvailableFilterColumns().length 
=== 0 && (\r\n                      
            <div className=\"p-4 
text-center text-sm 
text-muted-foreground\">\r\n        
                            Semua 
filter sudah ditambahkan\r\n        
                          
</div>\r\n                          
      )}\r\n                        
      </CommandGroup>\r\n           
                 </CommandList>\r\n 
                         
</Command>\r\n                      
  ) : (\r\n                         
 // Step 2: Pilih nilai + Apply 
button\r\n                          
<Command>\r\n                       
     <div className=\"flex 
items-center justify-between px-3 
py-2.5 border-b\">\r\n              
                <div 
className=\"flex items-center 
gap-2\">\r\n                        
        <Button\r\n                 
                 
variant=\"ghost\"\r\n               
                   size=\"sm\"\r\n  
                                
className=\"h-7 w-7 p-0 
hover:bg-muted\"\r\n                
                  onClick={() => 
{\r\n                               
     setSelectedColumnForFilter(null
)\r\n                               
     setTempNewFilterValues([])\r\n 
                                 
}}\r\n                              
    aria-label=\"Kembali ke pilihan 
kolom\"\r\n                         
       >\r\n                        
          <ArrowLeft 
className=\"h-4 w-4\" 
aria-hidden=\"true\" />\r\n         
                       
</Button>\r\n                       
         <span className=\"text-sm 
font-medium\">\r\n                  
                {getFilterColumnConf
ig(selectedColumnForFilter)?.label 
|| \"Nilai\"}\r\n                   
             </span>\r\n            
                  </div>\r\n        
                      <Button\r\n   
                             
size=\"sm\"\r\n                     
           className=\"h-7 px-3 
text-xs\"\r\n                       
         
onClick={applyNewFilter}\r\n        
                        disabled={te
mpNewFilterValues.length === 0}\r\n 
                               
aria-label={`Terapkan filter dengan 
${tempNewFilterValues.length} nilai 
yang dipilih`}\r\n                  
              aria-disabled={tempNew
FilterValues.length === 0}\r\n      
                        >\r\n       
                         Apply 
filter\r\n                          
    </Button>\r\n                   
         </div>\r\n                 
           {getFilterColumnConfig(se
lectedColumnForFilter)?.options.leng
th &&\r\n                           
   getFilterColumnConfig(selectedCol
umnForFilter)!.options.length > 5 
&& (\r\n                            
    <CommandInput\r\n               
                   
placeholder={`Cari ${getFilterColumn
Config(selectedColumnForFilter)?.lab
el.toLowerCase()}...`}\r\n          
                        
className=\"h-9\"\r\n               
                   
aria-label={`Cari ${getFilterColumnC
onfig(selectedColumnForFilter)?.labe
l.toLowerCase()}`}\r\n              
                  />\r\n            
                  )}\r\n            
                <CommandList 
className=\"max-h-[280px]\">\r\n    
                          
<CommandEmpty role=\"status\">Tidak 
ada pilihan</CommandEmpty>\r\n      
                        
<CommandGroup>\r\n                  
              {loadingFilterOptions[
selectedColumnForFilter] ? (\r\n    
                              <div 
className=\"flex items-center 
justify-center py-6\" 
role=\"status\" 
aria-live=\"polite\" 
aria-busy=\"true\">\r\n             
                       <Loader2 
className=\"h-4 w-4 animate-spin\" 
aria-hidden=\"true\" />\r\n         
                           <span 
className=\"sr-only\">Memuat 
opsi...</span>\r\n                  
                </div>\r\n          
                      ) : (\r\n     
                             getFilt
erColumnConfig(selectedColumnForFilt
er)?.options.map((option) => {\r\n  
                                  
const checked = tempNewFilterValues.
includes(option.value)\r\n          
                          return 
(\r\n                               
       <CommandItem\r\n             
                           
key={option.value}\r\n              
                          
value={option.value}\r\n            
                            
onSelect={() => {\r\n               
                           const 
newValues = checked\r\n             
                               ? 
tempNewFilterValues.filter(v => v 
!== option.value)\r\n               
                             : 
[...tempNewFilterValues, 
option.value]\r\n                   
                       setTempNewFil
terValues(newValues)\r\n            
                            }}\r\n  
                                    
  className=\"flex items-center 
gap-2 py-2\"\r\n                    
                    
aria-label={`${checked ? 'Hapus' : 
'Pilih'} ${option.label}`}\r\n      
                                
>\r\n                               
         <Checkbox\r\n              
                            
checked={checked}\r\n               
                           
onCheckedChange={(isChecked) => 
{\r\n                               
             const newValues = 
isChecked\r\n                       
                       ? 
[...tempNewFilterValues, 
option.value]\r\n                   
                           : 
tempNewFilterValues.filter(v => v 
!== option.value)\r\n               
                             setTemp
NewFilterValues(newValues)\r\n      
                                    
}}\r\n                              
            aria-label={`${checked 
? 'Hapus' : 'Pilih'} 
${option.label}`}\r\n               
                         />\r\n     
                                   
<span className=\"text-sm\">{option.
label}</span>\r\n                   
                   
</CommandItem>\r\n                  
                  )\r\n             
                     })\r\n         
                       )}\r\n       
                       
</CommandGroup>\r\n                 
           </CommandList>\r\n       
                   </Command>\r\n   
                     )}\r\n         
             </PopoverContent>\r\n  
                  </Popover>\r\n    
              </div>\r\n\r\n        
          {/* Active Filters 
*/}\r\n                  
{filters.length > 0 && (\r\n        
            <div 
className=\"space-y-2\">\r\n        
              <Label>Filter 
Aktif</Label>\r\n                   
   <div className=\"flex flex-wrap 
gap-2\">\r\n                        
{filters.map((filter) => {\r\n      
                    const 
columnConfig = getFilterColumnConfig
(filter.column)\r\n                 
         const selectedLabels = 
filter.values\r\n                   
         .map(val => {\r\n          
                    if 
(filter.column === \"group\") {\r\n 
                               
const group = groups.find(g => 
String(g.id) === val)\r\n           
                     return 
group?.name || val\r\n              
                }\r\n               
               return 
columnConfig?.options.find(opt => 
opt.value === val)?.label || 
val\r\n                            
})\r\n                            
.join(\", \")\r\n\r\n               
           return (\r\n             
               <div key={filter.id} 
className=\"flex items-center gap-2 
p-2 border rounded-lg 
bg-muted/50\">\r\n                  
            <GripVertical 
className=\"h-4 w-4 
text-muted-foreground\" />\r\n      
                        <div 
className=\"flex items-center 
gap-1\">\r\n                        
        <span 
className=\"font-medium text-sm\">{c
olumnConfig?.label}:</span>\r\n     
                           <span 
className=\"text-sm 
text-muted-foreground\">\r\n        
                          
{filter.values.length > 0 ? 
selectedLabels : \"Pilih 
nilai...\"}\r\n                     
           </span>\r\n              
                </div>\r\n          
                    <Popover 
open={editingFilterId === 
filter.id} onOpenChange={(open) => 
{\r\n                               
 if (open) {\r\n                    
              
setEditingFilterId(filter.id)\r\n   
                             } else 
{\r\n                               
   setEditingFilterId(null)\r\n     
                           }\r\n    
                          }}>\r\n   
                             
<PopoverTrigger asChild>\r\n        
                          
<Button\r\n                         
           variant=\"ghost\"\r\n    
                                
size=\"sm\"\r\n                     
               className=\"h-6 
px-2\"\r\n                          
          aria-label={`Edit filter 
${columnConfig?.label}`}\r\n        
                            
aria-expanded={editingFilterId === 
filter.id}\r\n                      
              
aria-haspopup=\"dialog\"\r\n        
                          >\r\n     
                               
Edit\r\n                            
      </Button>\r\n                 
               
</PopoverTrigger>\r\n               
                 
<PopoverContent\r\n                 
                 
className=\"w-[300px] p-0\"\r\n     
                             
align=\"start\"\r\n                 
                 
role=\"dialog\"\r\n                 
                 aria-label={`Edit 
filter ${columnConfig?.label}`}\r\n 
                               
>\r\n                               
   <Command role=\"combobox\" 
aria-label={`Pilih nilai untuk 
${columnConfig?.label}`}>\r\n       
                             <div 
className=\"px-3 py-2 
border-b\">\r\n                     
                 <span 
className=\"text-sm 
font-medium\">\r\n                  
                      
{columnConfig?.label || 
\"Nilai\"}\r\n                      
                </span>\r\n         
                           
</div>\r\n\r\n                      
              {columnConfig && 
columnConfig.options.length > 5 && 
(\r\n                               
       <CommandInput\r\n            
                            
placeholder={`Cari ${columnConfig.la
bel.toLowerCase()}...`}\r\n         
                               
aria-label={`Cari ${columnConfig.lab
el.toLowerCase()}`}\r\n             
                         />\r\n     
                               
)}\r\n                              
      <CommandList>\r\n             
                         
<CommandEmpty role=\"status\">Tidak 
ada pilihan</CommandEmpty>\r\n      
                                
<CommandGroup>\r\n                  
                      {loadingFilter
Options[filter.column] ? (\r\n      
                                    
<div className=\"flex items-center 
justify-center py-4\" 
role=\"status\" 
aria-live=\"polite\" 
aria-busy=\"true\">\r\n             
                               
<Loader2 className=\"h-4 w-4 
animate-spin\" aria-hidden=\"true\" 
/>\r\n                              
              <span 
className=\"sr-only\">Memuat 
opsi...</span>\r\n                  
                        </div>\r\n  
                                    
  ) : (\r\n                         
                 
columnConfig?.options.map((option) 
=> {\r\n                            
                const checked = filt
er.values.includes(option.value)\r\n
                                    
        return (\r\n                
                              
<CommandItem\r\n                    
                            
key={option.value}\r\n              
                                  
value={option.value}\r\n            
                                    
// Edit langsung - langsung update 
filter saat checkbox diubah\r\n     
                                    
       onSelect={() => {\r\n        
                                    
      const newValues = checked\r\n 
                                    
               ? 
filter.values.filter(v => v !== 
option.value)\r\n                   
                                 : 
[...filter.values, 
option.value]\r\n                   
                               
updateFilterValues(filter.id, 
newValues)\r\n                      
                          }}\r\n    
                                    
        className=\"flex 
items-center gap-2\"\r\n            
                                    
aria-label={`${checked ? 'Hapus' : 
'Pilih'} ${option.label} untuk 
filter ${columnConfig?.label}`}\r\n 
                                    
         >\r\n                      
                          
<Checkbox\r\n                       
                           
checked={checked}\r\n               
                                   
onCheckedChange={(isChecked) => 
{\r\n                               
                     const 
newValues = isChecked\r\n           
                                    
       ? [...filter.values, 
option.value]\r\n                   
                                   
: filter.values.filter(v => v !== 
option.value)\r\n                   
                                 
updateFilterValues(filter.id, 
newValues)\r\n                      
                            }}\r\n  
                                    
            aria-label={`${checked 
? 'Hapus' : 'Pilih'} 
${option.label}`}\r\n               
                                 
/>\r\n                              
                  
{option.label}\r\n                  
                            
</CommandItem>\r\n                  
                          )\r\n     
                                    
 })\r\n                             
           )}\r\n                   
                   
</CommandGroup>\r\n                 
                   
</CommandList>\r\n                  
                </Command>\r\n      
                          
</PopoverContent>\r\n               
               </Popover>\r\n       
                       <Button\r\n  
                              
variant=\"ghost\"\r\n               
                 size=\"sm\"\r\n    
                            
className=\"h-6 w-6 p-0\"\r\n       
                         
onClick={() => 
removeFilter(filter.id)}\r\n        
                        
aria-label={`Hapus filter 
${columnConfig?.label}`}\r\n        
                      >\r\n         
                       <X 
className=\"h-3 w-3\" 
aria-hidden=\"true\" />\r\n         
                     </Button>\r\n  
                          
</div>\r\n                          
)\r\n                        
})}\r\n                      
</div>\r\n                    
</div>\r\n                  )}\r\n  
              </CardContent>\r\n    
          </Card>\r\n\r\n           
   <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle className=\"flex 
items-center gap-2\">\r\n           
         <Users className=\"h-5 
w-5\" />\r\n                    
Data Member\r\n                  
</CardTitle>\r\n                  
<CardDescription>\r\n               
     Menampilkan 
{totalCount.toLocaleString()} row 
member berdasarkan filter\r\n       
           </CardDescription>\r\n   
             </CardHeader>\r\n      
          <CardContent>\r\n         
         {loading || loadingMembers 
? (\r\n                    <div 
className=\"flex items-center 
justify-center py-8\" 
role=\"status\" 
aria-live=\"polite\" 
aria-busy=\"true\">\r\n             
         <Loader2 className=\"h-6 
w-6 animate-spin\" 
aria-hidden=\"true\" />\r\n         
             <span 
className=\"sr-only\">Memuat data 
member...</span>\r\n                
    </div>\r\n                  ) : 
(\r\n                    <div 
className=\"space-y-4\">\r\n        
              {/* Search - affects 
Data Member table */}\r\n           
           <div 
className=\"space-y-2\">\r\n        
                <Label 
htmlFor=\"search-member\">Search 
Member</Label>\r\n                  
      <div 
className=\"relative\">\r\n         
                 <Search 
className=\"absolute left-3 top-1/2 
transform -translate-y-1/2 h-4 w-4 
text-muted-foreground\" 
aria-hidden=\"true\" />\r\n         
                 <Input\r\n         
                   
id=\"search-member\"\r\n            
                placeholder=\"Cari 
nama, NIK, email...\"\r\n           
                 
value={searchQuery}\r\n             
               onChange={(e) => 
setSearchQuery(e.target.value)}\r\n 
                           
className=\"pl-9\"\r\n              
              aria-label=\"Cari 
member berdasarkan nama, NIK, atau 
email\"\r\n                         
 />\r\n                        
</div>\r\n                      
</div>\r\n\r\n                      
{(searchQuery || filters.length > 
0) && (\r\n                        
<Alert role=\"status\" 
aria-live=\"polite\">\r\n           
               <AlertCircle 
className=\"h-4 w-4\" 
aria-hidden=\"true\" />\r\n         
                 
<AlertDescription>\r\n              
              <strong>Filter 
Aktif:</strong>\r\n                 
           <ul 
className=\"list-disc list-inside 
mt-2 space-y-1\">\r\n               
               {searchQuery && 
<li>Search: 
&quot;{searchQuery}&quot;</li>}\r\n 
                             
{filters.map(filter => {\r\n        
                        const 
columnConfig = getFilterColumnConfig
(filter.column)\r\n                 
               return (\r\n         
                         <li 
key={filter.id}>\r\n                
                    
{columnConfig?.label}: 
{filter.values.length} nilai 
dipilih\r\n                         
         </li>\r\n                  
              )\r\n                 
             })}\r\n                
            </ul>\r\n               
           </AlertDescription>\r\n  
                      </Alert>\r\n  
                    )}\r\n\r\n      
                {totalCount === 0 ? 
(\r\n                        <Alert 
variant=\"destructive\" 
role=\"alert\">\r\n                 
         <AlertCircle 
className=\"h-4 w-4\" 
aria-hidden=\"true\" />\r\n         
                 
<AlertDescription>\r\n              
              Tidak ada data member 
yang sesuai dengan filter. Silakan 
ubah filter atau kembali ke halaman 
member.\r\n                         
 </AlertDescription>\r\n            
            </Alert>\r\n            
          ) : (\r\n                 
       <div 
className=\"space-y-2\">\r\n        
                  <div 
className=\"flex items-center 
justify-between\">\r\n              
              <Label 
id=\"data-member-label\">Data 
Member 
({totalCount.toLocaleString()} rows 
total, halaman {currentPage} dari 
{totalPages})</Label>\r\n           
                 <div 
className=\"flex items-center 
gap-2\">\r\n                        
      <Button\r\n                   
             
variant=\"outline\"\r\n             
                   size=\"sm\"\r\n  
                              
onClick={toggleSelectAll}\r\n       
                         
disabled={memberRows.length === 
0}\r\n                              
  aria-label={selectAllPages\r\n    
                              ? 
\"Hapus semua pilihan (semua 
halaman)\"\r\n                      
            : \"Pilih semua data di 
semua halaman\"}\r\n                
                
aria-pressed={selectAllPages}\r\n   
                           >\r\n    
                            
{selectAllPages\r\n                 
                 ? \"Hapus 
Semua\"\r\n                         
         : \"Pilih Semua\"}\r\n     
                         
</Button>\r\n                       
       {(selectAllPages || 
selectedRows.size > 0) && (\r\n     
                           
<Badge\r\n                          
        variant=\"secondary\"\r\n   
                               
role=\"status\"\r\n                 
                 
aria-live=\"polite\"\r\n            
                      
aria-atomic=\"true\"\r\n            
                    >\r\n           
                       
{selectAllPages ? 
`${totalCount.toLocaleString()} 
dipilih (semua halaman)` : 
`${selectedRows.size} dipilih`}\r\n 
                               
</Badge>\r\n                        
      )}\r\n                        
    </div>\r\n                      
    </div>\r\n                      
    <div\r\n                        
    className=\"border rounded-lg 
overflow-auto 
custom-scrollbar\"\r\n              
              style={{\r\n          
                    maxHeight: 
'500px'\r\n                         
   }}\r\n                           
 role=\"region\"\r\n                
            aria-labelledby=\"data-m
ember-label\"\r\n                   
         aria-label=\"Tabel data 
member untuk export\"\r\n           
               >\r\n                
            <Table\r\n              
                role=\"table\"\r\n  
                            
aria-label=\"Tabel data member 
untuk export\"\r\n                  
            aria-rowcount={memberRow
s.length}\r\n                       
       aria-colcount={17}\r\n       
                     >\r\n          
                    <TableHeader 
className=\"sticky top-0 
bg-background z-10\">\r\n           
                     <TableRow 
role=\"row\">\r\n                   
               <TableHead 
className=\"w-12\" 
role=\"columnheader\" 
scope=\"col\">\r\n                  
                  <span 
className=\"sr-only\">Pilih 
baris</span>\r\n                    
                <Checkbox\r\n       
                               
checked={selectAllPages || 
(selectedRows.size === 
memberRows.length && 
memberRows.length > 0)}\r\n         
                             onCheck
edChange={toggleSelectAll}\r\n      
                                
aria-label={selectAllPages ? 
\"Semua halaman dipilih\" : \"Pilih 
semua baris di tabel\"}\r\n         
                           />\r\n   
                               
</TableHead>\r\n                    
              <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">NIK</TableHead>\r\n   
                               
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Nama</TableHead>\r\n  
                                
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" scope=\"col\">
Nickname</TableHead>\r\n            
                      <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">NISN</TableHead>\r\n  
                                
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Jenis 
Kelamin</TableHead>\r\n             
                     <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Tempat 
Lahir</TableHead>\r\n               
                   <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Tanggal 
Lahir</TableHead>\r\n               
                   <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Agama</TableHead>\r\n 
                                 
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Jalan</TableHead>\r\n 
                                 
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">RT</TableHead>\r\n    
                              
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">RW</TableHead>\r\n    
                              
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Dusun</TableHead>\r\n 
                                 
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" scope=\"col\">
Kelurahan</TableHead>\r\n           
                       <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" scope=\"col\">
Kecamatan</TableHead>\r\n           
                       <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">No. 
Telepon</TableHead>\r\n             
                     <TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Email</TableHead>\r\n 
                                 
<TableHead 
className=\"whitespace-nowrap\" 
role=\"columnheader\" 
scope=\"col\">Group</TableHead>\r\n 
                               
</TableRow>\r\n                     
         </TableHeader>\r\n         
                     <TableBody clas
sName=\"[&>tr:nth-child(even)]:bg-mu
ted/50\">\r\n                       
         {memberRows.length === 0 ? 
(\r\n                               
   <TableRow role=\"row\">\r\n      
                              
<TableCell colSpan={17} 
className=\"text-center py-8 
text-muted-foreground\" 
role=\"gridcell\">\r\n              
                        Tidak ada 
data\r\n                            
        </TableCell>\r\n            
                      
</TableRow>\r\n                     
           ) : (\r\n                
                  
memberRows.map((row, idx) => (\r\n  
                                  
<TableRow key={idx} role=\"row\" 
aria-rowindex={idx + 1}>\r\n        
                              
<TableCell role=\"gridcell\">\r\n   
                                    
 <Checkbox\r\n                      
                    
checked={selectedRows.has(idx)}\r\n 
                                    
     onCheckedChange={() => 
toggleRowSelection(idx)}\r\n        
                                  
aria-label={`Pilih baris ${idx + 
1}, NIK: ${row.nik || 'tidak ada'}, 
Nama: ${row.nama || 'tidak 
ada'}`}\r\n                         
               />\r\n               
                       
</TableCell>\r\n                    
                  <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.nik || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.nama || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.nickname || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.nisn || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" role
=\"gridcell\">{row.jenis_kelamin || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.tempat_lahir 
|| \"-\"}</TableCell>\r\n           
                           
<TableCell 
className=\"whitespace-nowrap\" role
=\"gridcell\">{row.tanggal_lahir || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.agama || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.jalan || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.rt || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.rw || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.dusun || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.kelurahan || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.kecamatan || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.no_telepon 
|| \"-\"}</TableCell>\r\n           
                           
<TableCell 
className=\"whitespace-nowrap\" 
role=\"gridcell\">{row.email || 
\"-\"}</TableCell>\r\n              
                        <TableCell 
className=\"whitespace-nowrap\" role
=\"gridcell\">{row.department_id || 
\"-\"}</TableCell>\r\n              
                      
</TableRow>\r\n                     
             ))\r\n                 
               )}\r\n               
               </TableBody>\r\n     
                       </Table>\r\n 
                         </div>\r\n 
                         {/* 
Pagination */}\r\n                  
        {totalPages > 1 && (\r\n    
                        <nav 
aria-label=\"Pagination untuk tabel 
data member\" className=\"flex 
items-center justify-between mt-4 
py-4 px-4 bg-muted/50 rounded-md 
border\">\r\n                       
       <div className=\"flex 
items-center gap-2\">\r\n           
                     <Button\r\n    
                              
variant=\"ghost\"\r\n               
                   size=\"sm\"\r\n  
                                
onClick={() => 
setCurrentPage(1)}\r\n              
                    
disabled={currentPage === 1 || 
loadingMembers}\r\n                 
                 className=\"h-8 
w-8 p-0\"\r\n                       
           title=\"First page\"\r\n 
                                 
aria-label=\"Ke halaman 
pertama\"\r\n                       
         >\r\n                      
            <ChevronsLeft 
className=\"h-4 w-4\" />\r\n        
                        
</Button>\r\n                       
         <Button\r\n                
                  
variant=\"ghost\"\r\n               
                   size=\"sm\"\r\n  
                                
onClick={() => setCurrentPage(prev 
=> Math.max(1, prev - 1))}\r\n      
                            
disabled={currentPage === 1 || 
loadingMembers}\r\n                 
                 className=\"h-8 
w-8 p-0\"\r\n                       
           title=\"Previous 
page\"\r\n                          
        aria-label=\"Ke halaman 
sebelumnya\"\r\n                    
            >\r\n                   
               <ChevronLeft 
className=\"h-4 w-4\" />\r\n        
                        
</Button>\r\n\r\n                   
             <span 
className=\"text-sm text-muted-foreg
round\">Page</span>\r\n\r\n         
                       <input\r\n   
                               
type=\"number\"\r\n                 
                 min=\"1\"\r\n      
                            
max={totalPages}\r\n                
                  
value={currentPage}\r\n             
                     onChange={(e) 
=> {\r\n                            
        const page = e.target.value 
? Number(e.target.value) : 1\r\n    
                                
const safe = Math.max(1, 
Math.min(page, totalPages))\r\n     
                               
setCurrentPage(safe)\r\n            
                      }}\r\n        
                          
className=\"w-12 h-8 px-2 border 
rounded text-sm text-center 
bg-background\"\r\n                 
                 
disabled={loadingMembers || 
totalCount === 0}\r\n               
                   onKeyDown={(e) 
=> {\r\n                            
        if ([\"-\", \"+\", \"e\", 
\"E\", \".\"].includes(e.key)) 
{\r\n                               
       e.preventDefault();\r\n      
                              }\r\n 
                                 
}}\r\n                              
  />\r\n\r\n                        
        <span className=\"text-sm 
text-muted-foreground\">/ 
{totalPages}</span>\r\n\r\n         
                       <Button\r\n  
                                
variant=\"ghost\"\r\n               
                   size=\"sm\"\r\n  
                                
onClick={() => setCurrentPage(prev 
=> Math.min(totalPages, prev + 
1))}\r\n                            
      disabled={currentPage === 
totalPages || loadingMembers}\r\n   
                               
className=\"h-8 w-8 p-0\"\r\n       
                           
title=\"Next page\"\r\n             
                     
aria-label=\"Ke halaman 
berikutnya\"\r\n                    
            >\r\n                   
               <ChevronRight 
className=\"h-4 w-4\" />\r\n        
                        
</Button>\r\n                       
         <Button\r\n                
                  
variant=\"ghost\"\r\n               
                   size=\"sm\"\r\n  
                                
onClick={() => 
setCurrentPage(totalPages)}\r\n     
                             
disabled={currentPage === 
totalPages || loadingMembers}\r\n   
                               
className=\"h-8 w-8 p-0\"\r\n       
                           
title=\"Last page\"\r\n             
                     
aria-label=\"Ke halaman 
terakhir\"\r\n                      
          >\r\n                     
             <ChevronsRight 
className=\"h-4 w-4\" />\r\n        
                        
</Button>\r\n                       
       </div>\r\n\r\n               
               <div 
className=\"flex items-center 
gap-4\">\r\n                        
        <div className=\"text-sm 
text-muted-foreground\">\r\n        
                          Showing 
{totalCount > 0 ? ((currentPage - 
1) * pageSize) + 1 : 0} to 
{Math.min(currentPage * pageSize, 
totalCount)} of 
{totalCount.toLocaleString()} total 
records\r\n                         
       </div>\r\n                   
             <div className=\"flex 
items-center gap-2\">\r\n           
                       <select\r\n  
                                  
value={pageSize}\r\n                
                    onChange={(e) 
=> {\r\n                            
          const newPageSize = 
Number(e.target.value)\r\n          
                            
setPageSize(newPageSize)\r\n        
                              
setCurrentPage(1) // Reset to first 
page when changing page size\r\n    
                                
}}\r\n                              
      className=\"px-2 py-1 border 
rounded text-sm bg-background\"\r\n 
                                   
disabled={loadingMembers}\r\n       
                           >\r\n    
                                
<option 
value=\"100\">100</option>\r\n      
                              
<option 
value=\"500\">500</option>\r\n      
                              
<option 
value=\"1000\">1000</option>\r\n    
                              
</select>\r\n                       
         </div>\r\n                 
             </div>\r\n             
               </nav>\r\n           
               )}\r\n               
         </div>\r\n                 
     )}\r\n                    
</div>\r\n                  )}\r\n  
              </CardContent>\r\n    
          </Card>\r\n            
</div>\r\n          )}\r\n\r\n      
    {/* Step 2: Configure Export 
*/}\r\n          {currentStep === 2 
&& (\r\n            <div 
className=\"space-y-6\">\r\n        
      <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle>Format 
Export</CardTitle>\r\n              
    <CardDescription>Pilih format 
file yang 
diinginkan</CardDescription>\r\n    
            </CardHeader>\r\n       
         <CardContent>\r\n          
        <RadioGroup\r\n             
       
value={exportConfig.format}\r\n     
               
onValueChange={(value) => 
setExportConfig(prev => ({ ...prev, 
format: value as ExportFormat 
}))}\r\n                    
aria-label=\"Pilih format file 
export\"\r\n                  >\r\n 
                   <div 
className=\"flex items-center 
space-x-2 p-4 border rounded-lg 
hover:bg-muted/50 
cursor-pointer\">\r\n               
       <RadioGroupItem 
value=\"xlsx\" id=\"xlsx\" 
aria-label=\"Format Excel\" />\r\n  
                    <Label 
htmlFor=\"xlsx\" className=\"flex-1 
cursor-pointer flex items-center 
gap-2\">\r\n                        
<FileSpreadsheet className=\"h-5 
w-5\" aria-hidden=\"true\" />\r\n   
                     <div>\r\n      
                    <p 
className=\"font-medium\">Excel 
(.xlsx)</p>\r\n                     
     <p className=\"text-sm 
text-muted-foreground\">Format 
Excel dengan multiple 
sheets</p>\r\n                      
  </div>\r\n                      
</Label>\r\n                    
</div>\r\n                    <div 
className=\"flex items-center 
space-x-2 p-4 border rounded-lg 
hover:bg-muted/50 
cursor-pointer\">\r\n               
       <RadioGroupItem 
value=\"csv\" id=\"csv\" 
aria-label=\"Format CSV\" />\r\n    
                  <Label 
htmlFor=\"csv\" className=\"flex-1 
cursor-pointer flex items-center 
gap-2\">\r\n                        
<FileText className=\"h-5 w-5\" 
aria-hidden=\"true\" />\r\n         
               <div>\r\n            
              <p 
className=\"font-medium\">CSV 
(.csv)</p>\r\n                      
    <p className=\"text-sm 
text-muted-foreground\">Format CSV 
untuk kompatibilitas luas</p>\r\n   
                     </div>\r\n     
                 </Label>\r\n       
             </div>\r\n             
     </RadioGroup>\r\n              
  </CardContent>\r\n              
</Card>\r\n\r\n              
<Card>\r\n                
<CardHeader>\r\n                  
<CardTitle>Pilih 
Kolom</CardTitle>\r\n               
   <CardDescription>Pilih kolom 
yang akan disertakan dalam 
export</CardDescription>\r\n        
        </CardHeader>\r\n           
     <CardContent>\r\n              
    <ScrollArea 
className=\"h-[400px]\">\r\n        
            <div 
className=\"space-y-2\">\r\n        
              
{EXPORT_FIELDS.map((field) => (\r\n 
                       <div 
key={field.key} className=\"flex 
items-center space-x-2 p-3 border 
rounded-lg hover:bg-muted/50\">\r\n 
                         
<Checkbox\r\n                       
     id={field.key}\r\n             
               checked={exportConfig
.selectedFields.includes(field.key)}
\r\n                            
onCheckedChange={() => 
toggleField(field.key)}\r\n         
                 />\r\n             
             <Label 
htmlFor={field.key} 
className=\"flex-1 
cursor-pointer\">\r\n               
             {field.label}\r\n      
                    </Label>\r\n    
                    </div>\r\n      
                ))}\r\n             
       </div>\r\n                  
</ScrollArea>\r\n                  
<div className=\"mt-4\">\r\n        
            <Button\r\n             
         variant=\"outline\"\r\n    
                  size=\"sm\"\r\n   
                   onClick={() => 
{\r\n                        const 
allFieldsSelected = 
exportConfig.selectedFields.length 
=== EXPORT_FIELDS.length\r\n        
                
setExportConfig(prev => ({ \r\n     
                     ...prev, \r\n  
                        
selectedFields: allFieldsSelected ? 
[] : EXPORT_FIELDS.map(f => 
f.key)\r\n                        
}))\r\n                      }}\r\n 
                     aria-label={exp
ortConfig.selectedFields.length === 
EXPORT_FIELDS.length \r\n           
             ? \"Hapus semua 
pilihan kolom\" \r\n                
        : \"Pilih semua kolom untuk 
export\"}\r\n                    
>\r\n                      
{exportConfig.selectedFields.length 
=== EXPORT_FIELDS.length \r\n       
                 ? \"Hapus Semua\" 
\r\n                        : 
\"Pilih Semua\"}\r\n                
    </Button>\r\n                  
</div>\r\n                
</CardContent>\r\n              
</Card>\r\n\r\n              
<Card>\r\n                
<CardHeader>\r\n                  
<CardTitle>Opsi 
Tambahan</CardTitle>\r\n            
    </CardHeader>\r\n               
 <CardContent 
className=\"space-y-4\">\r\n        
          <div className=\"flex 
items-center space-x-2\">\r\n       
             <Checkbox\r\n          
            
id=\"includeHeader\"\r\n            
          checked={exportConfig.incl
udeHeader}\r\n                      
onCheckedChange={(checked) => 
setExportConfig(prev => ({ ...prev, 
includeHeader: checked as boolean 
}))}\r\n                    />\r\n  
                  <Label 
htmlFor=\"includeHeader\" 
className=\"cursor-pointer\">\r\n   
                   Sertakan header 
kolom\r\n                    
</Label>\r\n                  
</div>\r\n                
</CardContent>\r\n              
</Card>\r\n            </div>\r\n   
       )}\r\n\r\n          {/* Step 
3: Preview Data */}\r\n          
{currentStep === 3 && (\r\n         
   <div 
className=\"space-y-6\">\r\n        
      <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle>Preview 
Data</CardTitle>\r\n                
  <CardDescription>\r\n             
       Preview {previewData.length} 
baris pertama dari data yang akan 
diexport\r\n                  
</CardDescription>\r\n              
  </CardHeader>\r\n                
<CardContent>\r\n                  
{loading ? (\r\n                    
<div className=\"flex items-center 
justify-center py-8\" 
role=\"status\" 
aria-live=\"polite\" 
aria-busy=\"true\">\r\n             
         <Loader2 className=\"h-6 
w-6 animate-spin\" 
aria-hidden=\"true\" />\r\n         
             <span 
className=\"sr-only\">Memuat 
preview data...</span>\r\n          
          </div>\r\n                
  ) : (\r\n                    
<ScrollArea 
className=\"w-full\">\r\n           
           <Table\r\n               
         role=\"table\"\r\n         
               aria-label=\"Preview 
data yang akan diexport\"\r\n       
                 aria-rowcount={prev
iewData.length}\r\n                 
       aria-colcount={exportConfig.s
electedFields.length}\r\n           
           >\r\n                    
    <TableHeader>\r\n               
           <TableRow 
role=\"row\">\r\n                   
         {exportConfig.selectedField
s.map((fieldKey) => {\r\n           
                   const field = 
EXPORT_FIELDS.find(f => f.key === 
fieldKey)\r\n                       
       return (\r\n                 
               <TableHead 
key={fieldKey} 
role=\"columnheader\" 
scope=\"col\">{field?.label || 
fieldKey}</TableHead>\r\n           
                   )\r\n            
                })}\r\n             
             </TableRow>\r\n        
                </TableHeader>\r\n  
                      <TableBody cla
ssName=\"[&>tr:nth-child(even)]:bg-m
uted/50\">\r\n                      
    {previewData.length === 0 ? 
(\r\n                            
<TableRow role=\"row\">\r\n         
                     <TableCell colS
pan={exportConfig.selectedFields.len
gth} className=\"text-center py-8\" 
role=\"gridcell\">\r\n              
                  Tidak ada data 
untuk ditampilkan\r\n               
               </TableCell>\r\n     
                       
</TableRow>\r\n                     
     ) : (\r\n                      
      previewData.map((row, idx) => 
(\r\n                              
<TableRow key={idx} role=\"row\" 
aria-rowindex={idx + 1}>\r\n        
                        {exportConfi
g.selectedFields.map((fieldKey) => 
(\r\n                               
   <TableCell key={fieldKey} 
role=\"gridcell\">\r\n              
                      
{row[fieldKey] ?? \"-\"}\r\n        
                          
</TableCell>\r\n                    
            ))}\r\n                 
             </TableRow>\r\n        
                    ))\r\n          
                )}\r\n              
          </TableBody>\r\n          
            </Table>\r\n            
        </ScrollArea>\r\n           
       )}\r\n                
</CardContent>\r\n              
</Card>\r\n            </div>\r\n   
       )}\r\n\r\n          {/* Step 
4: Process Export */}\r\n          
{currentStep === 4 && (\r\n         
   <div 
className=\"space-y-6\">\r\n        
      <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle>Ready to 
Export</CardTitle>\r\n              
    <CardDescription>\r\n           
         Review your configuration 
and click Export to start the 
process\r\n                  
</CardDescription>\r\n              
  </CardHeader>\r\n                
<CardContent 
className=\"space-y-4\">\r\n        
          <div 
className=\"space-y-2\">\r\n        
            <p 
className=\"text-sm\">\r\n          
            <span className=\"font-m
edium\">Format:</span> {exportConfig
.format.toUpperCase()}\r\n          
          </p>\r\n                  
  <p className=\"text-sm\">\r\n     
                 <span 
className=\"font-medium\">Selected 
Fields:</span>{\" \"}\r\n           
           {exportConfig.selectedFie
lds.length} of 
{EXPORT_FIELDS.length}\r\n          
          </p>\r\n                  
  <p className=\"text-sm\">\r\n     
                 <span 
className=\"font-medium\">Total 
Rows:</span> {selectAllPages ? 
totalCount.toLocaleString() : 
(selectedRows.size > 0 ? 
selectedRows.size.toLocaleString() 
: totalCount.toLocaleString())}\r\n 
                   </p>\r\n         
           
{exportConfig.includeHeader && 
(\r\n                      <p 
className=\"text-sm\">\r\n          
              <span 
className=\"font-medium\">Include 
Header:</span> Yes\r\n              
        </p>\r\n                    
)}\r\n                  
</div>\r\n\r\n                  {/* 
Progress bar saat proses export 
berjalan */}\r\n                  
{exporting && (\r\n                 
   <div 
className=\"space-y-2\">\r\n        
              <p 
className=\"text-sm 
text-muted-foreground\">\r\n        
                Memproses export{\" 
\"}\r\n                        
<span 
className=\"font-semibold\">\r\n    
                      
{selectAllPages ? 
totalCount.toLocaleString() : 
(selectedRows.size > 0 ? 
selectedRows.size.toLocaleString() 
: totalCount.toLocaleString())}\r\n 
                       </span>{\" 
\"}\r\n                        
baris...\r\n                      
</p>\r\n                      <div 
className=\"h-2 w-full rounded-full 
bg-muted overflow-hidden\">\r\n     
                   
{exportProgress.total > 0 ? (\r\n   
                       <div\r\n     
                       
className=\"h-2 bg-primary 
transition-all duration-300 
ease-out\"\r\n                      
      style={{\r\n                  
            width: `${Math.min(\r\n 
                               
100,\r\n                            
    (exportProgress.current / 
exportProgress.total) * 100 || 
0\r\n                              
)}%`,\r\n                           
 }}\r\n                          
/>\r\n                        ) : 
(\r\n                          
<>\r\n                            
<div className=\"h-full w-full 
bg-primary/20 rounded-full\" />\r\n 
                           <div 
className=\"h-full 
animate-progress-shimmer 
rounded-full\" />\r\n               
           </>\r\n                  
      )}\r\n                      
</div>\r\n                      <p 
className=\"text-xs 
text-muted-foreground\">\r\n        
                
{exportProgress.total > 0 \r\n      
                    ? `${exportProgr
ess.current.toLocaleString()} / ${ex
portProgress.total.toLocaleString()}
 baris (${Math.round((exportProgress
.current / exportProgress.total) * 
100)}%)`\r\n                        
  : \"Mohon tunggu, jangan tutup 
halaman ini\"\r\n                   
     }\r\n                      
</p>\r\n                    
</div>\r\n                  
)}\r\n\r\n                  
{exportResult && !exporting && 
(\r\n                    <>\r\n     
                 
{exportResult.success ? (\r\n       
                 <Alert 
className=\"border-green-500/50 
bg-green-50 
dark:bg-green-950\">\r\n            
              <CheckCircle2 
className=\"h-4 w-4 
text-green-600\" />\r\n             
             <AlertDescription>\r\n 
                           Export 
berhasil! {exportResult.exportedCoun
t?.toLocaleString()} data berhasil 
diexport\r\n                        
  </AlertDescription>\r\n           
             </Alert>\r\n           
           ) : (\r\n                
        <Alert 
variant=\"destructive\">\r\n        
                  <AlertCircle 
className=\"h-4 w-4\" />\r\n        
                  
<AlertDescription>\r\n              
              {exportResult.message 
|| \"Export gagal\"}\r\n            
              
</AlertDescription>\r\n             
           </Alert>\r\n             
         )}\r\n                    
</>\r\n                  )}\r\n\r\n 
                 <div 
className=\"flex gap-2 pt-2\">\r\n  
                  <Button\r\n       
               
onClick={handlePrevious}\r\n        
              
disabled={exporting}\r\n            
          variant=\"outline\"\r\n   
                   
className=\"flex-1\"\r\n            
        >\r\n                      
Back\r\n                    
</Button>\r\n                    
<Button\r\n                      
onClick={processExport}\r\n         
             disabled={exporting || 
(!selectAllPages && 
selectedRows.size === 0) || 
exportConfig.selectedFields.length 
=== 0}\r\n                      
className=\"flex-1\"\r\n            
          size=\"lg\"\r\n           
         >\r\n                      
{exporting ? (\r\n                  
      <>\r\n                        
  <Loader2 className=\"mr-2 h-4 w-4 
animate-spin\" />\r\n               
           Exporting...\r\n         
               </>\r\n              
        ) : (\r\n                   
     <>\r\n                         
 <Download className=\"mr-2 h-4 
w-4\" />\r\n                        
  Start Export\r\n                  
      </>\r\n                      
)}\r\n                    
</Button>\r\n                  
</div>\r\n                
</CardContent>\r\n              
</Card>\r\n            </div>\r\n   
       )}\r\n\r\n          {/* Step 
5: Result */}\r\n          
{currentStep === 5 && exportResult 
&& (\r\n            <div 
className=\"space-y-6\">\r\n        
      <Card>\r\n                
<CardHeader>\r\n                  
<CardTitle className=\"flex 
items-center gap-2\">\r\n           
         {exportResult.success ? 
(\r\n                      
<CheckCircle2 className=\"h-5 w-5 
text-green-500\" 
aria-hidden=\"true\" />\r\n         
           ) : (\r\n                
      <AlertCircle className=\"h-5 
w-5 text-red-500\" 
aria-hidden=\"true\" />\r\n         
           )}\r\n                   
 {exportResult.success ? \"Export 
Berhasil\" : \"Export Gagal\"}\r\n  
                </CardTitle>\r\n    
            </CardHeader>\r\n       
         <CardContent 
className=\"space-y-4\">\r\n        
          {exportResult.success ? 
(\r\n                    <>\r\n     
                 <div 
className=\"p-4 bg-green-50 
dark:bg-green-950/20 
rounded-lg\">\r\n                   
     <p 
className=\"font-medium\">File 
berhasil dibuat!</p>\r\n            
            <p className=\"text-sm 
text-muted-foreground mt-1\">\r\n   
                       File: <strong
>{exportResult.fileName}</strong>\r\
n                        </p>\r\n   
                     <p 
className=\"text-sm 
text-muted-foreground\">\r\n        
                  Total data: <stron
g>{exportResult.exportedCount?.toLoc
aleString()}</strong> member\r\n    
                    </p>\r\n        
              </div>\r\n            
          <div className=\"flex 
gap-2\">\r\n                        
<Button\r\n                         
 onClick={() => 
router.push(\"/members\")}\r\n      
                    
aria-label=\"Kembali ke halaman 
members\"\r\n                       
 >\r\n                          
Kembali ke Member\r\n               
         </Button>\r\n              
          <Button\r\n               
           variant=\"outline\"\r\n  
                        onClick={() 
=> setCurrentStep(1)}\r\n           
               aria-label=\"Mulai 
export baru\"\r\n                   
     >\r\n                          
Export Lagi\r\n                     
   </Button>\r\n                    
  </div>\r\n                    
</>\r\n                  ) : (\r\n  
                  <>\r\n            
          <Alert 
variant=\"destructive\" 
role=\"alert\">\r\n                 
       <AlertCircle className=\"h-4 
w-4\" aria-hidden=\"true\" />\r\n   
                     
<AlertDescription>\r\n              
            {exportResult.message 
|| \"Terjadi kesalahan saat 
melakukan export\"}\r\n             
           </AlertDescription>\r\n  
                    </Alert>\r\n    
                  <div 
className=\"flex gap-2\">\r\n       
                 <Button\r\n        
                  asChild\r\n       
                   
aria-label=\"Kembali ke halaman 
members\"\r\n                       
 >\r\n                          
<Link\r\n                           
 href=\"/members\"\r\n              
              prefetch={false}\r\n  
                        // 
onMouseEnter={(e) => {\r\n          
                //   const href = e.
currentTarget.getAttribute('href')\r
\n                          //   if 
(href && router) {\r\n              
            //     
router.prefetch(href)\r\n           
               //   }\r\n           
               // }}\r\n            
              >\r\n                 
           Kembali ke Member\r\n    
                      </Link>\r\n   
                     </Button>\r\n  
                      <Button\r\n   
                       
variant=\"outline\"\r\n             
             onClick={() => 
setCurrentStep(1)}\r\n              
            aria-label=\"Coba 
export lagi\"\r\n                   
     >\r\n                          
Coba Lagi\r\n                       
 </Button>\r\n                      
</div>\r\n                    
</>\r\n                  )}\r\n     
           </CardContent>\r\n       
       </Card>\r\n            
</div>\r\n          )}\r\n        
</Wizard>\r\n      </div>\r\n    
</div>\r\n  )\r\n}\r\n\r\n","usedDep
recatedRules":[]},{"filePath":"D:\\U
BIG\\Projek\\Presensi-New\\src\\app\
\onboarding\\setup\\page.tsx","messa
ges":[{"ruleId":null,"message":"Unus
ed eslint-disable directive (no 
problems were reported from 'react-h
ooks/exhaustive-deps').","line":131,
"column":9,"severity":1,"nodeType":n
ull,"fix":{"range":[3886,3941],"text
":" "}}],"suppressedMessages":[],"er
rorCount":0,"fatalErrorCount":0,"war
ningCount":1,"fixableErrorCount":0,"
fixableWarningCount":1,"source":"\"u
se client\";\r\n\r\nimport { 
useEffect, useState, useRef } from 
\"react\";\r\nimport { 
useQueryClient } from \"@tanstack/re
act-query\";\r\nimport { 
useOrgStore } from 
\"@/store/org-store\";\r\nimport { 
useUserStore } from 
\"@/store/user-store\";\r\nimport { 
Button } from \"@/components/ui/butt
on\";\r\nimport { Input } from \"@/c
omponents/ui/input\";\r\nimport { 
Label } from \"@/components/ui/label
\";\r\nimport { Alert, 
AlertDescription } from \"@/componen
ts/ui/alert\";\r\nimport {\r\n    
AlertCircle,\r\n    
CheckCircle2,\r\n    Loader2,\r\n   
 Building2,\r\n    MapPin,\r\n    
ClipboardCheck,\r\n} from 
\"lucide-react\";\r\nimport {\r\n   
 Select,\r\n    SelectContent,\r\n  
  SelectItem,\r\n    
SelectTrigger,\r\n    
SelectValue,\r\n} from \"@/component
s/ui/select\";\r\nimport {\r\n    
createOrganization,\r\n    
validateOrganizationCode,\r\n    
getAvailableTimezones,\r\n    
getAvailableRoles,\r\n} from \"@/act
ion/create-organization\";\r\nimport
 { INDUSTRY_OPTIONS } from \"@/lib/c
onstants/industries\";\r\nimport { 
toast } from \"sonner\";\r\n\r\n// 
ΓöÇΓöÇΓöÇ Types ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
Ç\r\n\r\ninterface GeoCity {\r\n    
value: string;\r\n    label: 
string;\r\n    postal_codes?: 
string[];\r\n}\r\n\r\ninterface 
GeoState {\r\n    value: 
string;\r\n    label: string;\r\n   
 cities: 
GeoCity[];\r\n}\r\n\r\ninterface 
GeoCountry {\r\n    code: 
string;\r\n    name: string;\r\n    
states: GeoState[];\r\n}\r\n\r\n// 
ΓöÇΓöÇΓöÇ Step Config ΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\ncon
st STEPS = [\r\n    {\r\n        
number: 1,\r\n        title: 
\"Basic Information\",\r\n        
description: \"Required 
organization details\",\r\n        
icon: Building2,\r\n    },\r\n    
{\r\n        number: 2,\r\n        
title: \"Address & Location\",\r\n  
      description: \"Optional ΓÇô 
can be updated later\",\r\n        
icon: MapPin,\r\n    },\r\n    
{\r\n        number: 3,\r\n        
title: \"Review\",\r\n        
description: \"Confirm and create 
your organization\",\r\n        
icon: ClipboardCheck,\r\n    
},\r\n];\r\n\r\n// ΓöÇΓöÇΓöÇ 
Component ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nexport
 default function 
OnboardingSetupPage() {\r\n    
const orgStore = useOrgStore();\r\n 
   const userStore = 
useUserStore();\r\n    const 
queryClient = 
useQueryClient();\r\n\r\n    const 
[currentStep, setCurrentStep] = 
useState(1);\r\n    const 
[isSubmitting, setIsSubmitting] = 
useState(false);\r\n    const 
[globalError, setGlobalError] = 
useState<string | null>(null);\r\n  
  const [isHydrated, setIsHydrated] 
= useState(false);\r\n\r\n    // 
ΓöÇΓöÇ Data loading\r\n    const 
[timezones, setTimezones] = 
useState<string[]>([]);\r\n    
const [locationData, 
setLocationData] = 
useState<GeoCountry | 
null>(null);\r\n    const 
[isLoadingData, setIsLoadingData] = 
useState(true);\r\n    const 
[defaultRoleCode, 
setDefaultRoleCode] = 
useState(\"A001\");\r\n\r\n    // 
ΓöÇΓöÇ Form data\r\n    const 
[formData, setFormData] = 
useState({\r\n        orgName: 
\"\",\r\n        orgCode: \"\",\r\n 
       timezone: 
\"Asia/Jakarta\",\r\n        
industry: \"\",\r\n        phone: 
\"\",\r\n        email: \"\",\r\n   
     // Address\r\n        address: 
\"\",\r\n        stateProvince: 
\"\",\r\n        city: \"\",\r\n    
    postalCode: \"\",\r\n    
});\r\n\r\n    // ΓöÇΓöÇ Derived 
location state\r\n    const 
[availableCities, 
setAvailableCities] = 
useState<GeoCity[]>([]);\r\n    
const [availablePostalCodes, 
setAvailablePostalCodes] = 
useState<string[]>([]);\r\n\r\n    
// ΓöÇΓöÇ Code validation\r\n    
const [codeValidating, 
setCodeValidating] = 
useState(false);\r\n    const 
[codeValid, setCodeValid] = 
useState(true);\r\n    const 
[fieldErrors, setFieldErrors] = 
useState<Record<string, 
string>>({});\r\n    const 
codeValidationTimeoutRef = 
useRef<NodeJS.Timeout | 
null>(null);\r\n\r\n    // ΓöÇΓöÇ 
Hydration + data load ΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓö
ÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\n   
 useEffect(() => {\r\n        
setIsHydrated(true);\r\n        
loadInitialData();\r\n        
return () => {\r\n            if 
(codeValidationTimeoutRef.current) 
{\r\n                clearTimeout(co
deValidationTimeoutRef.current);\r\n
            }\r\n        };\r\n     
   // eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n    
}, []);\r\n\r\n    const 
loadInitialData = async () => {\r\n 
       try {\r\n            
setIsLoadingData(true);\r\n         
   const [timezonesList, rolesList, 
geoResult] = await 
Promise.all([\r\n                
getAvailableTimezones(),\r\n        
        getAvailableRoles(),\r\n    
            
fetch(\"/api/geo/ID\")\r\n          
          .then((r) => 
r.json())\r\n                    
.catch(() => null),\r\n            
]);\r\n\r\n            setTimezones(
timezonesList);\r\n\r\n            
if (geoResult?.code === \"ID\" && 
geoResult?.states) {\r\n            
    setLocationData(geoResult);\r\n 
           }\r\n\r\n            if 
(rolesList?.length > 0) {\r\n       
         setDefaultRoleCode(rolesLis
t[0]?.code ?? \"A001\");\r\n        
    }\r\n        } catch (err) 
{\r\n            
console.error(\"[ONBOARDING] Failed 
to load initial data:\", err);\r\n  
      } finally {\r\n            
setIsLoadingData(false);\r\n        
}\r\n    };\r\n\r\n    // ΓöÇΓöÇ 
Field helpers ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇ\r\n\r\n    const setField = 
(key: string, value: string) => 
{\r\n        setFormData((prev) => 
({ ...prev, [key]: value }));\r\n   
 };\r\n\r\n    const validateField 
= (name: string, value: string): 
string => {\r\n        switch 
(name) {\r\n            case 
\"orgName\":\r\n                if 
(!value.trim()) return 
\"Organization name is 
required\";\r\n                if 
(value.length < 2) return \"Minimum 
2 characters\";\r\n                
if (value.length > 100) return 
\"Maximum 100 characters\";\r\n     
           return \"\";\r\n         
   case \"orgCode\":\r\n            
    if (!value.trim()) return 
\"Organization code is 
required\";\r\n                if 
(value.length > 20) return 
\"Maximum 20 characters\";\r\n      
          return \"\";\r\n          
  case \"phone\":\r\n               
 if (value && value.length > 20) 
return \"Maximum 20 
characters\";\r\n                
return \"\";\r\n            case 
\"email\":\r\n                if 
(value && !value.includes(\"@\")) 
return \"Invalid email 
format\";\r\n                return 
\"\";\r\n            default:\r\n   
             return \"\";\r\n       
 }\r\n    };\r\n\r\n    const 
updateField = (name: string, value: 
string) => {\r\n        
setField(name, value);\r\n        
const err = validateField(name, 
value);\r\n        
setFieldErrors((prev) => ({ 
...prev, [name]: err }));\r\n    
};\r\n\r\n    const 
handleCodeChange = (e: React.ChangeE
vent<HTMLInputElement>) => {\r\n    
    const value = e.target.value.toU
pperCase().slice(0, 20);\r\n        
setFormData((prev) => ({ ...prev, 
orgCode: value }));\r\n        
setFieldErrors((prev) => ({ 
...prev, orgCode: \"\" }));\r\n\r\n 
       if 
(codeValidationTimeoutRef.current) 
{\r\n            clearTimeout(codeVa
lidationTimeoutRef.current);\r\n    
    }\r\n\r\n        if 
(value.length > 0) {\r\n            
setCodeValidating(true);\r\n        
    
codeValidationTimeoutRef.current = 
setTimeout(async () => {\r\n        
        try {\r\n                   
 const result = await validateOrgani
zationCode(value);\r\n              
      
setCodeValid(result.isValid);\r\n   
                 if 
(!result.isValid) {\r\n             
           setFieldErrors((prev) => 
({\r\n                            
...prev,\r\n                        
    orgCode: result.message || 
\"Code already taken\",\r\n         
               }));\r\n             
       }\r\n                } catch 
{\r\n                    
setCodeValid(false);\r\n            
        setFieldErrors((prev) => ({ 
...prev, orgCode: \"Error 
validating code\" }));\r\n          
      } finally {\r\n               
     setCodeValidating(false);\r\n  
              }\r\n            }, 
500);\r\n        } else {\r\n       
     setCodeValid(true);\r\n        
}\r\n    };\r\n\r\n    const 
handleStateChange = (stateValue: 
string) => {\r\n        const 
selectedState = 
locationData?.states.find((s) => 
s.value === stateValue);\r\n        
setAvailableCities(selectedState?.ci
ties ?? []);\r\n        
setAvailablePostalCodes([]);\r\n    
    setFormData((prev) => ({ 
...prev, stateProvince: stateValue, 
city: \"\", postalCode: \"\" 
}));\r\n    };\r\n\r\n    const 
handleCityChange = (cityValue: 
string) => {\r\n        const 
selectedCity = 
availableCities.find((c) => c.value 
=== cityValue);\r\n        
setFormData((prev) => ({ ...prev, 
city: cityValue, postalCode: \"\" 
}));\r\n        setAvailablePostalCo
des(selectedCity?.postal_codes ?? 
[]);\r\n    };\r\n\r\n    // ΓöÇΓöÇ 
Navigation ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇ\r\n\r\n    const 
canProceedStep1 = (): boolean => 
{\r\n        if 
(!formData.orgName.trim() || 
formData.orgName.length < 2) return 
false;\r\n        if 
(!formData.orgCode.trim()) return 
false;\r\n        if (!codeValid || 
codeValidating) return false;\r\n   
     if (fieldErrors.orgName || 
fieldErrors.orgCode || 
fieldErrors.email || 
fieldErrors.phone)\r\n            
return false;\r\n        return 
true;\r\n    };\r\n\r\n    const 
goNext = () => {\r\n        if 
(currentStep === 1) {\r\n           
 // Re-validate required fields 
before advancing\r\n            
const nameErr = 
validateField(\"orgName\", 
formData.orgName);\r\n            
const codeErr = 
validateField(\"orgCode\", 
formData.orgCode);\r\n            
if (nameErr || codeErr) {\r\n       
         setFieldErrors((prev) => 
({ ...prev, orgName: nameErr, 
orgCode: codeErr }));\r\n           
     return;\r\n            }\r\n   
     }\r\n        
setCurrentStep((s) => Math.min(s + 
1, STEPS.length));\r\n        
window.scrollTo({ top: 0, behavior: 
\"smooth\" });\r\n    };\r\n\r\n    
const goPrev = () => {\r\n        
setCurrentStep((s) => Math.max(s - 
1, 1));\r\n        
window.scrollTo({ top: 0, behavior: 
\"smooth\" });\r\n    };\r\n\r\n    
// ΓöÇΓöÇ Submit ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\
n    const handleSubmit = async () 
=> {\r\n        try {\r\n           
 setIsSubmitting(true);\r\n         
   setGlobalError(null);\r\n\r\n    
        const toastId = 
toast.loading(\"Creating your 
organization...\");\r\n\r\n         
   const result = await 
createOrganization({\r\n            
    orgName: formData.orgName,\r\n  
              orgCode: 
formData.orgCode,\r\n               
 timezone: formData.timezone,\r\n   
             industry: 
formData.industry,\r\n              
  phone: formData.phone,\r\n        
        email: formData.email,\r\n  
              website: \"\",\r\n    
            address: 
formData.address,\r\n               
 city: formData.city,\r\n           
     stateProvince: 
formData.stateProvince,\r\n         
       postalCode: 
formData.postalCode,\r\n            
    defaultRoleId: 
defaultRoleCode,\r\n            
});\r\n\r\n            if 
(!result.success) {\r\n             
   const msg = result.message || 
\"Failed to create 
organization\";\r\n                
const detail = result.error ? ` 
(${result.error})` : \"\";\r\n      
          
toast.dismiss(toastId);\r\n         
       toast.error(msg + 
detail);\r\n                
setGlobalError(msg + detail);\r\n   
             return;\r\n            
}\r\n\r\n            if 
(result.data) {\r\n                
// Invalidate caches\r\n            
    queryClient.invalidateQueries({ 
queryKey: [\"dashboard\"] });\r\n   
             
queryClient.invalidateQueries({ 
queryKey: [\"members\"] });\r\n     
           
queryClient.invalidateQueries({ 
queryKey: [\"organization\"] 
});\r\n\r\n                orgStore.
setOrganizationId(result.data.organi
zationId, 
result.data.organizationName);\r\n  
              orgStore.setTimezone(f
ormData.timezone);\r\n              
  
userStore.setRole(defaultRoleCode, r
esult.data.organizationId);\r\n\r\n 
               
toast.dismiss(toastId);\r\n         
       toast.success(`Organization 
\"${result.data.organizationName}\" 
created! Welcome aboard 
≡ƒÄë`);\r\n\r\n                // 
Set org_id cookie via API so 
middleware knows we're good\r\n     
           await 
fetch(\"/api/organization/select\", 
{\r\n                    method: 
\"POST\",\r\n                    
headers: { \"Content-Type\": 
\"application/json\" },\r\n         
           body: JSON.stringify({ 
organizationId: 
result.data.organizationId }),\r\n  
              });\r\n\r\n           
     await new Promise((r) => 
setTimeout(r, 1000));\r\n           
     window.location.href = 
\"/\";\r\n            }\r\n        
} catch (err) {\r\n            
const msg = err instanceof Error ? 
err.message : \"An unexpected error 
occurred\";\r\n            
setGlobalError(msg);\r\n            
toast.error(msg);\r\n        } 
finally {\r\n            
setIsSubmitting(false);\r\n        
}\r\n    };\r\n\r\n    // ΓöÇΓöÇ 
Loading state ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇ\r\n\r\n    if (!isHydrated) 
{\r\n        return (\r\n           
 <div className=\"flex h-screen 
items-center justify-center\">\r\n  
              <Loader2 
className=\"h-8 w-8 animate-spin 
text-muted-foreground\" />\r\n      
      </div>\r\n        );\r\n    
}\r\n\r\n    // ΓöÇΓöÇ Rendered 
steps ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r
\n    return (\r\n        <div 
className=\"min-h-screen 
bg-gradient-to-br from-slate-50 
to-slate-100 flex items-center 
justify-center p-4\">\r\n           
 <div className=\"w-full 
max-w-2xl\">\r\n                {/* 
ΓöÇΓöÇ Header ΓöÇΓöÇ */}\r\n        
        <div 
className=\"text-center mb-8\">\r\n 
                   <div 
className=\"inline-flex 
items-center justify-center w-14 
h-14 rounded-2xl bg-primary 
text-primary-foreground mb-4 
shadow-lg\">\r\n                    
    <Building2 className=\"w-7 
h-7\" />\r\n                    
</div>\r\n                    <h1 
className=\"text-2xl font-bold 
tracking-tight 
text-slate-900\">\r\n               
         Set Up Your 
Organization\r\n                    
</h1>\r\n                    <p 
className=\"text-slate-500 mt-1 
text-sm\">\r\n                      
  Let&apos;s get started ΓÇö this 
takes less than 2 minutes.\r\n      
              </p>\r\n              
  </div>\r\n\r\n                {/* 
ΓöÇΓöÇ Step Indicator ΓöÇΓöÇ 
*/}\r\n                <div 
className=\"flex items-center 
justify-center gap-0 mb-8\">\r\n    
                {STEPS.map((step, 
idx) => {\r\n                       
 const isCompleted = currentStep > 
step.number;\r\n                    
    const isActive = currentStep 
=== step.number;\r\n                
        const StepIcon = 
step.icon;\r\n                      
  return (\r\n                      
      <div key={step.number} 
className=\"flex 
items-center\">\r\n                 
               {/* Circle */}\r\n   
                             <div 
className=\"flex flex-col 
items-center\">\r\n                 
                   <div\r\n         
                               
className={`flex items-center 
justify-center w-10 h-10 
rounded-full border-2 
transition-all duration-300 
${isCompleted\r\n                   
                         ? 
\"bg-green-500 border-green-500 
text-white\"\r\n                    
                        : 
isActive\r\n                        
                        ? 
\"bg-primary border-primary 
text-primary-foreground shadow-md 
shadow-primary/30\"\r\n             
                                   
: \"bg-white border-slate-200 
text-slate-400\"\r\n                
                            }`}\r\n 
                                   
>\r\n                               
         {isCompleted ? (\r\n       
                                    
 <CheckCircle2 className=\"w-5 
h-5\" />\r\n                        
                ) : (\r\n           
                                 
<StepIcon className=\"w-4 h-4\" 
/>\r\n                              
          )}\r\n                    
                </div>\r\n          
                          <div 
className=\"mt-1.5 text-center 
w-24\">\r\n                         
               <p\r\n               
                             
className={`text-xs font-semibold 
leading-tight ${isActive ? 
\"text-primary\" : isCompleted ? 
\"text-green-600\" : 
\"text-slate-400\"\r\n              
                                  
}`}\r\n                             
           >\r\n                    
                        
{step.title}\r\n                    
                    </p>\r\n        
                                <p 
className=\"text-[10px] 
text-slate-400 leading-tight hidden 
sm:block\">\r\n                     
                       
{step.description}\r\n              
                          </p>\r\n  
                                  
</div>\r\n                          
      </div>\r\n                    
            {/* Connector */}\r\n   
                             {idx < 
STEPS.length - 1 && (\r\n           
                         <div\r\n   
                                    
 className={`h-0.5 w-16 mb-6 
transition-all duration-300 
${currentStep > step.number ? 
\"bg-green-400\" : 
\"bg-slate-200\"\r\n                
                            }`}\r\n 
                                   
/>\r\n                              
  )}\r\n                            
</div>\r\n                        
);\r\n                    })}\r\n   
             </div>\r\n\r\n         
       {/* ΓöÇΓöÇ Card ΓöÇΓöÇ 
*/}\r\n                <div 
className=\"bg-white rounded-2xl 
shadow-xl border border-slate-100 
overflow-hidden\">\r\n              
      {/* Card header */}\r\n       
             <div className=\"px-6 
pt-6 pb-4 border-b border-slate-100 
text-center\">\r\n                  
      <h2 className=\"text-lg 
font-semibold text-slate-900\">\r\n 
                           Step 
{currentStep}: {STEPS[currentStep - 
1]?.title}\r\n                      
  </h2>\r\n                        
<p className=\"text-sm 
text-slate-500 mt-0.5\">\r\n        
                    
{STEPS[currentStep - 
1]?.description}\r\n                
        </p>\r\n                    
</div>\r\n\r\n                    
{/* Global error */}\r\n            
        {globalError && (\r\n       
                 <div 
className=\"px-6 pt-4\">\r\n        
                    <Alert 
variant=\"destructive\">\r\n        
                        
<AlertCircle className=\"h-4 w-4\" 
/>\r\n                              
  <AlertDescription>{globalError}</A
lertDescription>\r\n                
            </Alert>\r\n            
            </div>\r\n              
      )}\r\n\r\n                    
{/* ΓöÇΓöÇ Step 1: Basic 
Information ΓöÇΓöÇ */}\r\n          
          {currentStep === 1 && 
(\r\n                        <div 
className=\"px-6 py-6 
space-y-5\">\r\n                    
        <div className=\"grid 
grid-cols-1 sm:grid-cols-2 
gap-5\">\r\n                        
        {/* Org Name */}\r\n        
                        <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"orgName\" 
className={fieldErrors.orgName ? 
\"text-red-500\" : \"\"}>\r\n       
                                 
Organization Name <span className=\"
text-red-500\">*</span>\r\n         
                           
</Label>\r\n                        
            <Input\r\n              
                          
id=\"orgName\"\r\n                  
                      
placeholder=\"e.g., PT Maju 
Jaya\"\r\n                          
              
value={formData.orgName}\r\n        
                                
onChange={(e) => 
updateField(\"orgName\", 
e.target.value.slice(0, 100))}\r\n  
                                    
  className={fieldErrors.orgName ? 
\"border-red-500\" : \"\"}\r\n      
                                  
disabled={isSubmitting}\r\n         
                           />\r\n   
                                 
{fieldErrors.orgName ? (\r\n        
                                <p 
className=\"text-xs text-red-500\">{
fieldErrors.orgName}</p>\r\n        
                            ) : 
(\r\n                               
         <p className=\"text-xs text
-muted-foreground\">{formData.orgNam
e.length}/100</p>\r\n               
                     )}\r\n         
                       
</div>\r\n\r\n                      
          {/* Org Code */}\r\n      
                          <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"orgCode\" 
className={fieldErrors.orgCode ? 
\"text-red-500\" : \"\"}>\r\n       
                                 
Organization Code <span className=\"
text-red-500\">*</span>\r\n         
                           
</Label>\r\n                        
            <div 
className=\"relative\">\r\n         
                               
<Input\r\n                          
                  
id=\"orgCode\"\r\n                  
                          
placeholder=\"e.g., PTMJ\"\r\n      
                                    
  value={formData.orgCode}\r\n      
                                    
  onChange={handleCodeChange}\r\n   
                                    
     className={`pr-9 
${fieldErrors.orgCode ? 
\"border-red-500\" : \"\"}`}\r\n    
                                    
    disabled={isSubmitting}\r\n     
                                   
/>\r\n                              
          {codeValidating && (\r\n  
                                    
      <Loader2 className=\"absolute 
right-3 top-1/2 -translate-y-1/2 
h-4 w-4 animate-spin 
text-muted-foreground\" />\r\n      
                                  
)}\r\n                              
          {!codeValidating && 
codeValid && formData.orgCode && 
!fieldErrors.orgCode && (\r\n       
                                    
 <CheckCircle2 className=\"absolute 
right-3 top-1/2 -translate-y-1/2 
h-4 w-4 text-green-500\" />\r\n     
                                   
)}\r\n                              
      </div>\r\n                    
                
{fieldErrors.orgCode ? (\r\n        
                                <p 
className=\"text-xs text-red-500\">{
fieldErrors.orgCode}</p>\r\n        
                            ) : 
(\r\n                               
         <p className=\"text-xs 
text-muted-foreground\">\r\n        
                                    
Max 20 characters ┬╖ 
auto-uppercase\r\n                  
                      </p>\r\n      
                              
)}\r\n                              
  </div>\r\n\r\n                    
            {/* Timezone */}\r\n    
                            <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"timezone\">\r\n    
                                    
Timezone <span className=\"text-red-
500\">*</span>\r\n                  
                  </Label>\r\n      
                              
<Select\r\n                         
               
value={formData.timezone}\r\n       
                                 
onValueChange={(v) => 
setField(\"timezone\", v)}\r\n      
                                  
disabled={isLoadingData || 
isSubmitting}\r\n                   
                 >\r\n              
                          
<SelectTrigger id=\"timezone\">\r\n 
                                    
       <SelectValue 
placeholder=\"Select timezone\" 
/>\r\n                              
          </SelectTrigger>\r\n      
                                  
<SelectContent>\r\n                 
                           
{timezones.map((tz) => (\r\n        
                                    
    <SelectItem key={tz} 
value={tz}>\r\n                     
                               
{tz}\r\n                            
                    
</SelectItem>\r\n                   
                         ))}\r\n    
                                    
</SelectContent>\r\n                
                    </Select>\r\n   
                             
</div>\r\n\r\n                      
          {/* Industry */}\r\n      
                          <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"industry\">Industry
</Label>\r\n                        
            <Select\r\n             
                           
value={formData.industry}\r\n       
                                 
onValueChange={(v) => 
setField(\"industry\", v)}\r\n      
                                  
disabled={isSubmitting}\r\n         
                           >\r\n    
                                    
<SelectTrigger id=\"industry\">\r\n 
                                    
       <SelectValue 
placeholder=\"Select industry 
type\" />\r\n                       
                 
</SelectTrigger>\r\n                
                        
<SelectContent 
className=\"max-h-64\">\r\n         
                                   
{INDUSTRY_OPTIONS.map((opt) => 
(\r\n                               
                 <SelectItem 
key={opt.value} 
value={opt.value}>\r\n              
                                    
  {opt.label}\r\n                   
                             
</SelectItem>\r\n                   
                         ))}\r\n    
                                    
</SelectContent>\r\n                
                    </Select>\r\n   
                             
</div>\r\n\r\n                      
          {/* Phone */}\r\n         
                       <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"phone\" 
className={fieldErrors.phone ? 
\"text-red-500\" : \"\"}>\r\n       
                                 
Phone Number\r\n                    
                </Label>\r\n        
                            
<Input\r\n                          
              id=\"phone\"\r\n      
                                  
type=\"tel\"\r\n                    
                    
placeholder=\"e.g., 
+62-821-1234-5678\"\r\n             
                           
value={formData.phone}\r\n          
                              
onChange={(e) => 
updateField(\"phone\", 
e.target.value.slice(0, 20))}\r\n   
                                    
 className={fieldErrors.phone ? 
\"border-red-500\" : \"\"}\r\n      
                                  
disabled={isSubmitting}\r\n         
                           />\r\n   
                                 
{fieldErrors.phone ? (\r\n          
                              <p 
className=\"text-xs text-red-500\">{
fieldErrors.phone}</p>\r\n          
                          ) : (\r\n 
                                    
   <p className=\"text-xs text-muted
-foreground\">{formData.phone.length
}/20</p>\r\n                        
            )}\r\n                  
              </div>\r\n\r\n        
                        {/* Email 
*/}\r\n                             
   <div 
className=\"space-y-1.5\">\r\n      
                              
<Label htmlFor=\"email\" 
className={fieldErrors.email ? 
\"text-red-500\" : \"\"}>\r\n       
                                 
Email Address\r\n                   
                 </Label>\r\n       
                             
<Input\r\n                          
              id=\"email\"\r\n      
                                  
type=\"email\"\r\n                  
                      
placeholder=\"e.g., 
info@company.com\"\r\n              
                          
value={formData.email}\r\n          
                              
onChange={(e) => 
updateField(\"email\", 
e.target.value.slice(0, 100))}\r\n  
                                    
  className={fieldErrors.email ? 
\"border-red-500\" : \"\"}\r\n      
                                  
disabled={isSubmitting}\r\n         
                           />\r\n   
                                 
{fieldErrors.email ? (\r\n          
                              <p 
className=\"text-xs text-red-500\">{
fieldErrors.email}</p>\r\n          
                          ) : (\r\n 
                                    
   <p className=\"text-xs text-muted
-foreground\">{formData.email.length
}/100</p>\r\n                       
             )}\r\n                 
               </div>\r\n           
                 </div>\r\n         
               </div>\r\n           
         )}\r\n\r\n                 
   {/* ΓöÇΓöÇ Step 2: Address & 
Location ΓöÇΓöÇ */}\r\n             
       {currentStep === 2 && (\r\n  
                      <div 
className=\"px-6 py-6 
space-y-5\">\r\n                    
        <div className=\"rounded-lg 
bg-slate-50 border border-slate-200 
px-4 py-3 text-sm 
text-slate-600\">\r\n               
                 All fields below 
are <strong>optional</strong> and 
can be updated anytime in\r\n       
                         
settings.\r\n                       
     </div>\r\n\r\n                 
           {/* Street Address 
*/}\r\n                            
<div className=\"space-y-1.5\">\r\n 
                               
<Label htmlFor=\"address\">Street 
Address</Label>\r\n                 
               <Input\r\n           
                         
id=\"address\"\r\n                  
                  
placeholder=\"e.g., Jl. Merdeka No. 
123\"\r\n                           
         
value={formData.address}\r\n        
                            
onChange={(e) => 
setField(\"address\", 
e.target.value)}\r\n                
                    
disabled={isSubmitting}\r\n         
                       />\r\n       
                     </div>\r\n\r\n 
                           <div 
className=\"grid grid-cols-1 
sm:grid-cols-3 gap-4\">\r\n         
                       {/* 
State/Province */}\r\n              
                  <div 
className=\"space-y-1.5\">\r\n      
                              
<Label>State / Province</Label>\r\n 
                                   
<Select\r\n                         
               
value={formData.stateProvince}\r\n  
                                    
  onValueChange={handleStateChange}\
r\n                                 
       disabled={isSubmitting || 
!locationData || isLoadingData}\r\n 
                                   
>\r\n                               
         <SelectTrigger>\r\n        
                                    
<SelectValue 
placeholder={isLoadingData ? 
\"LoadingΓÇª\" : \"Select state\"} 
/>\r\n                              
          </SelectTrigger>\r\n      
                                  
<SelectContent 
className=\"max-h-60\">\r\n         
                                   
{locationData?.states.map((s) => 
(\r\n                               
                 <SelectItem 
key={s.value} value={s.value}>\r\n  
                                    
              {s.label}\r\n         
                                    
   </SelectItem>\r\n                
                            ))}\r\n 
                                    
   </SelectContent>\r\n             
                       
</Select>\r\n                       
         </div>\r\n\r\n             
                   {/* City */}\r\n 
                               <div 
className=\"space-y-1.5\">\r\n      
                              
<Label>City</Label>\r\n             
                       <Select\r\n  
                                    
  value={formData.city}\r\n         
                               onVal
ueChange={handleCityChange}\r\n     
                                   
disabled={isSubmitting || 
availableCities.length === 0}\r\n   
                                 
>\r\n                               
         <SelectTrigger>\r\n        
                                    
<SelectValue placeholder=\"Select 
city\" />\r\n                       
                 
</SelectTrigger>\r\n                
                        
<SelectContent 
className=\"max-h-60\">\r\n         
                                   
{availableCities.map((c) => (\r\n   
                                    
         <SelectItem key={c.value} 
value={c.value}>\r\n                
                                    
{c.label}\r\n                       
                         
</SelectItem>\r\n                   
                         ))}\r\n    
                                    
</SelectContent>\r\n                
                    </Select>\r\n   
                             
</div>\r\n\r\n                      
          {/* Postal Code */}\r\n   
                             <div 
className=\"space-y-1.5\">\r\n      
                              
<Label>Postal Code</Label>\r\n      
                              
<Select\r\n                         
               
value={formData.postalCode}\r\n     
                                   
onValueChange={(v) => 
setField(\"postalCode\", v)}\r\n    
                                    
disabled={isSubmitting || 
availablePostalCodes.length === 
0}\r\n                              
      >\r\n                         
               <SelectTrigger>\r\n  
                                    
      <SelectValue 
placeholder=\"Select postal code\" 
/>\r\n                              
          </SelectTrigger>\r\n      
                                  
<SelectContent>\r\n                 
                           
{availablePostalCodes.map((code) => 
(\r\n                               
                 <SelectItem 
key={code} value={code}>\r\n        
                                    
        {code}\r\n                  
                              
</SelectItem>\r\n                   
                         ))}\r\n    
                                    
</SelectContent>\r\n                
                    </Select>\r\n   
                             
</div>\r\n                          
  </div>\r\n                        
</div>\r\n                    
)}\r\n\r\n                    {/* 
ΓöÇΓöÇ Step 3: Review ΓöÇΓöÇ 
*/}\r\n                    
{currentStep === 3 && (\r\n         
               <div 
className=\"px-6 py-6 
space-y-5\">\r\n                    
        <p className=\"text-sm 
text-slate-500\">\r\n               
                 Please review the 
information below before creating 
your organization.\r\n              
              </p>\r\n\r\n          
                  {/* Basic Info 
Summary */}\r\n                     
       <div className=\"rounded-xl 
border border-slate-200 divide-y 
divide-slate-100 
overflow-hidden\">\r\n              
                  <div 
className=\"px-4 py-3 
bg-slate-50\">\r\n                  
                  <p 
className=\"text-xs font-semibold 
text-slate-500 uppercase 
tracking-wide\">\r\n                
                        Basic 
Information\r\n                     
               </p>\r\n             
                   </div>\r\n       
                         <ReviewRow 
label=\"Organization Name\" 
value={formData.orgName} />\r\n     
                           
<ReviewRow label=\"Organization 
Code\" value={formData.orgCode} 
/>\r\n                              
  <ReviewRow label=\"Timezone\" 
value={formData.timezone} />\r\n    
                            
{formData.industry && (\r\n         
                           
<ReviewRow\r\n                      
                  
label=\"Industry\"\r\n              
                          
value={\r\n                         
                   
INDUSTRY_OPTIONS.find((o) => 
o.value === 
formData.industry)?.label ??\r\n    
                                    
    formData.industry\r\n           
                             }\r\n  
                                  
/>\r\n                              
  )}\r\n                            
    {formData.phone && <ReviewRow 
label=\"Phone Number\" 
value={formData.phone} />}\r\n      
                          
{formData.email && <ReviewRow 
label=\"Email Address\" 
value={formData.email} />}\r\n      
                      
</div>\r\n\r\n                      
      {/* Address Summary (only if 
any filled) */}\r\n                 
           {(formData.address || 
formData.stateProvince || 
formData.city || 
formData.postalCode) && (\r\n       
                         <div 
className=\"rounded-xl border 
border-slate-200 divide-y 
divide-slate-100 
overflow-hidden\">\r\n              
                      <div 
className=\"px-4 py-3 
bg-slate-50\">\r\n                  
                      <p 
className=\"text-xs font-semibold 
text-slate-500 uppercase 
tracking-wide\">\r\n                
                            Address 
& Location\r\n                      
                  </p>\r\n          
                          
</div>\r\n                          
          {formData.address && 
<ReviewRow label=\"Street Address\" 
value={formData.address} />}\r\n    
                                
{formData.stateProvince && (\r\n    
                                    
<ReviewRow\r\n                      
                      
label=\"State/Province\"\r\n        
                                    
value={\r\n                         
                       
locationData?.states.find(s => 
s.value === 
formData.stateProvince)?.label\r\n  
                                    
          ?? 
formData.stateProvince\r\n          
                                  
}\r\n                               
         />\r\n                     
               )}\r\n               
                     {formData.city 
&& (\r\n                            
            <ReviewRow\r\n          
                                  
label=\"City\"\r\n                  
                          
value={\r\n                         
                       
availableCities.find(c => c.value 
=== formData.city)?.label\r\n       
                                    
     ?? locationData?.states\r\n    
                                    
            .flatMap(s => 
s.cities)\r\n                       
                             
.find(c => c.value === 
formData.city)?.label\r\n           
                                    
 ?? formData.city\r\n               
                             }\r\n  
                                    
  />\r\n                            
        )}\r\n                      
              {formData.postalCode 
&& (\r\n                            
            <ReviewRow 
label=\"Postal Code\" 
value={formData.postalCode} />\r\n  
                                  
)}\r\n                              
  </div>\r\n                        
    )}\r\n\r\n                      
      {(!formData.address && 
!formData.stateProvince && 
!formData.city && 
!formData.postalCode) && (\r\n      
                          <p 
className=\"text-xs text-slate-400 
italic\">\r\n                       
             No address details 
provided ΓÇö you can add these 
later in settings.\r\n              
                  </p>\r\n          
                  )}\r\n            
            </div>\r\n              
      )}\r\n\r\n                    
{/* ΓöÇΓöÇ Footer / Actions ΓöÇΓöÇ 
*/}\r\n                    <div 
className=\"px-6 py-4 border-t 
border-slate-100 flex items-center 
justify-between bg-slate-50\">\r\n  
                      <div>\r\n     
                       {currentStep 
> 1 && (\r\n                        
        <Button\r\n                 
                   
type=\"button\"\r\n                 
                   
variant=\"outline\"\r\n             
                       
onClick={goPrev}\r\n                
                    
disabled={isSubmitting}\r\n         
                           
className=\"gap-2\"\r\n             
                   >\r\n            
                        Back\r\n    
                            
</Button>\r\n                       
     )}\r\n                        
</div>\r\n\r\n                      
  <div className=\"flex 
items-center gap-3\">\r\n           
                 {/* Step 2 can be 
skipped */}\r\n                     
       {currentStep === 2 && (\r\n  
                              
<Button\r\n                         
           type=\"button\"\r\n      
                              
variant=\"ghost\"\r\n               
                     
onClick={goNext}\r\n                
                    
disabled={isSubmitting}\r\n         
                       >\r\n        
                            Skip 
this step\r\n                       
         </Button>\r\n              
              )}\r\n\r\n            
                {currentStep < 
STEPS.length && (\r\n               
                 <Button\r\n        
                            
type=\"button\"\r\n                 
                   
onClick={goNext}\r\n                
                    
disabled={currentStep === 1 && 
!canProceedStep1()}\r\n             
                       
className=\"gap-2 
min-w-[100px]\"\r\n                 
               >\r\n                
                    Next\r\n        
                        
</Button>\r\n                       
     )}\r\n\r\n                     
       {currentStep === 
STEPS.length && (\r\n               
                 <Button\r\n        
                            
type=\"button\"\r\n                 
                   
onClick={handleSubmit}\r\n          
                          
disabled={isSubmitting || 
isLoadingData}\r\n                  
                  className=\"gap-2 
min-w-[160px]\"\r\n                 
               >\r\n                
                    {isSubmitting ? 
(\r\n                               
         <>\r\n                     
                       <Loader2 
className=\"h-4 w-4 animate-spin\" 
/>\r\n                              
              CreatingΓÇª\r\n       
                                 
</>\r\n                             
       ) : (\r\n                    
                    <>\r\n          
                                  
<CheckCircle2 className=\"h-4 w-4\" 
/>\r\n                              
              Create 
Organization\r\n                    
                    </>\r\n         
                           )}\r\n   
                             
</Button>\r\n                       
     )}\r\n                        
</div>\r\n                    
</div>\r\n                
</div>\r\n\r\n                {/* 
Submitting overlay */}\r\n          
      {isSubmitting && (\r\n        
            <div className=\"fixed 
inset-0 bg-black/40 
backdrop-blur-sm flex items-center 
justify-center z-50\">\r\n          
              <div 
className=\"bg-white rounded-2xl 
shadow-2xl p-8 flex flex-col 
items-center gap-4 max-w-xs 
w-full\">\r\n                       
     <Loader2 className=\"h-10 w-10 
animate-spin text-primary\" />\r\n  
                          <p 
className=\"font-semibold 
text-slate-800 text-center\">\r\n   
                             
Setting up your organizationΓÇª\r\n 
                           </p>\r\n 
                           <p 
className=\"text-sm text-slate-500 
text-center\">\r\n                  
              Please don&apos;t 
close this window.\r\n              
              </p>\r\n              
          </div>\r\n                
    </div>\r\n                
)}\r\n            </div>\r\n        
</div>\r\n    );\r\n}\r\n\r\n// 
ΓöÇΓöÇΓöÇ Helper Component ΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ
ΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇ\r\n\r\nfunction 
ReviewRow({ label, value }: { 
label: string; value: string }) 
{\r\n    return (\r\n        <div 
className=\"flex justify-between 
items-start px-4 py-3\">\r\n        
    <span className=\"text-sm 
text-slate-500 shrink-0 
mr-4\">{label}</span>\r\n           
 <span className=\"text-sm 
font-medium text-slate-900 
text-right 
break-all\">{value}</span>\r\n      
  </div>\r\n    );\r\n}\r\n","usedDe
precatedRules":[]},{"filePath":"D:\\
UBIG\\Projek\\Presensi-New\\src\\app
\\reports\\client-budgets\\page.tsx"
,"messages":[{"ruleId":"prefer-const
","severity":2,"message":"'finalGrou
pedData' is never reassigned. Use 
'const' instead.","line":319,"column
":29,"nodeType":"Identifier","messag
eId":"useConst","endLine":319,"endCo
lumn":45,"fix":{"range":[14921,14956
],"text":"const finalGroupedData = g
roupedData;"}}],"suppressedMessages"
:[],"errorCount":1,"fatalErrorCount"
:0,"warningCount":0,"fixableErrorCou
nt":1,"fixableWarningCount":0,"sourc
e":"\"use client\"\r\n\r\nimport { 
useState, useEffect } from 
\"react\"\r\nimport { columns } 
from \"./columns\"\r\nimport { 
DUMMY_CLIENT_BUDGETS, 
ClientBudgetEntry } from \"@/lib/dat
a/dummy-client-budgets\"\r\nimport 
{ DUMMY_MEMBERS, DUMMY_TEAMS, 
DUMMY_CLIENTS } from 
\"@/lib/data/dummy-data\"\r\nimport 
{ DataTable } from \"@/components/ta
bles/data-table\"\r\nimport { 
Button } from \"@/components/ui/butt
on\"\r\nimport { InsightsHeader } 
from \"@/components/insights/Insight
sHeader\"\r\nimport type { 
SelectedFilter, DateRange } from \"@
/components/insights/types\"\r\nimpo
rt { useTimezone } from \"@/componen
ts/providers/timezone-provider\"\r\n
import { ClientBudgetsFilterSidebar 
} from \"@/components/report/ClientB
udgetsFilterSidebar\"\r\nimport { 
Input } from 
\"@/components/ui/input\"\r\nimport 
{ Filter, Search, Download, 
Settings2, Layers } from 
\"lucide-react\"\r\nimport {\r\n    
DropdownMenu,\r\n    
DropdownMenuCheckboxItem,\r\n    
DropdownMenuContent,\r\n    
DropdownMenuTrigger,\r\n    
DropdownMenuLabel,\r\n    
DropdownMenuSeparator,\r\n    
DropdownMenuRadioGroup,\r\n    
DropdownMenuRadioItem,\r\n} from \"@
/components/ui/dropdown-menu\"\r\nim
port { VisibilityState } from \"@tan
stack/react-table\"\r\n\r\n\r\ntype 
GroupByOption = \"none\" | 
\"member\" | 
\"month\"\r\n\r\nexport default 
function ClientBudgetsPage() {\r\n  
  const timezone = 
useTimezone()\r\n    const 
[filterSidebarOpen, 
setFilterSidebarOpen] = 
useState(false)\r\n    const 
[sidebarFilters, setSidebarFilters] 
= useState({\r\n        client: 
\"all\",\r\n        budgetType: 
\"all\"\r\n    })\r\n    const 
[dateRange, setDateRange] = 
useState<DateRange>({\r\n        
startDate: new Date(),\r\n        
endDate: new Date()\r\n    })\r\n   
 const [selectedFilter, 
setSelectedFilter] = 
useState<SelectedFilter>({ type: 
\"members\", all: true, id: \"all\" 
})\r\n    const [groupBy, 
setGroupBy] = useState<GroupByOption
>(\"none\")\r\n\r\n    const [data] 
= 
useState(DUMMY_CLIENT_BUDGETS)\r\n  
  const [isLoading, setIsLoading] = 
useState(true)\r\n    const 
[searchQuery, setSearchQuery] = 
useState(\"\")\r\n    const 
[columnVisibility, 
setColumnVisibility] = useState<Visi
bilityState>({})\r\n\r\n    // 
Simulate loading\r\n    
useEffect(() => {\r\n        const 
timer = setTimeout(() => {\r\n      
      setIsLoading(false)\r\n       
 }, 1000)\r\n        return () => 
clearTimeout(timer)\r\n    }, 
[])\r\n\r\n    // Filter Logic\r\n  
  // State for client-side 
simulated data to prevent hydration 
mismatch\r\n    const 
[filteredData, setFilteredData] = us
eState<ClientBudgetEntry[]>(data)\r\
n\r\n    // Update derived data in 
useEffect (Client Only)\r\n    
useEffect(() => {\r\n        const 
now = new Date()\r\n\r\n        
const transformedData = 
data.map(item => {\r\n            
// Simulation Logic: \r\n           
 // We assume the 
DUMMY_CLIENT_BUDGETS represent the 
TOTAL budget/usage.\r\n            
// When a date range is selected, 
we scale the \"Time Tracked\" and 
\"Cost Incurred\"\r\n            // 
based on the proportion of the 
range overlap against a 
hypothetical \"Year\".\r\n          
  // Implementation similar to 
Project Budgets but simplified 
since Clients don't have explicit 
start/end dates in this 
view.\r\n\r\n            const 
client = DUMMY_CLIENTS.find(c => 
c.name === item.clientName)\r\n     
       // If client has createdAt, 
use it. Otherwise assume generic 
start.\r\n            const created 
= client ? new 
Date(client.createdAt) : new 
Date(now.getFullYear(), 0, 
1)\r\n\r\n            const 
rangeStart = new 
Date(dateRange.startDate)\r\n       
     const rangeEnd = new 
Date(dateRange.endDate)\r\n         
   rangeEnd.setHours(23, 59, 59, 
999)\r\n\r\n            // 
Calculate overlap between \"Client 
Active Period\" vs \"Selected 
Range\"\r\n            // For demo 
purposes, we treat \"Client 
Active\" as \"Created -> Now\"\r\n  
          const activeEnd = new 
Date(now)\r\n            const 
activeStart = created\r\n           
 const totalDuration = 
activeEnd.getTime() - 
activeStart.getTime()\r\n\r\n       
     const overlapStart = new Date(M
ath.max(activeStart.getTime(), 
rangeStart.getTime()))\r\n          
  const overlapEnd = new 
Date(Math.min(activeEnd.getTime(), 
rangeEnd.getTime()))\r\n\r\n        
    let ratio = 1\r\n            if 
(overlapStart < overlapEnd && 
totalDuration > 0) {\r\n            
    const overlapDuration = 
overlapEnd.getTime() - 
overlapStart.getTime()\r\n          
      ratio = overlapDuration / 
totalDuration\r\n            } else 
{\r\n                ratio = 0\r\n  
          }\r\n\r\n            // 
Apply ratio to usage stats\r\n      
      const newTime = 
item.timeTracked * ratio\r\n        
    const newCost = 
item.costIncurred * ratio\r\n\r\n   
         // Recalc status\r\n       
     let newStatus: 
ClientBudgetEntry['status'] = 
'Within Budget'\r\n            
const limit = item.budgetTotal\r\n  
          const used = 
item.budgetType === 'cost' ? 
newCost : newTime\r\n            
const pct = limit > 0 ? (used / 
limit) * 100 : 0\r\n\r\n            
if (pct > 100) newStatus = 
'Exceeded'\r\n            else if 
(pct > 80) newStatus = 'Approaching 
Limit'\r\n\r\n            return 
{\r\n                ...item,\r\n   
             timeTracked: 
newTime,\r\n                
costIncurred: newCost,\r\n          
      status: newStatus\r\n         
   }\r\n        }).filter((item): 
item is ClientBudgetEntry => {\r\n  
          if (!item) return 
false\r\n            const 
matchesClient = 
sidebarFilters.client === \"all\" 
|| item.clientName === 
sidebarFilters.client\r\n           
 const matchesType = 
sidebarFilters.budgetType === 
\"all\" || item.budgetType === 
sidebarFilters.budgetType\r\n       
     const matchesSearch = item.clie
ntName.toLowerCase().includes(search
Query.toLowerCase())\r\n            
return matchesClient && matchesType 
&& matchesSearch\r\n        
})\r\n\r\n        setFilteredData(tr
ansformedData)\r\n    }, [data, 
sidebarFilters, dateRange, 
searchQuery])\r\n\r\n\r\n    // 
Grouping Logic\r\n    const 
groupedData = (() => {\r\n        
if (groupBy === \"none\") return 
null\r\n\r\n        // Group by 
Member (Mock implementation since 
we don't have member data in this 
flat view)\r\n        // Group by 
Month (Dynamic)\r\n\r\n        if 
(groupBy === 'month') {\r\n         
   // Dynamically generate months 
based on the selected dateRange\r\n 
           const months: string[] = 
[]\r\n            const start = new 
Date(dateRange.startDate)\r\n       
     const end = new 
Date(dateRange.endDate)\r\n\r\n     
       const current = new 
Date(start)\r\n            
current.setDate(1)\r\n\r\n          
  while (current <= end) {\r\n      
          const monthStr = 
current.toLocaleDateString('en-US', 
{ month: 'long', year: 'numeric' 
})\r\n                if 
(!months.includes(monthStr)) {\r\n  
                  
months.push(monthStr)\r\n           
     }\r\n                
current.setMonth(current.getMonth() 
+ 1)\r\n            }\r\n\r\n       
     if (months.length === 0) {\r\n 
               months.push(start.toL
ocaleDateString('en-US', { month: 
'long', year: 'numeric' }))\r\n     
       }\r\n\r\n            const 
monthGroups: Record<string, 
ClientBudgetEntry[]> = {}\r\n       
     months.forEach(m => {\r\n      
          const splitFactor = (1 / 
months.length)\r\n                
monthGroups[m] = filteredData.map(p 
=> ({\r\n                    
...p,\r\n                    
timeTracked: p.timeTracked * 
(splitFactor * (0.8 + Math.random() 
* 0.4)),\r\n                    
costIncurred: p.costIncurred * 
(splitFactor * (0.8 + Math.random() 
* 0.4))\r\n                }))\r\n  
          })\r\n            return 
monthGroups\r\n        }\r\n\r\n    
    // Placeholder for future 
grouping\r\n        return {} as 
Record<string, 
ClientBudgetEntry[]>\r\n    
})()\r\n\r\n    const 
handleApplyFilters = (filters: 
typeof sidebarFilters) => {\r\n     
   setSidebarFilters(filters)\r\n   
     
setFilterSidebarOpen(false)\r\n     
   console.log(\"Filters 
applied:\", filters)\r\n    
}\r\n\r\n    const handleExport = 
() => {\r\n        const headers = 
[\"Client,Type,Budget Limit,Time 
Tracked,Cost 
Incurred,Remaining,Status\"]\r\n    
    const rows = 
filteredData.map(item => {\r\n      
      const isCost = 
item.budgetType === 'cost'\r\n      
      const used = isCost ? 
item.costIncurred : 
item.timeTracked\r\n            
const remaining = item.budgetTotal 
- used\r\n\r\n            return 
[\r\n                
item.clientName,\r\n                
item.budgetType,\r\n                
item.budgetTotal,\r\n               
 item.timeTracked.toFixed(2),\r\n   
             
item.costIncurred.toFixed(2),\r\n   
             
remaining.toFixed(2),\r\n           
     item.status\r\n            
].join(\",\")\r\n        })\r\n\r\n 
       const csvContent = 
\"data:text/csv;charset=utf-8,\" + 
[headers, 
...rows].join(\"\\n\")\r\n        
const encodedUri = 
encodeURI(csvContent)\r\n        
const link = 
document.createElement(\"a\")\r\n   
     link.setAttribute(\"href\", 
encodedUri)\r\n        
link.setAttribute(\"download\", 
\"client_budgets_report.csv\")\r\n  
      
document.body.appendChild(link)\r\n 
       link.click()\r\n        
document.body.removeChild(link)\r\n 
   }\r\n\r\n    return (\r\n        
<div className=\"px-6 pb-6 
space-y-6\">\r\n            <div 
className=\"flex justify-between 
items-center\">\r\n                
<h1 className=\"text-xl 
font-semibold\">Client Budgets 
Report</h1>\r\n                <div 
className=\"flex items-center 
gap-2\">\r\n                    
<div className=\"relative 
w-64\">\r\n                        
<Search className=\"absolute left-3 
top-1/2 transform -translate-y-1/2 
text-gray-400 w-4 h-4\" />\r\n      
                  <Input\r\n        
                    
placeholder=\"Search 
clients...\"\r\n                    
        value={searchQuery}\r\n     
                       
onChange={(e) => 
setSearchQuery(e.target.value)}\r\n 
                           
className=\"pl-9 ps-9 h-9 bg-white 
dark:bg-gray-950 
dark:border-gray-800 
dark:text-gray-200\"\r\n            
            />\r\n                  
  </div>\r\n                
</div>\r\n            
</div>\r\n\r\n            
<InsightsHeader\r\n                
selectedFilter={selectedFilter}\r\n 
               onSelectedFilterChang
e={setSelectedFilter}\r\n           
     dateRange={dateRange}\r\n      
          onDateRangeChange={setDate
Range}\r\n                
members={DUMMY_MEMBERS}\r\n         
       teams={DUMMY_TEAMS}\r\n      
          timezone={timezone}\r\n   
             hideFilter={true}\r\n  
          >\r\n                <div 
className=\"flex gap-2\">\r\n       
             <DropdownMenu>\r\n     
                   
<DropdownMenuTrigger asChild>\r\n   
                         <Button 
variant=\"outline\" className=\"h-9 
gap-2\">\r\n                        
        <Layers className=\"w-4 
h-4\" />\r\n                        
        <span className=\"hidden 
sm:inline\">\r\n                    
                Group by: {groupBy 
=== \"none\" ? \"None\" : groupBy 
=== \"month\" ? \"Month\" : 
\"Member\"}\r\n                     
           </span>\r\n              
              </Button>\r\n         
               
</DropdownMenuTrigger>\r\n          
              <DropdownMenuContent 
align=\"end\" 
className=\"w-[180px]\">\r\n        
                    
<DropdownMenuLabel>Group data 
by</DropdownMenuLabel>\r\n          
                  
<DropdownMenuSeparator />\r\n       
                     
<DropdownMenuRadioGroup 
value={groupBy} onValueChange={(v) 
=> setGroupBy(v as 
GroupByOption)}>\r\n                
                
<DropdownMenuRadioItem value=\"none\
">None</DropdownMenuRadioItem>\r\n  
                              
<DropdownMenuRadioItem value=\"month
\">Month</DropdownMenuRadioItem>\r\n
                                
<DropdownMenuRadioItem 
value=\"member\" disabled>Member 
(Coming 
Soon)</DropdownMenuRadioItem>\r\n   
                         
</DropdownMenuRadioGroup>\r\n       
                 
</DropdownMenuContent>\r\n          
          </DropdownMenu>\r\n\r\n   
                 <Button\r\n        
                
variant=\"outline\"\r\n             
           className=\"h-9 
text-gray-700 dark:text-gray-300 
border-gray-300 
dark:border-gray-700 bg-white 
dark:bg-gray-950 hover:bg-gray-50 
dark:hover:bg-gray-900 
font-medium\"\r\n                   
     onClick={() => 
setFilterSidebarOpen(true)}\r\n     
               >\r\n                
        <Filter className=\"w-4 h-4 
mr-2\" /> Filter\r\n                
    </Button>\r\n                   
 <DropdownMenu>\r\n                 
       <DropdownMenuTrigger 
asChild>\r\n                        
    <Button variant=\"outline\" 
size=\"icon\" className=\"h-9 w-9 
bg-white dark:bg-gray-950 
border-gray-300 
dark:border-gray-700 
hover:bg-gray-50 
dark:hover:bg-gray-900 
text-gray-700 
dark:text-gray-300\">\r\n           
                     <Settings2 
className=\"w-4 h-4\" />\r\n        
                    </Button>\r\n   
                     
</DropdownMenuTrigger>\r\n          
              <DropdownMenuContent 
align=\"end\" 
className=\"w-[180px]\">\r\n        
                    {columns\r\n    
                            
.map((col) => {\r\n                 
                   const id = 
col.id || (col as 
any).accessorKey\r\n                
                    const label = 
{\r\n                               
         clientName: 
\"Client\",\r\n                     
                   budgetType: 
\"Type\",\r\n                       
                 budgetTotal: 
\"Budget\",\r\n                     
                   timeTracked: 
\"Time Tracked\",\r\n               
                         
costIncurred: \"Cost\",\r\n         
                               
budgetUsed: \"Used %\",\r\n         
                               
remaining: \"Remaining\",\r\n       
                                 
status: \"Status\"\r\n              
                      }[id as 
string] || id\r\n\r\n               
                     return (\r\n   
                                    
 <DropdownMenuCheckboxItem\r\n      
                                    
  key={id}\r\n                      
                      
className=\"capitalize\"\r\n        
                                    
checked={columnVisibility[id] !== 
false}\r\n                          
                  
onCheckedChange={(value) =>\r\n     
                                    
       setColumnVisibility((prev) 
=> ({\r\n                           
                         
...prev,\r\n                        
                            [id]: 
!!value,\r\n                        
                        }))\r\n     
                                    
   }\r\n                            
            >\r\n                   
                         
{label}\r\n                         
               
</DropdownMenuCheckboxItem>\r\n     
                               
)\r\n                               
 })}\r\n                        
</DropdownMenuContent>\r\n          
          </DropdownMenu>\r\n       
             <Button 
variant=\"outline\" 
className=\"h-9\" 
onClick={handleExport}>\r\n         
               <Download 
className=\"w-4 h-4 mr-2\" /> 
Export\r\n                    
</Button>\r\n                
</div>\r\n            
</InsightsHeader>\r\n\r\n           
 {/* Main Content */}\r\n           
 {groupBy === \"none\" ? (\r\n      
          <DataTable\r\n            
        columns={columns}\r\n       
             
data={filteredData}\r\n             
       isLoading={isLoading}\r\n    
                
showColumnToggle={false}\r\n        
            columnVisibility={column
Visibility}\r\n                    o
nColumnVisibilityChange={setColumnVi
sibility}\r\n                />\r\n 
           ) : (\r\n                
<div className=\"space-y-6\">\r\n   
                 {(() => {\r\n      
                  let 
finalGroupedData = 
groupedData;\r\n\r\n                
        if (groupBy === \"month\") 
{\r\n                            // 
Render logic logic is handled in 
derived state 'groupedData' 
above,\r\n                          
  // but we check output here.\r\n  
                      }\r\n\r\n     
                   if 
(!finalGroupedData || Object.keys(fi
nalGroupedData).length === 0) {\r\n 
                           if 
(!isLoading) {\r\n                  
              return (\r\n          
                          <div 
className=\"py-10 text-center 
text-gray-500 bg-white rounded-lg 
border border-dashed\">\r\n         
                               No 
data found for the current 
filters.\r\n                        
            </div>\r\n              
                  )\r\n             
               }\r\n                
            return null\r\n         
               }\r\n\r\n            
            return Object.entries(fi
nalGroupedData).map(([groupName, 
items]) => (\r\n                    
        <div key={groupName} 
className=\"space-y-3\">\r\n        
                        <div 
className=\"flex items-center gap-2 
px-1\">\r\n                         
           <h3 
className=\"font-semibold text-lg te
xt-gray-800\">{groupName}</h3>\r\n  
                                  
<span className=\"text-sm 
text-muted-foreground bg-gray-100 
px-2 py-0.5 rounded-full\">\r\n     
                                   
{items.length} Clients\r\n          
                          
</span>\r\n                         
       </div>\r\n                   
             <DataTable\r\n         
                           
columns={columns}\r\n               
                     
data={items}\r\n                    
                
isLoading={isLoading}\r\n           
                         
showColumnToggle={false}\r\n        
                            
showPagination={false}\r\n          
                          columnVisi
bility={columnVisibility}\r\n       
                         />\r\n     
                       </div>\r\n   
                     ))\r\n         
           })()}\r\n                
</div>\r\n            )}\r\n\r\n    
        
<ClientBudgetsFilterSidebar\r\n     
           
open={filterSidebarOpen}\r\n        
        onOpenChange={setFilterSideb
arOpen}\r\n                
onApply={handleApplyFilters}\r\n    
        />\r\n        </div>\r\n    
)\r\n}\r\n","usedDeprecatedRules":[]
},{"filePath":"D:\\UBIG\\Projek\\Pre
sensi-New\\src\\components\\insights
\\DateRangePicker.tsx","messages":[{
"ruleId":null,"message":"Unused 
eslint-disable directive (no 
problems were reported from 'react-h
ooks/exhaustive-deps').","line":33,"
column":5,"severity":1,"nodeType":nu
ll,"fix":{"range":[1479,1534],"text"
:" "}}],"suppressedMessages":[],"err
orCount":0,"fatalErrorCount":0,"warn
ingCount":1,"fixableErrorCount":0,"f
ixableWarningCount":1,"source":"\"us
e client\"\r\n\r\nimport { 
useEffect, useMemo, useState } from 
\"react\"\r\nimport { DropdownMenu, 
DropdownMenuContent, 
DropdownMenuTrigger } from \"@/compo
nents/ui/dropdown-menu\"\r\nimport 
type { DateRange } from 
\"./types\"\r\n\r\ninterface Props 
{\r\n  dateRange: DateRange\r\n  
onDateRangeChange: (next: 
DateRange) => void\r\n  timezone?: 
string\r\n}\r\n\r\nexport function 
DateRangePicker({\r\n  
dateRange,\r\n  
onDateRangeChange,\r\n  
timezone,\r\n}: Props) {\r\n  const 
[tempStartDate, setTempStartDate] = 
useState<Date>(dateRange.startDate)\
r\n  const [tempEndDate, 
setTempEndDate] = useState<Date>(dat
eRange.endDate)\r\n  const 
[leftMonth, setLeftMonth] = 
useState<Date>(new 
Date(dateRange.startDate))\r\n  
const [rightMonth, setRightMonth] = 
useState<Date>(new Date(new Date(dat
eRange.startDate).setMonth(new Date(
dateRange.startDate).getMonth() + 
1)))\r\n  const [selectingStart, 
setSelectingStart] = 
useState(true)\r\n  const 
[dateRangeOpen, setDateRangeOpen] = 
useState(false)\r\n  // Initialize 
selectedPreset dengan null, akan 
di-update oleh useEffect\r\n  const 
[selectedPreset, setSelectedPreset] 
= useState<string | 
null>(null)\r\n\r\n  // Deteksi 
preset saat pertama kali mount dan 
saat dateRange berubah\r\n  
useEffect(() => {\r\n    // Selalu 
update preset berdasarkan 
dateRange, baik modal terbuka atau 
tidak\r\n    // Tapi jika modal 
terbuka, preset akan di-override 
oleh useEffect yang lain\r\n    
const detectedPreset = 
detectPreset(dateRange.startDate, 
dateRange.endDate)\r\n    setSelecte
dPreset(detectedPreset)\r\n    // 
eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n  }, 
[dateRange.startDate.getTime(), date
Range.endDate.getTime()])\r\n\r\n  
const fmt = (d: Date) =>\r\n    
d.toLocaleDateString(\"en-US\", { 
weekday: \"short\", month: 
\"short\", day: \"numeric\", year: 
\"numeric\", timeZone: timezone || 
\"UTC\" })\r\n\r\n  const tzOffset 
= useMemo((): string => {\r\n    if 
(!timezone) return \"\"\r\n    try 
{\r\n      const now = new 
Date()\r\n      const parts = new 
Intl.DateTimeFormat(\"en-US\", { 
timeZone: timezone, timeZoneName: 
\"short\" }).formatToParts(now)\r\n 
     const name = parts.find(p => 
p.type === \"timeZoneName\")?.value 
?? \"\"\r\n      const m = name.matc
h(/GMT([+-]\\d{1,2})(?::(\\d{2}))?/)
\r\n      if (m) {\r\n        const 
raw = m[1] ?? \"\"\r\n        const 
sign = raw.startsWith(\"-\") ? 
\"-\" : \"+\"\r\n        let hours 
= raw.replace(/[+-]/, \"\")\r\n     
   if (hours.length === 0) hours = 
\"00\"\r\n        else if 
(hours.length === 1) hours = 
`0${hours}`\r\n        const 
minutes = m[2] ?? \"00\"\r\n        
return minutes !== \"00\" ? 
`${sign}${hours}:${minutes}` : 
`${sign}${hours}`\r\n      }\r\n    
} catch { }\r\n    return \"\"\r\n  
}, [timezone])\r\n\r\n  // Fungsi 
untuk mendeteksi apakah date range 
sesuai dengan preset\r\n  const 
detectPreset = (start: Date, end: 
Date): string | null => {\r\n    
const now = new Date()\r\n    
now.setHours(23, 59, 59, 999)\r\n   
 const today = new Date(now)\r\n    
today.setHours(0, 0, 0, 0)\r\n\r\n  
  // Normalize dates untuk 
perbandingan - pastikan hanya 
membandingkan tanggal, bukan 
waktu\r\n    const startDate = new 
Date(start)\r\n    
startDate.setHours(0, 0, 0, 0)\r\n  
  const endDate = new Date(end)\r\n 
   endDate.setHours(23, 59, 59, 
999)\r\n\r\n    const startTime = 
startDate.getTime()\r\n    const 
endTime = endDate.getTime()\r\n    
const todayTime = 
today.getTime()\r\n    const 
nowTime = now.getTime()\r\n\r\n    
// Today - harus start dan end sama 
dengan today\r\n    if (startTime 
=== todayTime && endTime === 
nowTime) {\r\n      return 
\"today\"\r\n    }\r\n\r\n    // 
Yesterday\r\n    const yesterday = 
new Date(today)\r\n    yesterday.set
Date(yesterday.getDate() - 1)\r\n   
 const yesterdayEnd = new 
Date(yesterday)\r\n    
yesterdayEnd.setHours(23, 59, 59, 
999)\r\n    if (startTime === 
yesterday.getTime() && endTime === 
yesterdayEnd.getTime()) {\r\n      
return \"yesterday\"\r\n    
}\r\n\r\n    // Last 7 days - harus 
dari 6 hari yang lalu sampai hari 
ini\r\n    const last7Start = new 
Date(today)\r\n    last7Start.setDat
e(last7Start.getDate() - 6)\r\n    
last7Start.setHours(0, 0, 0, 0)\r\n 
   if (startTime === 
last7Start.getTime() && endTime === 
nowTime) {\r\n      return 
\"last_7_days\"\r\n    }\r\n\r\n    
// This week\r\n    const dayOfWeek 
= now.getDay()\r\n    const diff = 
dayOfWeek === 0 ? 6 : dayOfWeek - 
1\r\n    const thisWeekStart = new 
Date(today)\r\n    thisWeekStart.set
Date(thisWeekStart.getDate() - 
diff)\r\n    
thisWeekStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
thisWeekStart.getTime() && endTime 
=== nowTime) {\r\n      return 
\"this_week\"\r\n    }\r\n\r\n    
// Last week\r\n    const 
lastWeekEnd = new Date(today)\r\n   
 lastWeekEnd.setDate(lastWeekEnd.get
Date() - lastWeekEnd.getDay())\r\n  
  lastWeekEnd.setHours(23, 59, 59, 
999)\r\n    const lastWeekStart = 
new Date(lastWeekEnd)\r\n    lastWee
kStart.setDate(lastWeekStart.getDate
() - 6)\r\n    
lastWeekStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
lastWeekStart.getTime() && endTime 
=== lastWeekEnd.getTime()) {\r\n    
  return \"last_week\"\r\n    
}\r\n\r\n    // Last 2 weeks\r\n    
const last2WeeksStart = new 
Date(today)\r\n    last2WeeksStart.s
etDate(last2WeeksStart.getDate() - 
13)\r\n    
last2WeeksStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
last2WeeksStart.getTime() && 
endTime === nowTime) {\r\n      
return \"last_2_weeks\"\r\n    
}\r\n\r\n    // This month\r\n    
const thisMonthStart = new 
Date(now.getFullYear(), 
now.getMonth(), 1)\r\n    
thisMonthStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
thisMonthStart.getTime() && endTime 
=== nowTime) {\r\n      return 
\"this_month\"\r\n    }\r\n\r\n    
// Last month\r\n    const 
lastMonthStart = new 
Date(now.getFullYear(), 
now.getMonth() - 1, 1)\r\n    
lastMonthStart.setHours(0, 0, 0, 
0)\r\n    const lastMonthEnd = new 
Date(now.getFullYear(), 
now.getMonth(), 0)\r\n    
lastMonthEnd.setHours(23, 59, 59, 
999)\r\n    if (startTime === 
lastMonthStart.getTime() && endTime 
=== lastMonthEnd.getTime()) {\r\n   
   return \"last_month\"\r\n    
}\r\n\r\n    // Jika tidak sesuai 
dengan preset manapun, return 
null\r\n    return null\r\n  
}\r\n\r\n  useEffect(() => {\r\n    
if (dateRangeOpen) {\r\n      setTem
pStartDate(dateRange.startDate)\r\n 
     setTempEndDate(dateRange.endDat
e)\r\n      const lm = new 
Date(dateRange.startDate)\r\n      
const rm = new Date(lm)\r\n      
rm.setMonth(rm.getMonth() + 1)\r\n  
    setLeftMonth(lm)\r\n      
setRightMonth(rm)\r\n      
setSelectingStart(true)\r\n      // 
Deteksi preset berdasarkan 
dateRange yang ada saat modal 
dibuka\r\n      const 
detectedPreset = 
detectPreset(dateRange.startDate, 
dateRange.endDate)\r\n      setSelec
tedPreset(detectedPreset)\r\n    
}\r\n  }, [dateRangeOpen, 
dateRange.startDate, 
dateRange.endDate])\r\n\r\n  // 
Update preset saat tempStartDate 
atau tempEndDate berubah (saat user 
memilih tanggal manual)\r\n  
useEffect(() => {\r\n    if 
(!dateRangeOpen) return\r\n\r\n    
// Jika range sudah selesai dipilih 
(selectingStart = true)\r\n    if 
(selectingStart) {\r\n      // 
Deteksi preset berdasarkan 
tempStartDate dan tempEndDate\r\n   
   const detectedPreset = 
detectPreset(tempStartDate, 
tempEndDate)\r\n      setSelectedPre
set(detectedPreset)\r\n    }\r\n    
// Jika sedang memilih start date 
(klik pertama), reset preset\r\n    
else {\r\n      
setSelectedPreset(null)\r\n    
}\r\n  }, [dateRangeOpen, 
tempStartDate, tempEndDate, 
selectingStart])\r\n\r\n  const 
generateCalendarDays = (month: 
Date) => {\r\n    const year = 
month.getFullYear()\r\n    const 
monthIndex = month.getMonth()\r\n   
 const firstDay = new Date(year, 
monthIndex, 1)\r\n    const lastDay 
= new Date(year, monthIndex + 1, 
0)\r\n    let startDay = 
firstDay.getDay() - 1\r\n    if 
(startDay < 0) startDay = 6\r\n    
const days: { day: number; 
isCurrentMonth: boolean }[] = 
[]\r\n    const prevMonthLastDay = 
new Date(year, monthIndex, 
0).getDate()\r\n    for (let i = 
startDay - 1; i >= 0; i--) 
days.push({ day: prevMonthLastDay - 
i, isCurrentMonth: false })\r\n    
for (let i = 1; i <= 
lastDay.getDate(); i++) days.push({ 
day: i, isCurrentMonth: true })\r\n 
   const remaining = 42 - 
days.length\r\n    for (let i = 1; 
i <= remaining; i++) days.push({ 
day: i, isCurrentMonth: false 
})\r\n    return days\r\n  
}\r\n\r\n  const handleDateClick = 
(day: number, month: Date, 
isCurrentMonth: boolean) => {\r\n   
 if (!isCurrentMonth) return\r\n    
const selectedDate = new 
Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
selectedDate.setHours(0, 0, 0, 
0)\r\n\r\n    if (selectingStart) 
{\r\n      // Klik pertama - reset 
preset dan set start date\r\n      
setSelectedPreset(null)\r\n      
setTempStartDate(selectedDate)\r\n  
    
setTempEndDate(selectedDate)\r\n    
  setSelectingStart(false)\r\n    } 
else {\r\n      // Klik kedua - 
selesaikan range\r\n      if 
(selectedDate < tempStartDate) 
{\r\n        
setTempStartDate(selectedDate)\r\n  
      
setTempEndDate(tempStartDate)\r\n   
   } else {\r\n        
setTempEndDate(selectedDate)\r\n    
  }\r\n      
setSelectingStart(true)\r\n      // 
Preset akan di-detect oleh 
useEffect\r\n    }\r\n  }\r\n\r\n  
const isDateInRange = (day: number, 
month: Date) => {\r\n    const date 
= new Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
date.setHours(0, 0, 0, 0)\r\n    
const start = new 
Date(tempStartDate); 
start.setHours(0, 0, 0, 0)\r\n    
const end = new Date(tempEndDate); 
end.setHours(0, 0, 0, 0)\r\n    
return date >= start && date <= 
end\r\n  }\r\n\r\n  const 
isStartOrEndDate = (day: number, 
month: Date) => {\r\n    const date 
= new Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
date.setHours(0, 0, 0, 0)\r\n    
const start = new 
Date(tempStartDate); 
start.setHours(0, 0, 0, 0)\r\n    
const end = new Date(tempEndDate); 
end.setHours(0, 0, 0, 0)\r\n    
return date.getTime() === 
start.getTime() || date.getTime() 
=== end.getTime()\r\n  }\r\n\r\n  
const moveLeftMonth = (delta: 
number) => {\r\n    const lm = new 
Date(leftMonth)\r\n    
lm.setMonth(lm.getMonth() + 
delta)\r\n    const rm = new 
Date(lm); rm.setMonth(rm.getMonth() 
+ 1)\r\n    setLeftMonth(lm); 
setRightMonth(rm)\r\n  }\r\n  const 
moveRightMonth = (delta: number) => 
{\r\n    const rm = new 
Date(rightMonth)\r\n    
rm.setMonth(rm.getMonth() + 
delta)\r\n    const lm = new 
Date(rm); lm.setMonth(lm.getMonth() 
- 1)\r\n    setLeftMonth(lm); 
setRightMonth(rm)\r\n  }\r\n\r\n  
const applyDateRange = () => {\r\n  
  // Deteksi preset berdasarkan 
tanggal yang dipilih sebelum 
apply\r\n    const detectedPreset = 
detectPreset(tempStartDate, 
tempEndDate)\r\n    setSelectedPrese
t(detectedPreset)\r\n    
onDateRangeChange({ startDate: 
tempStartDate, endDate: tempEndDate 
})\r\n    
setDateRangeOpen(false)\r\n  }\r\n  
const cancelDateRange = () => {\r\n 
   setTempStartDate(dateRange.startD
ate)\r\n    setTempEndDate(dateRange
.endDate)\r\n    
setDateRangeOpen(false)\r\n  
}\r\n\r\n  const applyPreset = 
(preset: string) => {\r\n    
setSelectedPreset(preset)\r\n    
const now = new Date()\r\n    let 
start = new Date()\r\n    let end = 
new Date()\r\n\r\n    switch 
(preset) {\r\n      case \"today\": 
{\r\n        start = new 
Date(now)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"yesterday\": {\r\n        start = 
new Date(now)\r\n        
start.setDate(start.getDate() - 
1)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(start)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"this_week\": {\r\n        const 
dayOfWeek = now.getDay()\r\n        
const diff = dayOfWeek === 0 ? 6 : 
dayOfWeek - 1\r\n        start = 
new Date(now)\r\n        
start.setDate(start.getDate() - 
diff)\r\n        start.setHours(0, 
0, 0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_7_days\": {\r\n        start 
= new Date(now)\r\n        
start.setDate(start.getDate() - 
6)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_week\": {\r\n        const 
lastWeekEnd = new Date(now)\r\n     
   lastWeekEnd.setDate(lastWeekEnd.g
etDate() - 
lastWeekEnd.getDay())\r\n        
lastWeekEnd.setHours(23, 59, 59, 
999)\r\n        const lastWeekStart 
= new Date(lastWeekEnd)\r\n        l
astWeekStart.setDate(lastWeekStart.g
etDate() - 6)\r\n        
lastWeekStart.setHours(0, 0, 0, 
0)\r\n        start = 
lastWeekStart\r\n        end = 
lastWeekEnd\r\n        break\r\n    
  }\r\n      case \"last_2_weeks\": 
{\r\n        start = new 
Date(now)\r\n        
start.setDate(start.getDate() - 
13)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"this_month\": {\r\n        start 
= new Date(now.getFullYear(), 
now.getMonth(), 1)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_month\": {\r\n        start 
= new Date(now.getFullYear(), 
now.getMonth() - 1, 1)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now.getFullYear(), 
now.getMonth(), 0)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n    
}\r\n\r\n    
setTempStartDate(start)\r\n    
setTempEndDate(end)\r\n\r\n    
const lm = new Date(start)\r\n    
const rm = new Date(lm); 
rm.setMonth(rm.getMonth() + 1)\r\n  
  setLeftMonth(lm)\r\n    
setRightMonth(rm)\r\n    
setSelectingStart(true)\r\n  
}\r\n\r\n  return (\r\n    
<DropdownMenu open={dateRangeOpen} o
nOpenChange={setDateRangeOpen}>\r\n 
     <DropdownMenuTrigger 
asChild>\r\n        <button 
className=\"px-4 py-2 border 
border-gray-300 
dark:border-gray-800 rounded-md 
text-sm bg-white dark:bg-gray-950 
hover:bg-gray-50 
dark:hover:bg-gray-900 flex 
items-center gap-2 text-gray-800 
dark:text-gray-200\">\r\n          
<svg className=\"w-4 h-4\" 
fill=\"none\" viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
    <rect x=\"3\" y=\"4\" 
width=\"18\" height=\"18\" rx=\"2\" 
ry=\"2\" />\r\n            <line 
x1=\"16\" y1=\"2\" x2=\"16\" 
y2=\"6\" />\r\n            <line 
x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" 
/>\r\n            <line x1=\"3\" 
y1=\"10\" x2=\"21\" y2=\"10\" 
/>\r\n          </svg>\r\n          
{fmt(dateRange.startDate)} - 
{fmt(dateRange.endDate)}\r\n        
</button>\r\n      
</DropdownMenuTrigger>\r\n      
<DropdownMenuContent 
align=\"start\" className=\"w-auto 
p-0 dark:bg-gray-950 
dark:border-gray-800\">\r\n        
<div className=\"flex\">\r\n        
  <div className=\"w-40 border-r 
border-gray-200 
dark:border-gray-800 p-3 
space-y-1\">\r\n            
<button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'today' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"today\")}\r\n         
   >Today</button>\r\n            
<button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'yesterday' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"yesterday\")}\r\n     
       >Yesterday</button>\r\n      
      <button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'this_week' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"this_week\")}\r\n     
       >This week</button>\r\n      
      <button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'last_7_days' 
? 'bg-black text-white 
dark:bg-white dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"last_7_days\")}\r\n   
         >Last 7 days</button>\r\n  
          <button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'last_week' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"last_week\")}\r\n     
       >Last week</button>\r\n      
      <button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'last_2_weeks' 
? 'bg-black text-white 
dark:bg-white dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"last_2_weeks\")}\r\n  
          >Last 2 
weeks</button>\r\n            
<button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'this_month' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"this_month\")}\r\n    
        >This month</button>\r\n    
        <button\r\n              
className={`w-full text-left px-3 
py-2 text-sm rounded 
${selectedPreset === 'last_month' ? 
'bg-black text-white dark:bg-white 
dark:text-black' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800 
dark:text-gray-300'}`}\r\n          
    onClick={() => 
applyPreset(\"last_month\")}\r\n    
        >Last month</button>\r\n    
      </div>\r\n          <div 
className=\"p-4\">\r\n            
{timezone && (\r\n              
<div className=\"flex justify-end 
mb-2\">\r\n                <span 
className=\"text-xs text-gray-500 
dark:text-gray-400\">\r\n           
       {timezone}{tzOffset ? ` 
(${tzOffset})` : \"\"}\r\n          
      </span>\r\n              
</div>\r\n            )}\r\n        
    <div className=\"flex 
gap-4\">\r\n              <div 
className=\"w-64\">\r\n             
   <div className=\"flex 
items-center justify-between 
mb-4\">\r\n                  
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded 
dark:text-gray-300\" onClick={() => 
moveLeftMonth(-1)}>\r\n             
       <svg className=\"w-4 h-4\" 
fill=\"none\" viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
              <polyline points=\"15 
18 9 12 15 6\" />\r\n               
     </svg>\r\n                  
</button>\r\n                  
<span className=\"font-semibold 
text-gray-900 
dark:text-gray-100\">\r\n           
         {leftMonth.toLocaleDateStri
ng(\"en-US\", { month: \"short\", 
year: \"numeric\" })}\r\n           
       </span>\r\n                  
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded 
dark:text-gray-300\" onClick={() => 
moveLeftMonth(1)}>\r\n              
      <svg className=\"w-4 h-4\" 
fill=\"none\" viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
              <polyline points=\"9 
18 15 12 9 6\" />\r\n               
     </svg>\r\n                  
</button>\r\n                
</div>\r\n\r\n                <div 
className=\"grid grid-cols-7 gap-1 
text-center text-xs mb-2\">\r\n     
             <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Mo</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Tu</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">We</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Th</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Fr</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Sa</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Su</div>\r\n   
             </div>\r\n\r\n         
       <div className=\"grid 
grid-cols-7 gap-1 text-center 
text-sm\">\r\n                  {gen
erateCalendarDays(leftMonth).map((d,
 i) => {\r\n                    
const inRange = d.isCurrentMonth && 
isDateInRange(d.day, leftMonth)\r\n 
                   const isEdge = 
d.isCurrentMonth && 
isStartOrEndDate(d.day, 
leftMonth)\r\n                    
return (\r\n                      
<button\r\n                        
key={i}\r\n                        
onClick={() => 
handleDateClick(d.day, leftMonth, 
d.isCurrentMonth)}\r\n              
          className={`p-2 rounded 
${isEdge ? \"bg-black text-white 
dark:bg-white dark:text-black 
hover:bg-gray-800 
dark:hover:bg-gray-200\" :\r\n      
                    inRange ? 
\"bg-gray-100 dark:bg-gray-800 
hover:bg-gray-200 
dark:hover:bg-gray-700 text-black 
dark:text-white\" :\r\n             
               d.isCurrentMonth ? 
\"text-gray-800 dark:text-gray-200 
hover:bg-gray-100 
dark:hover:bg-gray-800\" : 
\"text-gray-400 
dark:text-gray-600\"}`}\r\n         
             >\r\n                  
      {d.day}\r\n                   
   </button>\r\n                    
)\r\n                  })}\r\n      
          </div>\r\n              
</div>\r\n\r\n              <div 
className=\"w-64\">\r\n             
   <div className=\"flex 
items-center justify-between 
mb-4\">\r\n                  
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded 
dark:text-gray-300\" onClick={() => 
moveRightMonth(-1)}>\r\n            
        <svg className=\"w-4 h-4\" 
fill=\"none\" viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
              <polyline points=\"15 
18 9 12 15 6\" />\r\n               
     </svg>\r\n                  
</button>\r\n                  
<span className=\"font-semibold 
text-gray-900 
dark:text-gray-100\">\r\n           
         {rightMonth.toLocaleDateStr
ing(\"en-US\", { month: \"short\", 
year: \"numeric\" })}\r\n           
       </span>\r\n                  
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded 
dark:text-gray-300\" onClick={() => 
moveRightMonth(1)}>\r\n             
       <svg className=\"w-4 h-4\" 
fill=\"none\" viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
              <polyline points=\"9 
18 15 12 9 6\" />\r\n               
     </svg>\r\n                  
</button>\r\n                
</div>\r\n\r\n                <div 
className=\"grid grid-cols-7 gap-1 
text-center text-xs mb-2\">\r\n     
             <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Mo</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Tu</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">We</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Th</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Fr</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Sa</div>\r\n   
               <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Su</div>\r\n   
             </div>\r\n\r\n         
       <div className=\"grid 
grid-cols-7 gap-1 text-center 
text-sm\">\r\n                  {gen
erateCalendarDays(rightMonth).map((d
, i) => {\r\n                    
const inRange = d.isCurrentMonth && 
isDateInRange(d.day, 
rightMonth)\r\n                    
const isEdge = d.isCurrentMonth && 
isStartOrEndDate(d.day, 
rightMonth)\r\n                    
return (\r\n                      
<button\r\n                        
key={i}\r\n                        
onClick={() => 
handleDateClick(d.day, rightMonth, 
d.isCurrentMonth)}\r\n              
          className={`p-2 rounded 
${isEdge ? \"bg-black text-white 
dark:bg-white dark:text-black 
hover:bg-gray-800 
dark:hover:bg-gray-200\" :\r\n      
                    inRange ? 
\"bg-gray-100 dark:bg-gray-800 
hover:bg-gray-200 
dark:hover:bg-gray-700 text-black 
dark:text-white\" :\r\n             
               d.isCurrentMonth ? 
\"text-gray-800 dark:text-gray-200 
hover:bg-gray-100 
dark:hover:bg-gray-800\" : 
\"text-gray-400 
dark:text-gray-600\"}`}\r\n         
             >\r\n                  
      {d.day}\r\n                   
   </button>\r\n                    
)\r\n                  })}\r\n      
          </div>\r\n              
</div>\r\n            
</div>\r\n\r\n            <div 
className=\"text-xs text-center 
text-gray-600 dark:text-gray-400 
mt-2\">\r\n              
{fmt(tempStartDate)} - 
{fmt(tempEndDate)}\r\n            
</div>\r\n            <div 
className=\"flex items-center gap-2 
mt-4 pt-4 border-t border-gray-200 
dark:border-gray-800\">\r\n         
     <button className=\"px-4 py-2 
bg-black text-white dark:bg-white 
dark:text-black rounded 
hover:bg-gray-800 
dark:hover:bg-gray-200 
font-medium\" 
onClick={applyDateRange}>\r\n       
         Apply\r\n              
</button>\r\n              <button 
className=\"px-4 py-2 border 
border-gray-300 
dark:border-gray-700 rounded 
hover:bg-gray-50 
dark:hover:bg-gray-800 
dark:text-gray-200 text-gray-800 
hover:text-black\" 
onClick={cancelDateRange}>\r\n      
          Cancel\r\n              
</button>\r\n            </div>\r\n 
         </div>\r\n        
</div>\r\n      
</DropdownMenuContent>\r\n    
</DropdownMenu>\r\n  )\r\n}\r\n\r\n"
,"usedDeprecatedRules":[]},{"filePat
h":"D:\\UBIG\\Projek\\Presensi-New\\
src\\components\\insights\\InsightsH
eader.tsx","messages":[{"ruleId":nul
l,"message":"Unused eslint-disable 
directive (no problems were 
reported from 'react-hooks/exhaustiv
e-deps').","line":185,"column":5,"se
verity":1,"nodeType":null,"fix":{"ra
nge":[6899,6954],"text":" "}}],"supp
ressedMessages":[],"errorCount":0,"f
atalErrorCount":0,"warningCount":1,"
fixableErrorCount":0,"fixableWarning
Count":1,"source":"\"use 
client\"\r\nimport { useEffect, 
useMemo, useState } from 
\"react\"\r\nimport { Menu, Search, 
ChevronDown } from 
\"lucide-react\"\r\nimport { 
DropdownMenu, DropdownMenuContent, 
DropdownMenuTrigger } from \"@/compo
nents/ui/dropdown-menu\"\r\nimport 
{ Input } from 
\"@/components/ui/input\"\r\nimport 
type { DateRange, FilterTab, 
PickerItem, SelectedFilter } from 
\"./types\"\r\n\r\ninterface Props 
{\r\n  selectedFilter: 
SelectedFilter\r\n  
onSelectedFilterChange: (next: 
SelectedFilter) => void\r\n\r\n  
dateRange: DateRange\r\n  
onDateRangeChange: (next: 
DateRange) => void\r\n\r\n  
members: PickerItem[]\r\n  teams: 
PickerItem[]\r\n\r\n  sidebarOpen?: 
boolean\r\n  onToggleSidebar?: () 
=> void\r\n\r\n  timezone?: 
string\r\n\r\n  children?: 
React.ReactNode\r\n\r\n  
hideAllOption?: boolean // Untuk 
menyembunyikan opsi \"All Members\" 
/ \"All Teams\"\r\n  hideTeamsTab?: 
boolean // Untuk menyembunyikan tab 
\"Teams\"\r\n  hideFilter?: boolean 
// To hide the entire filter 
dropdown\r\n}\r\n\r\nexport 
function InsightsHeader({\r\n  
selectedFilter,\r\n  
onSelectedFilterChange,\r\n  
dateRange,\r\n  
onDateRangeChange,\r\n  
members,\r\n  teams,\r\n  
sidebarOpen,\r\n  
onToggleSidebar,\r\n  timezone,\r\n 
 children,\r\n  hideAllOption = 
false,\r\n  hideTeamsTab = 
false,\r\n  hideFilter = 
false,\r\n}: Props) {\r\n  // STATE 
UNTUK KALENDER\r\n  const 
[tempStartDate, setTempStartDate] = 
useState<Date>(dateRange.startDate)\
r\n  const [tempEndDate, 
setTempEndDate] = useState<Date>(dat
eRange.endDate)\r\n  const 
[leftMonth, setLeftMonth] = 
useState<Date>(new 
Date(dateRange.startDate))\r\n  
const [rightMonth, setRightMonth] = 
useState<Date>(new Date(new Date(dat
eRange.startDate).setMonth(new Date(
dateRange.startDate).getMonth() + 
1)))\r\n  const [selectingStart, 
setSelectingStart] = 
useState(true)\r\n  const 
[filterTab, setFilterTab] = useState
<FilterTab>(\"members\")\r\n  const 
[filterSearch, setFilterSearch] = 
useState(\"\")\r\n  const 
[dateRangeOpen, setDateRangeOpen] = 
useState(false)\r\n\r\n  // Fungsi 
untuk mendeteksi preset dari 
dateRange\r\n  const detectPreset = 
(start: Date, end: Date): string | 
null => {\r\n    const now = new 
Date()\r\n    now.setHours(23, 59, 
59, 999)\r\n    const today = new 
Date(now)\r\n    today.setHours(0, 
0, 0, 0)\r\n\r\n    const startDate 
= new Date(start)\r\n    
startDate.setHours(0, 0, 0, 0)\r\n  
  const endDate = new Date(end)\r\n 
   endDate.setHours(23, 59, 59, 
999)\r\n\r\n    const startTime = 
startDate.getTime()\r\n    const 
endTime = endDate.getTime()\r\n    
const todayTime = 
today.getTime()\r\n    const 
nowTime = now.getTime()\r\n\r\n    
// Today - harus start dan end sama 
dengan today\r\n    if (startTime 
=== todayTime && endTime === 
nowTime) {\r\n      return 
\"today\"\r\n    }\r\n\r\n    // 
Yesterday\r\n    const yesterday = 
new Date(today)\r\n    yesterday.set
Date(yesterday.getDate() - 1)\r\n   
 const yesterdayEnd = new 
Date(yesterday)\r\n    
yesterdayEnd.setHours(23, 59, 59, 
999)\r\n    if (startTime === 
yesterday.getTime() && endTime === 
yesterdayEnd.getTime()) {\r\n      
return \"yesterday\"\r\n    
}\r\n\r\n    // Last 7 days\r\n    
const last7Start = new 
Date(today)\r\n    last7Start.setDat
e(last7Start.getDate() - 6)\r\n    
last7Start.setHours(0, 0, 0, 0)\r\n 
   if (startTime === 
last7Start.getTime() && endTime === 
nowTime) {\r\n      return 
\"last_7_days\"\r\n    }\r\n\r\n    
// This week\r\n    const dayOfWeek 
= now.getDay()\r\n    const diff = 
dayOfWeek === 0 ? 6 : dayOfWeek - 
1\r\n    const thisWeekStart = new 
Date(today)\r\n    thisWeekStart.set
Date(thisWeekStart.getDate() - 
diff)\r\n    
thisWeekStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
thisWeekStart.getTime() && endTime 
=== nowTime) {\r\n      return 
\"this_week\"\r\n    }\r\n\r\n    
// Last week\r\n    const 
lastWeekEnd = new Date(today)\r\n   
 lastWeekEnd.setDate(lastWeekEnd.get
Date() - lastWeekEnd.getDay())\r\n  
  lastWeekEnd.setHours(23, 59, 59, 
999)\r\n    const lastWeekStart = 
new Date(lastWeekEnd)\r\n    lastWee
kStart.setDate(lastWeekStart.getDate
() - 6)\r\n    
lastWeekStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
lastWeekStart.getTime() && endTime 
=== lastWeekEnd.getTime()) {\r\n    
  return \"last_week\"\r\n    
}\r\n\r\n    // Last 2 weeks\r\n    
const last2WeeksStart = new 
Date(today)\r\n    last2WeeksStart.s
etDate(last2WeeksStart.getDate() - 
13)\r\n    
last2WeeksStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
last2WeeksStart.getTime() && 
endTime === nowTime) {\r\n      
return \"last_2_weeks\"\r\n    
}\r\n\r\n    // This month\r\n    
const thisMonthStart = new 
Date(now.getFullYear(), 
now.getMonth(), 1)\r\n    
thisMonthStart.setHours(0, 0, 0, 
0)\r\n    if (startTime === 
thisMonthStart.getTime() && endTime 
=== nowTime) {\r\n      return 
\"this_month\"\r\n    }\r\n\r\n    
// Last month\r\n    const 
lastMonthStart = new 
Date(now.getFullYear(), 
now.getMonth() - 1, 1)\r\n    
lastMonthStart.setHours(0, 0, 0, 
0)\r\n    const lastMonthEnd = new 
Date(now.getFullYear(), 
now.getMonth(), 0)\r\n    
lastMonthEnd.setHours(23, 59, 59, 
999)\r\n    if (startTime === 
lastMonthStart.getTime() && endTime 
=== lastMonthEnd.getTime()) {\r\n   
   return \"last_month\"\r\n    
}\r\n\r\n    return null\r\n  
}\r\n\r\n  const [selectedPreset, 
setSelectedPreset] = 
useState<string | null>(() => {\r\n 
   return 
detectPreset(dateRange.startDate, 
dateRange.endDate)\r\n  })\r\n\r\n  
// STATE UNTUK FILTER MEMBER/TEAM 
(pending sebelum di-apply)\r\n  
const [filterDropdownOpen, 
setFilterDropdownOpen] = 
useState(false)\r\n  // const 
[tempFilter, setTempFilter] = useSta
te<SelectedFilter>(selectedFilter) 
// Removed tempFilter for immediate 
apply\r\n\r\n  const filterLabel = 
useMemo(() => {\r\n    if 
(selectedFilter.all) return 
selectedFilter.type === \"members\" 
? \"All Members\" : \"All 
Teams\"\r\n    const source = 
selectedFilter.type === \"members\" 
? members : teams\r\n    return 
source.find(x => x.id === 
selectedFilter.id)?.name || 
(selectedFilter.type === 
\"members\" ? \"Member\" : 
\"Team\")\r\n  }, [selectedFilter, 
members, teams])\r\n\r\n  // date 
display helper\r\n  const fmt = (d: 
Date) =>\r\n    
d.toLocaleDateString(\"en-US\", { 
weekday: \"short\", month: 
\"short\", day: \"numeric\", year: 
\"numeric\", timeZone: timezone || 
\"UTC\" })\r\n\r\n  // timezone 
offset (e.g. +07, -05, +05:30)\r\n  
const tzOffset = useMemo((): string 
=> {\r\n    if (!timezone) return 
\"\"\r\n    try {\r\n      const 
now = new Date()\r\n      const 
parts = new 
Intl.DateTimeFormat(\"en-US\", { 
timeZone: timezone, timeZoneName: 
\"short\" }).formatToParts(now)\r\n 
     const name = parts.find(p => 
p.type === \"timeZoneName\")?.value 
?? \"\"\r\n      const m = name.matc
h(/GMT([+-]\\d{1,2})(?::(\\d{2}))?/)
\r\n      if (m) {\r\n        const 
raw = m[1] ?? \"\"\r\n        const 
sign = raw.startsWith(\"-\") ? 
\"-\" : \"+\"\r\n        let hours 
= raw.replace(/[+-]/, \"\")\r\n     
   if (hours.length === 0) hours = 
\"00\"\r\n        else if 
(hours.length === 1) hours = 
`0${hours}`\r\n        const 
minutes = m[2] ?? \"00\"\r\n        
return minutes !== \"00\" ? 
`${sign}${hours}:${minutes}` : 
`${sign}${hours}`\r\n      }\r\n    
} catch { }\r\n    return \"\"\r\n  
}, [timezone])\r\n\r\n  // Deteksi 
preset saat dateRange berubah\r\n  
useEffect(() => {\r\n    const 
detectedPreset = 
detectPreset(dateRange.startDate, 
dateRange.endDate)\r\n    setSelecte
dPreset(detectedPreset)\r\n    // 
eslint-disable-next-line 
react-hooks/exhaustive-deps\r\n  }, 
[dateRange.startDate.getTime(), date
Range.endDate.getTime()])\r\n\r\n  
useEffect(() => {\r\n    if 
(dateRangeOpen) {\r\n      setTempSt
artDate(dateRange.startDate)\r\n    
  setTempEndDate(dateRange.endDate)\
r\n      // pastikan pasangan bulan 
berdampingan\r\n      const lm = 
new Date(dateRange.startDate)\r\n   
   const rm = new Date(lm)\r\n      
rm.setMonth(rm.getMonth() + 1)\r\n  
    setLeftMonth(lm)\r\n      
setRightMonth(rm)\r\n      
setSelectingStart(true)\r\n      // 
Deteksi preset saat modal 
dibuka\r\n      const 
detectedPreset = 
detectPreset(dateRange.startDate, 
dateRange.endDate)\r\n      setSelec
tedPreset(detectedPreset)\r\n    
}\r\n  }, [dateRangeOpen, 
dateRange])\r\n\r\n  // Sync 
tempFilter when dropdown opens 
(Removed logic as we auto-apply 
now)\r\n  useEffect(() => {\r\n    
if (filterDropdownOpen) {\r\n      
// 
setTempFilter(selectedFilter)\r\n   
   // Jika hideTeamsTab true, paksa 
ke \"members\"\r\n      
setFilterTab(hideTeamsTab ? 
\"members\" : 
selectedFilter.type)\r\n      
setFilterSearch(\"\")\r\n    }\r\n  
}, [filterDropdownOpen, 
selectedFilter, 
hideTeamsTab])\r\n\r\n  const 
generateCalendarDays = (month: 
Date) => {\r\n    const year = 
month.getFullYear()\r\n    const 
monthIndex = month.getMonth()\r\n   
 const firstDay = new Date(year, 
monthIndex, 1)\r\n    const lastDay 
= new Date(year, monthIndex + 1, 
0)\r\n    let startDay = 
firstDay.getDay() - 1\r\n    if 
(startDay < 0) startDay = 6\r\n    
const days: { day: number; 
isCurrentMonth: boolean }[] = 
[]\r\n    const prevMonthLastDay = 
new Date(year, monthIndex, 
0).getDate()\r\n    for (let i = 
startDay - 1; i >= 0; i--) 
days.push({ day: prevMonthLastDay - 
i, isCurrentMonth: false })\r\n    
for (let i = 1; i <= 
lastDay.getDate(); i++) days.push({ 
day: i, isCurrentMonth: true })\r\n 
   const remaining = 42 - 
days.length\r\n    for (let i = 1; 
i <= remaining; i++) days.push({ 
day: i, isCurrentMonth: false 
})\r\n    return days\r\n  
}\r\n\r\n  const handleDateClick = 
(day: number, month: Date, 
isCurrentMonth: boolean) => {\r\n   
 if (!isCurrentMonth) return\r\n    
const selectedDate = new 
Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
selectedDate.setHours(0, 0, 0, 
0)\r\n    if (selectingStart) {\r\n 
     // Klik pertama - reset 
preset\r\n      
setSelectedPreset(null)\r\n      
setTempStartDate(selectedDate)\r\n  
    
setTempEndDate(selectedDate)\r\n    
  setSelectingStart(false)\r\n    } 
else {\r\n      // Klik kedua - 
selesaikan range dan deteksi 
preset\r\n      let newStart = 
tempStartDate\r\n      let newEnd = 
selectedDate\r\n      if 
(selectedDate < tempStartDate) 
{\r\n        newStart = 
selectedDate\r\n        newEnd = 
tempStartDate\r\n        
setTempStartDate(selectedDate)\r\n  
      
setTempEndDate(tempStartDate)\r\n   
   } else {\r\n        
setTempEndDate(selectedDate)\r\n    
  }\r\n      
setSelectingStart(true)\r\n      // 
Deteksi preset setelah range 
selesai dipilih\r\n      const 
detectedPreset = 
detectPreset(newStart, newEnd)\r\n  
    setSelectedPreset(detectedPreset
)\r\n    }\r\n  }\r\n\r\n  const 
isDateInRange = (day: number, 
month: Date) => {\r\n    const date 
= new Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
date.setHours(0, 0, 0, 0)\r\n    
const start = new 
Date(tempStartDate); 
start.setHours(0, 0, 0, 0)\r\n    
const end = new Date(tempEndDate); 
end.setHours(0, 0, 0, 0)\r\n    
return date >= start && date <= 
end\r\n  }\r\n\r\n  const 
isStartOrEndDate = (day: number, 
month: Date) => {\r\n    const date 
= new Date(month.getFullYear(), 
month.getMonth(), day)\r\n    
date.setHours(0, 0, 0, 0)\r\n    
const start = new 
Date(tempStartDate); 
start.setHours(0, 0, 0, 0)\r\n    
const end = new Date(tempEndDate); 
end.setHours(0, 0, 0, 0)\r\n    
return date.getTime() === 
start.getTime() || date.getTime() 
=== end.getTime()\r\n  }\r\n\r\n  
// Navigasi bulan kiri/kanan (jaga 
bersebelahan)\r\n  const 
moveLeftMonth = (delta: number) => 
{\r\n    const lm = new 
Date(leftMonth)\r\n    
lm.setMonth(lm.getMonth() + 
delta)\r\n    const rm = new 
Date(lm); rm.setMonth(rm.getMonth() 
+ 1)\r\n    setLeftMonth(lm); 
setRightMonth(rm)\r\n  }\r\n  const 
moveRightMonth = (delta: number) => 
{\r\n    const rm = new 
Date(rightMonth)\r\n    
rm.setMonth(rm.getMonth() + 
delta)\r\n    const lm = new 
Date(rm); lm.setMonth(lm.getMonth() 
- 1)\r\n    setLeftMonth(lm); 
setRightMonth(rm)\r\n  }\r\n\r\n  
const applyDateRange = () => {\r\n  
  // Deteksi preset sebelum 
apply\r\n    const detectedPreset = 
detectPreset(tempStartDate, 
tempEndDate)\r\n    setSelectedPrese
t(detectedPreset)\r\n    
onDateRangeChange({ startDate: 
tempStartDate, endDate: tempEndDate 
})\r\n    
setDateRangeOpen(false)\r\n  }\r\n  
const cancelDateRange = () => {\r\n 
   setTempStartDate(dateRange.startD
ate)\r\n    setTempEndDate(dateRange
.endDate)\r\n    
setDateRangeOpen(false)\r\n  
}\r\n\r\n  // Helper to auto apply 
filter\r\n  const 
handleFilterSelect = (filter: 
SelectedFilter) => {\r\n    
onSelectedFilterChange(filter)\r\n  
  setFilterDropdownOpen(false)\r\n  
}\r\n\r\n  // Removed manual 
applyFilter and cancelFilter 
functions\r\n\r\n  // presets 
(mengikuti pola highlights: update 
temp state + highlight, commit saat 
Apply)\r\n  const applyPreset = 
(preset: string) => {\r\n    
setSelectedPreset(preset)\r\n    
const now = new Date()\r\n    let 
start = new Date()\r\n    let end = 
new Date()\r\n\r\n    switch 
(preset) {\r\n      case \"today\": 
{\r\n        start = new 
Date(now)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"yesterday\": {\r\n        start = 
new Date(now)\r\n        
start.setDate(start.getDate() - 
1)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(start)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"this_week\": {\r\n        const 
dayOfWeek = now.getDay()\r\n        
const diff = dayOfWeek === 0 ? 6 : 
dayOfWeek - 1 // Senin awal 
minggu\r\n        start = new 
Date(now)\r\n        
start.setDate(start.getDate() - 
diff)\r\n        start.setHours(0, 
0, 0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_7_days\": {\r\n        start 
= new Date(now)\r\n        
start.setDate(start.getDate() - 
6)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_week\": {\r\n        const 
lastWeekEnd = new Date(now)\r\n     
   lastWeekEnd.setDate(lastWeekEnd.g
etDate() - 
lastWeekEnd.getDay())\r\n        
lastWeekEnd.setHours(23, 59, 59, 
999)\r\n        const lastWeekStart 
= new Date(lastWeekEnd)\r\n        l
astWeekStart.setDate(lastWeekStart.g
etDate() - 6)\r\n        
lastWeekStart.setHours(0, 0, 0, 
0)\r\n        start = 
lastWeekStart\r\n        end = 
lastWeekEnd\r\n        break\r\n    
  }\r\n      case \"last_2_weeks\": 
{\r\n        start = new 
Date(now)\r\n        
start.setDate(start.getDate() - 
13)\r\n        start.setHours(0, 0, 
0, 0)\r\n        end = new 
Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"this_month\": {\r\n        start 
= new Date(now.getFullYear(), 
now.getMonth(), 1)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n      case 
\"last_month\": {\r\n        start 
= new Date(now.getFullYear(), 
now.getMonth() - 1, 1)\r\n        
start.setHours(0, 0, 0, 0)\r\n      
  end = new Date(now.getFullYear(), 
now.getMonth(), 0)\r\n        
end.setHours(23, 59, 59, 999)\r\n   
     break\r\n      }\r\n    
}\r\n\r\n    // Update tanggal 
sementara untuk display\r\n    
setTempStartDate(start)\r\n    
setTempEndDate(end)\r\n\r\n    // 
Deteksi preset dan apply 
IMMEDIATELY\r\n    // const 
detectedPreset = 
detectPreset(start, end)\r\n    // s
etSelectedPreset(detectedPreset)\r\n
    // onDateRangeChange({ 
startDate: start, endDate: end 
})\r\n    // 
setDateRangeOpen(false)\r\n\r\n    
// IMPORTANT: Wait for state update 
or just call parent directly\r\n    
onDateRangeChange({ startDate: 
start, endDate: end })\r\n    
setDateRangeOpen(false)\r\n\r\n    
// We also need to update calendar 
view states just in case\r\n    
const lm = new Date(start)\r\n    
const rm = new Date(lm); 
rm.setMonth(rm.getMonth() + 1)\r\n  
  setLeftMonth(lm)\r\n    
setRightMonth(rm)\r\n    
setSelectingStart(true)\r\n  
}\r\n\r\n  // Jika hideTeamsTab 
true, paksa filterTab ke 
\"members\"\r\n  const 
effectiveFilterTab = hideTeamsTab ? 
\"members\" : filterTab\r\n  const 
source = effectiveFilterTab === 
\"members\" ? members : teams\r\n  
const filtered = source.filter(it 
=> it.name.toLowerCase().includes(fi
lterSearch.toLowerCase()))\r\n\r\n  
return (\r\n    <div 
className=\"flex flex-col 
sm:flex-row items-start 
sm:items-center justify-between 
w-full gap-4\">\r\n      <div 
className=\"flex flex-wrap 
items-center gap-3 w-full 
sm:w-auto\">\r\n        {/* 
Members/Teams filter */}\r\n        
{!hideFilter && (\r\n          
<DropdownMenu 
open={filterDropdownOpen} onOpenChan
ge={setFilterDropdownOpen}>\r\n     
       <DropdownMenuTrigger 
asChild>\r\n              <button 
className=\"px-4 py-2 border 
border-gray-300 
dark:border-gray-700 rounded-md 
text-sm bg-white dark:bg-gray-950 
hover:bg-gray-50 
dark:hover:bg-gray-900 
min-w-[150px] w-full sm:w-auto 
text-left text-gray-800 
dark:text-gray-200 flex 
items-center justify-between\">\r\n 
               {filterLabel}\r\n    
            <ChevronDown 
className=\"w-4 h-4 opacity-50 
ml-2\" />\r\n              
</button>\r\n            
</DropdownMenuTrigger>\r\n          
  <DropdownMenuContent 
align=\"start\" className=\"w-80 
p-3 dark:bg-gray-950 
dark:border-gray-800\">\r\n         
     {!hideTeamsTab && (\r\n        
        <div className=\"flex 
items-center gap-2 mb-3\">\r\n      
            <button\r\n             
       className={`px-3 py-1 
rounded-full text-sm border 
${filterTab === \"members\" ? 
\"bg-gray-100 dark:bg-gray-700 
border-black dark:border-gray-400 
text-black dark:text-white\" : 
\"bg-white dark:bg-gray-900 
border-gray-300 
dark:border-gray-700 text-gray-700 
dark:text-gray-300\"}`}\r\n         
           onClick={() => { 
setFilterTab(\"members\"); 
setFilterSearch(\"\") }}\r\n        
          >Members</button>\r\n\r\n 
                 <button\r\n        
            className={`px-3 py-1 
rounded-full text-sm border 
${filterTab === \"teams\" ? 
\"bg-gray-100 dark:bg-gray-700 
border-black dark:border-gray-400 
text-black dark:text-white\" : 
\"bg-white dark:bg-gray-900 
border-gray-300 
dark:border-gray-700 text-gray-700 
dark:text-gray-300\"}`}\r\n         
           onClick={() => { 
setFilterTab(\"teams\"); 
setFilterSearch(\"\") }}\r\n        
          >Teams</button>\r\n       
         </div>\r\n              
)}\r\n\r\n              <div 
className=\"mb-3 relative\">\r\n    
            <Search 
className=\"absolute left-2 top-1/2 
-translate-y-1/2 w-4 h-4 
text-gray-400\" />\r\n              
  <Input\r\n                  
placeholder=\"Search items\"\r\n    
              
value={filterSearch}\r\n            
      onChange={(e) => setFilterSear
ch(e.target.value)}\r\n             
     className=\"ps-8 pl-8 pe-8 
pr-8\"\r\n                />\r\n    
            {filterSearch && (\r\n  
                <button\r\n         
           className=\"absolute 
right-2 top-1/2 -translate-y-1/2 
text-gray-600\"\r\n                 
   onClick={() => 
setFilterSearch(\"\")}\r\n          
          aria-label=\"Clear\"\r\n  
                >├ù</button>\r\n    
            )}\r\n              
</div>\r\n\r\n              
{!hideAllOption && (\r\n            
    <div className=\"mb-2 pb-2 
border-b border-gray-200 
dark:border-gray-800\">\r\n         
         <button\r\n                
    className={`w-full flex 
items-center gap-2 px-2 py-2 
rounded text-sm 
${selectedFilter.all && 
selectedFilter.type === 
effectiveFilterTab ? \"bg-gray-100 
dark:bg-gray-800 text-black 
dark:text-white\" : 
\"hover:bg-gray-50 
dark:hover:bg-gray-800 
text-gray-700 
dark:text-gray-300\"}`}\r\n         
           onClick={() => 
handleFilterSelect({ type: 
effectiveFilterTab, all: true 
})}\r\n                  >\r\n      
              <span 
className={`inline-block w-2 h-2 
rounded-full border 
${selectedFilter.all && 
selectedFilter.type === 
effectiveFilterTab ? \"bg-black 
border-black\" : 
\"border-gray-400\"}`} />\r\n       
             All 
{effectiveFilterTab === \"members\" 
? \"Members\" : \"Teams\"}\r\n      
            </button>\r\n           
     </div>\r\n              
)}\r\n\r\n              <div 
className=\"max-h-64 
overflow-auto\">\r\n                
{filtered.map(it => {\r\n           
       const isActive = 
!selectedFilter.all && 
selectedFilter.type === 
effectiveFilterTab && 
selectedFilter.id === it.id\r\n     
             return (\r\n           
         <button\r\n                
      key={it.id}\r\n               
       className={`w-full flex 
items-center gap-2 px-2 py-2 
rounded text-sm ${isActive ? 
\"bg-gray-100 dark:bg-gray-800 
text-black dark:text-white\" : 
\"hover:bg-gray-50 
dark:hover:bg-gray-800 
text-gray-700 
dark:text-gray-300\"}`}\r\n         
             onClick={() => 
handleFilterSelect({ type: 
effectiveFilterTab, all: false, id: 
it.id })}\r\n                    
>\r\n                      <span 
className={`inline-block w-2 h-2 
rounded-full border ${isActive ? 
\"bg-black border-black\" : 
\"border-gray-400\"}`} />\r\n       
               {it.name}\r\n        
            </button>\r\n           
       )\r\n                })}\r\n 
             </div>\r\n\r\n         
     {/* Apply/Cancel Buttons 
removed for Auto-Apply */}\r\n      
        {/* <div className=\"flex 
items-center gap-2 mt-4 pt-4 
border-t border-gray-200\">\r\n     
         <button className=\"px-4 
py-2 bg-black text-white rounded 
hover:bg-gray-800 font-medium\" 
onClick={applyFilter}>\r\n          
      Apply\r\n              
</button>\r\n              <button 
className=\"px-4 py-2 border 
border-gray-300 rounded 
hover:bg-gray-50\" 
onClick={cancelFilter}>\r\n         
       Cancel\r\n              
</button>\r\n            </div> 
*/}\r\n            
</DropdownMenuContent>\r\n          
</DropdownMenu>\r\n        )}\r\n   
     {/* Date range */}\r\n        
<DropdownMenu open={dateRangeOpen} o
nOpenChange={setDateRangeOpen}>\r\n 
         <DropdownMenuTrigger 
asChild>\r\n            <button 
className=\"px-4 py-2 border 
border-gray-300 
dark:border-gray-700 rounded-md 
text-sm bg-white dark:bg-gray-950 
hover:bg-gray-50 
dark:hover:bg-gray-900 flex 
items-center gap-2 text-gray-800 
dark:text-gray-200 w-full sm:w-auto 
justify-between 
sm:justify-start\">\r\n             
 <div className=\"flex items-center 
gap-2\">\r\n                <svg 
className=\"w-4 h-4\" fill=\"none\" 
viewBox=\"0 0 24 24\" 
stroke=\"currentColor\">\r\n        
          <rect x=\"3\" y=\"4\" 
width=\"18\" height=\"18\" rx=\"2\" 
ry=\"2\" />\r\n                  
<line x1=\"16\" y1=\"2\" x2=\"16\" 
y2=\"6\" />\r\n                  
<line x1=\"8\" y1=\"2\" x2=\"8\" 
y2=\"6\" />\r\n                  
<line x1=\"3\" y1=\"10\" x2=\"21\" 
y2=\"10\" />\r\n                
</svg>\r\n                
<span>{fmt(dateRange.startDate)} - 
{fmt(dateRange.endDate)}</span>\r\n 
             </div>\r\n             
 <ChevronDown className=\"w-4 h-4 
opacity-50 sm:hidden\" />\r\n       
     </button>\r\n          
</DropdownMenuTrigger>\r\n          
<DropdownMenuContent 
align=\"start\" 
className=\"w-[calc(100vw-2rem)] 
sm:w-auto p-0 dark:bg-gray-950 
dark:border-gray-800 
overflow-hidden\">\r\n            
<div className=\"flex flex-col 
sm:flex-row max-h-[80vh] 
overflow-y-auto 
sm:max-h-none\">\r\n              
<div className=\"w-40 border-r 
border-gray-200 
dark:border-gray-800 p-3 
space-y-1\">\r\n                
<button\r\n                  
className={`w-full text-left px-3 
py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'today' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"today\")}\r\n         
       >Today</button>\r\n          
      <button\r\n                  
className={`w-full text-left px-3 
py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'yesterday' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"yesterday\")}\r\n     
           >Yesterday</button>\r\n  
              <button\r\n           
       className={`w-full text-left 
px-3 py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'this_week' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"this_week\")}\r\n     
           >This week</button>\r\n  
              <button\r\n           
       className={`w-full text-left 
px-3 py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'last_7_days' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"last_7_days\")}\r\n   
             >Last 7 
days</button>\r\n                
<button\r\n                  
className={`w-full text-left px-3 
py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'last_week' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"last_week\")}\r\n     
           >Last week</button>\r\n  
              <button\r\n           
       className={`w-full text-left 
px-3 py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'last_2_weeks' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"last_2_weeks\")}\r\n  
              >Last 2 
weeks</button>\r\n                
<button\r\n                  
className={`w-full text-left px-3 
py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'this_month' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"this_month\")}\r\n    
            >This 
month</button>\r\n                
<button\r\n                  
className={`w-full text-left px-3 
py-2 text-sm rounded 
dark:text-gray-200 ${selectedPreset 
=== 'last_month' ? 'bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200' : 
'hover:bg-gray-100 
dark:hover:bg-gray-800'}`}\r\n      
            onClick={() => 
applyPreset(\"last_month\")}\r\n    
            >Last 
month</button>\r\n              
</div>\r\n              {/* Right 
Calendar */}\r\n              <div 
className=\"p-2 sm:p-4\">\r\n       
         {timezone && (\r\n         
         <div className=\"flex 
justify-end mb-2\">\r\n             
       <span className=\"text-xs 
text-gray-500\">\r\n                
      {timezone}{tzOffset ? ` 
(${tzOffset})` : \"\"}\r\n          
          </span>\r\n               
   </div>\r\n                )}\r\n 
               <div 
className=\"flex flex-col 
md:flex-row gap-4\">\r\n            
      {/* Left Month */}\r\n        
          <div className=\"w-full 
sm:w-64\">\r\n                    
<div className=\"flex items-center 
justify-between mb-4\">\r\n         
             <button 
className=\"p-1 hover:bg-gray-100 
dark:hover:bg-gray-800 rounded\" 
onClick={() => 
moveLeftMonth(-1)}>\r\n             
           <svg className=\"w-4 
h-4\" fill=\"none\" viewBox=\"0 0 
24 24\" 
stroke=\"currentColor\">\r\n        
                  <polyline 
points=\"15 18 9 12 15 6\" />\r\n   
                     </svg>\r\n     
                 </button>\r\n      
                <span 
className=\"font-semibold 
text-gray-900 
dark:text-gray-100\">\r\n           
             {leftMonth.toLocaleDate
String(\"en-US\", { month: 
\"short\", year: \"numeric\" 
})}\r\n                      
</span>\r\n                      
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded\" 
onClick={() => 
moveLeftMonth(1)}>\r\n              
          <svg className=\"w-4 
h-4\" fill=\"none\" viewBox=\"0 0 
24 24\" 
stroke=\"currentColor\">\r\n        
                  <polyline 
points=\"9 18 15 12 9 6\" />\r\n    
                    </svg>\r\n      
                </button>\r\n       
             </div>\r\n\r\n         
           <div className=\"grid 
grid-cols-7 gap-1 text-center 
text-xs mb-2\">\r\n                 
     <div className=\"font-semibold 
p-1 text-gray-900 
dark:text-gray-100\">Mo</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Tu</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">We</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Th</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Fr</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Sa</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Su</div>\r\n   
                 </div>\r\n\r\n     
               <div 
className=\"grid grid-cols-7 gap-1 
text-center text-sm\">\r\n          
            {generateCalendarDays(le
ftMonth).map((d, i) => {\r\n        
                const inRange = 
d.isCurrentMonth && 
isDateInRange(d.day, leftMonth)\r\n 
                       const isEdge 
= d.isCurrentMonth && 
isStartOrEndDate(d.day, 
leftMonth)\r\n                      
  return (\r\n                      
    <button\r\n                     
       key={i}\r\n                  
          onClick={() => 
handleDateClick(d.day, leftMonth, 
d.isCurrentMonth)}\r\n              
              className={`p-2 
rounded ${isEdge ? \"bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200\" :\r\n      
                        inRange ? 
\"bg-gray-100 dark:bg-gray-800 
hover:bg-gray-200 
dark:hover:bg-gray-700 text-black 
dark:text-white\" :\r\n             
                   d.isCurrentMonth 
? \"text-gray-800 
dark:text-gray-200 
hover:bg-gray-100 
dark:hover:bg-gray-800\" : 
\"text-gray-400 
dark:text-gray-600\"}`}\r\n         
                 >\r\n              
              {d.day}\r\n           
               </button>\r\n        
                )\r\n               
       })}\r\n                    
</div>\r\n                  
</div>\r\n\r\n                  {/* 
Right Month - Hidden on mobile, 
visible on medium screens+ */}\r\n  
                <div 
className=\"w-64 hidden 
md:block\">\r\n                    
<div className=\"flex items-center 
justify-between mb-4\">\r\n         
             <button 
className=\"p-1 hover:bg-gray-100 
dark:hover:bg-gray-800 rounded\" 
onClick={() => 
moveRightMonth(-1)}>\r\n            
            <svg className=\"w-4 
h-4\" fill=\"none\" viewBox=\"0 0 
24 24\" 
stroke=\"currentColor\">\r\n        
                  <polyline 
points=\"15 18 9 12 15 6\" />\r\n   
                     </svg>\r\n     
                 </button>\r\n      
                <span 
className=\"font-semibold 
text-gray-900 
dark:text-gray-100\">\r\n           
             {rightMonth.toLocaleDat
eString(\"en-US\", { month: 
\"short\", year: \"numeric\" 
})}\r\n                      
</span>\r\n                      
<button className=\"p-1 
hover:bg-gray-100 
dark:hover:bg-gray-800 rounded\" 
onClick={() => 
moveRightMonth(1)}>\r\n             
           <svg className=\"w-4 
h-4\" fill=\"none\" viewBox=\"0 0 
24 24\" 
stroke=\"currentColor\">\r\n        
                  <polyline 
points=\"9 18 15 12 9 6\" />\r\n    
                    </svg>\r\n      
                </button>\r\n       
             </div>\r\n\r\n         
           <div className=\"grid 
grid-cols-7 gap-1 text-center 
text-xs mb-2\">\r\n                 
     <div className=\"font-semibold 
p-1 text-gray-900 
dark:text-gray-100\">Mo</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Tu</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">We</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Th</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Fr</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Sa</div>\r\n   
                   <div 
className=\"font-semibold p-1 
text-gray-900 
dark:text-gray-100\">Su</div>\r\n   
                 </div>\r\n\r\n     
               <div 
className=\"grid grid-cols-7 gap-1 
text-center text-sm\">\r\n          
            {generateCalendarDays(ri
ghtMonth).map((d, i) => {\r\n       
                 const inRange = 
d.isCurrentMonth && 
isDateInRange(d.day, 
rightMonth)\r\n                     
   const isEdge = d.isCurrentMonth 
&& isStartOrEndDate(d.day, 
rightMonth)\r\n                     
   return (\r\n                     
     <button\r\n                    
        key={i}\r\n                 
           onClick={() => 
handleDateClick(d.day, rightMonth, 
d.isCurrentMonth)}\r\n              
              className={`p-2 
rounded ${isEdge ? \"bg-black 
dark:bg-white text-white 
dark:text-black hover:bg-gray-800 
dark:hover:bg-gray-200\" :\r\n      
                        inRange ? 
\"bg-gray-100 dark:bg-gray-800 
hover:bg-gray-200 
dark:hover:bg-gray-700 text-black 
dark:text-white\" :\r\n             
                   d.isCurrentMonth 
? \"text-gray-800 
dark:text-gray-200 
hover:bg-gray-100 
dark:hover:bg-gray-800\" : 
\"text-gray-400 
dark:text-gray-600\"}`}\r\n         
                 >\r\n              
              {d.day}\r\n           
               </button>\r\n        
                )\r\n               
       })}\r\n                    
</div>\r\n                  
</div>\r\n                
</div>\r\n\r\n                {/* 
Footer tanggal terpilih + aksi 
*/}\r\n                <div 
className=\"text-xs text-center 
text-gray-600 dark:text-gray-400 
mt-2\">\r\n                  
{fmt(tempStartDate)} - 
{fmt(tempEndDate)}\r\n              
  </div>\r\n                <div 
className=\"flex items-center gap-2 
mt-4 pt-4 border-t border-gray-200 
dark:border-gray-800\">\r\n         
         <button className=\"px-4 
py-2 bg-black dark:bg-white 
text-white dark:text-black rounded 
hover:bg-gray-800 
dark:hover:bg-gray-200 
font-medium\" 
onClick={applyDateRange}>\r\n       
             Apply\r\n              
    </button>\r\n                  
<button className=\"px-4 py-2 
border border-gray-300 
dark:border-gray-700 rounded 
hover:bg-gray-50 
dark:hover:bg-gray-800 
dark:text-gray-300\" 
onClick={cancelDateRange}>\r\n      
              Cancel\r\n            
      </button>\r\n                
</div>\r\n              </div>\r\n  
          </div>\r\n          
</DropdownMenuContent>\r\n        
</DropdownMenu>\r\n\r\n        {/* 
Timezone label opsional */}\r\n     
   {timezone && (\r\n          <div 
className=\"flex justify-end 
mb-2\">\r\n            <span 
className=\"text-xs 
text-gray-600\">\r\n              
{timezone}{tzOffset ? ` 
(${tzOffset})` : \"\"}\r\n          
  </span>\r\n          </div>\r\n   
     )}\r\n      </div>\r\n\r\n     
 {/* Right cluster (ikon dsb) 
*/}\r\n      <div className=\"flex 
items-center gap-2\">\r\n        
{children}\r\n        
{onToggleSidebar && (\r\n          
<button\r\n            
className=\"p-2 hover:bg-gray-100 
dark:hover:bg-gray-800 
rounded\"\r\n            
onClick={onToggleSidebar}\r\n       
     aria-expanded={typeof 
sidebarOpen === \"boolean\" ? 
sidebarOpen : undefined}\r\n        
    aria-label={sidebarOpen ? 
\"Hide sidebar\" : \"Show 
sidebar\"}\r\n            
title={sidebarOpen ? \"Hide 
sidebar\" : \"Show sidebar\"}\r\n   
       >\r\n            <Menu 
className=\"w-5 h-5 text-gray-600\" 
/>\r\n          </button>\r\n       
 )}\r\n      </div>\r\n    
</div>\r\n  )\r\n}","usedDeprecatedR
ules":[]},{"filePath":"D:\\UBIG\\Pro
jek\\Presensi-New\\src\\components\\
organization\\ApplicationsClient.tsx
","messages":[{"ruleId":null,"messag
e":"Unused eslint-disable directive 
(no problems were reported from '@ne
xt/next/no-img-element').","line":40
8,"column":15,"severity":1,"nodeType
":null,"fix":{"range":[14721,14774],
"text":" "}},{"ruleId":null,"message
":"Unused eslint-disable directive 
(no problems were reported from '@ne
xt/next/no-img-element').","line":58
7,"column":22,"severity":1,"nodeType
":null,"fix":{"range":[21440,21496],
"text":" "}}],"suppressedMessages":[
],"errorCount":0,"fatalErrorCount":0
,"warningCount":2,"fixableErrorCount
":0,"fixableWarningCount":2,"source"
:"\"use client\"\r\n\r\n/**\r\n * ap
p/applications/applications-client.t
sx\r\n *\r\n */\r\n\r\nimport 
React, { useState, useCallback, 
useTransition, useId } from 
\"react\"\r\nimport { Input } from 
\"@/components/ui/input\"\r\nimport 
{ Button } from \"@/components/ui/bu
tton\"\r\nimport {\r\n  Search,\r\n 
 ExternalLink,\r\n  
CheckCircle2,\r\n  XCircle,\r\n  
Loader2,\r\n  AlertCircle,\r\n  
Unplug,\r\n  Plug,\r\n  
MoreHorizontal,\r\n  Calendar,\r\n} 
from \"lucide-react\"\r\nimport { 
cn } from \"@/lib/utils\"\r\nimport 
type { Application, 
ApplicationSection, 
ApplicationStatus } from \"@/types/a
pplication.ts\"\r\nimport {\r\n  
Table,\r\n  TableBody,\r\n  
TableCell,\r\n  TableHead,\r\n  
TableHeader,\r\n  TableRow,\r\n} 
from 
\"@/components/ui/table\"\r\nimport 
{\r\n  DropdownMenu,\r\n  
DropdownMenuContent,\r\n  
DropdownMenuItem,\r\n  
DropdownMenuTrigger,\r\n} from \"@/c
omponents/ui/dropdown-menu\"\r\n\r\n
// ---------------------------------
------------------------------------
------\r\n// Props\r\n// -----------
------------------------------------
----------------------------\r\ninte
rface ApplicationsClientProps {\r\n 
 initialSections: 
ApplicationSection[]\r\n}\r\n\r\n// 
------------------------------------
------------------------------------
---\r\n// Main client 
component\r\n// --------------------
------------------------------------
-------------------\r\nexport 
default function 
ApplicationsClient({ 
initialSections }: 
ApplicationsClientProps) {\r\n  
const searchId = useId()\r\n  const 
[searchTerm, setSearchTerm] = 
useState(\"\")\r\n  const 
[loadingState, setLoadingState] = 
useState<{ provider: string; 
message: string } | null>(null)\r\n 
 const [sections, setSections] = use
State<ApplicationSection[]>(initialS
ections)\r\n  const [, 
startTransition] = 
useTransition()\r\n\r\n  // --------
------------------------------------
-------------------------------\r\n 
 // Derived state ΓÇö filter 
without mutating sections\r\n  // --
------------------------------------
------------------------------------
-\r\n  const filteredSections = 
React.useMemo(() => {\r\n    const 
term = 
searchTerm.trim().toLowerCase()\r\n 
   if (!term) return 
sections\r\n\r\n    return 
sections\r\n      .map((section) => 
({\r\n        ...section,\r\n       
 items: section.items.filter(\r\n   
       (item) =>\r\n            item
.name.toLowerCase().includes(term) 
||\r\n            item.description.t
oLowerCase().includes(term) ||\r\n  
          item.category.toLowerCase(
).includes(term)\r\n        ),\r\n  
    }))\r\n      .filter((section) 
=> section.items.length > 0)\r\n  
}, [searchTerm, sections])\r\n\r\n  
// Split filtered sections into 
Active (Flat list) and Available 
(Grouped sections)\r\n  const 
activeApplications = 
React.useMemo(() => {\r\n    return 
filteredSections.flatMap((s) => 
s.items).filter((i) => 
i.connected)\r\n  }, 
[filteredSections])\r\n\r\n  const 
availableSections = 
React.useMemo(() => {\r\n    return 
filteredSections\r\n      .map((s) 
=> ({\r\n        ...s,\r\n        
items: s.items.filter((i) => 
!i.connected),\r\n      }))\r\n     
 .filter((s) => s.items.length > 
0)\r\n  }, 
[filteredSections])\r\n\r\n  // ----
------------------------------------
-----------------------------------\
r\n  // Per-card status updater ΓÇö 
immutable, returns new sections 
array\r\n  // ----------------------
------------------------------------
-----------------\r\n  const 
updateItemStatus = useCallback(\r\n 
   (\r\n      id: string,\r\n      
patch: Partial<Pick<Application, 
\"connected\" | \"status\" | 
\"errorMessage\">>\r\n    ) => 
{\r\n      setSections((prev) 
=>\r\n        prev.map((section) => 
({\r\n          ...section,\r\n     
     items: 
section.items.map((item) =>\r\n     
       item.id === id ? { ...item, 
...patch } : item\r\n          
),\r\n        }))\r\n      )\r\n    
},\r\n    []\r\n  )\r\n\r\n  // ----
------------------------------------
-----------------------------------\
r\n  // Connect / Disconnect 
handler\r\n  //\r\n  // Design 
decisions:\r\n  //  1. Sets 
`status` to 
\"connecting\"/\"disconnecting\" 
immediately (optimistic UX).\r\n  
//  2. Calls the REST API ΓÇö 
matches routes from README.md.\r\n  
//  3. On success, flips 
`connected` and resets `status` to 
\"idle\".\r\n  //  4. On failure, 
sets `status` to \"error\" with a 
message; does NOT flip state.\r\n  
//  5. The in-flight status on each 
card acts as a per-item mutex ΓÇö 
the button\r\n  //     is disabled 
while the request is pending, 
preventing duplicate requests.\r\n  
// ---------------------------------
------------------------------------
------\r\n  const handleToggle = 
useCallback(\r\n    async (item: 
Application) => {\r\n      // 
Guard: if already processing, do 
nothing (prevents race 
conditions)\r\n      if 
(item.status === \"connecting\" || 
item.status === \"disconnecting\") 
return\r\n\r\n      const 
nextStatus: ApplicationStatus = 
item.connected\r\n        ? 
\"disconnecting\"\r\n        : 
\"connecting\"\r\n\r\n      // 
Immediate feedback ΓÇö card shows 
spinner\r\n      
updateItemStatus(item.id, { status: 
nextStatus, errorMessage: undefined 
})\r\n\r\n      try {\r\n        
let res: Response\r\n\r\n        if 
(item.connected) {\r\n          // Γ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü\
r\n          // DISCONNECT FLOW\r\n 
         // ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöü\r\n          res = 
await fetch(`/api/applications/${ite
m.id}`, {\r\n            method: 
\"DELETE\",\r\n          })\r\n\r\n 
         const data = await 
res.json().catch(() => 
({}))\r\n\r\n          if (!res.ok) 
{\r\n            throw new 
Error(data?.error || data?.message 
|| `Disconnect failed 
(${res.status})`)\r\n          
}\r\n\r\n          // Disconnect 
successful - update UI 
immediately\r\n          
startTransition(() => {\r\n         
   updateItemStatus(item.id, {\r\n  
            connected: false,\r\n   
           status: \"idle\",\r\n    
          errorMessage: 
undefined,\r\n            })\r\n    
      })\r\n\r\n          
console.log('[applications-ui] 
Disconnect successful:', 
item.id)\r\n\r\n        } else 
{\r\n          // ΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü
ΓöüΓöüΓöüΓöüΓöüΓöü\r\n          // 
CONNECT FLOW\r\n          // ΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓ
öüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöüΓöü\r\n\r\
n          // Zoom now uses 
standard OAuth flow (User 
OAuth)\r\n          // Fall through 
to generic OAuth handler 
below\r\n\r\n\r\n          // 
GitHub/Slack: OAuth flow with user 
authorization\r\n          res = 
await fetch(`/api/applications/${ite
m.id}/authorize`, {\r\n            
method: \"POST\",\r\n            
headers: { \"Content-Type\": 
\"application/json\" }\r\n          
})\r\n\r\n          const data = 
await res.json().catch(() => 
({}))\r\n\r\n          if (!res.ok) 
{\r\n            throw new 
Error(data?.error || data?.message 
|| `Connection failed 
(${res.status})`)\r\n          
}\r\n\r\n          // OAuth 
applications return a redirect 
URL\r\n          if 
(data?.redirectUrl) {\r\n           
 console.log('[applications-ui] 
Redirecting to OAuth provider:', 
item.id)\r\n\r\n            // Show 
full-screen loading overlay\r\n     
       setLoadingState({\r\n        
      provider: item.name,\r\n      
        message: `Please wait while 
we redirect you to 
${item.name}`\r\n            
})\r\n\r\n            // Small 
delay to ensure render updates and 
provide visual feedback\r\n         
   await new Promise(resolve => 
setTimeout(resolve, 800))\r\n\r\n   
         // Redirect to OAuth 
provider in same window\r\n         
   window.location.href = 
data.redirectUrl\r\n            
return\r\n          }\r\n\r\n       
   // Direct toggle (non-OAuth 
applications)\r\n          
startTransition(() => {\r\n         
   updateItemStatus(item.id, {\r\n  
            connected: true,\r\n    
          status: \"idle\",\r\n     
         errorMessage: 
undefined,\r\n            })\r\n    
      })\r\n        }\r\n      } 
catch (err) {\r\n        const 
message =\r\n          err 
instanceof Error ? err.message : 
\"Something went wrong. Try 
again.\"\r\n\r\n        
updateItemStatus(item.id, {\r\n     
     status: \"error\",\r\n         
 errorMessage: message,\r\n         
 // connected state is NOT changed 
on error\r\n        })\r\n      
}\r\n    },\r\n    
[updateItemStatus, 
startTransition]\r\n  )\r\n\r\n  // 
------------------------------------
------------------------------------
---\r\n  // Dismiss error on a 
specific card\r\n  // --------------
------------------------------------
-------------------------\r\n  
const handleDismissError = 
useCallback(\r\n    (id: string) => 
{\r\n      updateItemStatus(id, { 
status: \"idle\", errorMessage: 
undefined })\r\n    },\r\n    
[updateItemStatus]\r\n  )\r\n\r\n  
// ---------------------------------
------------------------------------
------\r\n  // Counts for 
accessible status summary\r\n  // --
------------------------------------
------------------------------------
-\r\n  const connectedCount = 
React.useMemo(\r\n    () => 
sections.flatMap((s) => 
s.items).filter((i) => 
i.connected).length,\r\n    
[sections]\r\n  )\r\n\r\n  const 
totalCount = React.useMemo(\r\n    
() => sections.flatMap((s) => 
s.items).length,\r\n    
[sections]\r\n  )\r\n\r\n  // ------
------------------------------------
---------------------------------\r\
n  // Render\r\n  // ---------------
------------------------------------
------------------------\r\n  
return (\r\n    <div 
className=\"w-full flex flex-1 
flex-col gap-10 p-6 pt-2 
max-w-[1600px] mx-auto\">\r\n      
{/* Full-screen Loading Overlay for 
Redirects/Connections */}\r\n      
{loadingState && (\r\n        <div 
className=\"fixed inset-0 z-50 flex 
flex-col items-center 
justify-center bg-background 
animate-in fade-in 
duration-300\">\r\n          
<Loader2 className=\"h-10 w-10 
animate-spin text-primary mb-6\" 
/>\r\n          <h2 
className=\"text-xl font-medium 
text-foreground mb-2\">\r\n         
   {loadingState.message}\r\n       
   </h2>\r\n          <p className=\
"text-muted-foreground\">It should 
only take a few moments.</p>\r\n    
    </div>\r\n      )}\r\n\r\n      
{/* ΓöÇΓöÇ Page Header ΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓöÇΓ
öÇΓöÇ */}\r\n      <header 
className=\"w-full flex flex-col 
gap-4 sm:flex-row sm:items-center 
sm:justify-between\">\r\n        
<div>\r\n          <h1 
className=\"text-2xl font-bold text-
gray-800\">Applications</h1>\r\n    
      <p className=\"text-sm 
text-muted-foreground mt-1\">\r\n   
         Manage your 
organisation&apos;s connections 
with third-party services.{\" 
\"}\r\n            <span\r\n        
      className=\"font-medium 
text-gray-600\"\r\n              
aria-live=\"polite\"\r\n            
  aria-atomic=\"true\"\r\n          
  >\r\n              
{connectedCount} of {totalCount} 
connected.\r\n            
</span>\r\n          </p>\r\n       
 </div>\r\n\r\n        <div 
className=\"flex flex-col gap-3 
sm:flex-row sm:items-center\">\r\n  
        {/* Search */}\r\n          
<div className=\"relative w-full 
sm:w-[300px]\">\r\n            
<label htmlFor={searchId} 
className=\"sr-only\">\r\n          
    Search applications\r\n         
   </label>\r\n            
<Search\r\n              
className=\"absolute left-3 top-1/2 
h-4 w-4 -translate-y-1/2 
text-gray-400 
pointer-events-none\"\r\n           
   aria-hidden=\"true\"\r\n         
   />\r\n            <Input\r\n     
         id={searchId}\r\n          
    placeholder=\"Search 
applicationsΓÇª\"\r\n              
value={searchTerm}\r\n              
onChange={(e) => 
setSearchTerm(e.target.value)}\r\n  
            className=\"pl-9 
border-gray-300 rounded-full 
bg-white shadow-sm 
focus-visible:ring-2 
focus-visible:ring-offset-1\"\r\n   
           autoComplete=\"off\"\r\n 
             spellCheck={false}\r\n 
           />\r\n          
</div>\r\n        </div>\r\n      
</header>\r\n\r\n      <main 
className=\"space-y-16 
pb-16\">\r\n\r\n        
{activeApplications.length > 0 && 
(\r\n          <section 
className=\"space-y-6\" aria-labelle
dby=\"section-active\">\r\n         
   <h2\r\n              
id=\"section-active\"\r\n           
   className=\"text-xs 
font-semibold text-gray-500 
uppercase tracking-widest\"\r\n     
       >\r\n              Active 
Applications\r\n            
</h2>\r\n            
<ActiveApplicationsTable\r\n        
      
items={activeApplications}\r\n      
        onDisconnect={(item) => 
handleToggle(item)}\r\n            
/>\r\n          </section>\r\n      
  )}\r\n\r\n        
{activeApplications.length === 0 && 
availableSections.length === 0 ? 
(\r\n          <EmptyState 
searchTerm={searchTerm} />\r\n      
  ) : (\r\n          
availableSections.map((section) => 
(\r\n            <section\r\n       
       key={section.title}\r\n      
        className=\"space-y-6\"\r\n 
             aria-labelledby={`secti
on-${section.title.toLowerCase()}`}\
r\n            >\r\n              
<h2\r\n                id={`section-
${section.title.toLowerCase()}`}\r\n
                className=\"text-xs 
font-semibold text-gray-500 
uppercase tracking-widest\"\r\n     
         >\r\n                
{section.title}\r\n              
</h2>\r\n\r\n              <ul\r\n  
              className=\"grid 
gap-6 grid-cols-1 md:grid-cols-2 
lg:grid-cols-3 xl:grid-cols-4 
list-none p-0 m-0\"\r\n             
   aria-label={`${section.title} 
application`}\r\n              
>\r\n                
{section.items.map((item) => (\r\n  
                <li 
key={item.id}>\r\n                  
  <ApplicationCard\r\n              
        item={item}\r\n             
         onToggle={() => 
handleToggle(item)}\r\n             
         onDismissError={() => 
handleDismissError(item.id)}\r\n    
                />\r\n              
    </li>\r\n                
))}\r\n              </ul>\r\n      
      </section>\r\n          
))\r\n        )}\r\n      
</main>\r\n    </div>\r\n  
)\r\n}\r\n\r\n// -------------------
------------------------------------
--------------------\r\n// 
ApplicationCard\r\n// --------------
------------------------------------
-------------------------\r\ninterfa
ce ApplicationCardProps {\r\n  
item: Application\r\n  onToggle: () 
=> void\r\n  onDismissError: () => 
void\r\n}\r\n\r\nfunction 
ApplicationCard({ item, onToggle, 
onDismissError }: 
ApplicationCardProps) {\r\n  const 
[imgError, setImgError] = 
useState(false)\r\n\r\n  const 
isLoading =\r\n    item.status === 
\"connecting\" || item.status === 
\"disconnecting\"\r\n  const 
isError = item.status === 
\"error\"\r\n\r\n  const 
actionLabel = isLoading\r\n    ? 
item.status === \"connecting\"\r\n  
    ? \"ConnectingΓÇª\"\r\n      : 
\"DisconnectingΓÇª\"\r\n    : 
item.connected\r\n      ? 
\"Disconnect\"\r\n      : 
\"Connect\"\r\n\r\n  const 
ariaLabel = isLoading\r\n    ? 
`${actionLabel} ${item.name}`\r\n   
 : item.connected\r\n      ? 
`Disconnect ${item.name}`\r\n      
: `Connect ${item.name}`\r\n\r\n  
return (\r\n    <article\r\n      
className={cn(\r\n        \"group 
relative flex flex-col 
justify-between p-5 bg-white border 
rounded-xl transition-all 
duration-200\",\r\n        
\"focus-within:ring-2 
focus-within:ring-offset-2 
focus-within:ring-gray-400\",\r\n   
     isError\r\n          ? 
\"border-red-200 shadow-sm 
shadow-red-50\"\r\n          : 
\"border-gray-200 hover:shadow-md 
hover:border-gray-300\"\r\n      
)}\r\n      
aria-label={`${item.name} 
application ΓÇö ${item.connected ? 
\"Connected\" : \"Not 
connected\"}`}\r\n    >\r\n      
{/* ΓöÇΓöÇ Card Header ΓöÇΓöÇ 
*/}\r\n      <div>\r\n        <div 
className=\"flex items-start 
justify-between mb-4\">\r\n         
 <div\r\n            
className=\"h-11 w-11 flex 
items-center justify-center 
rounded-lg bg-gray-50 border 
border-gray-100 p-2 shrink-0\"\r\n  
          aria-hidden=\"true\"\r\n  
        >\r\n            {imgError 
? (\r\n              
<InitialsAvatar name={item.name} 
/>\r\n            ) : (\r\n         
     // eslint-disable-next-line 
@next/next/no-img-element\r\n       
       <img\r\n                
src={item.iconUrl}\r\n              
  alt=\"\"\r\n                
aria-hidden=\"true\"\r\n            
    className=\"h-full w-full 
object-contain\"\r\n                
onError={() => 
setImgError(true)}\r\n              
  loading=\"lazy\"\r\n              
  decoding=\"async\"\r\n            
  />\r\n            )}\r\n          
</div>\r\n\r\n          {/* Status 
badge */}\r\n          <div 
aria-live=\"polite\" 
aria-atomic=\"true\" 
className=\"flex flex-col items-end 
gap-1.5\">\r\n            
{item.connected && !isLoading && 
!isError && (\r\n              
<span className=\"inline-flex 
items-center gap-1 text-xs 
font-medium text-green-700 
bg-green-50 px-2 py-0.5 
rounded-full border 
border-green-200\">\r\n             
   <CheckCircle2 className=\"h-3 
w-3\" aria-hidden=\"true\" />\r\n   
             Connected\r\n          
    </span>\r\n            )}\r\n   
         {isLoading && (\r\n        
      <span className=\"inline-flex 
items-center gap-1 text-xs 
font-medium text-blue-600 
bg-blue-50 px-2 py-0.5 rounded-full 
border border-blue-200\">\r\n       
         <Loader2 className=\"h-3 
w-3 animate-spin\" 
aria-hidden=\"true\" />\r\n         
       {item.status === 
\"connecting\" ? \"Connecting\" : 
\"Disconnecting\"}\r\n              
</span>\r\n            )}\r\n       
     {isError && (\r\n              
<span className=\"inline-flex 
items-center gap-1 text-xs 
font-medium text-red-600 bg-red-50 
px-2 py-0.5 rounded-full border 
border-red-200\">\r\n               
 <XCircle className=\"h-3 w-3\" 
aria-hidden=\"true\" />\r\n         
       Failed\r\n              
</span>\r\n            )}\r\n       
   </div>\r\n        </div>\r\n\r\n 
       <h3 className=\"text-base 
font-semibold text-gray-900 
group-hover:text-blue-600 
transition-colors 
leading-snug\">\r\n          
{item.name}\r\n        </h3>\r\n    
    <p className=\"text-sm 
text-gray-500 mt-1.5 
leading-relaxed line-clamp-2\">\r\n 
         {item.description}\r\n     
   </p>\r\n\r\n        {/* Error 
message banner */}\r\n        
{isError && item.errorMessage && 
(\r\n          <div\r\n            
role=\"alert\"\r\n            
className=\"mt-3 flex items-start 
gap-2 text-xs text-red-700 
bg-red-50 border border-red-200 
rounded-md px-3 py-2\"\r\n          
>\r\n            <AlertCircle 
className=\"h-3.5 w-3.5 mt-0.5 
shrink-0\" aria-hidden=\"true\" 
/>\r\n            <span className=\"
flex-1\">{item.errorMessage}</span>\
r\n            <button\r\n          
    onClick={onDismissError}\r\n    
          className=\"shrink-0 
text-red-500 hover:text-red-700 
focus:outline-none 
focus:underline\"\r\n              
aria-label=\"Dismiss error\"\r\n    
        >\r\n              Γ£ò\r\n  
          </button>\r\n          
</div>\r\n        )}\r\n      
</div>\r\n\r\n      {/* ΓöÇΓöÇ Card 
Footer ΓöÇΓöÇ */}\r\n      <div 
className=\"flex items-center 
justify-between mt-4 pt-4 border-t 
border-gray-100\">\r\n        
<a\r\n          
href={item.docsUrl}\r\n          
target=\"_blank\"\r\n          
rel=\"noopener noreferrer\"\r\n     
     className=\"text-sm 
font-medium text-muted-foreground 
hover:text-primary inline-flex 
items-center gap-1 
transition-colors 
focus:outline-none 
focus:underline\"\r\n          
aria-label={`Learn more about 
${item.name} (opens in new 
tab)`}\r\n        >\r\n          
Learn more\r\n          
<ExternalLink className=\"h-3 w-3\" 
aria-hidden=\"true\" />\r\n        
</a>\r\n\r\n        <Button\r\n     
     variant={item.connected ? 
\"outline\" : \"default\"}\r\n      
    size=\"sm\"\r\n          
className={cn(\r\n            \"h-8 
px-4 text-xs font-medium 
transition-all min-w-[90px]\",\r\n  
          item.connected && 
!isLoading\r\n              ? 
\"hover:bg-red-50 
hover:text-red-600 
hover:border-red-200\"\r\n          
    : !item.connected && 
!isLoading\r\n                ? 
\"bg-black text-white 
hover:bg-gray-800 shadow-sm\"\r\n   
             : \"\" // loading 
state ΓÇö neutral styling\r\n       
   )}\r\n          
onClick={onToggle}\r\n          
disabled={isLoading}\r\n          
aria-label={ariaLabel}\r\n          
aria-busy={isLoading}\r\n        
>\r\n          {isLoading ? (\r\n   
         <>\r\n              
<Loader2 className=\"h-3 w-3 mr-1.5 
animate-spin\" aria-hidden=\"true\" 
/>\r\n              {item.status 
=== \"connecting\" ? \"Connecting\" 
: \"Disconnecting\"}\r\n            
</>\r\n          ) : item.connected 
? (\r\n            <>\r\n           
   <Unplug className=\"h-3 w-3 
mr-1.5\" aria-hidden=\"true\" 
/>\r\n              Disconnect\r\n  
          </>\r\n          ) : 
(\r\n            <>\r\n             
 <Plug className=\"h-3 w-3 mr-1.5\" 
aria-hidden=\"true\" />\r\n         
     Connect\r\n            </>\r\n 
         )}\r\n        
</Button>\r\n      </div>\r\n    
</article>\r\n  )\r\n}\r\n\r\n// ---
------------------------------------
------------------------------------
\r\n// Empty State\r\n// -----------
------------------------------------
----------------------------\r\nfunc
tion EmptyState({ searchTerm }: { 
searchTerm: string }) {\r\n  return 
(\r\n    <div\r\n      
className=\"text-center py-24\"\r\n 
     role=\"status\"\r\n      
aria-live=\"polite\"\r\n    >\r\n   
   <div className=\"mx-auto mb-4 
h-14 w-14 rounded-full bg-gray-100 
flex items-center 
justify-center\">\r\n        
<Search className=\"h-6 w-6 
text-gray-400\" 
aria-hidden=\"true\" />\r\n      
</div>\r\n      <h3 
className=\"text-base font-semibold 
text-gray-900\">\r\n        No 
applications found\r\n      
</h3>\r\n      <p className=\"mt-1 
text-sm text-gray-500\">\r\n        
{searchTerm\r\n          ? `No 
results for \"${searchTerm}\". Try 
a different search term.`\r\n       
   : \"No applications are 
available right now.\"}\r\n      
</p>\r\n    </div>\r\n  
)\r\n}\r\n\r\nfunction 
InitialsAvatar({ name }: { name: 
string }) {\r\n  const initials = 
name\r\n    .split(\" \")\r\n    
.slice(0, 2)\r\n    .map((w) => 
w[0]?.toUpperCase() ?? \"\")\r\n    
.join(\"\")\r\n\r\n  return (\r\n   
 <span\r\n      className=\"text-xs 
font-bold text-gray-500 
select-none\"\r\n      
aria-hidden=\"true\"\r\n    >\r\n   
   {initials}\r\n    </span>\r\n  
)\r\n}\r\n\r\nfunction 
ActiveApplicationsTable({\r\n  
items,\r\n  onDisconnect,\r\n}: 
{\r\n  items: Application[]\r\n  
onDisconnect: (item: Application) 
=> void\r\n}) {\r\n  return (\r\n   
 <div className=\"rounded-md border 
border-gray-200 bg-white 
overflow-hidden shadow-sm\">\r\n    
  <Table>\r\n        <TableHeader 
className=\"bg-gray-50/50\">\r\n    
      <TableRow>\r\n            
<TableHead className=\"w-[300px]\">A
pplication</TableHead>\r\n          
  <TableHead>Last 
Sync</TableHead>\r\n            
<TableHead>Status</TableHead>\r\n   
         <TableHead className=\"text
-right\">Actions</TableHead>\r\n    
      </TableRow>\r\n        
</TableHeader>\r\n        
<TableBody>\r\n          
{items.map((item) => (\r\n          
  <TableRow key={item.id} 
className=\"group 
hover:bg-gray-50/50 
transition-colors\">\r\n            
  <TableCell 
className=\"font-medium\">\r\n      
          <div className=\"flex 
items-center gap-3\">\r\n           
       <div className=\"h-8 w-8 
flex items-center justify-center 
rounded-md bg-gray-100 border 
border-gray-200 p-1\">\r\n          
          {/* 
eslint-disable-next-line 
@next/next/no-img-element */}\r\n   
                 <img\r\n           
           src={item.iconUrl}\r\n   
                   alt=\"\"\r\n     
                 className=\"h-full 
w-full object-contain\"\r\n         
             loading=\"lazy\"\r\n   
                 />\r\n             
     </div>\r\n                  
<div>\r\n                    <div 
className=\"font-semibold text-gray-
900\">{item.name}</div>\r\n         
           <div className=\"text-xs 
text-gray-500\">{item.category}</div
>\r\n                  </div>\r\n   
             </div>\r\n             
 </TableCell>\r\n              
<TableCell 
className=\"text-gray-500\">\r\n    
            <div className=\"flex 
items-center gap-2\">\r\n           
       <Calendar className=\"h-4 
w-4 text-gray-400\" />\r\n          
        <span 
className=\"text-sm\">\r\n          
          {item.lastSyncAt\r\n      
                ? new Date(item.last
SyncAt).toLocaleString(\"en-US\", 
{\r\n                        year: 
\"numeric\",\r\n                    
    month: \"short\",\r\n           
             day: \"numeric\",\r\n  
                      hour: 
\"numeric\",\r\n                    
    minute: \"numeric\",\r\n        
                timeZoneName: 
\"short\"\r\n                      
})\r\n                      : \"Not 
synced yet\"}\r\n                  
</span>\r\n                
</div>\r\n              
</TableCell>\r\n              
<TableCell>\r\n                
{item.status === \"disconnecting\" 
? (\r\n                  <span 
className=\"inline-flex 
items-center gap-1.5 px-2.5 py-0.5 
rounded-full text-xs font-medium 
bg-blue-50 text-blue-700 border 
border-blue-200\">\r\n              
      <Loader2 className=\"h-3 w-3 
animate-spin\" />\r\n               
     Disconnecting\r\n              
    </span>\r\n                ) : 
item.status === \"error\" ? (\r\n   
               <span 
className=\"inline-flex 
items-center px-2.5 py-0.5 
rounded-full text-xs font-medium 
bg-red-100 text-red-800\">\r\n      
              Error\r\n             
     </span>\r\n                ) : 
(\r\n                  <span 
className=\"inline-flex 
items-center px-2.5 py-0.5 
rounded-full text-xs font-medium 
bg-green-100 text-green-800\">\r\n  
                  Active\r\n        
          </span>\r\n               
 )}\r\n              
</TableCell>\r\n              
<TableCell 
className=\"text-right\">\r\n       
         <DropdownMenu>\r\n         
         <DropdownMenuTrigger 
asChild>\r\n                    
<Button\r\n                      
variant=\"ghost\"\r\n               
       size=\"sm\"\r\n              
        className=\"h-8 w-8 p-0 
text-gray-500 
hover:text-gray-900\"\r\n           
           disabled={item.status 
=== \"disconnecting\"}\r\n          
          >\r\n                     
 <span className=\"sr-only\">Open 
menu</span>\r\n                     
 <MoreHorizontal className=\"h-4 
w-4\" />\r\n                    
</Button>\r\n                  
</DropdownMenuTrigger>\r\n          
        <DropdownMenuContent 
align=\"end\" 
className=\"w-[160px]\">\r\n        
            <DropdownMenuItem 
disabled>\r\n                      
Sync Now\r\n                      
<span className=\"ml-auto text-xs te
xt-muted-foreground\">Soon</span>\r\
n                    
</DropdownMenuItem>\r\n             
       <DropdownMenuItem 
disabled>\r\n                      
Configure\r\n                      
<span className=\"ml-auto text-xs te
xt-muted-foreground\">Soon</span>\r\
n                    
</DropdownMenuItem>\r\n             
       <DropdownMenuItem\r\n        
              
className=\"text-red-600 
focus:text-red-600 
focus:bg-red-50\"\r\n               
       onClick={() => 
onDisconnect(item)}\r\n             
       >\r\n                      
Disconnect\r\n                    
</DropdownMenuItem>\r\n             
     </DropdownMenuContent>\r\n     
           </DropdownMenu>\r\n      
        </TableCell>\r\n            
</TableRow>\r\n          ))}\r\n    
    </TableBody>\r\n      
</Table>\r\n    </div>\r\n  )\r\n}",
"usedDeprecatedRules":[]},{"filePath
":"D:\\UBIG\\Projek\\Presensi-New\\s
rc\\components\\report\\VisitsMap.ts
x","messages":[{"ruleId":null,"messa
ge":"Unused eslint-disable 
directive (no problems were 
reported from '@typescript-eslint/no
-explicit-any').","line":39,"column"
:9,"severity":1,"nodeType":null,"fix
":{"range":[968,1030],"text":" "}}],
"suppressedMessages":[],"errorCount"
:0,"fatalErrorCount":0,"warningCount
":1,"fixableErrorCount":0,"fixableWa
rningCount":1,"source":"\"use 
client\"\r\n\r\nimport { useEffect 
} from \"react\"\r\nimport { 
MapContainer, TileLayer, Marker, 
Popup, useMap } from 
\"react-leaflet\"\r\nimport \"leafle
t/dist/leaflet.css\"\r\nimport L 
from \"leaflet\"\r\n\r\nconst 
iconUrl = \"https://unpkg.com/leafle
t@1.9.3/dist/images/marker-icon.png\
"\r\nconst iconRetinaUrl = \"https:/
/unpkg.com/leaflet@1.9.3/dist/images
/marker-icon-2x.png\"\r\nconst 
shadowUrl = \"https://unpkg.com/leaf
let@1.9.3/dist/images/marker-shadow.
png\"\r\n\r\nfunction ChangeView({ 
center }: { center: [number, 
number] }) {\r\n    const map = 
useMap()\r\n\r\n    useEffect(() => 
{\r\n        
map.setView(center)\r\n    }, 
[center, map])\r\n\r\n    return 
null\r\n}\r\n\r\ninterface Visit 
{\r\n    id: string\r\n    
memberName: string\r\n    
locationName: string\r\n    
address: string\r\n    
coordinates?: {\r\n        lat: 
number\r\n        lng: number\r\n   
 }\r\n}\r\n\r\ninterface 
VisitsMapProps {\r\n    visits: 
Visit[]\r\n}\r\n\r\nexport default 
function VisitsMap({ visits }: 
VisitsMapProps) {\r\n    
useEffect(() => {\r\n        // 
eslint-disable-next-line @typescript
-eslint/no-explicit-any\r\n        
delete (L.Icon.Default.prototype as 
any)._getIconUrl\r\n        
L.Icon.Default.mergeOptions({\r\n   
         iconUrl,\r\n            
iconRetinaUrl,\r\n            
shadowUrl,\r\n        })\r\n    }, 
[])\r\n\r\n    const validVisits = 
visits.filter(v => 
v.coordinates)\r\n\r\n    const 
center: [number, number] = 
validVisits[0]?.coordinates\r\n     
   ? 
[validVisits[0].coordinates!.lat, va
lidVisits[0].coordinates!.lng]\r\n  
      : [-6.2088, 106.8456]\r\n\r\n 
   return (\r\n        <div 
className=\"h-[600px] w-full 
rounded-lg overflow-hidden border 
shadow-sm z-0 relative\">\r\n       
     <MapContainer\r\n              
  center={[-6.2088, 106.8456]}\r\n  
              zoom={13}\r\n         
       style={{ height: \"100%\", 
width: \"100%\" }}\r\n            
>\r\n                <ChangeView 
center={center} />\r\n\r\n          
      <TileLayer\r\n                
    attribution='&copy; <a href=\"ht
tps://www.openstreetmap.org/copyrigh
t\">OpenStreetMap</a> 
contributors'\r\n                   
 url=\"https://{s}.tile.openstreetma
p.org/{z}/{x}/{y}.png\"\r\n         
       />\r\n\r\n                
{validVisits.map(v => (\r\n         
           <Marker\r\n              
          key={v.id}\r\n            
            
position={[v.coordinates!.lat, 
v.coordinates!.lng]}\r\n            
        >\r\n                       
 <Popup>\r\n                        
    <div className=\"p-1\">\r\n     
                           <h3 
className=\"font-bold 
text-sm\">{v.locationName}</h3>\r\n 
                               <p 
className=\"text-xs text-gray-600\">
{v.memberName}</p>\r\n              
                  <p 
className=\"text-xs text-gray-500 
mt-1\">{v.address}</p>\r\n          
                  </div>\r\n        
                </Popup>\r\n        
            </Marker>\r\n           
     ))}\r\n            
</MapContainer>\r\n        
</div>\r\n    )\r\n}\r\n","usedDepre
catedRules":[]},{"filePath":"D:\\UBI
G\\Projek\\Presensi-New\\src\\compon
ents\\tables\\pagination-footer.tsx"
,"messages":[{"ruleId":"prefer-const
","severity":2,"message":"'i' is 
never reassigned. Use 'const' instea
d.","line":49,"column":14,"nodeType"
:"Identifier","messageId":"useConst"
,"endLine":49,"endColumn":15,"fix":{
"range":[1118,1123],"text":"const i"
}}],"suppressedMessages":[],"errorCo
unt":1,"fatalErrorCount":0,"warningC
ount":0,"fixableErrorCount":1,"fixab
leWarningCount":0,"source":"\"use 
client\"\r\n\r\nimport React from 
\"react\"\r\nimport { Button } from 
\"@/components/ui/button\"\r\nimport
 { ChevronLeft, ChevronRight, 
MoreHorizontal } from 
\"lucide-react\"\r\nimport { cn } 
from \"@/lib/utils\"\r\n\r\nexport 
type PaginationFooterProps = {\r\n  
page: number\r\n  totalPages: 
number\r\n  onPageChange: (page: 
number) => void\r\n  isLoading?: 
boolean\r\n  from: number\r\n  to: 
number\r\n  total: number\r\n  
pageSize: number\r\n  
onPageSizeChange: (size: number) => 
void\r\n  pageSizeOptions?: 
number[]\r\n  className?: 
string\r\n}\r\n\r\nexport function 
PaginationFooter({\r\n  page,\r\n  
totalPages,\r\n  onPageChange,\r\n  
isLoading = false,\r\n  from,\r\n  
to,\r\n  total,\r\n  pageSize,\r\n  
onPageSizeChange,\r\n  
pageSizeOptions = [10, 20, 50],\r\n 
 className = \"\",\r\n}: 
PaginationFooterProps) {\r\n  const 
safeTotalPages = Math.max(1, 
totalPages || 1)\r\n\r\n  const 
getPageNumbers = () => {\r\n    
const delta = 1\r\n    const range 
= []\r\n    const rangeWithDots = 
[]\r\n    let l\r\n\r\n    for (let 
i = 1; i <= safeTotalPages; i++) 
{\r\n      if (i === 1 || i === 
safeTotalPages || (i >= page - 
delta && i <= page + delta)) {\r\n  
      range.push(i)\r\n      }\r\n  
  }\r\n\r\n    for (let i of range) 
{\r\n      if (l) {\r\n        if 
(i - l === 2) {\r\n          
rangeWithDots.push(l + 1)\r\n       
 } else if (i - l !== 1) {\r\n      
    rangeWithDots.push('...')\r\n   
     }\r\n      }\r\n      
rangeWithDots.push(i)\r\n      l = 
i\r\n    }\r\n\r\n    return 
rangeWithDots\r\n  }\r\n\r\n  
return (\r\n    <div 
className={cn(\"mt-4 flex 
flex-col-reverse sm:flex-row 
items-center justify-between gap-4 
py-4\", className)}>\r\n      {/* 
Left Side: Info & Page Size */}\r\n 
     <div className=\"flex 
items-center gap-4 text-sm 
text-gray-600 
dark:text-gray-400\">\r\n        
<span>\r\n          Showing <span 
className=\"font-medium 
text-gray-900 dark:text-gray-100\">{
from}-{to}</span> of <span 
className=\"font-medium 
text-gray-900 
dark:text-gray-100\">{total}</span> 
data\r\n        </span>\r\n        
<div className=\"flex items-center 
gap-2\">\r\n          
<span>Rows:</span>\r\n          
<select\r\n            
value={pageSize}\r\n            
onChange={(e) => onPageSizeChange(Nu
mber(e.target.value))}\r\n          
  disabled={isLoading}\r\n          
  className=\"h-8 px-2 rounded-md 
border border-gray-300 
dark:border-gray-800 bg-white 
dark:bg-gray-950 text-sm 
focus:outline-none focus:ring-2 
focus:ring-blue-500 
dark:text-gray-100\"\r\n          
>\r\n            
{pageSizeOptions.map((size) => 
(\r\n              <option 
key={size} value={size}>\r\n        
        {size}\r\n              
</option>\r\n            ))}\r\n    
      </select>\r\n        
</div>\r\n      </div>\r\n\r\n      
{/* Right Side: Pagination */}\r\n  
    <div className=\"flex 
items-center gap-1\">\r\n        
<Button\r\n          
variant=\"outline\"\r\n          
size=\"icon\"\r\n          
className=\"h-8 w-8 p-0 
dark:border-gray-800 
dark:hover:bg-gray-800\"\r\n        
  onClick={() => onPageChange(page 
- 1)}\r\n          disabled={page 
<= 1 || isLoading}\r\n        >\r\n 
         <ChevronLeft 
className=\"h-4 w-4\" />\r\n        
</Button>\r\n\r\n        
{getPageNumbers().map((pageNum, 
idx) => (\r\n          pageNum === 
'...' ? (\r\n            <span 
key={`dots-${idx}`} 
className=\"px-2 text-gray-400 
dark:text-gray-600\">\r\n           
   <MoreHorizontal className=\"h-4 
w-4\" />\r\n            </span>\r\n 
         ) : (\r\n            
<Button\r\n              
key={pageNum}\r\n              
variant={page === pageNum ? 
\"default\" : \"outline\"}\r\n      
        size=\"icon\"\r\n           
   className={cn(\r\n               
 \"h-8 w-8 p-0\",\r\n               
 page === pageNum\r\n               
   ? \"bg-zinc-900 text-zinc-50 
hover:bg-zinc-900/90 
dark:bg-zinc-50 dark:text-zinc-900 
dark:hover:bg-zinc-50/90\"\r\n      
            : \"text-gray-600 
hover:text-gray-900 
dark:text-gray-400 
dark:hover:text-gray-100 
dark:border-gray-800 
dark:hover:bg-gray-800\"\r\n        
      )}\r\n              
onClick={() => 
onPageChange(Number(pageNum))}\r\n  
            
disabled={isLoading}\r\n            
>\r\n              {pageNum}\r\n    
        </Button>\r\n          
)\r\n        ))}\r\n\r\n        
<Button\r\n          
variant=\"outline\"\r\n          
size=\"icon\"\r\n          
className=\"h-8 w-8 p-0 
dark:border-gray-800 
dark:hover:bg-gray-800\"\r\n        
  onClick={() => onPageChange(page 
+ 1)}\r\n          disabled={page 
>= safeTotalPages || isLoading}\r\n 
       >\r\n          <ChevronRight 
className=\"h-4 w-4\" />\r\n        
</Button>\r\n      </div>\r\n    
</div>\r\n  )\r\n}\r\n","usedDepreca
tedRules":[]},{"filePath":"D:\\UBIG\
\Projek\\Presensi-New\\src\\componen
ts\\timesheets\\AddTimeEntryDialog.t
sx","messages":[{"ruleId":"prefer-co
nst","severity":2,"message":"'bDiff'
 is never reassigned. Use 'const' in
stead.","line":113,"column":21,"node
Type":"Identifier","messageId":"useC
onst","endLine":113,"endColumn":26,"
fix":{"range":[3986,4031],"text":"co
nst bDiff = 
differenceInMinutes(bEnd, bStart)"}}
],"suppressedMessages":[],"errorCoun
t":1,"fatalErrorCount":0,"warningCou
nt":0,"fixableErrorCount":1,"fixable
WarningCount":0,"source":"\"use 
client\"\r\n\r\nimport { useState, 
useEffect, useRef } from 
\"react\"\r\nimport { Dialog, 
DialogContent, DialogFooter, 
DialogTitle, DialogHeader } from \"@
/components/ui/dialog\"\r\nimport { 
Button } from \"@/components/ui/butt
on\"\r\nimport { Label } from 
\"@/components/ui/label\"\r\nimport 
{ Input } from 
\"@/components/ui/input\"\r\nimport 
{ Textarea } from \"@/components/ui/
textarea\"\r\nimport { Select, 
SelectContent, SelectItem, 
SelectTrigger, SelectValue } from \"
@/components/ui/select\"\r\nimport 
{ Calendar } from \"@/components/ui/
calendar\"\r\nimport { Popover, 
PopoverContent, PopoverTrigger } 
from \"@/components/ui/popover\"\r\n
import { format, 
differenceInMinutes, parse, 
isValid, isAfter, isBefore } from 
\"date-fns\"\r\nimport { Calendar 
as CalendarIcon, Clock, HelpCircle, 
Plus, Trash2, Coffee } from 
\"lucide-react\"\r\nimport { cn } 
from \"@/lib/utils\"\r\nimport { 
DUMMY_PROJECTS, DUMMY_MEMBERS, 
DUMMY_TASKS } from 
\"@/lib/data/dummy-data\"\r\nimport 
type { TimeEntry, Break } from 
\"@/lib/data/dummy-data\"\r\nimport 
{ Avatar, AvatarFallback } from \"@/
components/ui/avatar\"\r\nimport { 
Switch } from \"@/components/ui/swit
ch\"\r\nimport { Checkbox } from \"@
/components/ui/checkbox\"\r\n\r\nint
erface AddTimeEntryDialogProps 
{\r\n    open: boolean\r\n    
onOpenChange: (open: boolean) => 
void\r\n    onSave: (entry: 
Partial<TimeEntry>) => void\r\n    
isAdmin?: boolean\r\n}\r\n\r\nconst 
REASONS = [\r\n    \"Forgot to 
start timer\",\r\n    \"Technical 
issue\",\r\n    \"Meeting 
offsite\",\r\n    
\"Correction\",\r\n    
\"Other\"\r\n]\r\n\r\nexport 
function AddTimeEntryDialog({\r\n   
 open,\r\n    onOpenChange,\r\n    
onSave,\r\n}: 
AddTimeEntryDialogProps) {\r\n    
const [formData, setFormData] = 
useState<Partial<TimeEntry>>({\r\n  
      memberId: \"\",\r\n        
projectId: \"\",\r\n        taskId: 
\"\",\r\n        date: new Date().to
ISOString().split('T')[0],\r\n      
  startTime: \"09:00\",\r\n        
endTime: \"17:00\",\r\n        
notes: \"\",\r\n        source: 
\"manual\",\r\n        activityPct: 
100,\r\n        billable: true,\r\n 
       reason: \"\",\r\n        
breaks: []\r\n    })\r\n\r\n    
const [date, setDate] = 
useState<Date | undefined>(new 
Date())\r\n    const [touched, 
setTouched] = 
useState<Record<string, 
boolean>>({})\r\n    const 
[otherReason, setOtherReason] = 
useState(\"\")\r\n    const 
[isWorkBreak, setIsWorkBreak] = 
useState(false)\r\n    const 
[breaks, setBreaks] = 
useState<Break[]>([])\r\n\r\n    
const startTimeRef = 
useRef<HTMLInputElement>(null)\r\n  
  const endTimeRef = useRef<HTMLInpu
tElement>(null)\r\n\r\n    
useEffect(() => {\r\n        if 
(open) {\r\n            const today 
= new Date()\r\n            
setFormData({\r\n                
memberId: DUMMY_MEMBERS[0]?.id || 
\"\",\r\n                projectId: 
\"\",\r\n                taskId: 
\"\",\r\n                date: today
.toISOString().split('T')[0],\r\n   
             startTime: 
\"09:00\",\r\n                
endTime: \"17:00\",\r\n             
   notes: \"\",\r\n                
source: \"manual\",\r\n             
   activityPct: 0,\r\n              
  billable: true,\r\n               
 reason: \"\",\r\n                
breaks: []\r\n            })\r\n    
        setDate(today)\r\n          
  setBreaks([])\r\n            
setOtherReason(\"\")\r\n            
setTouched({})\r\n            
setIsWorkBreak(false)\r\n        
}\r\n    }, [open])\r\n\r\n    
useEffect(() => {\r\n        if 
(date) {\r\n            
setFormData(prev => ({ ...prev, 
date: format(date, \"yyyy-MM-dd\") 
}))\r\n        }\r\n    }, 
[date])\r\n\r\n    const 
calculateDuration = () => {\r\n     
   if (!formData.startTime || 
!formData.endTime) return 
\"0:00:00\"\r\n\r\n        const 
start = parse(formData.startTime, 
\"HH:mm\", new Date())\r\n        
const end = parse(formData.endTime, 
\"HH:mm\", new Date())\r\n\r\n      
  if (!isValid(start) || 
!isValid(end)) return 
\"Invalid\"\r\n\r\n        let diff 
= differenceInMinutes(end, 
start)\r\n        if (diff < 0) 
diff += 24 * 60\r\n\r\n        // 
Subtract breaks\r\n        let 
breakMinutes = 0\r\n        
breaks.forEach(b => {\r\n           
 const bStart = parse(b.startTime, 
\"HH:mm\", new Date())\r\n          
  const bEnd = parse(b.endTime, 
\"HH:mm\", new Date())\r\n          
  if (isValid(bStart) && 
isValid(bEnd)) {\r\n                
let bDiff = 
differenceInMinutes(bEnd, 
bStart)\r\n                if 
(bDiff > 0) breakMinutes += 
bDiff\r\n            }\r\n        
})\r\n\r\n        diff -= 
breakMinutes\r\n        if (diff < 
0) diff = 0\r\n\r\n        const 
hours = Math.floor(diff / 60)\r\n   
     const minutes = diff % 60\r\n  
      return `${hours}:${minutes.toS
tring().padStart(2, '0')}:00`\r\n   
 }\r\n\r\n    const isValidTimes = 
() => {\r\n        if 
(!formData.startTime || 
!formData.endTime) return false\r\n 
       const start = 
parse(formData.startTime, 
\"HH:mm\", new Date())\r\n        
const end = parse(formData.endTime, 
\"HH:mm\", new Date())\r\n        
if (!isValid(start) || 
!isValid(end) || start >= end) 
return false\r\n        return 
true\r\n    }\r\n\r\n    const 
validateBreaks = () => {\r\n        
const start = 
parse(formData.startTime!, 
\"HH:mm\", new Date())\r\n        
const end = 
parse(formData.endTime!, \"HH:mm\", 
new Date())\r\n\r\n        for 
(const b of breaks) {\r\n           
 const bStart = parse(b.startTime, 
\"HH:mm\", new Date())\r\n          
  const bEnd = parse(b.endTime, 
\"HH:mm\", new Date())\r\n\r\n      
      if (!isValid(bStart) || 
!isValid(bEnd) || bStart >= bEnd) 
return \"Invalid break times\"\r\n  
          if (isBefore(bStart, 
start) || isAfter(bEnd, end)) 
return \"Break must be within work 
hours\"\r\n        }\r\n        
return null\r\n    }\r\n\r\n    
const handleAddBreak = () => {\r\n  
      setBreaks([...breaks, {\r\n   
         id: 
Math.random().toString(),\r\n       
     startTime: \"12:00\",\r\n      
      endTime: \"12:30\",\r\n       
     notes: \"\"\r\n        }])\r\n 
   }\r\n\r\n    const 
handleRemoveBreak = (id: string) => 
{\r\n        
setBreaks(breaks.filter(b => b.id 
!== id))\r\n    }\r\n\r\n    const 
handleUpdateBreak = (id: string, 
field: keyof Break, value: string) 
=> {\r\n        
setBreaks(breaks.map(b => b.id === 
id ? { ...b, [field]: value } : 
b))\r\n    }\r\n\r\n    const 
handleSave = () => {\r\n        if 
(!formData.projectId) {\r\n         
   setTouched(prev => ({ ...prev, 
projectId: true }))\r\n            
return\r\n        }\r\n        if 
(!isValidTimes()) {\r\n            
setTouched(prev => ({ ...prev, 
time: true }))\r\n            
return\r\n        }\r\n        
const breakError = 
validateBreaks()\r\n        if 
(breakError) {\r\n            
alert(breakError)\r\n            
return\r\n        }\r\n\r\n        
if (formData.reason === \"Other\" 
&& !otherReason.trim()) {\r\n       
     setTouched(prev => ({ ...prev, 
otherReason: true }))\r\n           
 return\r\n        }\r\n\r\n        
const project = 
DUMMY_PROJECTS.find(p => p.id === 
formData.projectId)\r\n        
const task = DUMMY_TASKS.find(t => 
t.id === formData.taskId)\r\n       
 const finalReason = 
formData.reason === \"Other\" ? 
otherReason : 
formData.reason\r\n\r\n        
onSave({\r\n            
...formData,\r\n            
memberId: formData.memberId || 
DUMMY_MEMBERS[0]?.id,\r\n           
 projectName: project?.name,\r\n    
        taskId: formData.taskId || 
undefined,\r\n            taskName: 
task?.title,\r\n            reason: 
finalReason,\r\n            
duration: calculateDuration(),\r\n  
          breaks: breaks\r\n        
})\r\n        
onOpenChange(false)\r\n    
}\r\n\r\n    return (\r\n        
<Dialog open={open} 
onOpenChange={onOpenChange}>\r\n    
        <DialogContent 
className=\"sm:max-w-[600px] 
max-h-[90vh] overflow-y-auto\">\r\n 
               <DialogHeader>\r\n   
                 <div 
className=\"flex items-center 
justify-between\">\r\n              
          <DialogTitle>Add 
time</DialogTitle>\r\n              
          <HelpCircle 
className=\"h-5 w-5 
text-muted-foreground 
hover:text-foreground 
cursor-pointer mr-6\" />\r\n        
            </div>\r\n              
  </DialogHeader>\r\n\r\n           
     <div className=\"space-y-6 
py-4\">\r\n                    {/* 
User Info & Break Toggle */}\r\n    
                <div 
className=\"flex items-start 
justify-between gap-4\">\r\n        
                <div 
className=\"flex-1 space-y-2\">\r\n 
                           <div 
className=\"text-xs font-semibold te
xt-muted-foreground\">MEMBER</div>\r
\n                            
<Select\r\n                         
       
value={formData.memberId}\r\n       
                         
onValueChange={(v) => setFormData({ 
...formData, memberId: v })}\r\n    
                        >\r\n       
                         
<SelectTrigger 
className=\"w-full\">\r\n           
                         
<SelectValue placeholder=\"Select 
member\" />\r\n                     
           </SelectTrigger>\r\n     
                           
<SelectContent>\r\n                 
                   
{DUMMY_MEMBERS.map(m => (\r\n       
                                 
<SelectItem key={m.id} 
value={m.id}>\r\n                   
                         <div 
className=\"flex items-center 
gap-2\">\r\n                        
                        <Avatar 
className=\"h-5 w-5\">\r\n          
                                    
      <AvatarFallback className=\"te
xt-[10px]\">{m.name.substring(0, 2).
toUpperCase()}</AvatarFallback>\r\n 
                                    
           </Avatar>\r\n            
                                    
{m.name}\r\n                        
                    </div>\r\n      
                                  
</SelectItem>\r\n                   
                 ))}\r\n            
                    
</SelectContent>\r\n                
            </Select>\r\n           
             </div>\r\n             
           <div className=\"flex 
items-center gap-2 mt-8\">\r\n      
                      <Switch\r\n   
                             
checked={isWorkBreak}\r\n           
                     onCheckedChange
={setIsWorkBreak}\r\n               
                 
id=\"work-break\"\r\n               
             />\r\n                 
           <Label 
htmlFor=\"work-break\" 
className=\"text-sm font-normal 
text-muted-foreground\">Work 
break</Label>\r\n                   
     </div>\r\n                    
</div>\r\n\r\n                    
{/* Project */}\r\n                 
   <div 
className=\"space-y-2\">\r\n        
                <div 
className=\"text-xs font-semibold te
xt-muted-foreground\">PROJECT*</div>
\r\n                        
<Select\r\n                         
   value={formData.projectId}\r\n   
                         
onValueChange={(v) => {\r\n         
                       
setFormData({ ...formData, 
projectId: v })\r\n                 
               setTouched(prev => 
({ ...prev, projectId: false 
}))\r\n                            
}}\r\n                        >\r\n 
                           
<SelectTrigger 
className={cn(\"w-full\", 
touched.projectId && 
!formData.projectId && 
\"border-destructive\")}>\r\n       
                         
<SelectValue placeholder=\"Select 
project\" />\r\n                    
        </SelectTrigger>\r\n        
                    
<SelectContent>\r\n                 
               
{DUMMY_PROJECTS.map(p => (\r\n      
                              
<SelectItem key={p.id} value={p.id}>
{p.name}</SelectItem>\r\n           
                     ))}\r\n        
                    
</SelectContent>\r\n                
        </Select>\r\n               
         {touched.projectId && 
!formData.projectId && (\r\n        
                    <p 
className=\"text-xs 
text-destructive\">Project is 
required.</p>\r\n                   
     )}\r\n                    
</div>\r\n\r\n                    
{/* Task */}\r\n                    
<div className=\"space-y-2\">\r\n   
                     <div 
className=\"text-xs font-semibold te
xt-muted-foreground\">TASKS</div>\r\
n                        
<Select\r\n                         
   value={formData.taskId || 
\"none\"}\r\n                       
     onValueChange={(v) => 
setFormData({ ...formData, taskId: 
v === \"none\" ? \"\" : v })}\r\n   
                     >\r\n          
                  <SelectTrigger 
className=\"w-full\">\r\n           
                     <SelectValue 
placeholder=\"-- No Task --\" 
/>\r\n                            
</SelectTrigger>\r\n                
            <SelectContent>\r\n     
                           
<SelectItem value=\"none\">-- No 
Task --</SelectItem>\r\n            
                    
{DUMMY_TASKS.map(t => (\r\n         
                           
<SelectItem key={t.id} value={t.id}>
{t.title}</SelectItem>\r\n          
                      ))}\r\n       
                     
</SelectContent>\r\n                
        </Select>\r\n               
     </div>\r\n\r\n                 
   {/* Time Span */}\r\n            
        <div 
className=\"space-y-2\">\r\n        
                <div 
className=\"text-xs font-semibold 
text-muted-foreground\">TIME SPAN 
(+07)*</div>\r\n\r\n                
        <div className=\"flex 
items-center gap-4\">\r\n           
                 <div 
className=\"flex-1\">\r\n           
                     <Popover>\r\n  
                                  
<PopoverTrigger asChild>\r\n        
                                
<Button\r\n                         
                   
variant={\"outline\"}\r\n           
                                 
className={cn(\r\n                  
                              
\"w-full justify-between text-left 
font-normal\",\r\n                  
                              !date 
&& \"text-muted-foreground\"\r\n    
                                    
    )}\r\n                          
              >\r\n                 
                           {date ? 
format(date, \"EEE, MMM d, yyyy\") 
: <span>Pick a date</span>}\r\n     
                                    
   <CalendarIcon className=\"h-4 
w-4 text-muted-foreground\" />\r\n  
                                    
  </Button>\r\n                     
               
</PopoverTrigger>\r\n               
                     
<PopoverContent className=\"w-auto 
p-0\" align=\"start\">\r\n          
                              
<Calendar\r\n                       
                     
mode=\"single\"\r\n                 
                           
selected={date}\r\n                 
                           
onSelect={setDate}\r\n              
                              
initialFocus\r\n                    
                    />\r\n          
                          
</PopoverContent>\r\n               
                 </Popover>\r\n     
                       
</div>\r\n\r\n                      
      <div className=\"flex 
items-center gap-2\">\r\n           
                     <span 
className=\"text-xs font-semibold 
text-muted-foreground 
uppercase\">FROM</span>\r\n         
                       <div 
className=\"relative w-32\">\r\n    
                                
<Input\r\n                          
              
ref={startTimeRef}\r\n              
                          
type=\"time\"\r\n                   
                     step=\"1\"\r\n 
                                    
   value={formData.startTime}\r\n   
                                    
 onChange={e => setFormData({ 
...formData, startTime: 
e.target.value })}\r\n              
                          
className=\"pr-8 [&::-webkit-calenda
r-picker-indicator]:hidden\"\r\n    
                                
/>\r\n                              
      <Clock\r\n                    
                    onClick={() => s
tartTimeRef.current?.showPicker()}\r
\n                                  
      className=\"absolute 
right-2.5 top-1/2 -translate-y-1/2 
h-4 w-4 text-primary cursor-pointer 
hover:text-primary/80\"\r\n         
                           />\r\n   
                             
</div>\r\n                          
  </div>\r\n\r\n                    
        <div className=\"flex 
items-center gap-2\">\r\n           
                     <span 
className=\"text-xs font-semibold 
text-muted-foreground 
uppercase\">TO</span>\r\n           
                     <div 
className=\"relative w-32\">\r\n    
                                
<Input\r\n                          
              ref={endTimeRef}\r\n  
                                    
  type=\"time\"\r\n                 
                       
step=\"1\"\r\n                      
                  
value={formData.endTime}\r\n        
                                
onChange={e => setFormData({ 
...formData, endTime: 
e.target.value })}\r\n              
                          
className=\"pr-8 [&::-webkit-calenda
r-picker-indicator]:hidden\"\r\n    
                                
/>\r\n                              
      <Clock\r\n                    
                    onClick={() => e
ndTimeRef.current?.showPicker()}\r\n
                                    
    className=\"absolute right-2.5 
top-1/2 -translate-y-1/2 h-4 w-4 
text-primary cursor-pointer 
hover:text-primary/80\"\r\n         
                           />\r\n   
                             
</div>\r\n                          
  </div>\r\n                        
</div>\r\n                    
</div>\r\n\r\n                    
{/* Work Breaks Section */}\r\n     
               {isWorkBreak && 
(\r\n                        <div 
className=\"border rounded-lg p-4 
space-y-4 bg-muted/20\">\r\n        
                    <div 
className=\"flex justify-between 
items-center\">\r\n                 
               <div 
className=\"text-xs font-semibold 
text-muted-foreground flex 
items-center gap-2\">\r\n           
                         <Coffee 
className=\"h-4 w-4\" /> BREAKS\r\n 
                               
</div>\r\n                          
      <Button variant=\"ghost\" 
size=\"sm\" 
onClick={handleAddBreak} 
className=\"h-8 text-xs 
text-primary gap-1 
hover:text-primary/80\">\r\n        
                            <Plus 
className=\"h-3 w-3\" /> Add 
Break\r\n                           
     </Button>\r\n                  
          </div>\r\n\r\n            
                {breaks.length === 
0 && (\r\n                          
      <p className=\"text-xs 
text-muted-foreground italic\">No 
breaks added.</p>\r\n               
             )}\r\n\r\n             
               <div 
className=\"space-y-3\">\r\n        
                        
{breaks.map((b) => (\r\n            
                        <div 
key={b.id} className=\"flex gap-2 
items-center\">\r\n                 
                       <Input\r\n   
                                    
     type=\"time\"\r\n              
                              
className=\"h-9 w-28 
bg-background\"\r\n                 
                           
value={b.startTime}\r\n             
                               
onChange={(e) => 
handleUpdateBreak(b.id, 
'startTime', e.target.value)}\r\n   
                                    
 />\r\n                             
           <span className=\"text-mu
ted-foreground\">-</span>\r\n       
                                 
<Input\r\n                          
                  type=\"time\"\r\n 
                                    
       className=\"h-9 w-28 
bg-background\"\r\n                 
                           
value={b.endTime}\r\n               
                             
onChange={(e) => 
handleUpdateBreak(b.id, 'endTime', 
e.target.value)}\r\n                
                        />\r\n      
                                  
<Input\r\n                          
                  
placeholder=\"Notes\"\r\n           
                                 
className=\"h-9 flex-1 
bg-background\"\r\n                 
                           
value={b.notes || \"\"}\r\n         
                                   
onChange={(e) => 
handleUpdateBreak(b.id, 'notes', 
e.target.value)}\r\n                
                        />\r\n      
                                  
<Button variant=\"ghost\" 
size=\"icon\" className=\"h-9 w-9 
text-muted-foreground 
hover:text-destructive\" 
onClick={() => 
handleRemoveBreak(b.id)}>\r\n       
                                    
 <Trash2 className=\"h-4 w-4\" 
/>\r\n                              
          </Button>\r\n             
                       </div>\r\n   
                             
))}\r\n                            
</div>\r\n                        
</div>\r\n                    
)}\r\n\r\n                    {/* 
Billable */}\r\n                    
<div className=\"flex items-center 
justify-between\">\r\n              
          <div className=\"flex 
items-center gap-2\">\r\n           
                 <Checkbox\r\n      
                          
id=\"billable\"\r\n                 
               
checked={formData.billable}\r\n     
                           
onCheckedChange={(c) => 
setFormData({ ...formData, 
billable: c === true })}\r\n        
                    />\r\n          
                  <Label 
htmlFor=\"billable\" 
className=\"font-normal 
text-sm\">Billable</Label>\r\n      
                  </div>\r\n        
            </div>\r\n\r\n          
          {/* Reason */}\r\n        
            <div 
className=\"space-y-2\">\r\n        
                <div 
className={cn(\"text-xs 
font-semibold uppercase\", 
(formData.reason === \"Other\" && 
!otherReason) || !formData.reason ? 
\"text-red-500\" : 
\"text-muted-foreground\")}>\r\n    
                        REASON*\r\n 
                       </div>\r\n   
                     <Select\r\n    
                        
value={formData.reason || \"\"}\r\n 
                           
onValueChange={(v) => {\r\n         
                       
setFormData({ ...formData, reason: 
v === \"none\" ? \"\" : v })\r\n    
                            if (v 
!== \"Other\") 
setOtherReason(\"\")\r\n            
                }}\r\n              
          >\r\n                     
       <SelectTrigger 
className={cn(\"w-full\", 
((formData.reason === \"Other\" && 
!otherReason) || 
(touched.otherReason && 
!formData.reason)) && 
\"border-destructive\")}>\r\n       
                         
<SelectValue placeholder=\"Why are 
you editing this time entry?\" 
/>\r\n                            
</SelectTrigger>\r\n                
            <SelectContent>\r\n     
                           
{REASONS.map(r => (\r\n             
                       <SelectItem 
key={r} 
value={r}>{r}</SelectItem>\r\n      
                          ))}\r\n   
                         
</SelectContent>\r\n                
        </Select>\r\n\r\n           
             {formData.reason === 
\"Other\" && (\r\n                  
          <Textarea\r\n             
                   
placeholder=\"Please 
specify...\"\r\n                    
            value={otherReason}\r\n 
                               
onChange={(e) => {\r\n              
                      
setOtherReason(e.target.value)\r\n  
                                  
setTouched(prev => ({ ...prev, 
otherReason: false }))\r\n          
                      }}\r\n        
                        
className=\"mt-2\"\r\n              
                  rows={2}\r\n      
                      />\r\n        
                )}\r\n\r\n          
              {((formData.reason 
=== \"Other\" && !otherReason && 
touched.otherReason) || 
(!formData.reason && 
touched.otherReason)) && (\r\n      
                      <p 
className=\"text-xs 
text-destructive mt-1\">can't be 
blank</p>\r\n                       
 )}\r\n                    
</div>\r\n                
</div>\r\n\r\n                
<DialogFooter>\r\n                  
  <Button variant=\"outline\" 
onClick={() => onOpenChange(false)}>
Cancel</Button>\r\n                 
   <Button onClick={handleSave}>Add 
Time</Button>\r\n                
</DialogFooter>\r\n            
</DialogContent>\r\n        
</Dialog>\r\n    )\r\n}\r\n","usedDe
precatedRules":[]},{"filePath":"D:\\
UBIG\\Projek\\Presensi-New\\src\\com
ponents\\timesheets\\EditTimeEntryDi
alog.tsx","messages":[{"ruleId":"pre
fer-const","severity":2,"message":"'
bDiff' is never reassigned. Use 
'const' instead.","line":139,"column
":21,"nodeType":"Identifier","messag
eId":"useConst","endLine":139,"endCo
lumn":26,"fix":{"range":[5045,5090],
"text":"const bDiff = 
differenceInMinutes(bEnd, bStart)"}}
],"suppressedMessages":[],"errorCoun
t":1,"fatalErrorCount":0,"warningCou
nt":0,"fixableErrorCount":1,"fixable
WarningCount":0,"source":"\"use 
client\"\r\n\r\nimport { useState, 
useEffect, useRef } from 
\"react\"\r\nimport { Dialog, 
DialogContent, DialogFooter, 
DialogTitle, DialogHeader } from \"@
/components/ui/dialog\"\r\nimport { 
Button } from \"@/components/ui/butt
on\"\r\nimport { Label } from 
\"@/components/ui/label\"\r\nimport 
{ Input } from 
\"@/components/ui/input\"\r\nimport 
{ Textarea } from \"@/components/ui/
textarea\"\r\nimport { Select, 
SelectContent, SelectItem, 
SelectTrigger, SelectValue } from \"
@/components/ui/select\"\r\nimport 
{ Calendar } from \"@/components/ui/
calendar\"\r\nimport { Popover, 
PopoverContent, PopoverTrigger } 
from \"@/components/ui/popover\"\r\n
import { format, 
differenceInMinutes, parse, 
isValid, isAfter, isBefore } from 
\"date-fns\"\r\nimport { Calendar 
as CalendarIcon, Clock, Plus, 
Trash2, Coffee } from 
\"lucide-react\"\r\nimport { cn } 
from \"@/lib/utils\"\r\nimport { 
DUMMY_PROJECTS, DUMMY_MEMBERS, 
DUMMY_TASKS } from 
\"@/lib/data/dummy-data\"\r\nimport 
type { TimeEntry, Break } from 
\"@/lib/data/dummy-data\"\r\nimport 
{ Avatar, AvatarFallback } from \"@/
components/ui/avatar\"\r\nimport { 
Switch } from \"@/components/ui/swit
ch\"\r\nimport { Checkbox } from \"@
/components/ui/checkbox\"\r\nimport 
{ SplitTimeEntryDialog } from \"./Sp
litTimeEntryDialog\"\r\n\r\ninterfac
e EditTimeEntryDialogProps {\r\n    
open: boolean\r\n    onOpenChange: 
(open: boolean) => void\r\n    
initialData?: TimeEntry | null\r\n  
  onSave: (entry: 
Partial<TimeEntry>) => void\r\n    
isAdmin?: boolean\r\n}\r\n\r\nconst 
REASONS = [\r\n    \"Forgot to 
start timer\",\r\n    \"Technical 
issue\",\r\n    \"Meeting 
offsite\",\r\n    
\"Correction\",\r\n    
\"Other\"\r\n]\r\n\r\nexport 
function EditTimeEntryDialog({\r\n  
  open,\r\n    onOpenChange,\r\n    
initialData,\r\n    onSave,\r\n}: 
EditTimeEntryDialogProps) {\r\n    
const [formData, setFormData] = 
useState<Partial<TimeEntry>>({\r\n  
      memberId: \"\",\r\n        
projectId: \"\",\r\n        taskId: 
\"\",\r\n        date: new Date().to
ISOString().split('T')[0],\r\n      
  startTime: \"09:00\",\r\n        
endTime: \"17:00\",\r\n        
notes: \"\",\r\n        source: 
\"manual\",\r\n        activityPct: 
0,\r\n        billable: true,\r\n   
     reason: \"\",\r\n        
breaks: []\r\n    })\r\n\r\n    
const [date, setDate] = 
useState<Date | undefined>(new 
Date())\r\n    const [touched, 
setTouched] = 
useState<Record<string, 
boolean>>({})\r\n    const 
[otherReason, setOtherReason] = 
useState(\"\")\r\n    const 
[isWorkBreak, setIsWorkBreak] = 
useState(false)\r\n    const 
[breaks, setBreaks] = 
useState<Break[]>([])\r\n    const 
[isSplitOpen, setIsSplitOpen] = 
useState(false)\r\n\r\n    const 
startTimeRef = 
useRef<HTMLInputElement>(null)\r\n  
  const endTimeRef = useRef<HTMLInpu
tElement>(null)\r\n\r\n    // 
Derived member state\r\n    const 
member = DUMMY_MEMBERS.find(m => 
m.id === formData.memberId)\r\n\r\n 
   useEffect(() => {\r\n        if 
(initialData) {\r\n            
setFormData({\r\n                
...initialData,\r\n                
startTime: 
initialData.startTime.slice(0, 
5),\r\n                endTime: 
initialData.endTime.slice(0, 
5),\r\n                taskId: 
initialData.taskId || \"\",\r\n     
           billable: 
initialData.billable ?? true,\r\n   
             reason: 
initialData.reason || \"\"\r\n      
      })\r\n            setDate(new 
Date(initialData.date))\r\n         
   setBreaks(initialData.breaks || 
[])\r\n\r\n            if 
(initialData.reason && !REASONS.incl
udes(initialData.reason) && 
initialData.reason !== \"\") {\r\n  
              setFormData(prev => 
({ ...prev, reason: \"Other\" 
}))\r\n                setOtherReaso
n(initialData.reason)\r\n           
 } else {\r\n                
setOtherReason(\"\")\r\n            
}\r\n\r\n        } else {\r\n       
     const today = new Date()\r\n   
         setFormData({\r\n          
      memberId: 
DUMMY_MEMBERS[0]?.id || \"\",\r\n   
             projectId: \"\",\r\n   
             taskId: \"\",\r\n      
          date: today.toISOString().
split('T')[0],\r\n                
startTime: \"09:00\",\r\n           
     endTime: \"17:00\",\r\n        
        notes: \"\",\r\n            
    source: \"manual\",\r\n         
       activityPct: 0,\r\n          
      billable: true,\r\n           
     reason: \"\",\r\n              
  breaks: []\r\n            })\r\n  
          setDate(today)\r\n        
    setBreaks([])\r\n            
setOtherReason(\"\")\r\n        
}\r\n        setTouched({})\r\n     
   setIsWorkBreak(false)\r\n    }, 
[initialData, open])\r\n\r\n    
useEffect(() => {\r\n        if 
(date) {\r\n            
setFormData(prev => ({ ...prev, 
date: format(date, \"yyyy-MM-dd\") 
}))\r\n        }\r\n    }, 
[date])\r\n\r\n    const 
calculateDuration = () => {\r\n     
   if (!formData.startTime || 
!formData.endTime) return 
\"0:00:00\"\r\n\r\n        const 
start = parse(formData.startTime, 
\"HH:mm\", new Date())\r\n        
const end = parse(formData.endTime, 
\"HH:mm\", new Date())\r\n\r\n      
  if (!isValid(start) || 
!isValid(end)) return 
\"Invalid\"\r\n\r\n        let diff 
= differenceInMinutes(end, 
start)\r\n        if (diff < 0) 
diff += 24 * 60\r\n\r\n        // 
Subtract breaks\r\n        let 
breakMinutes = 0\r\n        
breaks.forEach(b => {\r\n           
 const bStart = parse(b.startTime, 
\"HH:mm\", new Date())\r\n          
  const bEnd = parse(b.endTime, 
\"HH:mm\", new Date())\r\n          
  if (isValid(bStart) && 
isValid(bEnd)) {\r\n                
let bDiff = 
differenceInMinutes(bEnd, 
bStart)\r\n                if 
(bDiff > 0) breakMinutes += 
bDiff\r\n            }\r\n        
})\r\n\r\n        diff -= 
breakMinutes\r\n        if (diff < 
0) diff = 0 // Should enforce 
validation instead, but clamp for 
display\r\n\r\n        const hours 
= Math.floor(diff / 60)\r\n        
const minutes = diff % 60\r\n       
 return `${hours}:${minutes.toString
().padStart(2, '0')}:00`\r\n    
}\r\n\r\n    const isValidTimes = 
() => {\r\n        if 
(!formData.startTime || 
!formData.endTime) return false\r\n 
       const start = 
parse(formData.startTime, 
\"HH:mm\", new Date())\r\n        
const end = parse(formData.endTime, 
\"HH:mm\", new Date())\r\n        
// Basic check\r\n        if 
(!isValid(start) || !isValid(end) 
|| start >= end) return false\r\n   
     return true\r\n    }\r\n\r\n   
 const validateBreaks = () => {\r\n 
       const start = 
parse(formData.startTime!, 
\"HH:mm\", new Date())\r\n        
const end = 
parse(formData.endTime!, \"HH:mm\", 
new Date())\r\n\r\n        for 
(const b of breaks) {\r\n           
 const bStart = parse(b.startTime, 
\"HH:mm\", new Date())\r\n          
  const bEnd = parse(b.endTime, 
\"HH:mm\", new Date())\r\n\r\n      
      if (!isValid(bStart) || 
!isValid(bEnd) || bStart >= bEnd) 
return \"Invalid break times\"\r\n  
          if (isBefore(bStart, 
start) || isAfter(bEnd, end)) 
return \"Break must be within work 
hours\"\r\n        }\r\n        
return null\r\n    }\r\n\r\n    
const handleAddBreak = () => {\r\n  
      setBreaks([...breaks, {\r\n   
         id: 
Math.random().toString(),\r\n       
     startTime: \"12:00\",\r\n      
      endTime: \"12:30\",\r\n       
     notes: \"\"\r\n        }])\r\n 
   }\r\n\r\n    const 
handleRemoveBreak = (id: string) => 
{\r\n        
setBreaks(breaks.filter(b => b.id 
!== id))\r\n    }\r\n\r\n    const 
handleUpdateBreak = (id: string, 
field: keyof Break, value: string) 
=> {\r\n        
setBreaks(breaks.map(b => b.id === 
id ? { ...b, [field]: value } : 
b))\r\n    }\r\n\r\n    const 
handleSave = () => {\r\n        if 
(!formData.projectId) {\r\n         
   setTouched(prev => ({ ...prev, 
projectId: true }))\r\n            
return\r\n        }\r\n        if 
(!isValidTimes()) {\r\n            
setTouched(prev => ({ ...prev, 
time: true }))\r\n            
return\r\n        }\r\n        
const breakError = 
validateBreaks()\r\n        if 
(breakError) {\r\n            // 
Could show toast or error state\r\n 
           alert(breakError)\r\n    
        return\r\n        }\r\n\r\n 
       if (formData.reason === 
\"Other\" && !otherReason.trim()) 
{\r\n            setTouched(prev => 
({ ...prev, otherReason: true 
}))\r\n            return\r\n       
 }\r\n\r\n        const project = 
DUMMY_PROJECTS.find(p => p.id === 
formData.projectId)\r\n        
const task = DUMMY_TASKS.find(t => 
t.id === formData.taskId)\r\n       
 const finalReason = 
formData.reason === \"Other\" ? 
otherReason : 
formData.reason\r\n\r\n        
onSave({\r\n            
...formData,\r\n            
projectName: project?.name,\r\n     
       taskId: formData.taskId || 
undefined,\r\n            taskName: 
task?.title,\r\n            reason: 
finalReason,\r\n            
duration: calculateDuration(),\r\n  
          breaks: breaks\r\n        
})\r\n        
onOpenChange(false)\r\n    
}\r\n\r\n    return (\r\n        
<Dialog open={open} 
onOpenChange={onOpenChange}>\r\n    
        <DialogContent 
className=\"sm:max-w-[600px] 
max-h-[90vh] overflow-y-auto\">\r\n 
               <DialogHeader>\r\n   
                 <DialogTitle>Edit 
time</DialogTitle>\r\n              
  </DialogHeader>\r\n\r\n           
     <div className=\"space-y-6 
py-4\">\r\n                    {/* 
User Info & Break Toggle */}\r\n    
                <div 
className=\"flex items-center 
justify-between\">\r\n              
          <div className=\"flex 
items-center gap-3\">\r\n           
                 <Avatar 
className=\"h-8 w-8\">\r\n          
                      
<AvatarFallback 
className=\"bg-gray-100 
text-gray-500 text-xs 
font-bold\">\r\n                    
                {member?.name?.match
(/\\b(\\w)/g)?.join('')?.substring(0
, 2) || \"U\"}\r\n                  
              </AvatarFallback>\r\n 
                           
</Avatar>\r\n                       
     <span className=\"text-sm 
font-medium\">{member?.name || 
\"User\"}</span>\r\n                
        </div>\r\n                  
      <div className=\"flex 
items-center gap-2\">\r\n           
                 <Switch\r\n        
                        
checked={isWorkBreak}\r\n           
                     onCheckedChange
={setIsWorkBreak}\r\n               
                 
id=\"work-break\"\r\n               
             />\r\n                 
           <Label 
htmlFor=\"work-break\" 
className=\"text-sm font-normal 
text-muted-foreground\">Work 
break</Label>\r\n                   
     </div>\r\n                    
</div>\r\n\r\n                    
{/* Project */}\r\n                 
   <div 
className=\"space-y-2\">\r\n        
                <div 
className=\"text-xs font-semibold te
xt-muted-foreground\">PROJECT*</div>
\r\n                        
<Select\r\n                         
   value={formData.projectId}\r\n   
                         
onValueChange={(v) => {\r\n         
                       
setFormData({ ...formData, 
projectId: v })\r\n                 
               setTouched(prev => 
({ ...prev, projectId: false 
}))\r\n                            
}}\r\n                        >\r\n 
                           
<SelectTrigger 
className={cn(\"w-full\", 
touched.projectId && 
!formData.projectId && 
\"border-destructive\")}>\r\n       
                         
<SelectValue placeholder=\"Select 
project\" />\r\n                    
        </SelectTrigger>\r\n        
                    
<SelectContent>\r\n                 
               
{DUMMY_PROJECTS.map(p => (\r\n      
                              
<SelectItem key={p.id} value={p.id}>
{p.name}</SelectItem>\r\n           
                     ))}\r\n        
                    
</SelectContent>\r\n                
        </Select>\r\n               
         {touched.projectId && 
!formData.projectId && (\r\n        
                    <p 
className=\"text-xs 
text-destructive\">Project is 
required.</p>\r\n                   
     )}\r\n                    
</div>\r\n\r\n                    
{/* Task */}\r\n                    
<div className=\"space-y-2\">\r\n   
                     <div 
className=\"text-xs font-semibold te
xt-muted-foreground\">TASKS</div>\r\
n                        
<Select\r\n                         
   value={formData.taskId || 
\"none\"}\r\n                       
     onValueChange={(v) => 
setFormData({ ...formData, taskId: 
v === \"none\" ? \"\" : v })}\r\n   
                     >\r\n          
                  <SelectTrigger 
className=\"w-full\">\r\n           
                     <SelectValue 
placeholder=\"-- No Task --\" 
/>\r\n                            
</SelectTrigger>\r\n                
            <SelectContent>\r\n     
                           
<SelectItem value=\"none\">-- No 
Task --</SelectItem>\r\n            
                    
{DUMMY_TASKS.map(t => (\r\n         
                           
<SelectItem key={t.id} value={t.id}>
{t.title}</SelectItem>\r\n          
                      ))}\r\n       
                     
</SelectContent>\r\n                
        </Select>\r\n               
     </div>\r\n\r\n                 
   {/* Time Span */}\r\n            
        <div 
className=\"space-y-2\">\r\n        
                <div 
className=\"text-xs font-semibold 
text-muted-foreground\">TIME SPAN 
(+07)*</div>\r\n\r\n                
        <div className=\"flex 
items-center gap-4\">\r\n           
                 <div 
className=\"flex-1\">\r\n           
                     <Popover>\r\n  
                                  
<PopoverTrigger asChild>\r\n        
                                
<Button\r\n                         
                   
variant={\"outline\"}\r\n           
                                 
className={cn(\r\n                  
                              
\"w-full justify-between text-left 
font-normal\",\r\n                  
                              !date 
&& \"text-muted-foreground\"\r\n    
                                    
    )}\r\n                          
              >\r\n                 
                           {date ? 
format(date, \"EEE, MMM d, yyyy\") 
: <span>Pick a date</span>}\r\n     
                                    
   <CalendarIcon className=\"h-4 
w-4 text-muted-foreground\" />\r\n  
                                    
  </Button>\r\n                     
               
</PopoverTrigger>\r\n               
                     
<PopoverContent className=\"w-auto 
p-0\" align=\"start\">\r\n          
                              
<Calendar\r\n                       
                     
mode=\"single\"\r\n                 
                           
selected={date}\r\n                 
                           
onSelect={setDate}\r\n              
                              
initialFocus\r\n                    
                    />\r\n          
                          
</PopoverContent>\r\n               
                 </Popover>\r\n     
                       
</div>\r\n\r\n                      
      <div className=\"flex 
items-center gap-2\">\r\n           
                     <span 
className=\"text-xs font-semibold 
text-muted-foreground 
uppercase\">FROM</span>\r\n         
                       <div 
className=\"relative w-32\">\r\n    
                                
<Input\r\n                          
              
ref={startTimeRef}\r\n              
                          
type=\"time\"\r\n                   
                     step=\"1\"\r\n 
                                    
   value={formData.startTime}\r\n   
                                    
 onChange={e => setFormData({ 
...formData, startTime: 
e.target.value })}\r\n              
                          
className=\"pr-8 [&::-webkit-calenda
r-picker-indicator]:hidden\"\r\n    
                                
/>\r\n                              
      <Clock\r\n                    
                    onClick={() => s
tartTimeRef.current?.showPicker()}\r
\n                                  
      className=\"absolute 
right-2.5 top-1/2 -translate-y-1/2 
h-4 w-4 text-primary cursor-pointer 
hover:text-primary/80\"\r\n         
                           />\r\n   
                             
</div>\r\n                          
  </div>\r\n\r\n                    
        <div className=\"flex 
items-center gap-2\">\r\n           
                     <span 
className=\"text-xs font-semibold 
text-muted-foreground 
uppercase\">TO</span>\r\n           
                     <div 
className=\"relative w-32\">\r\n    
                                
<Input\r\n                          
              ref={endTimeRef}\r\n  
                                    
  type=\"time\"\r\n                 
                       
step=\"1\"\r\n                      
                  
value={formData.endTime}\r\n        
                                
onChange={e => setFormData({ 
...formData, endTime: 
e.target.value })}\r\n              
                          
className=\"pr-8 [&::-webkit-calenda
r-picker-indicator]:hidden\"\r\n    
                                
/>\r\n                              
      <Clock\r\n                    
                    onClick={() => e
ndTimeRef.current?.showPicker()}\r\n
                                    
    className=\"absolute right-2.5 
top-1/2 -translate-y-1/2 h-4 w-4 
text-primary cursor-pointer 
hover:text-primary/80\"\r\n         
                           />\r\n   
                             
</div>\r\n                          
  </div>\r\n                        
</div>\r\n                    
</div>\r\n\r\n                    
{/* Work Breaks Section */}\r\n     
               {isWorkBreak && 
(\r\n                        <div 
className=\"border rounded-lg p-4 
space-y-4 bg-muted/20\">\r\n        
                    <div 
className=\"flex justify-between 
items-center\">\r\n                 
               <div 
className=\"text-xs font-semibold 
text-muted-foreground flex 
items-center gap-2\">\r\n           
                         <Coffee 
className=\"h-4 w-4\" /> BREAKS\r\n 
                               
</div>\r\n                          
      <Button variant=\"ghost\" 
size=\"sm\" 
onClick={handleAddBreak} 
className=\"h-8 text-xs 
text-primary gap-1 
hover:text-primary/80\">\r\n        
                            <Plus 
className=\"h-3 w-3\" /> Add 
Break\r\n                           
     </Button>\r\n                  
          </div>\r\n\r\n            
                {breaks.length === 
0 && (\r\n                          
      <p className=\"text-xs 
text-muted-foreground italic\">No 
breaks added.</p>\r\n               
             )}\r\n\r\n             
               <div 
className=\"space-y-3\">\r\n        
                        
{breaks.map((b) => (\r\n            
                        <div 
key={b.id} className=\"flex gap-2 
items-center\">\r\n                 
                       <Input\r\n   
                                    
     type=\"time\"\r\n              
                              
className=\"h-9 w-28 
bg-background\"\r\n                 
                           
value={b.startTime}\r\n             
                               
onChange={(e) => 
handleUpdateBreak(b.id, 
'startTime', e.target.value)}\r\n   
                                    
 />\r\n                             
           <span className=\"text-mu
ted-foreground\">-</span>\r\n       
                                 
<Input\r\n                          
                  type=\"time\"\r\n 
                                    
       className=\"h-9 w-28 
bg-background\"\r\n                 
                           
value={b.endTime}\r\n               
                             
onChange={(e) => 
handleUpdateBreak(b.id, 'endTime', 
e.target.value)}\r\n                
                        />\r\n      
                                  
<Input\r\n                          
                  
placeholder=\"Notes\"\r\n           
                                 
className=\"h-9 flex-1 
bg-background\"\r\n                 
                           
value={b.notes || \"\"}\r\n         
                                   
onChange={(e) => 
handleUpdateBreak(b.id, 'notes', 
e.target.value)}\r\n                
                        />\r\n      
                                  
<Button variant=\"ghost\" 
size=\"icon\" className=\"h-9 w-9 
text-muted-foreground 
hover:text-destructive\" 
onClick={() => 
handleRemoveBreak(b.id)}>\r\n       
                                    
 <Trash2 className=\"h-4 w-4\" 
/>\r\n                              
          </Button>\r\n             
                       </div>\r\n   
                             
))}\r\n                            
</div>\r\n                        
</div>\r\n                    
)}\r\n\r\n                    {/* 
Billable */}\r\n                    
<div className=\"flex items-center 
justify-between\">\r\n              
          <div className=\"flex 
items-center gap-2\">\r\n           
                 <Checkbox\r\n      
                          
id=\"billable\"\r\n                 
               
checked={formData.billable}\r\n     
                           
onCheckedChange={(c) => 
setFormData({ ...formData, 
billable: c === true })}\r\n        
                    />\r\n          
                  <Label 
htmlFor=\"billable\" 
className=\"font-normal 
text-sm\">Billable</Label>\r\n      
                  </div>\r\n        
            </div>\r\n\r\n          
          {/* Reason */}\r\n        
            <div 
className=\"space-y-2\">\r\n        
                <div 
className={cn(\"text-xs 
font-semibold uppercase\", 
(formData.reason === \"Other\" && 
!otherReason) || !formData.reason ? 
\"text-red-500\" : 
\"text-muted-foreground\")}>\r\n    
                        REASON*\r\n 
                       </div>\r\n   
                     <Select\r\n    
                        
value={formData.reason || \"\"}\r\n 
                           
onValueChange={(v) => {\r\n         
                       
setFormData({ ...formData, reason: 
v === \"none\" ? \"\" : v })\r\n    
                            if (v 
!== \"Other\") 
setOtherReason(\"\")\r\n            
                }}\r\n              
          >\r\n                     
       <SelectTrigger 
className={cn(\"w-full\", 
((formData.reason === \"Other\" && 
!otherReason) || 
(touched.otherReason && 
!formData.reason)) && 
\"border-destructive\")}>\r\n       
                         
<SelectValue placeholder=\"Why are 
you editing this time entry?\" 
/>\r\n                            
</SelectTrigger>\r\n                
            <SelectContent>\r\n     
                           
{REASONS.map(r => (\r\n             
                       <SelectItem 
key={r} 
value={r}>{r}</SelectItem>\r\n      
                          ))}\r\n   
                         
</SelectContent>\r\n                
        </Select>\r\n\r\n           
             {formData.reason === 
\"Other\" && (\r\n                  
          <Textarea\r\n             
                   
placeholder=\"Please 
specify...\"\r\n                    
            value={otherReason}\r\n 
                               
onChange={(e) => {\r\n              
                      
setOtherReason(e.target.value)\r\n  
                                  
setTouched(prev => ({ ...prev, 
otherReason: false }))\r\n          
                      }}\r\n        
                        
className=\"mt-2\"\r\n              
                  rows={2}\r\n      
                      />\r\n        
                )}\r\n\r\n          
              {((formData.reason 
=== \"Other\" && !otherReason && 
touched.otherReason) || 
(!formData.reason && 
touched.otherReason)) && (\r\n      
                      <p 
className=\"text-xs 
text-destructive mt-1\">can&apos;t 
be blank</p>\r\n                    
    )}\r\n                    
</div>\r\n                
</div>\r\n\r\n                
<DialogFooter>\r\n                  
  <Button variant=\"outline\" 
onClick={() => onOpenChange(false)}>
Cancel</Button>\r\n                 
   <Button onClick={handleSave}>Save
</Button>\r\n                
</DialogFooter>\r\n            
</DialogContent>\r\n\r\n            
<SplitTimeEntryDialog\r\n           
     open={isSplitOpen}\r\n         
       
onOpenChange={setIsSplitOpen}\r\n   
             
initialData={initialData as 
any}\r\n                
projects={DUMMY_PROJECTS}\r\n       
         tasks={DUMMY_TASKS}\r\n    
            onSave={(originalId, 
entry1, entry2) => {\r\n            
        console.log(\"Split 
Saved:\", originalId, entry1, 
entry2)\r\n                    // 
In a real app, this would call an 
API to split the entry\r\n          
          onOpenChange(false)\r\n   
             }}\r\n            
/>\r\n        </Dialog>\r\n    )\r\n
}\r\n","usedDeprecatedRules":[]}]

info  - Need to disable some ESLint 
rules? Learn more here: https://next
js.org/docs/app/api-reference/config
/eslint#disabling-rules
